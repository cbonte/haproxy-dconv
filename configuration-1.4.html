<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>HAProxy version 1.4.23 - Configuration Manual</title>
		<link href="bootstrap/css/bootstrap.min.css?0.2.0-2" rel="stylesheet" />
		<link href="css/page.css?0.2.0-2" rel="stylesheet" />
	</head>
	<body>
		<div class="navbar navbar-fixed-top navbar-inverse">
			<div class="navbar-inner">
				<div class="_container">
					<a class="brand" href="#">HAProxy Configuration Manual <small>1.4.23</small></a>
					<ul class="nav">
						<li class="divider-vertical"></li>
						<li><a href="http://haproxy.1wt.eu/">HAProxy home page</a></li>
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown">
								Versions
								<b class="caret"></b>
							</a>
							<ul class="dropdown-menu">
								<li class="dropdown-submenu">
									 <a tabindex="-1" href="#">HAProxy 1.4</a>
									 <ul class="dropdown-menu">
										<li><a href="configuration-1.4.html">Configuration Manual</a></li>
										<li class="divider"></li>
										<li><a href="http://git.1wt.eu/git/haproxy-1.4.git/">GIT Repository</a></li>
										<li><a href="http://haproxy.1wt.eu/git/?p=haproxy-1.4.git">Browse repository</a></li>
										<li><a href="http://haproxy.1wt.eu/download/1.4/">Browse directory</a></li>
									</ul>
								</li>
								<li class="dropdown-submenu">
									 <a tabindex="-1" href="#">HAProxy 1.5</a>
									 <ul class="dropdown-menu">
										<li><a href="configuration-1.5.html">Configuration Manual</a></li>
										<li class="divider"></li>
										<li><a href="http://git.1wt.eu/git/haproxy.git/">GIT Repository</a></li>
										<li><a href="http://haproxy.1wt.eu/git/?p=haproxy.git">Browse repository</a></li>
										<li><a href="http://haproxy.1wt.eu/download/1.5/">Browse directory</a></li>
									</ul>
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<div class="navbar navbar-fixed-bottom navbar-inverse">
			<div class="navbar-inner">
				<ul class="nav">
					<li id="previous"></li>
				</ul>
				<ul class="nav pull-right">
					<li id="next"></li>
				</ul>
			</div>
		</div>
		<div class="affix" id="menu-left">
			<div class="container-fluid">
				<form class="form" onsubmit="search(this.keyword.value); return false">
					<input id="searchKeyword" type="text" name="keyword" class="search-query input-block-level" placeholder="Search keyword" autocomplete="off"/>
				</form>
				<div id="error"></div>
				<p>
					You can use <strong>left</strong> and <strong>right</strong> arrow keys to navigate between chapters.
				</p>
				<p class="text-right">
					<small>Converted with <a href="http://github.com/cbonte/haproxy-dconv">haproxy-dconv</a> v<b>0.2.0-2</b> on <b>2013/04/03</b></small>
				</p>
			</div>
		</div>
		<div class="container-fluid" id="main">
			<div class="row-fluid">
				<div class="span12">
					<div class="well pagination-centered">
						<h1>HAProxy</h1>
						<h2>Configuration Manual</h2>
						<p><strong>version 1.4.23</strong></p>
						<p>
							<a href="http://haproxy.1wt.eu/" title="HAProxy Home Page"><img src="http://haproxy.1wt.eu/img/logo-med.png" /></a><br>
							willy tarreau<br>
							2013/04/03
						</p>
					</div>
					
					<div><pre class="text">This document covers the configuration language as implemented in the version
specified above. It does not provide any hint, example or advice. For such
documentation, please refer to the Reference Manual or the Architecture Manual.
The summary below is meant to help you search sections by name and navigate
through the document.

Note to documentation contributors :
    This document is formated with 80 columns per line, with even number of
    spaces for indentation and without tabs. Please follow these rules strictly
    so that it remains easily printable everywhere. If a line needs to be
    printed verbatim and does not fit, please end each line with a backslash
    ('\') and continue on next line. If you add sections, please update the
    summary below for easier searching.</pre></div>
<a class="anchor" id="summary" name="summary"></a>
<div class="page-header">
	<h1 id="chapter-summary" data-target="summary">Summary</h1>
</div>
<div class="row-fluid">
	<div class="span6">
		
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><b><small>1.</small></b></div>
					<div class="span11 noheight">
							<a href="#1"><b>Quick reminder about HTTP</b></a>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>1.1.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#1.1">The HTTP transaction model</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>1.2.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#1.2">HTTP request</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>1.2.1.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#1.2.1">The Request line</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>1.2.2.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#1.2.2">The request headers</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>1.3.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#1.3">HTTP response</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>1.3.1.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#1.3.1">The Response line</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>1.3.2.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#1.3.2">The response headers</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
					<br />
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><b><small>2.</small></b></div>
					<div class="span11 noheight">
							<a href="#2"><b>Configuring HAProxy</b></a>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>2.1.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#2.1">Configuration file format</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>2.2.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#2.2">Time format</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>2.3.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#2.3">Examples</a>
							</div>
					</div>
				</div>
				
			
				
					<br />
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><b><small>3.</small></b></div>
					<div class="span11 noheight">
							<a href="#3"><b>Global parameters</b></a>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>3.1.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#3.1">Process management and security</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>3.2.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#3.2">Performance tuning</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>3.3.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#3.3">Debugging</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>3.4.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#3.4">Userlists</a>
							</div>
					</div>
				</div>
				
			
				
					<br />
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><b><small>4.</small></b></div>
					<div class="span11 noheight">
							<a href="#4"><b>Proxies</b></a>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>4.1.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#4.1">Proxy keywords matrix</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>4.2.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#4.2">Alphabetically sorted keywords reference</a>
							</div>
					</div>
				</div>
				
			
				
					<br />
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><b><small>5.</small></b></div>
					<div class="span11 noheight">
							<a href="#5"><b>Server and default-server options</b></a>
					</div>
				</div>
				
			
				
					<br />
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><b><small>6.</small></b></div>
					<div class="span11 noheight">
							<a href="#6"><b>HTTP header manipulation</b></a>
					</div>
				</div>
				
			
				
					</div><div class="span6">
					
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><b><small>7.</small></b></div>
					<div class="span11 noheight">
							<a href="#7"><b>Using ACLs and pattern extraction</b></a>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>7.1.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#7.1">Matching integers</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>7.2.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#7.2">Matching strings</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>7.3.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#7.3">Matching regular expressions (regexes)</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>7.4.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#7.4">Matching IPv4 addresses</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>7.5.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#7.5">Available matching criteria</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>7.5.1.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#7.5.1">Matching at Layer 4 and below</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>7.5.2.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#7.5.2">Matching contents at Layer 4</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>7.5.3.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#7.5.3">Matching at Layer 7</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>7.6.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#7.6">Pre-defined ACLs</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>7.7.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#7.7">Using ACLs to form conditions</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>7.8.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#7.8">Pattern extraction</a>
							</div>
					</div>
				</div>
				
			
				
					<br />
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><b><small>8.</small></b></div>
					<div class="span11 noheight">
							<a href="#8"><b>Logging</b></a>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>8.1.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#8.1">Log levels</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>8.2.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#8.2">Log formats</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>8.2.1.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#8.2.1">Default log format</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>8.2.2.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#8.2.2">TCP log format</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>8.2.3.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#8.2.3">HTTP log format</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>8.3.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#8.3">Advanced logging options</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>8.3.1.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#8.3.1">Disabling logging of external tests</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>8.3.2.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#8.3.2">Logging before waiting for the session to terminate</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>8.3.3.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#8.3.3">Raising log level upon errors</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>8.3.4.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#8.3.4">Disabling logging of successful connections</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>8.4.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#8.4">Timing events</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>8.5.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#8.5">Session state at disconnection</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>8.6.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#8.6">Non-printable characters</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>8.7.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#8.7">Capturing HTTP cookies</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>8.8.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#8.8">Capturing HTTP headers</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>8.9.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#8.9">Examples of logs</a>
							</div>
					</div>
				</div>
				
			
				
					<br />
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><b><small>9.</small></b></div>
					<div class="span11 noheight">
							<a href="#9"><b>Statistics and monitoring</b></a>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>9.1.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#9.1">CSV format</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row-fluid">
					<div class="span1 pagination-right noheight"><small>9.2.</small></div>
					<div class="span11 noheight">
							<div class="tab">
							<a href="#9.2">Unix Socket commands</a>
							</div>
					</div>
				</div>
				
	</div>
</div>

<a class="anchor" id="1" name="1"></a>
<div class="page-header"><h1 id="chapter-1" data-target="1"><small><a class="small" href="#1">1.</a></small> Quick reminder about HTTP</h1>
</div><div><pre class="text">When haproxy is running in HTTP mode, both the request and the response are
fully analyzed and indexed, thus it becomes possible to build matching criteria
on almost anything found in the contents.

However, it is important to understand how HTTP requests and responses are
formed, and how HAProxy decomposes them. It will then become easier to write
correct rules and to debug existing configurations.</pre></div>
<a class="anchor" id="1.1" name="1.1"></a>
<h2 id="chapter-1.1" data-target="1.1"><small><a class="small" href="#1.1">1.1.</a></small> The HTTP transaction model</h2>
<div><pre class="text">The HTTP protocol is transaction-driven. This means that each request will lead
to one and only one response. Traditionally, a TCP connection is established
from the client to the server, a request is sent by the client on the
connection, the server responds and the connection is closed. A new request
will involve a new connection :

  [CON1] [REQ1] ... [RESP1] [CLO1] [CON2] [REQ2] ... [RESP2] [CLO2] ...

In this mode, called the &quot;HTTP close&quot; mode, there are as many connection
establishments as there are HTTP transactions. Since the connection is closed
by the server after the response, the client does not need to know the content
length.

Due to the transactional nature of the protocol, it was possible to improve it
to avoid closing a connection between two subsequent transactions. In this mode
however, it is mandatory that the server indicates the content length for each
response so that the client does not wait indefinitely. For this, a special
header is used: &quot;Content-length&quot;. This mode is called the &quot;keep-alive&quot; mode :

  [CON] [REQ1] ... [RESP1] [REQ2] ... [RESP2] [CLO] ...

Its advantages are a reduced latency between transactions, and less processing
power required on the server side. It is generally better than the close mode,
but not always because the clients often limit their concurrent connections to
a smaller value.

A last improvement in the communications is the pipelining mode. It still uses
keep-alive, but the client does not wait for the first response to send the
second request. This is useful for fetching large number of images composing a
page :

  [CON] [REQ1] [REQ2] ... [RESP1] [RESP2] [CLO] ...

This can obviously have a tremendous benefit on performance because the network
latency is eliminated between subsequent requests. Many HTTP agents do not
correctly support pipelining since there is no way to associate a response with
the corresponding request in HTTP. For this reason, it is mandatory for the
server to reply in the exact same order as the requests were received.

By default HAProxy operates in a tunnel-like mode with regards to persistent
connections: for each connection it processes the first request and forwards
everything else (including additional requests) to selected server. Once
established, the connection is persisted both on the client and server
sides. Use &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot; to preserve client persistent connections
while handling every incoming request individually, dispatching them one after
another to servers, in HTTP close mode. Use &quot;<a href="#option%20httpclose">option httpclose</a>&quot; to switch both
sides to HTTP close mode. &quot;<a href="#option%20forceclose">option forceclose</a>&quot; and &quot;option
http-pretend-keepalive&quot; help working around servers misbehaving in HTTP close
mode.</pre></div>
<a class="anchor" id="1.2" name="1.2"></a>
<h2 id="chapter-1.2" data-target="1.2"><small><a class="small" href="#1.2">1.2.</a></small> HTTP request</h2>
<div><pre class="text">First, let's consider this HTTP request :

  Line     Contents
  number
     1     GET /serv/login.php?lang=en&amp;profile=2 HTTP/1.1
     2     Host: www.mydomain.com
     3     User-agent: my small browser
     4     Accept: image/jpeg, image/gif
     5     Accept: image/png</pre></div>
<a class="anchor" id="1.2.1" name="1.2.1"></a>
<h3 id="chapter-1.2.1" data-target="1.2.1"><small><a class="small" href="#1.2.1">1.2.1.</a></small> The Request line</h3>
<div><pre class="text">Line 1 is the &quot;request line&quot;. It is always composed of 3 fields :

  - a METHOD      : GET
  - a URI         : /serv/login.php?lang=en&amp;profile=2
  - a version tag : HTTP/1.1

All of them are delimited by what the standard calls LWS (linear white spaces),
which are commonly spaces, but can also be tabs or line feeds/carriage returns
followed by spaces/tabs. The method itself cannot contain any colon (':') and
is limited to alphabetic letters. All those various combinations make it
desirable that HAProxy performs the splitting itself rather than leaving it to
the user to write a complex or inaccurate regular expression.

The URI itself can have several forms :

  - A &quot;relative URI&quot; :

      /serv/login.php?lang=en&amp;profile=2

    It is a complete URL without the host part. This is generally what is
    received by servers, reverse proxies and transparent proxies.

  - An &quot;absolute URI&quot;, also called a &quot;URL&quot; :

      http://192.168.0.12:8080/serv/login.php?lang=en&amp;profile=2

    It is composed of a &quot;scheme&quot; (the protocol name followed by '://'), a host
    name or address, optionally a colon (':') followed by a port number, then
    a relative URI beginning at the first slash ('/') after the address part.
    This is generally what proxies receive, but a server supporting HTTP/1.1
    must accept this form too.

  - a star ('*') : this form is only accepted in association with the OPTIONS
    method and is not relayable. It is used to inquiry a next hop's
    capabilities.

  - an address:port combination : 192.168.0.12:80
    This is used with the CONNECT method, which is used to establish TCP
    tunnels through HTTP proxies, generally for HTTPS, but sometimes for
    other protocols too.

In a relative URI, two sub-parts are identified. The part before the question
mark is called the &quot;<a href="#path">path</a>&quot;. It is typically the relative path to static objects
on the server. The part after the question mark is called the &quot;query string&quot;.
It is mostly used with GET requests sent to dynamic scripts and is very
specific to the language, framework or application in use.</pre></div>
<a class="anchor" id="1.2.2" name="1.2.2"></a>
<h3 id="chapter-1.2.2" data-target="1.2.2"><small><a class="small" href="#1.2.2">1.2.2.</a></small> The request headers</h3>
<div><pre class="text">The headers start at the second line. They are composed of a name at the
beginning of the line, immediately followed by a colon (':'). Traditionally,
an LWS is added after the colon but that's not required. Then come the values.
Multiple identical headers may be folded into one single line, delimiting the
values with commas, provided that their order is respected. This is commonly
encountered in the &quot;Cookie:&quot; field. A header may span over multiple lines if
the subsequent lines begin with an LWS. In the example in 1.2, lines 4 and 5
define a total of 3 values for the &quot;Accept:&quot; header.

Contrary to a common mis-conception, header names are not case-sensitive, and
their values are not either if they refer to other header names (such as the
&quot;Connection:&quot; header).

The end of the headers is indicated by the first empty line. People often say
that it's a double line feed, which is not exact, even if a double line feed
is one valid form of empty line.

Fortunately, HAProxy takes care of all these complex combinations when indexing
headers, checking values and counting them, so there is no reason to worry
about the way they could be written, but it is important not to accuse an
application of being buggy if it does unusual, valid things.

Important note:
   As suggested by RFC2616, HAProxy normalizes headers by replacing line breaks
   in the middle of headers by LWS in order to join multi-line headers. This
   is necessary for proper analysis and helps less capable HTTP parsers to work
   correctly and not to be fooled by such complex constructs.</pre></div>
<a class="anchor" id="1.3" name="1.3"></a>
<h2 id="chapter-1.3" data-target="1.3"><small><a class="small" href="#1.3">1.3.</a></small> HTTP response</h2>
<div><pre class="text">An HTTP response looks very much like an HTTP request. Both are called HTTP
messages. Let's consider this HTTP response :

  Line     Contents
  number
     1     HTTP/1.1 200 OK
     2     Content-length: 350
     3     Content-Type: text/html

As a special case, HTTP supports so called &quot;Informational responses&quot; as status
codes 1xx. These messages are special in that they don't convey any part of the
response, they're just used as sort of a signaling message to ask a client to
continue to post its request for instance. In the case of a status 100 response
the requested information will be carried by the next non-100 response message
following the informational one. This implies that multiple responses may be
sent to a single request, and that this only works when keep-alive is enabled
(1xx messages are HTTP/1.1 only). HAProxy handles these messages and is able to
correctly forward and skip them, and only process the next non-100 response. As
such, these messages are neither logged nor transformed, unless explicitly
state otherwise. Status 101 messages indicate that the protocol is changing
over the same connection and that haproxy must switch to tunnel mode, just as
if a CONNECT had occurred. Then the Upgrade header would contain additional
information about the type of protocol the connection is switching to.</pre></div>
<a class="anchor" id="1.3.1" name="1.3.1"></a>
<h3 id="chapter-1.3.1" data-target="1.3.1"><small><a class="small" href="#1.3.1">1.3.1.</a></small> The Response line</h3>
<div><pre class="text">Line 1 is the &quot;response line&quot;. It is always composed of 3 fields :

  - a version tag : HTTP/1.1
  - a status code : 200
  - a reason      : OK

The status code is always 3-digit. The first digit indicates a general status :
 - 1xx = informational message to be skipped (eg: 100, 101)
 - 2xx = OK, content is following   (eg: 200, 206)
 - 3xx = OK, no content following   (eg: 302, 304)
 - 4xx = error caused by the client (eg: 401, 403, 404)
 - 5xx = error caused by the server (eg: 500, 502, 503)

Please refer to RFC2616 for the detailed meaning of all such codes. The
&quot;reason&quot; field is just a hint, but is not parsed by clients. Anything can be
found there, but it's a common practice to respect the well-established
messages. It can be composed of one or multiple words, such as &quot;OK&quot;, &quot;Found&quot;,
or &quot;Authentication Required&quot;.

Haproxy may emit the following status codes by itself :

  Code  When / reason
   200  access to stats page, and when replying to monitoring requests
   301  when performing a redirection, depending on the configured code
   302  when performing a redirection, depending on the configured code
   303  when performing a redirection, depending on the configured code
   307  when performing a redirection, depending on the configured code
   308  when performing a redirection, depending on the configured code
   400  for an invalid or too large request
   401  when an authentication is required to perform the action (when
        accessing the stats page)
   403  when a request is forbidden by a &quot;<a href="#block">block</a>&quot; ACL or &quot;<a href="#reqdeny">reqdeny</a>&quot; filter
   408  when the request timeout strikes before the request is complete
   500  when haproxy encounters an unrecoverable internal error, such as a
        memory allocation failure, which should never happen
   502  when the server returns an empty, invalid or incomplete response, or
        when an &quot;<a href="#rspdeny">rspdeny</a>&quot; filter blocks the response.
   503  when no server was available to handle the request, or in response to
        monitoring requests which match the &quot;<a href="#monitor%20fail">monitor fail</a>&quot; condition
   504  when the response timeout strikes before the server responds

The error 4xx and 5xx codes above may be customized (see &quot;<a href="#errorloc">errorloc</a>&quot; in section
4.2).</pre></div>
<a class="anchor" id="1.3.2" name="1.3.2"></a>
<h3 id="chapter-1.3.2" data-target="1.3.2"><small><a class="small" href="#1.3.2">1.3.2.</a></small> The response headers</h3>
<div><pre class="text">Response headers work exactly like request headers, and as such, HAProxy uses
the same parsing function for both. Please refer to paragraph 1.2.2 for more
details.</pre></div>
<a class="anchor" id="2" name="2"></a>
<div class="page-header"><h1 id="chapter-2" data-target="2"><small><a class="small" href="#2">2.</a></small> Configuring HAProxy</h1>
</div><a class="anchor" id="2.1" name="2.1"></a>
<h2 id="chapter-2.1" data-target="2.1"><small><a class="small" href="#2.1">2.1.</a></small> Configuration file format</h2>
<div><pre class="text">HAProxy's configuration process involves 3 major sources of parameters :

  - the arguments from the command-line, which always take precedence
  - the &quot;global&quot; section, which sets process-wide parameters
  - the proxies sections which can take form of &quot;defaults&quot;, &quot;listen&quot;,
    &quot;frontend&quot; and &quot;backend&quot;.

The configuration file syntax consists in lines beginning with a keyword
referenced in this manual, optionally followed by one or several parameters
delimited by spaces. If spaces have to be entered in strings, then they must be
preceded by a backslash ('\') to be escaped. Backslashes also have to be
escaped by doubling them.</pre></div>
<a class="anchor" id="2.2" name="2.2"></a>
<h2 id="chapter-2.2" data-target="2.2"><small><a class="small" href="#2.2">2.2.</a></small> Time format</h2>
<div><pre class="text">Some parameters involve values representing time, such as timeouts. These
values are generally expressed in milliseconds (unless explicitly stated
otherwise) but may be expressed in any other unit by suffixing the unit to the
numeric value. It is important to consider this because it will not be repeated
for every keyword. Supported units are :

  - us : microseconds. 1 microsecond = 1/1000000 second
  - ms : milliseconds. 1 millisecond = 1/1000 second. This is the default.
  - s  : seconds. 1s = 1000ms
  - m  : minutes. 1m = 60s = 60000ms
  - h  : hours.   1h = 60m = 3600s = 3600000ms
  - d  : days.    1d = 24h = 1440m = 86400s = 86400000ms</pre></div>
<a class="anchor" id="2.3" name="2.3"></a>
<h2 id="chapter-2.3" data-target="2.3"><small><a class="small" href="#2.3">2.3.</a></small> Examples</h2>
<div><pre class="text">    # Simple configuration for an HTTP proxy listening on port 80 on all
    # interfaces and forwarding requests to a single backend &quot;servers&quot; with a
    # single server &quot;server1&quot; listening on 127.0.0.1:8000
    global
        daemon
        maxconn 256

    defaults
        mode http
        timeout connect 5000ms
        timeout client 50000ms
        timeout server 50000ms

    frontend http-in
        bind *:80
        default_backend servers

    backend servers
        server server1 127.0.0.1:8000 maxconn 32


    # The same configuration defined with a single listen block. Shorter but
    # less expressive, especially in HTTP mode.
    global
        daemon
        maxconn 256

    defaults
        mode http
        timeout connect 5000ms
        timeout client 50000ms
        timeout server 50000ms

    listen http-in
        bind *:80
        server server1 127.0.0.1:8000 maxconn 32


Assuming haproxy is in $PATH, test these configurations in a shell with:

    $ sudo haproxy -f configuration.conf -c</pre></div>
<a class="anchor" id="3" name="3"></a>
<div class="page-header"><h1 id="chapter-3" data-target="3"><small><a class="small" href="#3">3.</a></small> Global parameters</h1>
</div><div><pre class="text">Parameters in the &quot;global&quot; section are process-wide and often OS-specific. They
are generally set once for all and do not need being changed once correct. Some
of them have command-line equivalents.

The following keywords are supported in the &quot;global&quot; section :

 * Process management and security
   - chroot
   - daemon
   - gid
   - group
   - log
   - log-send-hostname
   - nbproc
   - pidfile
   - uid
   - ulimit-n
   - user
   - stats
   - node
   - description

 * Performance tuning
   - maxconn
   - maxpipes
   - noepoll
   - nokqueue
   - nopoll
   - nosepoll
   - nosplice
   - spread-checks
   - tune.bufsize
   - tune.chksize
   - tune.maxaccept
   - tune.maxpollevents
   - tune.maxrewrite
   - tune.rcvbuf.client
   - tune.rcvbuf.server
   - tune.sndbuf.client
   - tune.sndbuf.server

 * Debugging
   - debug
   - quiet</pre></div>
<a class="anchor" id="3.1" name="3.1"></a>
<h2 id="chapter-3.1" data-target="3.1"><small><a class="small" href="#3.1">3.1.</a></small> Process management and security</h2>
<div><a class="anchor" name="chroot"></a><a class="anchor" name="3-chroot"></a><a class="anchor" name="3.1-chroot"></a><a class="anchor" name="chroot (Global parameters)"></a><a class="anchor" name="chroot (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="chroot"></a><a href="#3-chroot">chroot</a></b> <span style="color: #080">&lt;jail dir&gt;</span></div><pre class="text">Changes current directory to &lt;jail dir&gt; and performs a chroot() there before
dropping privileges. This increases the security level in case an unknown
vulnerability would be exploited, since it would make it very hard for the
attacker to exploit the system. This only works when the process is started
with superuser privileges. It is important to ensure that &lt;jail_dir&gt; is both
empty and unwritable to anyone.</pre><a class="anchor" name="daemon"></a><a class="anchor" name="3-daemon"></a><a class="anchor" name="3.1-daemon"></a><a class="anchor" name="daemon (Global parameters)"></a><a class="anchor" name="daemon (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="daemon"></a><a href="#3-daemon">daemon</a></b></div><pre class="text">Makes the process fork into background. This is the recommended mode of
operation. It is equivalent to the command line &quot;-D&quot; argument. It can be
disabled by the command line &quot;-db&quot; argument.</pre><a class="anchor" name="gid"></a><a class="anchor" name="3-gid"></a><a class="anchor" name="3.1-gid"></a><a class="anchor" name="gid (Global parameters)"></a><a class="anchor" name="gid (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="gid"></a><a href="#3-gid">gid</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Changes the process' group ID to &lt;number&gt;. It is recommended that the group
ID is dedicated to HAProxy or to a small set of similar daemons. HAProxy must
be started with a user belonging to this group, or with superuser privileges.
Note that if haproxy is started from a user having supplementary groups, it
will only be able to drop these groups if started with superuser privileges.
See also &quot;<a href="#group">group</a>&quot; and &quot;<a href="#uid">uid</a>&quot;.</pre><a class="anchor" name="group"></a><a class="anchor" name="3-group"></a><a class="anchor" name="3.1-group"></a><a class="anchor" name="group (Global parameters)"></a><a class="anchor" name="group (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="group"></a><a href="#3-group">group</a></b> <span style="color: #080">&lt;group name&gt;</span></div><pre class="text">Similar to &quot;<a href="#gid">gid</a>&quot; but uses the GID of group name &lt;group name&gt; from /etc/group.
See also &quot;<a href="#gid">gid</a>&quot; and &quot;<a href="#user">user</a>&quot;.</pre><a class="anchor" name="log"></a><a class="anchor" name="3-log"></a><a class="anchor" name="3.1-log"></a><a class="anchor" name="log (Global parameters)"></a><a class="anchor" name="log (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="log"></a><a href="#3-log">log</a></b> <span style="color: #080">&lt;address&gt;</span> <span style="color: #080">&lt;facility&gt;</span> <span style="color: #008">[max level <span style="color: #008">[min level]</span>]</span></div><pre class="text">Adds a global syslog server. Up to two global servers can be defined. They
will receive logs for startups and exits, as well as all logs from proxies
configured with &quot;<a href="#log%20global">log global</a>&quot;.

&lt;address&gt; can be one of:

      - An IPv4 address optionally followed by a colon and a UDP port. If
        no port is specified, 514 is used by default (the standard syslog
        port).

      - A filesystem path to a UNIX domain socket, keeping in mind
        considerations for chroot (be sure the path is accessible inside
        the chroot) and uid/gid (be sure the path is appropriately
        writeable).

&lt;facility&gt; must be one of the 24 standard syslog facilities :

        kern   user   mail   daemon auth   syslog lpr    news
        uucp   cron   auth2  ftp    ntp    audit  alert  cron2
        local0 local1 local2 local3 local4 local5 local6 local7

An optional level can be specified to filter outgoing messages. By default,
all messages are sent. If a maximum level is specified, only messages with a
severity at least as important as this level will be sent. An optional minimum
level can be specified. If it is set, logs emitted with a more severe level
than this one will be capped to this level. This is used to avoid sending
&quot;emerg&quot; messages on all terminals on some default syslog configurations.
Eight levels are known :

        emerg  alert  crit   err    warning notice info  debug</pre><a class="anchor" name="log-send-hostname"></a><a class="anchor" name="3-log-send-hostname"></a><a class="anchor" name="3.1-log-send-hostname"></a><a class="anchor" name="log-send-hostname (Global parameters)"></a><a class="anchor" name="log-send-hostname (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="log-send-hostname"></a><a href="#3-log-send-hostname">log-send-hostname</a></b> <span style="color: #008">[<span style="color: #080">&lt;string&gt;</span>]</span></div><pre class="text">Sets the hostname field in the syslog header. If optional &quot;string&quot; parameter
is set the header is set to the string contents, otherwise uses the hostname
of the system. Generally used if one is not relaying logs through an
intermediate syslog server or for simply customizing the hostname printed in
the logs.</pre><a class="anchor" name="log-tag"></a><a class="anchor" name="3-log-tag"></a><a class="anchor" name="3.1-log-tag"></a><a class="anchor" name="log-tag (Global parameters)"></a><a class="anchor" name="log-tag (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="log-tag"></a><a href="#3-log-tag">log-tag</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">Sets the tag field in the syslog header to this string. It defaults to the
program name as launched from the command line, which usually is &quot;haproxy&quot;.
Sometimes it can be useful to differentiate between multiple processes
running on the same host.</pre><a class="anchor" name="nbproc"></a><a class="anchor" name="3-nbproc"></a><a class="anchor" name="3.1-nbproc"></a><a class="anchor" name="nbproc (Global parameters)"></a><a class="anchor" name="nbproc (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="nbproc"></a><a href="#3-nbproc">nbproc</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Creates &lt;number&gt; processes when going daemon. This requires the &quot;<a href="#daemon">daemon</a>&quot;
mode. By default, only one process is created, which is the recommended mode
of operation. For systems limited to small sets of file descriptors per
process, it may be needed to fork multiple daemons. USING MULTIPLE PROCESSES
IS HARDER TO DEBUG AND IS REALLY DISCOURAGED. See also &quot;<a href="#daemon">daemon</a>&quot;.</pre><a class="anchor" name="pidfile"></a><a class="anchor" name="3-pidfile"></a><a class="anchor" name="3.1-pidfile"></a><a class="anchor" name="pidfile (Global parameters)"></a><a class="anchor" name="pidfile (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="pidfile"></a><a href="#3-pidfile">pidfile</a></b> <span style="color: #080">&lt;pidfile&gt;</span></div><pre class="text">Writes pids of all daemons into file &lt;pidfile&gt;. This option is equivalent to
the &quot;-p&quot; command line argument. The file must be accessible to the user
starting the process. See also &quot;<a href="#daemon">daemon</a>&quot;.</pre><a class="anchor" name="stats"></a><a class="anchor" name="3-stats"></a><a class="anchor" name="3.1-stats"></a><a class="anchor" name="stats (Global parameters)"></a><a class="anchor" name="stats (Process management and security)"></a><a class="anchor" name="stats socket"></a><a class="anchor" name="3-stats socket"></a><a class="anchor" name="3.1-stats socket"></a><a class="anchor" name="stats socket (Global parameters)"></a><a class="anchor" name="stats socket (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="stats socket"></a><a href="#3-stats%20socket">stats socket</a></b> <span style="color: #080">&lt;path&gt;</span> <span style="color: #008">[<span style="color: #800">{uid | user}</span> <span style="color: #080">&lt;uid&gt;</span>]</span> <span style="color: #008">[<span style="color: #800">{gid | group}</span> <span style="color: #080">&lt;gid&gt;</span>]</span> <span style="color: #008">[mode <span style="color: #080">&lt;mode&gt;</span>]</span>
             <span style="color: #008">[level <span style="color: #080">&lt;level&gt;</span>]</span></div><pre class="text">Creates a UNIX socket in stream mode at location &lt;path&gt;. Any previously
existing socket will be backed up then replaced. Connections to this socket
will return various statistics outputs and even allow some commands to be
issued. Please consult <a href="#9.2">section 9.2</a> &quot;Unix Socket commands&quot; for more details.

An optional &quot;level&quot; parameter can be specified to restrict the nature of
the commands that can be issued on the socket :
  - &quot;<a href="#user">user</a>&quot; is the least privileged level ; only non-sensitive stats can be
    read, and no change is allowed. It would make sense on systems where it
    is not easy to restrict access to the socket.

  - &quot;operator&quot; is the default level and fits most common uses. All data can
    be read, and only non-sensitive changes are permitted (eg: clear max
    counters).

  - &quot;admin&quot; should be used with care, as everything is permitted (eg: clear
    all counters).

On platforms which support it, it is possible to restrict access to this
socket by specifying numerical IDs after &quot;<a href="#uid">uid</a>&quot; and &quot;<a href="#gid">gid</a>&quot;, or valid user and
group names after the &quot;<a href="#user">user</a>&quot; and &quot;<a href="#group">group</a>&quot; keywords. It is also possible to
restrict permissions on the socket by passing an octal value after the &quot;<a href="#mode">mode</a>&quot;
keyword (same syntax as chmod). Depending on the platform, the permissions on
the socket will be inherited from the directory which hosts it, or from the
user the process is started with.</pre><a class="anchor" name="stats"></a><a class="anchor" name="3-stats"></a><a class="anchor" name="3.1-stats"></a><a class="anchor" name="stats (Global parameters)"></a><a class="anchor" name="stats (Process management and security)"></a><a class="anchor" name="stats timeout"></a><a class="anchor" name="3-stats timeout"></a><a class="anchor" name="3.1-stats timeout"></a><a class="anchor" name="stats timeout (Global parameters)"></a><a class="anchor" name="stats timeout (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="stats timeout"></a><a href="#3-stats%20timeout">stats timeout</a></b> <span style="color: #080">&lt;timeout, in milliseconds&gt;</span></div><pre class="text">The default timeout on the stats socket is set to 10 seconds. It is possible
to change this value with &quot;<a href="#stats%20timeout">stats timeout</a>&quot;. The value must be passed in
milliseconds, or be suffixed by a time unit among { us, ms, s, m, h, d }.</pre><a class="anchor" name="stats"></a><a class="anchor" name="3-stats"></a><a class="anchor" name="3.1-stats"></a><a class="anchor" name="stats (Global parameters)"></a><a class="anchor" name="stats (Process management and security)"></a><a class="anchor" name="stats maxconn"></a><a class="anchor" name="3-stats maxconn"></a><a class="anchor" name="3.1-stats maxconn"></a><a class="anchor" name="stats maxconn (Global parameters)"></a><a class="anchor" name="stats maxconn (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="stats maxconn"></a><a href="#3-stats%20maxconn">stats maxconn</a></b> <span style="color: #080">&lt;connections&gt;</span></div><pre class="text">By default, the stats socket is limited to 10 concurrent connections. It is
possible to change this value with &quot;<a href="#stats%20maxconn">stats maxconn</a>&quot;.</pre><a class="anchor" name="uid"></a><a class="anchor" name="3-uid"></a><a class="anchor" name="3.1-uid"></a><a class="anchor" name="uid (Global parameters)"></a><a class="anchor" name="uid (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="uid"></a><a href="#3-uid">uid</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Changes the process' user ID to &lt;number&gt;. It is recommended that the user ID
is dedicated to HAProxy or to a small set of similar daemons. HAProxy must
be started with superuser privileges in order to be able to switch to another
one. See also &quot;<a href="#gid">gid</a>&quot; and &quot;<a href="#user">user</a>&quot;.</pre><a class="anchor" name="ulimit-n"></a><a class="anchor" name="3-ulimit-n"></a><a class="anchor" name="3.1-ulimit-n"></a><a class="anchor" name="ulimit-n (Global parameters)"></a><a class="anchor" name="ulimit-n (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="ulimit-n"></a><a href="#3-ulimit-n">ulimit-n</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the maximum number of per-process file-descriptors to &lt;number&gt;. By
default, it is automatically computed, so it is recommended not to use this
option.</pre><a class="anchor" name="user"></a><a class="anchor" name="3-user"></a><a class="anchor" name="3.1-user"></a><a class="anchor" name="user (Global parameters)"></a><a class="anchor" name="user (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="user"></a><a href="#3-user">user</a></b> <span style="color: #080">&lt;user name&gt;</span></div><pre class="text">Similar to &quot;<a href="#uid">uid</a>&quot; but uses the UID of user name &lt;user name&gt; from /etc/passwd.
See also &quot;<a href="#uid">uid</a>&quot; and &quot;<a href="#group">group</a>&quot;.</pre><a class="anchor" name="node"></a><a class="anchor" name="3-node"></a><a class="anchor" name="3.1-node"></a><a class="anchor" name="node (Global parameters)"></a><a class="anchor" name="node (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="node"></a><a href="#3-node">node</a></b> <span style="color: #080">&lt;name&gt;</span></div><pre class="text">Only letters, digits, hyphen and underscore are allowed, like in DNS names.

This statement is useful in HA configurations where two or more processes or
servers share the same IP address. By setting a different node-name on all
nodes, it becomes easy to immediately spot what server is handling the
traffic.</pre><a class="anchor" name="description"></a><a class="anchor" name="3-description"></a><a class="anchor" name="3.1-description"></a><a class="anchor" name="description (Global parameters)"></a><a class="anchor" name="description (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="description"></a><a href="#3-description">description</a></b> <span style="color: #080">&lt;text&gt;</span></div><pre class="text">Add a text that describes the instance.

Please note that it is required to escape certain characters (# for example)
and this text is inserted into a html page so you should avoid using
&quot;&lt;&quot; and &quot;&gt;&quot; characters.</pre></div>
<a class="anchor" id="3.2" name="3.2"></a>
<h2 id="chapter-3.2" data-target="3.2"><small><a class="small" href="#3.2">3.2.</a></small> Performance tuning</h2>
<div><a class="anchor" name="maxconn"></a><a class="anchor" name="3-maxconn"></a><a class="anchor" name="3.2-maxconn"></a><a class="anchor" name="maxconn (Global parameters)"></a><a class="anchor" name="maxconn (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="maxconn"></a><a href="#3-maxconn">maxconn</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the maximum per-process number of concurrent connections to &lt;number&gt;. It
is equivalent to the command-line argument &quot;-n&quot;. Proxies will stop accepting
connections when this limit is reached. The &quot;<a href="#ulimit-n">ulimit-n</a>&quot; parameter is
automatically adjusted according to this value. See also &quot;<a href="#ulimit-n">ulimit-n</a>&quot;.</pre><a class="anchor" name="maxpipes"></a><a class="anchor" name="3-maxpipes"></a><a class="anchor" name="3.2-maxpipes"></a><a class="anchor" name="maxpipes (Global parameters)"></a><a class="anchor" name="maxpipes (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="maxpipes"></a><a href="#3-maxpipes">maxpipes</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the maximum per-process number of pipes to &lt;number&gt;. Currently, pipes
are only used by kernel-based tcp splicing. Since a pipe contains two file
descriptors, the &quot;<a href="#ulimit-n">ulimit-n</a>&quot; value will be increased accordingly. The default
value is maxconn/4, which seems to be more than enough for most heavy usages.
The splice code dynamically allocates and releases pipes, and can fall back
to standard copy, so setting this value too low may only impact performance.</pre><a class="anchor" name="noepoll"></a><a class="anchor" name="3-noepoll"></a><a class="anchor" name="3.2-noepoll"></a><a class="anchor" name="noepoll (Global parameters)"></a><a class="anchor" name="noepoll (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="noepoll"></a><a href="#3-noepoll">noepoll</a></b></div><pre class="text">Disables the use of the &quot;epoll&quot; event polling system on Linux. It is
equivalent to the command-line argument &quot;-de&quot;. The next polling system
used will generally be &quot;poll&quot;. See also &quot;<a href="#nosepoll">nosepoll</a>&quot;, and &quot;<a href="#nopoll">nopoll</a>&quot;.</pre><a class="anchor" name="nokqueue"></a><a class="anchor" name="3-nokqueue"></a><a class="anchor" name="3.2-nokqueue"></a><a class="anchor" name="nokqueue (Global parameters)"></a><a class="anchor" name="nokqueue (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="nokqueue"></a><a href="#3-nokqueue">nokqueue</a></b></div><pre class="text">Disables the use of the &quot;kqueue&quot; event polling system on BSD. It is
equivalent to the command-line argument &quot;-dk&quot;. The next polling system
used will generally be &quot;poll&quot;. See also &quot;<a href="#nopoll">nopoll</a>&quot;.</pre><a class="anchor" name="nopoll"></a><a class="anchor" name="3-nopoll"></a><a class="anchor" name="3.2-nopoll"></a><a class="anchor" name="nopoll (Global parameters)"></a><a class="anchor" name="nopoll (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="nopoll"></a><a href="#3-nopoll">nopoll</a></b></div><pre class="text">Disables the use of the &quot;poll&quot; event polling system. It is equivalent to the
command-line argument &quot;-dp&quot;. The next polling system used will be &quot;select&quot;.
It should never be needed to disable &quot;poll&quot; since it's available on all
platforms supported by HAProxy. See also &quot;<a href="#nosepoll">nosepoll</a>&quot;, and &quot;<a href="#nopoll">nopoll</a>&quot; and
&quot;<a href="#nokqueue">nokqueue</a>&quot;.</pre><a class="anchor" name="nosepoll"></a><a class="anchor" name="3-nosepoll"></a><a class="anchor" name="3.2-nosepoll"></a><a class="anchor" name="nosepoll (Global parameters)"></a><a class="anchor" name="nosepoll (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="nosepoll"></a><a href="#3-nosepoll">nosepoll</a></b></div><pre class="text">Disables the use of the &quot;speculative epoll&quot; event polling system on Linux. It
is equivalent to the command-line argument &quot;-ds&quot;. The next polling system
used will generally be &quot;epoll&quot;. See also &quot;<a href="#nosepoll">nosepoll</a>&quot;, and &quot;<a href="#nopoll">nopoll</a>&quot;.</pre><a class="anchor" name="nosplice"></a><a class="anchor" name="3-nosplice"></a><a class="anchor" name="3.2-nosplice"></a><a class="anchor" name="nosplice (Global parameters)"></a><a class="anchor" name="nosplice (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="nosplice"></a><a href="#3-nosplice">nosplice</a></b></div><pre class="text">Disables the use of kernel tcp splicing between sockets on Linux. It is
equivalent to the command line argument &quot;-dS&quot;.  Data will then be copied
using conventional and more portable recv/send calls. Kernel tcp splicing is
limited to some very recent instances of kernel 2.6. Most versions between
2.6.25 and 2.6.28 are buggy and will forward corrupted data, so they must not
be used. This option makes it easier to globally disable kernel splicing in
case of doubt. See also &quot;<a href="#option%20splice-auto">option splice-auto</a>&quot;, &quot;<a href="#option%20splice-request">option splice-request</a>&quot; and
&quot;<a href="#option%20splice-response">option splice-response</a>&quot;.</pre><a class="anchor" name="spread-checks"></a><a class="anchor" name="3-spread-checks"></a><a class="anchor" name="3.2-spread-checks"></a><a class="anchor" name="spread-checks (Global parameters)"></a><a class="anchor" name="spread-checks (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="spread-checks"></a><a href="#3-spread-checks">spread-checks</a></b> <span style="color: #080">&lt;0..50, in percent&gt;</span></div><pre class="text">Sometimes it is desirable to avoid sending health checks to servers at exact
intervals, for instance when many logical servers are located on the same
physical server. With the help of this parameter, it becomes possible to add
some randomness in the check interval between 0 and +/- 50%. A value between
2 and 5 seems to show good results. The default value remains at 0.</pre><a class="anchor" name="tune.bufsize"></a><a class="anchor" name="3-tune.bufsize"></a><a class="anchor" name="3.2-tune.bufsize"></a><a class="anchor" name="tune.bufsize (Global parameters)"></a><a class="anchor" name="tune.bufsize (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.bufsize"></a><a href="#3-tune.bufsize">tune.bufsize</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the buffer size to this size (in bytes). Lower values allow more
sessions to coexist in the same amount of RAM, and higher values allow some
applications with very large cookies to work. The default value is 16384 and
can be changed at build time. It is strongly recommended not to change this
from the default value, as very low values will break some services such as
statistics, and values larger than default size will increase memory usage,
possibly causing the system to run out of memory. At least the global maxconn
parameter should be decreased by the same factor as this one is increased.</pre><a class="anchor" name="tune.chksize"></a><a class="anchor" name="3-tune.chksize"></a><a class="anchor" name="3.2-tune.chksize"></a><a class="anchor" name="tune.chksize (Global parameters)"></a><a class="anchor" name="tune.chksize (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.chksize"></a><a href="#3-tune.chksize">tune.chksize</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the check buffer size to this size (in bytes). Higher values may help
find string or regex patterns in very large pages, though doing so may imply
more memory and CPU usage. The default value is 16384 and can be changed at
build time. It is not recommended to change this value, but to use better
checks whenever possible.</pre><a class="anchor" name="tune.maxaccept"></a><a class="anchor" name="3-tune.maxaccept"></a><a class="anchor" name="3.2-tune.maxaccept"></a><a class="anchor" name="tune.maxaccept (Global parameters)"></a><a class="anchor" name="tune.maxaccept (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.maxaccept"></a><a href="#3-tune.maxaccept">tune.maxaccept</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the maximum number of consecutive accepts that a process may perform on
a single wake up. High values give higher priority to high connection rates,
while lower values give higher priority to already established connections.
This value is limited to 100 by default in single process mode. However, in
multi-process mode (nbproc &gt; 1), it defaults to 8 so that when one process
wakes up, it does not take all incoming connections for itself and leaves a
part of them to other processes. Setting this value to -1 completely disables
the limitation. It should normally not be needed to tweak this value.</pre><a class="anchor" name="tune.maxpollevents"></a><a class="anchor" name="3-tune.maxpollevents"></a><a class="anchor" name="3.2-tune.maxpollevents"></a><a class="anchor" name="tune.maxpollevents (Global parameters)"></a><a class="anchor" name="tune.maxpollevents (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.maxpollevents"></a><a href="#3-tune.maxpollevents">tune.maxpollevents</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the maximum amount of events that can be processed at once in a call to
the polling system. The default value is adapted to the operating system. It
has been noticed that reducing it below 200 tends to slightly decrease
latency at the expense of network bandwidth, and increasing it above 200
tends to trade latency for slightly increased bandwidth.</pre><a class="anchor" name="tune.maxrewrite"></a><a class="anchor" name="3-tune.maxrewrite"></a><a class="anchor" name="3.2-tune.maxrewrite"></a><a class="anchor" name="tune.maxrewrite (Global parameters)"></a><a class="anchor" name="tune.maxrewrite (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.maxrewrite"></a><a href="#3-tune.maxrewrite">tune.maxrewrite</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the reserved buffer space to this size in bytes. The reserved space is
used for header rewriting or appending. The first reads on sockets will never
fill more than bufsize-maxrewrite. Historically it has defaulted to half of
bufsize, though that does not make much sense since there are rarely large
numbers of headers to add. Setting it too high prevents processing of large
requests or responses. Setting it too low prevents addition of new headers
to already large requests or to POST requests. It is generally wise to set it
to about 1024. It is automatically readjusted to half of bufsize if it is
larger than that. This means you don't have to worry about it when changing
bufsize.</pre><a class="anchor" name="tune.rcvbuf.client"></a><a class="anchor" name="3-tune.rcvbuf.client"></a><a class="anchor" name="3.2-tune.rcvbuf.client"></a><a class="anchor" name="tune.rcvbuf.client (Global parameters)"></a><a class="anchor" name="tune.rcvbuf.client (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.rcvbuf.client"></a><a href="#3-tune.rcvbuf.client">tune.rcvbuf.client</a></b> <span style="color: #080">&lt;number&gt;</span></div><a class="anchor" name="tune.rcvbuf.server"></a><a class="anchor" name="3-tune.rcvbuf.server"></a><a class="anchor" name="3.2-tune.rcvbuf.server"></a><a class="anchor" name="tune.rcvbuf.server (Global parameters)"></a><a class="anchor" name="tune.rcvbuf.server (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.rcvbuf.server"></a><a href="#3-tune.rcvbuf.server">tune.rcvbuf.server</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Forces the kernel socket receive buffer size on the client or the server side
to the specified value in bytes. This value applies to all TCP/HTTP frontends
and backends. It should normally never be set, and the default size (0) lets
the kernel autotune this value depending on the amount of available memory.
However it can sometimes help to set it to very low values (eg: 4096) in
order to save kernel memory by preventing it from buffering too large amounts
of received data. Lower values will significantly increase CPU usage though.</pre><a class="anchor" name="tune.sndbuf.client"></a><a class="anchor" name="3-tune.sndbuf.client"></a><a class="anchor" name="3.2-tune.sndbuf.client"></a><a class="anchor" name="tune.sndbuf.client (Global parameters)"></a><a class="anchor" name="tune.sndbuf.client (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.sndbuf.client"></a><a href="#3-tune.sndbuf.client">tune.sndbuf.client</a></b> <span style="color: #080">&lt;number&gt;</span></div><a class="anchor" name="tune.sndbuf.server"></a><a class="anchor" name="3-tune.sndbuf.server"></a><a class="anchor" name="3.2-tune.sndbuf.server"></a><a class="anchor" name="tune.sndbuf.server (Global parameters)"></a><a class="anchor" name="tune.sndbuf.server (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.sndbuf.server"></a><a href="#3-tune.sndbuf.server">tune.sndbuf.server</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Forces the kernel socket send buffer size on the client or the server side to
the specified value in bytes. This value applies to all TCP/HTTP frontends
and backends. It should normally never be set, and the default size (0) lets
the kernel autotune this value depending on the amount of available memory.
However it can sometimes help to set it to very low values (eg: 4096) in
order to save kernel memory by preventing it from buffering too large amounts
of received data. Lower values will significantly increase CPU usage though.
Another use case is to prevent write timeouts with extremely slow clients due
to the kernel waiting for a large part of the buffer to be read before
notifying haproxy again.</pre></div>
<a class="anchor" id="3.3" name="3.3"></a>
<h2 id="chapter-3.3" data-target="3.3"><small><a class="small" href="#3.3">3.3.</a></small> Debugging</h2>
<div><a class="anchor" name="debug"></a><a class="anchor" name="3-debug"></a><a class="anchor" name="3.3-debug"></a><a class="anchor" name="debug (Global parameters)"></a><a class="anchor" name="debug (Debugging)"></a><div class="keyword"><b><a class="anchor" name="debug"></a><a href="#3-debug">debug</a></b></div><pre class="text">Enables debug mode which dumps to stdout all exchanges, and disables forking
into background. It is the equivalent of the command-line argument &quot;-d&quot;. It
should never be used in a production configuration since it may prevent full
system startup.</pre><a class="anchor" name="quiet"></a><a class="anchor" name="3-quiet"></a><a class="anchor" name="3.3-quiet"></a><a class="anchor" name="quiet (Global parameters)"></a><a class="anchor" name="quiet (Debugging)"></a><div class="keyword"><b><a class="anchor" name="quiet"></a><a href="#3-quiet">quiet</a></b></div><pre class="text">Do not display any message during startup. It is equivalent to the command-
line argument &quot;-q&quot;.</pre></div>
<a class="anchor" id="3.4" name="3.4"></a>
<h2 id="chapter-3.4" data-target="3.4"><small><a class="small" href="#3.4">3.4.</a></small> Userlists</h2>
<div><pre class="text">It is possible to control access to frontend/backend/listen sections or to
http stats by allowing only authenticated and authorized users. To do this,
it is required to create at least one userlist and to define users.</pre><a class="anchor" name="userlist"></a><a class="anchor" name="3-userlist"></a><a class="anchor" name="3.4-userlist"></a><a class="anchor" name="userlist (Global parameters)"></a><a class="anchor" name="userlist (Userlists)"></a><div class="keyword"><b><a class="anchor" name="userlist"></a><a href="#3-userlist">userlist</a></b> <span style="color: #080">&lt;listname&gt;</span></div><pre class="text">Creates new userlist with name &lt;listname&gt;. Many independent userlists can be
used to store authentication &amp; authorization data for independent customers.</pre><a class="anchor" name="group"></a><a class="anchor" name="3-group"></a><a class="anchor" name="3.4-group"></a><a class="anchor" name="group (Global parameters)"></a><a class="anchor" name="group (Userlists)"></a><div class="keyword"><b><a class="anchor" name="group"></a><a href="#3-group">group</a></b> <span style="color: #080">&lt;groupname&gt;</span> <span style="color: #008">[users <span style="color: #080">&lt;user&gt;</span>,<span style="color: #080">&lt;user&gt;</span>,(...)]</span></div><pre class="text">Adds group &lt;groupname&gt; to the current userlist. It is also possible to
attach users to this group by using a comma separated list of names
proceeded by &quot;users&quot; keyword.</pre><a class="anchor" name="user"></a><a class="anchor" name="3-user"></a><a class="anchor" name="3.4-user"></a><a class="anchor" name="user (Global parameters)"></a><a class="anchor" name="user (Userlists)"></a><div class="keyword"><b><a class="anchor" name="user"></a><a href="#3-user">user</a></b> <span style="color: #080">&lt;username&gt;</span> <span style="color: #008">[password|insecure-password <span style="color: #080">&lt;password&gt;</span>]</span>
                <span style="color: #008">[groups <span style="color: #080">&lt;group&gt;</span>,<span style="color: #080">&lt;group&gt;</span>,(...)]</span></div><pre class="text">Adds user &lt;username&gt; to the current userlist. Both secure (encrypted) and
insecure (unencrypted) passwords can be used. Encrypted passwords are
evaluated using the crypt(3) function so depending of the system's
capabilities, different algorithms are supported. For example modern Glibc
based Linux system supports MD5, SHA-256, SHA-512 and of course classic,
DES-based method of crypting passwords.</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>userlist L1
  group G1 users tiger,scott
  group G2 users xdb,scott

  user tiger password $6$k6y3o.eP$JlKBx9za9667qe4(...)xHSwRv6J.C0/D7cV91
  user scott insecure-password elgato
  user xdb insecure-password hello

userlist L2
  group G1
  group G2

  user tiger password $6$k6y3o.eP$JlKBx(...)xHSwRv6J.C0/D7cV91 groups G1
  user scott insecure-password elgato groups G1,G2
  user xdb insecure-password hello groups G2
</code></pre>
</div><pre class="text">Please note that both lists are functionally identical.</pre></div>
<a class="anchor" id="4" name="4"></a>
<div class="page-header"><h1 id="chapter-4" data-target="4"><small><a class="small" href="#4">4.</a></small> Proxies</h1>
</div><div><pre class="text">Proxy configuration can be located in a set of sections :
 - defaults &lt;name&gt;
 - frontend &lt;name&gt;
 - backend  &lt;name&gt;
 - listen   &lt;name&gt;

A &quot;defaults&quot; section sets default parameters for all other sections following
its declaration. Those default parameters are reset by the next &quot;defaults&quot;
section. See below for the list of parameters which can be set in a &quot;defaults&quot;
section. The name is optional but its use is encouraged for better readability.

A &quot;frontend&quot; section describes a set of listening sockets accepting client
connections.

A &quot;backend&quot; section describes a set of servers to which the proxy will connect
to forward incoming connections.

A &quot;listen&quot; section defines a complete proxy with its frontend and backend
parts combined in one section. It is generally useful for TCP-only traffic.

All proxy names must be formed from upper and lower case letters, digits,
'-' (dash), '_' (underscore) , '.' (dot) and ':' (colon). ACL names are
case-sensitive, which means that &quot;www&quot; and &quot;WWW&quot; are two different proxies.

Historically, all proxy names could overlap, it just caused troubles in the
logs. Since the introduction of content switching, it is mandatory that two
proxies with overlapping capabilities (frontend/backend) have different names.
However, it is still permitted that a frontend and a backend share the same
name, as this configuration seems to be commonly encountered.

Right now, two major proxy modes are supported : &quot;tcp&quot;, also known as layer 4,
and &quot;http&quot;, also known as layer 7. In layer 4 mode, HAProxy simply forwards
bidirectional traffic between two sides. In layer 7 mode, HAProxy analyzes the
protocol, and can interact with it by allowing, blocking, switching, adding,
modifying, or removing arbitrary contents in requests or responses, based on
arbitrary criteria.</pre></div>
<a class="anchor" id="4.1" name="4.1"></a>
<h2 id="chapter-4.1" data-target="4.1"><small><a class="small" href="#4.1">4.1.</a></small> Proxy keywords matrix</h2>
<div><pre class="text">The following list of keywords is supported. Most of them may only be used in a
limited set of section types. Some of them are marked as &quot;deprecated&quot; because
they are inherited from an old syntax which may be confusing or functionally
limited, and there are new recommended keywords to replace them. Keywords
marked with &quot;(*)&quot; can be optionally inverted using the &quot;no&quot; prefix, eg. &quot;no
option contstats&quot;. This makes sense when the option has been enabled by default
and must be disabled for a specific instance. Such options may also be prefixed
with &quot;default&quot; in order to restore default settings regardless of what has been
specified in a previous &quot;defaults&quot; section.</pre><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>keyword</th><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td None><a href="#4-acl">acl</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-appsession">appsession</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-backlog">backlog</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-balance">balance</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-bind">bind</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-bind-process">bind-process</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-block">block</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-capture%20cookie">capture cookie</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-capture%20request%20header">capture request header</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-capture%20response%20header">capture response header</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-clitimeout"><span class="pull-right"><span class="label label-warning">(deprecated)</span></span>clitimeout</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-contimeout"><span class="pull-right"><span class="label label-warning">(deprecated)</span></span>contimeout</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-cookie">cookie</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-default-server">default-server</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-default_backend">default_backend</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-description">description</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-disabled">disabled</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-dispatch">dispatch</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-enabled">enabled</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-errorfile">errorfile</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<thead><tr><th>keyword</th><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td None><a href="#4-errorloc">errorloc</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-errorloc302">errorloc302</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-errorloc303">errorloc303</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-force-persist">force-persist</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-fullconn">fullconn</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-grace">grace</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-hash-type">hash-type</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-http-check%20disable-on-404">http-check disable-on-404</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-http-check%20expect">http-check expect</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-http-check%20send-state">http-check send-state</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-http-request">http-request</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-id">id</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-ignore-persist">ignore-persist</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-log">log</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-maxconn">maxconn</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-mode">mode</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-monitor%20fail">monitor fail</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-monitor-net">monitor-net</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-monitor-uri">monitor-uri</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-option%20abortonclose"><span class="pull-right"><span>(*)</span></span>option abortonclose</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<thead><tr><th>keyword</th><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td None><a href="#4-option%20accept-invalid-http-request"><span class="pull-right"><span>(*)</span></span>option accept-invalid-http-request</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-option%20accept-invalid-http-response"><span class="pull-right"><span>(*)</span></span>option accept-invalid-http-response</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20allbackups"><span class="pull-right"><span>(*)</span></span>option allbackups</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20checkcache"><span class="pull-right"><span>(*)</span></span>option checkcache</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20clitcpka"><span class="pull-right"><span>(*)</span></span>option clitcpka</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-option%20contstats"><span class="pull-right"><span>(*)</span></span>option contstats</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-option%20dontlog-normal"><span class="pull-right"><span>(*)</span></span>option dontlog-normal</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-option%20dontlognull"><span class="pull-right"><span>(*)</span></span>option dontlognull</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-option%20forceclose"><span class="pull-right"><span>(*)</span></span>option forceclose</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20forwardfor">option forwardfor</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20http-no-delay"><span class="pull-right"><span>(*)</span></span>option http-no-delay</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20http-pretend-keepalive"><span class="pull-right"><span>(*)</span></span>option http-pretend-keepalive</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20http-server-close"><span class="pull-right"><span>(*)</span></span>option http-server-close</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20http-use-proxy-header"><span class="pull-right"><span>(*)</span></span>option http-use-proxy-header</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-option%20httpchk">option httpchk</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20httpclose"><span class="pull-right"><span>(*)</span></span>option httpclose</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20httplog">option httplog</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20http_proxy"><span class="pull-right"><span>(*)</span></span>option http_proxy</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20independant-streams"><span class="pull-right"><span>(*)</span></span>option independant-streams</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20ldap-check">option ldap-check</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<thead><tr><th>keyword</th><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td None><a href="#4-option%20log-health-checks"><span class="pull-right"><span>(*)</span></span>option log-health-checks</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20log-separate-errors"><span class="pull-right"><span>(*)</span></span>option log-separate-errors</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-option%20logasap"><span class="pull-right"><span>(*)</span></span>option logasap</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-option%20mysql-check">option mysql-check</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20nolinger"><span class="pull-right"><span>(*)</span></span>option nolinger</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20originalto">option originalto</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20persist"><span class="pull-right"><span>(*)</span></span>option persist</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20redispatch"><span class="pull-right"><span>(*)</span></span>option redispatch</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20smtpchk">option smtpchk</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20socket-stats"><span class="pull-right"><span>(*)</span></span>option socket-stats</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-option%20splice-auto"><span class="pull-right"><span>(*)</span></span>option splice-auto</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20splice-request"><span class="pull-right"><span>(*)</span></span>option splice-request</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20splice-response"><span class="pull-right"><span>(*)</span></span>option splice-response</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20srvtcpka"><span class="pull-right"><span>(*)</span></span>option srvtcpka</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20ssl-hello-chk">option ssl-hello-chk</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20tcp-smart-accept"><span class="pull-right"><span>(*)</span></span>option tcp-smart-accept</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-option%20tcp-smart-connect"><span class="pull-right"><span>(*)</span></span>option tcp-smart-connect</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20tcpka">option tcpka</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20tcplog">option tcplog</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20transparent"><span class="pull-right"><span>(*)</span></span>option transparent</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<thead><tr><th>keyword</th><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td None><a href="#4-persist%20rdp-cookie">persist rdp-cookie</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-rate-limit%20sessions">rate-limit sessions</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-redirect">redirect</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-redisp"><span class="pull-right"><span class="label label-warning">(deprecated)</span></span>redisp</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-redispatch"><span class="pull-right"><span class="label label-warning">(deprecated)</span></span>redispatch</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqadd">reqadd</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqallow">reqallow</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqdel">reqdel</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqdeny">reqdeny</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqiallow">reqiallow</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqidel">reqidel</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqideny">reqideny</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqipass">reqipass</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqirep">reqirep</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqisetbe">reqisetbe</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqitarpit">reqitarpit</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqpass">reqpass</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqrep">reqrep</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqsetbe">reqsetbe</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqtarpit">reqtarpit</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<thead><tr><th>keyword</th><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td None><a href="#4-retries">retries</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-rspadd">rspadd</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-rspdel">rspdel</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-rspdeny">rspdeny</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-rspidel">rspidel</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-rspideny">rspideny</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-rspirep">rspirep</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-rsprep">rsprep</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-server">server</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-source">source</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-srvtimeout"><span class="pull-right"><span class="label label-warning">(deprecated)</span></span>srvtimeout</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stats%20admin">stats admin</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stats%20auth">stats auth</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stats%20enable">stats enable</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stats%20hide-version">stats hide-version</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stats%20http-request">stats http-request</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stats%20realm">stats realm</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stats%20refresh">stats refresh</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stats%20scope">stats scope</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stats%20show-desc">stats show-desc</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<thead><tr><th>keyword</th><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td None><a href="#4-stats%20show-legends">stats show-legends</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stats%20show-node">stats show-node</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stats%20uri">stats uri</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stick%20match">stick match</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stick%20on">stick on</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stick%20store-request">stick store-request</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stick-table">stick-table</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-tcp-request%20content%20accept">tcp-request content accept</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-tcp-request%20content%20reject">tcp-request content reject</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-tcp-request%20inspect-delay">tcp-request inspect-delay</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-timeout%20check">timeout check</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-timeout%20client">timeout client</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-timeout%20clitimeout"><span class="pull-right"><span class="label label-warning">(deprecated)</span></span>timeout clitimeout</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-timeout%20connect">timeout connect</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-timeout%20contimeout"><span class="pull-right"><span class="label label-warning">(deprecated)</span></span>timeout contimeout</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-timeout%20http-keep-alive">timeout http-keep-alive</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-timeout%20http-request">timeout http-request</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-timeout%20queue">timeout queue</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-timeout%20server">timeout server</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-timeout%20srvtimeout"><span class="pull-right"><span class="label label-warning">(deprecated)</span></span>timeout srvtimeout</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<thead><tr><th>keyword</th><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td None><a href="#4-timeout%20tarpit">timeout tarpit</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-transparent"><span class="pull-right"><span class="label label-warning">(deprecated)</span></span>transparent</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-use_backend">use_backend</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
</table></div>
<a class="anchor" id="4.2" name="4.2"></a>
<h2 id="chapter-4.2" data-target="4.2"><small><a class="small" href="#4.2">4.2.</a></small> Alphabetically sorted keywords reference</h2>
<div><pre class="text">This section provides a description of each keyword and its usage.</pre><a class="anchor" name="acl"></a><a class="anchor" name="4-acl"></a><a class="anchor" name="4.2-acl"></a><a class="anchor" name="acl (Proxies)"></a><a class="anchor" name="acl (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="acl"></a><a href="#4-acl">acl</a></b> <span style="color: #080">&lt;aclname&gt;</span> <span style="color: #080">&lt;criterion&gt;</span> <span style="color: #008">[flags]</span> <span style="color: #008">[operator]</span> <span style="color: #080">&lt;value&gt;</span> ...</div><pre class="text">Declare or complete an access list.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>acl invalid_src  src          0.0.0.0/7 224.0.0.0/3
acl invalid_src  src_port     0:1023
acl local_dst    hdr(host) -i localhost
</code></pre>
</div><pre class="text">See <a href="#7">section 7</a> about ACL usage.</pre><a class="anchor" name="appsession"></a><a class="anchor" name="4-appsession"></a><a class="anchor" name="4.2-appsession"></a><a class="anchor" name="appsession (Proxies)"></a><a class="anchor" name="appsession (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="appsession"></a><a href="#4-appsession">appsession</a></b> <span style="color: #080">&lt;cookie&gt;</span> len <span style="color: #080">&lt;length&gt;</span> timeout <span style="color: #080">&lt;holdtime&gt;</span>
           <span style="color: #008">[request-learn]</span> <span style="color: #008">[prefix]</span> <span style="color: #008">[mode <span style="color: #080">&lt;path-parameters|query-string&gt;</span>]</span></div><pre class="text">Define session stickiness on an existing application cookie.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;cookie&gt;   this is the name of the cookie used by the application and which
           HAProxy will have to learn for each new session.

&lt;length&gt;   this is the max number of characters that will be memorized and
           checked in each cookie value.

&lt;holdtime&gt; this is the time after which the cookie will be removed from
           memory if unused. If no unit is specified, this time is in
           milliseconds.

request-learn
           If this option is specified, then haproxy will be able to learn
           the cookie found in the request in case the server does not
           specify any in response. This is typically what happens with
           PHPSESSID cookies, or when haproxy's session expires before
           the application's session and the correct server is selected.
           It is recommended to specify this option to improve reliability.

prefix     When this option is specified, haproxy will match on the cookie
           prefix (or URL parameter prefix). The appsession value is the
           data following this prefix.

           Example :
           appsession ASPSESSIONID len 64 timeout 3h prefix

           This will match the cookie ASPSESSIONIDXXXX=XXXXX,
           the appsession value will be XXXX=XXXXX.

mode       This option allows to change the URL parser mode.
           2 modes are currently supported :
           - path-parameters :
             The parser looks for the appsession in the path parameters
             part (each parameter is separated by a semi-colon), which is
             convenient for JSESSIONID for example.
             This is the default mode if the option is not set.
           - query-string :
             In this mode, the parser will look for the appsession in the
             query string.</pre>
</div>
<pre class="text">When an application cookie is defined in a backend, HAProxy will check when
the server sets such a cookie, and will store its value in a table, and
associate it with the server's identifier. Up to &lt;length&gt; characters from
the value will be retained. On each connection, haproxy will look for this
cookie both in the &quot;Cookie:&quot; headers, and as a URL parameter (depending on
the mode used). If a known value is found, the client will be directed to the
server associated with this value. Otherwise, the load balancing algorithm is
applied. Cookies are automatically removed from memory when they have been
unused for a duration longer than &lt;holdtime&gt;.

The definition of an application cookie is limited to one per backend.

Note : Consider not using this feature in multi-process mode (nbproc &gt; 1)
       unless you know what you do : memory is not shared between the
       processes, which can result in random behaviours.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>appsession JSESSIONID len 52 timeout 3h
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">cookie<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#cookie%20%28Proxies%29">Proxies</a></li><li><a href="#cookie%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;, &quot;<a href="#capture%20cookie">capture cookie</a>&quot;, &quot;<a href="#balance">balance</a>&quot;, &quot;<a href="#stick">stick</a>&quot;, &quot;<a href="#stick-table">stick-table</a>&quot;, &quot;<a href="#ignore-persist">ignore-persist</a>&quot;, &quot;<a href="#nbproc">nbproc</a>&quot; and &quot;<a href="#bind-process">bind-process</a>&quot;.</div>
<a class="anchor" name="backlog"></a><a class="anchor" name="4-backlog"></a><a class="anchor" name="4.2-backlog"></a><a class="anchor" name="backlog (Proxies)"></a><a class="anchor" name="backlog (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="backlog"></a><a href="#4-backlog">backlog</a></b> <span style="color: #080">&lt;conns&gt;</span></div><pre class="text">Give hints to the system about the approximate listen backlog desired size</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;conns&gt;   is the number of pending connections. Depending on the operating
          system, it may represent the number of already acknowledged
          connections, of non-acknowledged ones, or both.</pre>
</div>
<pre class="text">In order to protect against SYN flood attacks, one solution is to increase
the system's SYN backlog size. Depending on the system, sometimes it is just
tunable via a system parameter, sometimes it is not adjustable at all, and
sometimes the system relies on hints given by the application at the time of
the listen() syscall. By default, HAProxy passes the frontend's maxconn value
to the listen() syscall. On systems which can make use of this value, it can
sometimes be useful to be able to specify a different value, hence this
backlog parameter.

On Linux 2.4, the parameter is ignored by the system. On Linux 2.6, it is
used as a hint and the system accepts up to the smallest greater power of
two, and never more than some limits (usually 32768).</pre><div class="page-header"><b>See also :</b> &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#maxconn%20%28Proxies%29">Proxies</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; and the target operating system's tuning guide.</div>
<a class="anchor" name="balance"></a><a class="anchor" name="4-balance"></a><a class="anchor" name="4.2-balance"></a><a class="anchor" name="balance (Proxies)"></a><a class="anchor" name="balance (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="balance"></a><a href="#4-balance">balance</a></b> <span style="color: #080">&lt;algorithm&gt;</span> <span style="color: #008">[ <span style="color: #080">&lt;arguments&gt;</span> ]</span></div><a class="anchor" name="balance"></a><a class="anchor" name="4-balance"></a><a class="anchor" name="4.2-balance"></a><a class="anchor" name="balance (Proxies)"></a><a class="anchor" name="balance (Alphabetically sorted keywords reference)"></a><a class="anchor" name="balance url_param"></a><a class="anchor" name="4-balance url_param"></a><a class="anchor" name="4.2-balance url_param"></a><a class="anchor" name="balance url_param (Proxies)"></a><a class="anchor" name="balance url_param (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="balance url_param"></a><a href="#4-balance%20url_param">balance url_param</a></b> <span style="color: #080">&lt;param&gt;</span> <span style="color: #008">[check_post <span style="color: #008">[<span style="color: #080">&lt;max_wait&gt;</span>]</span>]</span></div><pre class="text">Define the load balancing algorithm to be used in a backend.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;algorithm&gt; is the algorithm used to select a server when doing load
            balancing. This only applies when no persistence information
            is available, or when a connection is redispatched to another
            server. &lt;algorithm&gt; may be one of the following :

  roundrobin  Each server is used in turns, according to their weights.
              This is the smoothest and fairest algorithm when the server's
              processing time remains equally distributed. This algorithm
              is dynamic, which means that server weights may be adjusted
              on the fly for slow starts for instance. It is limited by
              design to 4128 active servers per backend. Note that in some
              large farms, when a server becomes up after having been down
              for a very short time, it may sometimes take a few hundreds
              requests for it to be re-integrated into the farm and start
              receiving traffic. This is normal, though very rare. It is
              indicated here in case you would have the chance to observe
              it, so that you don't worry.

  static-rr   Each server is used in turns, according to their weights.
              This algorithm is as similar to roundrobin except that it is
              static, which means that changing a server's weight on the
              fly will have no effect. On the other hand, it has no design
              limitation on the number of servers, and when a server goes
              up, it is always immediately reintroduced into the farm, once
              the full map is recomputed. It also uses slightly less CPU to
              run (around -1%).

  leastconn   The server with the lowest number of connections receives the
              connection. Round-robin is performed within groups of servers
              of the same load to ensure that all servers will be used. Use
              of this algorithm is recommended where very long sessions are
              expected, such as LDAP, SQL, TSE, etc... but is not very well
              suited for protocols using short sessions such as HTTP. This
              algorithm is dynamic, which means that server weights may be
              adjusted on the fly for slow starts for instance.

  source      The source IP address is hashed and divided by the total
              weight of the running servers to designate which server will
              receive the request. This ensures that the same client IP
              address will always reach the same server as long as no
              server goes down or up. If the hash result changes due to the
              number of running servers changing, many clients will be
              directed to a different server. This algorithm is generally
              used in TCP mode where no cookie may be inserted. It may also
              be used on the Internet to provide a best-effort stickiness
              to clients which refuse session cookies. This algorithm is
              static by default, which means that changing a server's
              weight on the fly will have no effect, but this can be
              changed using &quot;<a href="#hash-type">hash-type</a>&quot;.

  uri         This algorithm hashes either the left part of the URI (before
              the question mark) or the whole URI (if the &quot;whole&quot; parameter
              is present) and divides the hash value by the total weight of
              the running servers. The result designates which server will
              receive the request. This ensures that the same URI will
              always be directed to the same server as long as no server
              goes up or down. This is used with proxy caches and
              anti-virus proxies in order to maximize the cache hit rate.
              Note that this algorithm may only be used in an HTTP backend.
              This algorithm is static by default, which means that
              changing a server's weight on the fly will have no effect,
              but this can be changed using &quot;<a href="#hash-type">hash-type</a>&quot;.

              This algorithm supports two optional parameters &quot;len&quot; and
              &quot;depth&quot;, both followed by a positive integer number. These
              options may be helpful when it is needed to balance servers
              based on the beginning of the URI only. The &quot;len&quot; parameter
              indicates that the algorithm should only consider that many
              characters at the beginning of the URI to compute the hash.
              Note that having &quot;len&quot; set to 1 rarely makes sense since most
              URIs start with a leading &quot;/&quot;.

              The &quot;depth&quot; parameter indicates the maximum directory depth
              to be used to compute the hash. One level is counted for each
              slash in the request. If both parameters are specified, the
              evaluation stops when either is reached.

  url_param   The URL parameter specified in argument will be looked up in
              the query string of each HTTP GET request.

              If the modifier &quot;check_post&quot; is used, then an HTTP POST
              request entity will be searched for the parameter argument,
              when it is not found in a query string after a question mark
              ('?') in the URL. Optionally, specify a number of octets to
              wait for before attempting to search the message body. If the
              entity can not be searched, then round robin is used for each
              request. For instance, if your clients always send the LB
              parameter in the first 128 bytes, then specify that. The
              default is 48. The entity data will not be scanned until the
              required number of octets have arrived at the gateway, this
              is the minimum of: (default/max_wait, Content-Length or first
              chunk length). If Content-Length is missing or zero, it does
              not need to wait for more data than the client promised to
              send. When Content-Length is present and larger than
              &lt;max_wait&gt;, then waiting is limited to &lt;max_wait&gt; and it is
              assumed that this will be enough data to search for the
              presence of the parameter. In the unlikely event that
              Transfer-Encoding: chunked is used, only the first chunk is
              scanned. Parameter values separated by a chunk boundary, may
              be randomly balanced if at all.

              If the parameter is found followed by an equal sign ('=') and
              a value, then the value is hashed and divided by the total
              weight of the running servers. The result designates which
              server will receive the request.

              This is used to track user identifiers in requests and ensure
              that a same user ID will always be sent to the same server as
              long as no server goes up or down. If no value is found or if
              the parameter is not found, then a round robin algorithm is
              applied. Note that this algorithm may only be used in an HTTP
              backend. This algorithm is static by default, which means
              that changing a server's weight on the fly will have no
              effect, but this can be changed using &quot;<a href="#hash-type">hash-type</a>&quot;.

  hdr(&lt;name&gt;) The HTTP header &lt;name&gt; will be looked up in each HTTP request.
              Just as with the equivalent ACL 'hdr()' function, the header
              name in parenthesis is not case sensitive. If the header is
              absent or if it does not contain any value, the roundrobin
              algorithm is applied instead.

              An optional 'use_domain_only' parameter is available, for
              reducing the hash algorithm to the main domain part with some
              specific headers such as 'Host'. For instance, in the Host
              value &quot;haproxy.1wt.eu&quot;, only &quot;1wt&quot; will be considered.

              This algorithm is static by default, which means that
              changing a server's weight on the fly will have no effect,
              but this can be changed using &quot;<a href="#hash-type">hash-type</a>&quot;.

  rdp-cookie
  rdp-cookie(name)
              The RDP cookie &lt;name&gt; (or &quot;mstshash&quot; if omitted) will be
              looked up and hashed for each incoming TCP request. Just as
              with the equivalent ACL 'req_rdp_cookie()' function, the name
              is not case-sensitive. This mechanism is useful as a degraded
              persistence mode, as it makes it possible to always send the
              same user (or the same session ID) to the same server. If the
              cookie is not found, the normal roundrobin algorithm is
              used instead.

              Note that for this to work, the frontend must ensure that an
              RDP cookie is already present in the request buffer. For this
              you must use 'tcp-request content accept' rule combined with
              a 'req_rdp_cookie_cnt' ACL.

              This algorithm is static by default, which means that
              changing a server's weight on the fly will have no effect,
              but this can be changed using &quot;<a href="#hash-type">hash-type</a>&quot;.

&lt;arguments&gt; is an optional list of arguments which may be needed by some
            algorithms. Right now, only &quot;url_param&quot; and &quot;uri&quot; support an
            optional argument.

            balance uri [len &lt;len&gt;] [depth &lt;depth&gt;]
            balance url_param &lt;param&gt; [check_post [&lt;max_wait&gt;]]</pre>
</div>
<pre class="text">The load balancing algorithm of a backend is set to roundrobin when no other
algorithm, mode nor option have been set. The algorithm may only be set once
for each backend.</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code>balance roundrobin
balance url_param userid
balance url_param session_id check_post 64
balance hdr(User-Agent)
balance hdr(host)
balance hdr(Host) use_domain_only
</code></pre>
</div><pre class="text">Note: the following caveats and limitations on using the &quot;check_post&quot;
extension with &quot;url_param&quot; must be considered :

  - all POST requests are eligible for consideration, because there is no way
    to determine if the parameters will be found in the body or entity which
    may contain binary data. Therefore another method may be required to
    restrict consideration of POST requests that have no URL parameters in
    the body. (see acl reqideny http_end)

  - using a &lt;max_wait&gt; value larger than the request buffer size does not
    make sense and is useless. The buffer size is set at build time, and
    defaults to 16 kB.

  - Content-Encoding is not supported, the parameter search will probably
    fail; and load balancing will fall back to Round Robin.

  - Expect: 100-continue is not supported, load balancing will fall back to
    Round Robin.

  - Transfer-Encoding (RFC2616 3.6.1) is only supported in the first chunk.
    If the entire parameter value is not present in the first chunk, the
    selection of server is undefined (actually, defined by how little
    actually appeared in the first chunk).

  - This feature does not support generation of a 100, 411 or 501 response.

  - In some cases, requesting &quot;check_post&quot; MAY attempt to scan the entire
    contents of a message body. Scanning normally terminates when linear
    white space or control characters are found, indicating the end of what
    might be a URL parameter list. This is probably not a concern with SGML
    type message bodies.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#dispatch">dispatch</a>&quot;, &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">cookie<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#cookie%20%28Proxies%29">Proxies</a></li><li><a href="#cookie%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;, &quot;<a href="#appsession">appsession</a>&quot;, &quot;<a href="#option%20transparent">transparent</a>&quot;, &quot;<a href="#hash-type">hash-type</a>&quot; and &quot;<a href="#option%20http_proxy">http_proxy</a>&quot;.</div>
<a class="anchor" name="bind"></a><a class="anchor" name="4-bind"></a><a class="anchor" name="4.2-bind"></a><a class="anchor" name="bind (Proxies)"></a><a class="anchor" name="bind (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="bind"></a><a href="#4-bind">bind</a></b> <span style="color: #008">[<span style="color: #080">&lt;address&gt;</span>]</span>:<span style="color: #080">&lt;port_range&gt;</span> <span style="color: #008">[, ...]</span></div><a class="anchor" name="bind"></a><a class="anchor" name="4-bind"></a><a class="anchor" name="4.2-bind"></a><a class="anchor" name="bind (Proxies)"></a><a class="anchor" name="bind (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="bind"></a><a href="#4-bind">bind</a></b> <span style="color: #008">[<span style="color: #080">&lt;address&gt;</span>]</span>:<span style="color: #080">&lt;port_range&gt;</span> <span style="color: #008">[, ...]</span> interface <span style="color: #080">&lt;interface&gt;</span></div><a class="anchor" name="bind"></a><a class="anchor" name="4-bind"></a><a class="anchor" name="4.2-bind"></a><a class="anchor" name="bind (Proxies)"></a><a class="anchor" name="bind (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="bind"></a><a href="#4-bind">bind</a></b> <span style="color: #008">[<span style="color: #080">&lt;address&gt;</span>]</span>:<span style="color: #080">&lt;port_range&gt;</span> <span style="color: #008">[, ...]</span> mss <span style="color: #080">&lt;maxseg&gt;</span></div><a class="anchor" name="bind"></a><a class="anchor" name="4-bind"></a><a class="anchor" name="4.2-bind"></a><a class="anchor" name="bind (Proxies)"></a><a class="anchor" name="bind (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="bind"></a><a href="#4-bind">bind</a></b> <span style="color: #008">[<span style="color: #080">&lt;address&gt;</span>]</span>:<span style="color: #080">&lt;port_range&gt;</span> <span style="color: #008">[, ...]</span> transparent</div><a class="anchor" name="bind"></a><a class="anchor" name="4-bind"></a><a class="anchor" name="4.2-bind"></a><a class="anchor" name="bind (Proxies)"></a><a class="anchor" name="bind (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="bind"></a><a href="#4-bind">bind</a></b> <span style="color: #008">[<span style="color: #080">&lt;address&gt;</span>]</span>:<span style="color: #080">&lt;port_range&gt;</span> <span style="color: #008">[, ...]</span> id <span style="color: #080">&lt;id&gt;</span></div><a class="anchor" name="bind"></a><a class="anchor" name="4-bind"></a><a class="anchor" name="4.2-bind"></a><a class="anchor" name="bind (Proxies)"></a><a class="anchor" name="bind (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="bind"></a><a href="#4-bind">bind</a></b> <span style="color: #008">[<span style="color: #080">&lt;address&gt;</span>]</span>:<span style="color: #080">&lt;port_range&gt;</span> <span style="color: #008">[, ...]</span> name <span style="color: #080">&lt;name&gt;</span></div><a class="anchor" name="bind"></a><a class="anchor" name="4-bind"></a><a class="anchor" name="4.2-bind"></a><a class="anchor" name="bind (Proxies)"></a><a class="anchor" name="bind (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="bind"></a><a href="#4-bind">bind</a></b> <span style="color: #008">[<span style="color: #080">&lt;address&gt;</span>]</span>:<span style="color: #080">&lt;port_range&gt;</span> <span style="color: #008">[, ...]</span> defer-accept</div><pre class="text">Define one or several listening addresses and/or ports in a frontend.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;address&gt;     is optional and can be a host name, an IPv4 address, an IPv6
              address, or '*'. It designates the address the frontend will
              listen on. If unset, all IPv4 addresses of the system will be
              listened on. The same will apply for '*' or the system's
              special address &quot;0.0.0.0&quot;.

&lt;port_range&gt;  is either a unique TCP port, or a port range for which the
              proxy will accept connections for the IP address specified
              above. The port is mandatory. Note that in the case of an
              IPv6 address, the port is always the number after the last
              colon (':'). A range can either be :
               - a numerical port (ex: '80')
               - a dash-delimited ports range explicitly stating the lower
                 and upper bounds (ex: '2000-2100') which are included in
                 the range.

              Particular care must be taken against port ranges, because
              every &lt;address:port&gt; couple consumes one socket (= a file
              descriptor), so it's easy to consume lots of descriptors
              with a simple range, and to run out of sockets. Also, each
              &lt;address:port&gt; couple must be used only once among all
              instances running on a same system. Please note that binding
              to ports lower than 1024 generally require particular
              privileges to start the program, which are independant of
              the 'uid' parameter.

&lt;interface&gt;   is an optional physical interface name. This is currently
              only supported on Linux. The interface must be a physical
              interface, not an aliased interface. When specified, all
              addresses on the same line will only be accepted if the
              incoming packet physically come through the designated
              interface. It is also possible to bind multiple frontends to
              the same address if they are bound to different interfaces.
              Note that binding to a physical interface requires root
              privileges.

&lt;maxseg&gt;      is an optional TCP Maximum Segment Size (MSS) value to be
              advertised on incoming connections. This can be used to force
              a lower MSS for certain specific ports, for instance for
              connections passing through a VPN. Note that this relies on a
              kernel feature which is theorically supported under Linux but
              was buggy in all versions prior to 2.6.28. It may or may not
              work on other operating systems. The commonly advertised
              value on Ethernet networks is 1460 = 1500(MTU) - 40(IP+TCP).

&lt;id&gt;          is a persistent value for socket ID. Must be positive and
              unique in the proxy. An unused value will automatically be
              assigned if unset. Can only be used when defining only a
              single socket.

&lt;name&gt;        is an optional name provided for stats

transparent   is an optional keyword which is supported only on certain
              Linux kernels. It indicates that the addresses will be bound
              even if they do not belong to the local machine. Any packet
              targeting any of these addresses will be caught just as if
              the address was locally configured. This normally requires
              that IP forwarding is enabled. Caution! do not use this with
              the default address '*', as it would redirect any traffic for
              the specified port. This keyword is available only when
              HAProxy is built with USE_LINUX_TPROXY=1.

defer-accept  is an optional keyword which is supported only on certain
              Linux kernels. It states that a connection will only be
              accepted once some data arrive on it, or at worst after the
              first retransmit. This should be used only on protocols for
              which the client talks first (eg: HTTP). It can slightly
              improve performance by ensuring that most of the request is
              already available when the connection is accepted. On the
              other hand, it will not be able to detect connections which
              don't talk. It is important to note that this option is
              broken in all kernels up to 2.6.31, as the connection is
              never accepted until the client talks. This can cause issues
              with front firewalls which would see an established
              connection while the proxy will only see it in SYN_RECV.</pre>
</div>
<pre class="text">It is possible to specify a list of address:port combinations delimited by
commas. The frontend will then listen on all of these addresses. There is no
fixed limit to the number of addresses and ports which can be listened on in
a frontend, as well as there is no limit to the number of &quot;<a href="#bind">bind</a>&quot; statements
in a frontend.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>listen http_proxy
    bind :80,:443
    bind 10.0.0.1:10080,10.0.0.1:10443
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#source%20%28Proxies%29">Proxies</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;.</div>
<a class="anchor" name="bind-process"></a><a class="anchor" name="4-bind-process"></a><a class="anchor" name="4.2-bind-process"></a><a class="anchor" name="bind-process (Proxies)"></a><a class="anchor" name="bind-process (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="bind-process"></a><a href="#4-bind-process">bind-process</a></b> <span style="color: #008">[ all | odd | even | <span style="color: #080">&lt;number 1-32&gt;</span> ]</span> ...</div><pre class="text">Limit visibility of an instance to a certain set of processes numbers.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">all           All process will see this instance. This is the default. It
              may be used to override a default value.

odd           This instance will be enabled on processes 1,3,5,...31. This
              option may be combined with other numbers.

even          This instance will be enabled on processes 2,4,6,...32. This
              option may be combined with other numbers. Do not use it
              with less than 2 processes otherwise some instances might be
              missing from all processes.

number        The instance will be enabled on this process number, between
              1 and 32. You must be careful not to reference a process
              number greater than the configured global.nbproc, otherwise
              some instances might be missing from all processes.</pre>
</div>
<pre class="text">This keyword limits binding of certain instances to certain processes. This
is useful in order not to have too many processes listening to the same
ports. For instance, on a dual-core machine, it might make sense to set
'nbproc 2' in the global section, then distributes the listeners among 'odd'
and 'even' instances.

At the moment, it is not possible to reference more than 32 processes using
this keyword, but this should be more than enough for most setups. Please
note that 'all' really means all processes and is not limited to the first
32.

If some backends are referenced by frontends bound to other processes, the
backend automatically inherits the frontend's processes.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>listen app_ip1
    bind 10.0.0.1:80
    bind-process odd

listen app_ip2
    bind 10.0.0.2:80
    bind-process even

listen management
    bind 10.0.0.3:80
    bind-process 1 2 3 4
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#nbproc">nbproc</a>&quot; in global section.</div>
<a class="anchor" name="block"></a><a class="anchor" name="4-block"></a><a class="anchor" name="4.2-block"></a><a class="anchor" name="block (Proxies)"></a><a class="anchor" name="block (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="block"></a><a href="#4-block">block</a></b> <span style="color: #800">{ if | unless }</span> <span style="color: #080">&lt;condition&gt;</span></div><pre class="text">Block a layer 7 request if/unless a condition is matched</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">The HTTP request will be blocked very early in the layer 7 processing
if/unless &lt;condition&gt; is matched. A 403 error will be returned if the request
is blocked. The condition has to reference ACLs (see <a href="#7">section 7</a>). This is
typically used to deny access to certain sensitive resources if some
conditions are met or not met. There is no fixed limit to the number of
&quot;<a href="#block">block</a>&quot; statements per instance.</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>acl invalid_src  src          0.0.0.0/7 224.0.0.0/3
acl invalid_src  src_port     0:1023
acl local_dst    hdr(host) -i localhost
block if invalid_src || local_dst
</code></pre>
</div><pre class="text">See <a href="#7">section 7</a> about ACL usage.</pre><a class="anchor" name="capture"></a><a class="anchor" name="4-capture"></a><a class="anchor" name="4.2-capture"></a><a class="anchor" name="capture (Proxies)"></a><a class="anchor" name="capture (Alphabetically sorted keywords reference)"></a><a class="anchor" name="capture cookie"></a><a class="anchor" name="4-capture cookie"></a><a class="anchor" name="4.2-capture cookie"></a><a class="anchor" name="capture cookie (Proxies)"></a><a class="anchor" name="capture cookie (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="capture cookie"></a><a href="#4-capture%20cookie">capture cookie</a></b> <span style="color: #080">&lt;name&gt;</span> len <span style="color: #080">&lt;length&gt;</span></div><pre class="text">Capture and log a cookie in the request and in the response.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;name&gt;    is the beginning of the name of the cookie to capture. In order
          to match the exact name, simply suffix the name with an equal
          sign ('='). The full name will appear in the logs, which is
          useful with application servers which adjust both the cookie name
          and value (eg: ASPSESSIONXXXXX).

&lt;length&gt;  is the maximum number of characters to report in the logs, which
          include the cookie name, the equal sign and the value, all in the
          standard &quot;name=value&quot; form. The string will be truncated on the
          right if it exceeds &lt;length&gt;.</pre>
</div>
<pre class="text">Only the first cookie is captured. Both the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">cookie<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#cookie%20%28Proxies%29">Proxies</a></li><li><a href="#cookie%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; request headers and the
&quot;set-cookie&quot; response headers are monitored. This is particularly useful to
check for application bugs causing session crossing or stealing between
users, because generally the user's cookies can only change on a login page.

When the cookie was not presented by the client, the associated log column
will report &quot;-&quot;. When a request does not cause a cookie to be assigned by the
server, a &quot;-&quot; is reported in the response column.

The capture is performed in the frontend only because it is necessary that
the log format does not change for a given frontend depending on the
backends. This may change in the future. Note that there can be only one
&quot;<a href="#capture%20cookie">capture cookie</a>&quot; statement in a frontend. The maximum capture length is
configured in the sources by default to 64 characters. It is not possible to
specify a capture in a &quot;defaults&quot; section.</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>capture cookie ASPSESSION len 32
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#capture%20request%20header">capture request header</a>&quot;, &quot;<a href="#capture%20response%20header">capture response header</a>&quot; as well as <a href="#8">section 8</a> about logging.</div>
<a class="anchor" name="capture"></a><a class="anchor" name="4-capture"></a><a class="anchor" name="4.2-capture"></a><a class="anchor" name="capture (Proxies)"></a><a class="anchor" name="capture (Alphabetically sorted keywords reference)"></a><a class="anchor" name="capture request"></a><a class="anchor" name="4-capture request"></a><a class="anchor" name="4.2-capture request"></a><a class="anchor" name="capture request (Proxies)"></a><a class="anchor" name="capture request (Alphabetically sorted keywords reference)"></a><a class="anchor" name="capture request header"></a><a class="anchor" name="4-capture request header"></a><a class="anchor" name="4.2-capture request header"></a><a class="anchor" name="capture request header (Proxies)"></a><a class="anchor" name="capture request header (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="capture request header"></a><a href="#4-capture%20request%20header">capture request header</a></b> <span style="color: #080">&lt;name&gt;</span> len <span style="color: #080">&lt;length&gt;</span></div><pre class="text">Capture and log the first occurrence of the specified request header.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;name&gt;    is the name of the header to capture. The header names are not
          case-sensitive, but it is a common practice to write them as they
          appear in the requests, with the first letter of each word in
          upper case. The header name will not appear in the logs, only the
          value is reported, but the position in the logs is respected.

&lt;length&gt;  is the maximum number of characters to extract from the value and
          report in the logs. The string will be truncated on the right if
          it exceeds &lt;length&gt;.</pre>
</div>
<pre class="text">Only the first value of the last occurrence of the header is captured. The
value will be added to the logs between braces ('{}'). If multiple headers
are captured, they will be delimited by a vertical bar ('|') and will appear
in the same order they were declared in the configuration. Non-existent
headers will be logged just as an empty string. Common uses for request
header captures include the &quot;Host&quot; field in virtual hosting environments, the
&quot;Content-length&quot; when uploads are supported, &quot;User-agent&quot; to quickly
differentiate between real users and robots, and &quot;X-Forwarded-For&quot; in proxied
environments to find where the request came from.

Note that when capturing headers such as &quot;User-agent&quot;, some spaces may be
logged, making the log analysis more difficult. Thus be careful about what
you log if you know your log parser is not smart enough to rely on the
braces.

There is no limit to the number of captured request headers, but each capture
is limited to 64 characters. In order to keep log format consistent for a
same frontend, header captures can only be declared in a frontend. It is not
possible to specify a capture in a &quot;defaults&quot; section.</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>capture request header Host len 15
capture request header X-Forwarded-For len 15
capture request header Referrer len 15
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#capture%20cookie">capture cookie</a>&quot;, &quot;<a href="#capture%20response%20header">capture response header</a>&quot; as well as <a href="#8">section 8</a> about logging.</div>
<a class="anchor" name="capture"></a><a class="anchor" name="4-capture"></a><a class="anchor" name="4.2-capture"></a><a class="anchor" name="capture (Proxies)"></a><a class="anchor" name="capture (Alphabetically sorted keywords reference)"></a><a class="anchor" name="capture response"></a><a class="anchor" name="4-capture response"></a><a class="anchor" name="4.2-capture response"></a><a class="anchor" name="capture response (Proxies)"></a><a class="anchor" name="capture response (Alphabetically sorted keywords reference)"></a><a class="anchor" name="capture response header"></a><a class="anchor" name="4-capture response header"></a><a class="anchor" name="4.2-capture response header"></a><a class="anchor" name="capture response header (Proxies)"></a><a class="anchor" name="capture response header (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="capture response header"></a><a href="#4-capture%20response%20header">capture response header</a></b> <span style="color: #080">&lt;name&gt;</span> len <span style="color: #080">&lt;length&gt;</span></div><pre class="text">Capture and log the first occurrence of the specified response header.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;name&gt;    is the name of the header to capture. The header names are not
          case-sensitive, but it is a common practice to write them as they
          appear in the response, with the first letter of each word in
          upper case. The header name will not appear in the logs, only the
          value is reported, but the position in the logs is respected.

&lt;length&gt;  is the maximum number of characters to extract from the value and
          report in the logs. The string will be truncated on the right if
          it exceeds &lt;length&gt;.</pre>
</div>
<pre class="text">Only the first value of the last occurrence of the header is captured. The
result will be added to the logs between braces ('{}') after the captured
request headers. If multiple headers are captured, they will be delimited by
a vertical bar ('|') and will appear in the same order they were declared in
the configuration. Non-existent headers will be logged just as an empty
string. Common uses for response header captures include the &quot;Content-length&quot;
header which indicates how many bytes are expected to be returned, the
&quot;Location&quot; header to track redirections.

There is no limit to the number of captured response headers, but each
capture is limited to 64 characters. In order to keep log format consistent
for a same frontend, header captures can only be declared in a frontend. It
is not possible to specify a capture in a &quot;defaults&quot; section.</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>capture response header Content-length len 9
capture response header Location len 15
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#capture%20cookie">capture cookie</a>&quot;, &quot;<a href="#capture%20request%20header">capture request header</a>&quot; as well as <a href="#8">section 8</a> about logging.</div>
<a class="anchor" name="clitimeout"></a><a class="anchor" name="4-clitimeout"></a><a class="anchor" name="4.2-clitimeout"></a><a class="anchor" name="clitimeout (Proxies)"></a><a class="anchor" name="clitimeout (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="clitimeout"></a><a href="#4-clitimeout">clitimeout</a></b> <span style="color: #080">&lt;timeout&gt;</span> <span class="label label-warning">(deprecated)</span></div><pre class="text">Set the maximum inactivity time on the client side.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value is specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">The inactivity timeout applies when the client is expected to acknowledge or
send data. In HTTP mode, this timeout is particularly important to consider
during the first phase, when the client sends the request, and during the
response while it is reading data sent by the server. The value is specified
in milliseconds by default, but can be in any other unit if the number is
suffixed by the unit, as specified at the top of this document. In TCP mode
(and to a lesser extent, in HTTP mode), it is highly recommended that the
client timeout remains equal to the server timeout in order to avoid complex
situations to debug. It is a good practice to cover one or several TCP packet
losses by specifying timeouts that are slightly above multiples of 3 seconds
(eg: 4 or 5 seconds).

This parameter is specific to frontends, but can be specified once for all in
&quot;defaults&quot; sections. This is in fact one of the easiest solutions not to
forget about it. An unspecified timeout results in an infinite timeout, which
is not recommended. Such a usage is accepted and works but reports a warning
during startup because it may results in accumulation of expired sessions in
the system if the system's timeouts are not configured either.

This parameter is provided for compatibility but is currently deprecated.
Please use &quot;<a href="#timeout%20client">timeout client</a>&quot; instead.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#timeout%20client">timeout client</a>&quot;, &quot;<a href="#timeout%20http-request">timeout http-request</a>&quot;, &quot;<a href="#timeout%20server">timeout server</a>&quot;, and &quot;<a href="#srvtimeout">srvtimeout</a>&quot;.</div>
<a class="anchor" name="contimeout"></a><a class="anchor" name="4-contimeout"></a><a class="anchor" name="4.2-contimeout"></a><a class="anchor" name="contimeout (Proxies)"></a><a class="anchor" name="contimeout (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="contimeout"></a><a href="#4-contimeout">contimeout</a></b> <span style="color: #080">&lt;timeout&gt;</span> <span class="label label-warning">(deprecated)</span></div><pre class="text">Set the maximum time to wait for a connection attempt to a server to succeed.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value is specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">If the server is located on the same LAN as haproxy, the connection should be
immediate (less than a few milliseconds). Anyway, it is a good practice to
cover one or several TCP packet losses by specifying timeouts that are
slightly above multiples of 3 seconds (eg: 4 or 5 seconds). By default, the
connect timeout also presets the queue timeout to the same value if this one
has not been specified. Historically, the contimeout was also used to set the
tarpit timeout in a listen section, which is not possible in a pure frontend.

This parameter is specific to backends, but can be specified once for all in
&quot;defaults&quot; sections. This is in fact one of the easiest solutions not to
forget about it. An unspecified timeout results in an infinite timeout, which
is not recommended. Such a usage is accepted and works but reports a warning
during startup because it may results in accumulation of failed sessions in
the system if the system's timeouts are not configured either.

This parameter is provided for backwards compatibility but is currently
deprecated. Please use &quot;<a href="#timeout%20connect">timeout connect</a>&quot;, &quot;<a href="#timeout%20queue">timeout queue</a>&quot; or &quot;<a href="#timeout%20tarpit">timeout tarpit</a>&quot;
instead.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#timeout%20connect">timeout connect</a>&quot;, &quot;<a href="#timeout%20queue">timeout queue</a>&quot;, &quot;<a href="#timeout%20tarpit">timeout tarpit</a>&quot;, &quot;<a href="#timeout%20server">timeout server</a>&quot;, &quot;<a href="#contimeout">contimeout</a>&quot;.</div>
<a class="anchor" name="cookie"></a><a class="anchor" name="4-cookie"></a><a class="anchor" name="4.2-cookie"></a><a class="anchor" name="cookie (Proxies)"></a><a class="anchor" name="cookie (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="cookie"></a><a href="#4-cookie">cookie</a></b> <span style="color: #080">&lt;name&gt;</span> <span style="color: #008">[ rewrite | insert | prefix ]</span> <span style="color: #008">[ indirect ]</span> <span style="color: #008">[ nocache ]</span>
              <span style="color: #008">[ postonly ]</span> <span style="color: #008">[ preserve ]</span> <span style="color: #008">[ httponly ]</span> <span style="color: #008">[ secure ]</span>
              <span style="color: #008">[ domain <span style="color: #080">&lt;domain&gt;</span> ]</span>* <span style="color: #008">[ maxidle <span style="color: #080">&lt;idle&gt;</span> ]</span> <span style="color: #008">[ maxlife <span style="color: #080">&lt;life&gt;</span> ]</span></div><pre class="text">Enable cookie-based persistence in a backend.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;name&gt;    is the name of the cookie which will be monitored, modified or
          inserted in order to bring persistence. This cookie is sent to
          the client via a &quot;Set-Cookie&quot; header in the response, and is
          brought back by the client in a &quot;Cookie&quot; header in all requests.
          Special care should be taken to choose a name which does not
          conflict with any likely application cookie. Also, if the same
          backends are subject to be used by the same clients (eg:
          HTTP/HTTPS), care should be taken to use different cookie names
          between all backends if persistence between them is not desired.

rewrite   This keyword indicates that the cookie will be provided by the
          server and that haproxy will have to modify its value to set the
          server's identifier in it. This mode is handy when the management
          of complex combinations of &quot;Set-cookie&quot; and &quot;Cache-control&quot;
          headers is left to the application. The application can then
          decide whether or not it is appropriate to emit a persistence
          cookie. Since all responses should be monitored, this mode only
          works in HTTP close mode. Unless the application behaviour is
          very complex and/or broken, it is advised not to start with this
          mode for new deployments. This keyword is incompatible with
          &quot;insert&quot; and &quot;prefix&quot;.

insert    This keyword indicates that the persistence cookie will have to
          be inserted by haproxy in server responses if the client did not

          already have a cookie that would have permitted it to access this
          server. When used without the &quot;preserve&quot; option, if the server
          emits a cookie with the same name, it will be remove before
          processing.  For this reason, this mode can be used to upgrade
          existing configurations running in the &quot;rewrite&quot; mode. The cookie
          will only be a session cookie and will not be stored on the
          client's disk. By default, unless the &quot;indirect&quot; option is added,
          the server will see the cookies emitted by the client. Due to
          caching effects, it is generally wise to add the &quot;nocache&quot; or
          &quot;postonly&quot; keywords (see below). The &quot;insert&quot; keyword is not
          compatible with &quot;rewrite&quot; and &quot;prefix&quot;.

prefix    This keyword indicates that instead of relying on a dedicated
          cookie for the persistence, an existing one will be completed.
          This may be needed in some specific environments where the client
          does not support more than one single cookie and the application
          already needs it. In this case, whenever the server sets a cookie
          named &lt;name&gt;, it will be prefixed with the server's identifier
          and a delimiter. The prefix will be removed from all client
          requests so that the server still finds the cookie it emitted.
          Since all requests and responses are subject to being modified,
          this mode requires the HTTP close mode. The &quot;prefix&quot; keyword is
          not compatible with &quot;rewrite&quot; and &quot;insert&quot;.

indirect  When this option is specified, no cookie will be emitted to a
          client which already has a valid one for the server which has
          processed the request. If the server sets such a cookie itself,
          it will be removed, unless the &quot;preserve&quot; option is also set. In
          &quot;insert&quot; mode, this will additionally remove cookies from the
          requests transmitted to the server, making the persistence
          mechanism totally transparent from an application point of view.

nocache   This option is recommended in conjunction with the insert mode
          when there is a cache between the client and HAProxy, as it
          ensures that a cacheable response will be tagged non-cacheable if
          a cookie needs to be inserted. This is important because if all
          persistence cookies are added on a cacheable home page for
          instance, then all customers will then fetch the page from an
          outer cache and will all share the same persistence cookie,
          leading to one server receiving much more traffic than others.
          See also the &quot;insert&quot; and &quot;postonly&quot; options.

postonly  This option ensures that cookie insertion will only be performed
          on responses to POST requests. It is an alternative to the
          &quot;nocache&quot; option, because POST responses are not cacheable, so
          this ensures that the persistence cookie will never get cached.
          Since most sites do not need any sort of persistence before the
          first POST which generally is a login request, this is a very
          efficient method to optimize caching without risking to find a
          persistence cookie in the cache.
          See also the &quot;insert&quot; and &quot;nocache&quot; options.

preserve  This option may only be used with &quot;insert&quot; and/or &quot;indirect&quot;. It
          allows the server to emit the persistence cookie itself. In this
          case, if a cookie is found in the response, haproxy will leave it
          untouched. This is useful in order to end persistence after a
          logout request for instance. For this, the server just has to
          emit a cookie with an invalid value (eg: empty) or with a date in
          the past. By combining this mechanism with the &quot;disable-on-404&quot;
          check option, it is possible to perform a completely graceful
          shutdown because users will definitely leave the server after
          they logout.

httponly  This option tells haproxy to add an &quot;HttpOnly&quot; cookie attribute
          when a cookie is inserted. This attribute is used so that a
          user agent doesn't share the cookie with non-HTTP components.
          Please check RFC6265 for more information on this attribute.

secure    This option tells haproxy to add a &quot;Secure&quot; cookie attribute when
          a cookie is inserted. This attribute is used so that a user agent
          never emits this cookie over non-secure channels, which means
          that a cookie learned with this flag will be presented only over
          SSL/TLS connections. Please check RFC6265 for more information on
          this attribute.

domain    This option allows to specify the domain at which a cookie is
          inserted. It requires exactly one parameter: a valid domain
          name. If the domain begins with a dot, the browser is allowed to
          use it for any host ending with that name. It is also possible to
          specify several domain names by invoking this option multiple
          times. Some browsers might have small limits on the number of
          domains, so be careful when doing that. For the record, sending
          10 domains to MSIE 6 or Firefox 2 works as expected.

maxidle   This option allows inserted cookies to be ignored after some idle
          time. It only works with insert-mode cookies. When a cookie is
          sent to the client, the date this cookie was emitted is sent too.
          Upon further presentations of this cookie, if the date is older
          than the delay indicated by the parameter (in seconds), it will
          be ignored. Otherwise, it will be refreshed if needed when the
          response is sent to the client. This is particularly useful to
          prevent users who never close their browsers from remaining for
          too long on the same server (eg: after a farm size change). When
          this option is set and a cookie has no date, it is always
          accepted, but gets refreshed in the response. This maintains the
          ability for admins to access their sites. Cookies that have a
          date in the future further than 24 hours are ignored. Doing so
          lets admins fix timezone issues without risking kicking users off
          the site.

maxlife   This option allows inserted cookies to be ignored after some life
          time, whether they're in use or not. It only works with insert
          mode cookies. When a cookie is first sent to the client, the date
          this cookie was emitted is sent too. Upon further presentations
          of this cookie, if the date is older than the delay indicated by
          the parameter (in seconds), it will be ignored. If the cookie in
          the request has no date, it is accepted and a date will be set.
          Cookies that have a date in the future further than 24 hours are
          ignored. Doing so lets admins fix timezone issues without risking
          kicking users off the site. Contrary to maxidle, this value is
          not refreshed, only the first visit date counts. Both maxidle and
          maxlife may be used at the time. This is particularly useful to
          prevent users who never close their browsers from remaining for
          too long on the same server (eg: after a farm size change). This
          is stronger than the maxidle method in that it forces a
          redispatch after some absolute delay.</pre>
</div>
<pre class="text">There can be only one persistence cookie per HTTP backend, and it can be
declared in a defaults section. The value of the cookie will be the value
indicated after the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">cookie<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#cookie%20%28Proxies%29">Proxies</a></li><li><a href="#cookie%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; keyword in a &quot;<a href="#server">server</a>&quot; statement. If no cookie
is declared for a given server, the cookie is not set.</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code>cookie JSESSIONID prefix
cookie SRV insert indirect nocache
cookie SRV insert postonly indirect
cookie SRV insert indirect nocache maxidle 30m maxlife 8h
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#appsession">appsession</a>&quot;, &quot;balance source&quot;, &quot;<a href="#capture%20cookie">capture cookie</a>&quot;, &quot;<a href="#server">server</a>&quot; and &quot;<a href="#ignore-persist">ignore-persist</a>&quot;.</div>
<a class="anchor" name="default-server"></a><a class="anchor" name="4-default-server"></a><a class="anchor" name="4.2-default-server"></a><a class="anchor" name="default-server (Proxies)"></a><a class="anchor" name="default-server (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="default-server"></a><a href="#4-default-server">default-server</a></b> <span style="color: #008">[param*]</span></div><pre class="text">Change default options for a server in a backend</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments:</span><pre class="prettyprint arguments">&lt;param*&gt;  is a list of parameters for this server. The &quot;<a href="#default-server">default-server</a>&quot;
          keyword accepts an important number of options and has a complete
          section dedicated to it. Please refer to <a href="#5">section 5</a> for more
          details.</pre>
</div>
<div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>default-server inter 1000 weight 13
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#server">server</a>&quot; and <a href="#5">section 5</a> about server options</div>
<a class="anchor" name="default_backend"></a><a class="anchor" name="4-default_backend"></a><a class="anchor" name="4.2-default_backend"></a><a class="anchor" name="default_backend (Proxies)"></a><a class="anchor" name="default_backend (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="default_backend"></a><a href="#4-default_backend">default_backend</a></b> <span style="color: #080">&lt;backend&gt;</span></div><pre class="text">Specify the backend to use when no &quot;<a href="#use_backend">use_backend</a>&quot; rule has been matched.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;backend&gt; is the name of the backend to use.</pre>
</div>
<pre class="text">When doing content-switching between frontend and backends using the
&quot;<a href="#use_backend">use_backend</a>&quot; keyword, it is often useful to indicate which backend will be
used when no rule has matched. It generally is the dynamic backend which
will catch all undetermined requests.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>use_backend     dynamic  if  url_dyn
use_backend     static   if  url_css url_img extension_img
default_backend dynamic
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#use_backend">use_backend</a>&quot;, &quot;reqsetbe&quot;, &quot;reqisetbe&quot;</div>
<a class="anchor" name="disabled"></a><a class="anchor" name="4-disabled"></a><a class="anchor" name="4.2-disabled"></a><a class="anchor" name="disabled (Proxies)"></a><a class="anchor" name="disabled (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="disabled"></a><a href="#4-disabled">disabled</a></b></div><pre class="text">Disable a proxy, frontend or backend.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span></div>
<pre class="text">The &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">disabled<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#disabled%20%28Proxies%29">Proxies</a></li><li><a href="#disabled%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; keyword is used to disable an instance, mainly in order to
liberate a listening port or to temporarily disable a service. The instance
will still be created and its configuration will be checked, but it will be
created in the &quot;stopped&quot; state and will appear as such in the statistics. It
will not receive any traffic nor will it send any health-checks or logs. It
is possible to disable many instances at once by adding the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">disabled<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#disabled%20%28Proxies%29">Proxies</a></li><li><a href="#disabled%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;
keyword in a &quot;defaults&quot; section.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#enabled">enabled</a>&quot;</div>
<a class="anchor" name="dispatch"></a><a class="anchor" name="4-dispatch"></a><a class="anchor" name="4.2-dispatch"></a><a class="anchor" name="dispatch (Proxies)"></a><a class="anchor" name="dispatch (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="dispatch"></a><a href="#4-dispatch">dispatch</a></b> <span style="color: #080">&lt;address&gt;</span>:<span style="color: #080">&lt;port&gt;</span></div><pre class="text">Set a default server address</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">  &lt;address&gt; is the IPv4 address of the default server. Alternatively, a
            resolvable hostname is supported, but this name will be resolved
            during start-up.

  &lt;ports&gt;   is a mandatory port specification. All connections will be sent
            to this port, and it is not permitted to use port offsets as is
            possible with normal servers.

The &quot;<a href="#dispatch">dispatch</a>&quot; keyword designates a default server for use when no other
server can take the connection. In the past it was used to forward non
persistent connections to an auxiliary load balancer. Due to its simple
syntax, it has also been used for simple TCP relays. It is recommended not to
use it for more clarity, and to use the &quot;<a href="#server">server</a>&quot; directive instead.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#server">server</a>&quot;</div>
<a class="anchor" name="enabled"></a><a class="anchor" name="4-enabled"></a><a class="anchor" name="4.2-enabled"></a><a class="anchor" name="enabled (Proxies)"></a><a class="anchor" name="enabled (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="enabled"></a><a href="#4-enabled">enabled</a></b></div><pre class="text">Enable a proxy, frontend or backend.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">The &quot;<a href="#enabled">enabled</a>&quot; keyword is used to explicitly enable an instance, when the
defaults has been set to &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">disabled<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#disabled%20%28Proxies%29">Proxies</a></li><li><a href="#disabled%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;. This is very rarely used.</pre><div class="page-header"><b>See also :</b> &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">disabled<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#disabled%20%28Proxies%29">Proxies</a></li><li><a href="#disabled%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;</div>
<a class="anchor" name="errorfile"></a><a class="anchor" name="4-errorfile"></a><a class="anchor" name="4.2-errorfile"></a><a class="anchor" name="errorfile (Proxies)"></a><a class="anchor" name="errorfile (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="errorfile"></a><a href="#4-errorfile">errorfile</a></b> <span style="color: #080">&lt;code&gt;</span> <span style="color: #080">&lt;file&gt;</span></div><pre class="text">Return a file contents instead of errors generated by HAProxy</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;code&gt;    is the HTTP status code. Currently, HAProxy is capable of
          generating codes 200, 400, 403, 408, 500, 502, 503, and 504.

&lt;file&gt;    designates a file containing the full HTTP response. It is
          recommended to follow the common practice of appending &quot;.http&quot; to
          the filename so that people do not confuse the response with HTML
          error pages, and to use absolute paths, since files are read
          before any chroot is performed.</pre>
</div>
<pre class="text">It is important to understand that this keyword is not meant to rewrite
errors returned by the server, but errors detected and returned by HAProxy.
This is why the list of supported errors is limited to a small set.

Code 200 is emitted in response to requests matching a &quot;<a href="#monitor-uri">monitor-uri</a>&quot; rule.

The files are returned verbatim on the TCP socket. This allows any trick such
as redirections to another URL or site, as well as tricks to clean cookies,
force enable or disable caching, etc... The package provides default error
files returning the same contents as default errors.

The files should not exceed the configured buffer size (BUFSIZE), which
generally is 8 or 16 kB, otherwise they will be truncated. It is also wise
not to put any reference to local contents (eg: images) in order to avoid
loops between the client and HAProxy when all servers are down, causing an
error to be returned instead of an image. For better HTTP compliance, it is
recommended that all header lines end with CR-LF and not LF alone.

The files are read at the same time as the configuration and kept in memory.
For this reason, the errors continue to be returned even when the process is
chrooted, and no file change is considered while the process is running. A
simple method for developing those files consists in associating them to the
403 status code and interrogating a blocked URL.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#errorloc">errorloc</a>&quot;, &quot;<a href="#errorloc302">errorloc302</a>&quot;, &quot;<a href="#errorloc303">errorloc303</a>&quot;</div>
<div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>errorfile 400 /etc/haproxy/errorfiles/400badreq.http
errorfile 403 /etc/haproxy/errorfiles/403forbid.http
errorfile 503 /etc/haproxy/errorfiles/503sorry.http
</code></pre>
</div><a class="anchor" name="errorloc"></a><a class="anchor" name="4-errorloc"></a><a class="anchor" name="4.2-errorloc"></a><a class="anchor" name="errorloc (Proxies)"></a><a class="anchor" name="errorloc (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="errorloc"></a><a href="#4-errorloc">errorloc</a></b> <span style="color: #080">&lt;code&gt;</span> <span style="color: #080">&lt;url&gt;</span></div><a class="anchor" name="errorloc302"></a><a class="anchor" name="4-errorloc302"></a><a class="anchor" name="4.2-errorloc302"></a><a class="anchor" name="errorloc302 (Proxies)"></a><a class="anchor" name="errorloc302 (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="errorloc302"></a><a href="#4-errorloc302">errorloc302</a></b> <span style="color: #080">&lt;code&gt;</span> <span style="color: #080">&lt;url&gt;</span></div><pre class="text">Return an HTTP redirection to a URL instead of errors generated by HAProxy</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;code&gt;    is the HTTP status code. Currently, HAProxy is capable of
          generating codes 200, 400, 403, 408, 500, 502, 503, and 504.

&lt;url&gt;     it is the exact contents of the &quot;Location&quot; header. It may contain
          either a relative URI to an error page hosted on the same site,
          or an absolute URI designating an error page on another site.
          Special care should be given to relative URIs to avoid redirect
          loops if the URI itself may generate the same error (eg: 500).</pre>
</div>
<pre class="text">It is important to understand that this keyword is not meant to rewrite
errors returned by the server, but errors detected and returned by HAProxy.
This is why the list of supported errors is limited to a small set.

Code 200 is emitted in response to requests matching a &quot;<a href="#monitor-uri">monitor-uri</a>&quot; rule.

Note that both keyword return the HTTP 302 status code, which tells the
client to fetch the designated URL using the same HTTP method. This can be
quite problematic in case of non-GET methods such as POST, because the URL
sent to the client might not be allowed for something other than GET. To
workaround this problem, please use &quot;<a href="#errorloc303">errorloc303</a>&quot; which send the HTTP 303
status code, indicating to the client that the URL must be fetched with a GET
request.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#errorfile">errorfile</a>&quot;, &quot;<a href="#errorloc303">errorloc303</a>&quot;</div>
<a class="anchor" name="errorloc303"></a><a class="anchor" name="4-errorloc303"></a><a class="anchor" name="4.2-errorloc303"></a><a class="anchor" name="errorloc303 (Proxies)"></a><a class="anchor" name="errorloc303 (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="errorloc303"></a><a href="#4-errorloc303">errorloc303</a></b> <span style="color: #080">&lt;code&gt;</span> <span style="color: #080">&lt;url&gt;</span></div><pre class="text">Return an HTTP redirection to a URL instead of errors generated by HAProxy</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;code&gt;    is the HTTP status code. Currently, HAProxy is capable of
          generating codes 400, 403, 408, 500, 502, 503, and 504.

&lt;url&gt;     it is the exact contents of the &quot;Location&quot; header. It may contain
          either a relative URI to an error page hosted on the same site,
          or an absolute URI designating an error page on another site.
          Special care should be given to relative URIs to avoid redirect
          loops if the URI itself may generate the same error (eg: 500).</pre>
</div>
<pre class="text">It is important to understand that this keyword is not meant to rewrite
errors returned by the server, but errors detected and returned by HAProxy.
This is why the list of supported errors is limited to a small set.

Code 200 is emitted in response to requests matching a &quot;<a href="#monitor-uri">monitor-uri</a>&quot; rule.

Note that both keyword return the HTTP 303 status code, which tells the
client to fetch the designated URL using the same HTTP GET method. This
solves the usual problems associated with &quot;<a href="#errorloc">errorloc</a>&quot; and the 302 code. It is
possible that some very old browsers designed before HTTP/1.1 do not support
it, but no such problem has been reported till now.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#errorfile">errorfile</a>&quot;, &quot;<a href="#errorloc">errorloc</a>&quot;, &quot;<a href="#errorloc302">errorloc302</a>&quot;</div>
<a class="anchor" name="force-persist"></a><a class="anchor" name="4-force-persist"></a><a class="anchor" name="4.2-force-persist"></a><a class="anchor" name="force-persist (Proxies)"></a><a class="anchor" name="force-persist (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="force-persist"></a><a href="#4-force-persist">force-persist</a></b> <span style="color: #800">{ if | unless }</span> <span style="color: #080">&lt;condition&gt;</span></div><pre class="text">Declare a condition to force persistence on down servers</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">By default, requests are not dispatched to down servers. It is possible to
force this using &quot;<a href="#option%20persist">option persist</a>&quot;, but it is unconditional and redispatches
to a valid server if &quot;<a href="#option%20redispatch">option redispatch</a>&quot; is set. That leaves with very little
possibilities to force some requests to reach a server which is artificially
marked down for maintenance operations.

The &quot;<a href="#force-persist">force-persist</a>&quot; statement allows one to declare various ACL-based
conditions which, when met, will cause a request to ignore the down status of
a server and still try to connect to it. That makes it possible to start a
server, still replying an error to the health checks, and run a specially
configured browser to test the service. Among the handy methods, one could
use a specific source IP address, or a specific cookie. The cookie also has
the advantage that it can easily be added/removed on the browser from a test
page. Once the service is validated, it is then possible to open the service
to the world by returning a valid response to health checks.

The forced persistence is enabled when an &quot;if&quot; condition is met, or unless an
&quot;unless&quot; condition is met. The final redispatch is always disabled when this
is used.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20redispatch">option redispatch</a>&quot;, &quot;<a href="#ignore-persist">ignore-persist</a>&quot;, &quot;<a href="#option%20persist">persist</a>&quot;, and <a href="#7">section 7</a> about ACL usage.</div>
<a class="anchor" name="fullconn"></a><a class="anchor" name="4-fullconn"></a><a class="anchor" name="4.2-fullconn"></a><a class="anchor" name="fullconn (Proxies)"></a><a class="anchor" name="fullconn (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="fullconn"></a><a href="#4-fullconn">fullconn</a></b> <span style="color: #080">&lt;conns&gt;</span></div><pre class="text">Specify at what backend load the servers will reach their maxconn</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;conns&gt;   is the number of connections on the backend which will make the
          servers use the maximal number of connections.</pre>
</div>
<pre class="text">When a server has a &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#maxconn%20%28Proxies%29">Proxies</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; parameter specified, it means that its number
of concurrent connections will never go higher. Additionally, if it has a
&quot;<a href="#minconn">minconn</a>&quot; parameter, it indicates a dynamic limit following the backend's
load. The server will then always accept at least &lt;minconn&gt; connections,
never more than &lt;maxconn&gt;, and the limit will be on the ramp between both
values when the backend has less than &lt;conns&gt; concurrent connections. This
makes it possible to limit the load on the servers during normal loads, but
push it further for important loads without overloading the servers during
exceptional loads.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># The servers will accept between 100 and 1000 concurrent connections each</span>
<span class="comment"># and the maximum of 1000 will be reached when the backend reaches 10000</span>
<span class="comment"># connections.</span>
backend dynamic
   fullconn   10000
   server     srv1   dyn1:80 minconn 100 maxconn 1000
   server     srv2   dyn2:80 minconn 100 maxconn 1000
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#maxconn%20%28Proxies%29">Proxies</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;, &quot;<a href="#server">server</a>&quot;</div>
<a class="anchor" name="grace"></a><a class="anchor" name="4-grace"></a><a class="anchor" name="4.2-grace"></a><a class="anchor" name="grace (Proxies)"></a><a class="anchor" name="grace (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="grace"></a><a href="#4-grace">grace</a></b> <span style="color: #080">&lt;time&gt;</span></div><pre class="text">Maintain a proxy operational for some time after a soft stop</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;time&gt;    is the time (by default in milliseconds) for which the instance
          will remain operational with the frontend sockets still listening
          when a soft-stop is received via the SIGUSR1 signal.</pre>
</div>
<pre class="text">This may be used to ensure that the services disappear in a certain order.
This was designed so that frontends which are dedicated to monitoring by an
external equipment fail immediately while other ones remain up for the time
needed by the equipment to detect the failure.

Note that currently, there is very little benefit in using this parameter,
and it may in fact complicate the soft-reconfiguration process more than
simplify it.</pre><a class="anchor" name="hash-type"></a><a class="anchor" name="4-hash-type"></a><a class="anchor" name="4.2-hash-type"></a><a class="anchor" name="hash-type (Proxies)"></a><a class="anchor" name="hash-type (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="hash-type"></a><a href="#4-hash-type">hash-type</a></b> <span style="color: #080">&lt;method&gt;</span></div><pre class="text">Specify a method to use for mapping hashes to servers</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">map-based   the hash table is a static array containing all alive servers.
            The hashes will be very smooth, will consider weights, but will
            be static in that weight changes while a server is up will be
            ignored. This means that there will be no slow start. Also,
            since a server is selected by its position in the array, most
            mappings are changed when the server count changes. This means
            that when a server goes up or down, or when a server is added
            to a farm, most connections will be redistributed to different
            servers. This can be inconvenient with caches for instance.

consistent  the hash table is a tree filled with many occurrences of each
            server. The hash key is looked up in the tree and the closest
            server is chosen. This hash is dynamic, it supports changing
            weights while the servers are up, so it is compatible with the
            slow start feature. It has the advantage that when a server
            goes up or down, only its associations are moved. When a server
            is added to the farm, only a few part of the mappings are
            redistributed, making it an ideal algorithm for caches.
            However, due to its principle, the algorithm will never be very
            smooth and it may sometimes be necessary to adjust a server's
            weight or its ID to get a more balanced distribution. In order
            to get the same distribution on multiple load balancers, it is
            important that all servers have the same IDs.</pre>
</div>
<pre class="text">The default hash type is &quot;map-based&quot; and is recommended for most usages.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#balance">balance</a>&quot;, &quot;<a href="#server">server</a>&quot;</div>
<a class="anchor" name="http-check"></a><a class="anchor" name="4-http-check"></a><a class="anchor" name="4.2-http-check"></a><a class="anchor" name="http-check (Proxies)"></a><a class="anchor" name="http-check (Alphabetically sorted keywords reference)"></a><a class="anchor" name="http-check disable-on-404"></a><a class="anchor" name="4-http-check disable-on-404"></a><a class="anchor" name="4.2-http-check disable-on-404"></a><a class="anchor" name="http-check disable-on-404 (Proxies)"></a><a class="anchor" name="http-check disable-on-404 (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="http-check disable-on-404"></a><a href="#4-http-check%20disable-on-404">http-check disable-on-404</a></b></div><pre class="text">Enable a maintenance mode upon HTTP/404 response to health-checks</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When this option is set, a server which returns an HTTP code 404 will be
excluded from further load-balancing, but will still receive persistent
connections. This provides a very convenient method for Web administrators
to perform a graceful shutdown of their servers. It is also important to note
that a server which is detected as failed while it was in this mode will not
generate an alert, just a notice. If the server responds 2xx or 3xx again, it
will immediately be reinserted into the farm. The status on the stats page
reports &quot;NOLB&quot; for a server in this mode. It is important to note that this
option only works in conjunction with the &quot;<a href="#option%20httpchk">httpchk</a>&quot; option. If this option
is used with &quot;<a href="#http-check%20expect">http-check expect</a>&quot;, then it has precedence over it so that 404
responses will still be considered as soft-stop.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httpchk">option httpchk</a>&quot;, &quot;<a href="#http-check%20expect">http-check expect</a>&quot;</div>
<a class="anchor" name="http-check"></a><a class="anchor" name="4-http-check"></a><a class="anchor" name="4.2-http-check"></a><a class="anchor" name="http-check (Proxies)"></a><a class="anchor" name="http-check (Alphabetically sorted keywords reference)"></a><a class="anchor" name="http-check expect"></a><a class="anchor" name="4-http-check expect"></a><a class="anchor" name="4.2-http-check expect"></a><a class="anchor" name="http-check expect (Proxies)"></a><a class="anchor" name="http-check expect (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="http-check expect"></a><a href="#4-http-check%20expect">http-check expect</a></b> <span style="color: #008">[!]</span> <span style="color: #080">&lt;match&gt;</span> <span style="color: #080">&lt;pattern&gt;</span></div><pre class="text">Make HTTP health checks consider reponse contents or specific status codes</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;match&gt;   is a keyword indicating how to look for a specific pattern in the
          response. The keyword may be one of &quot;<a href="#status">status</a>&quot;, &quot;rstatus&quot;,
          &quot;string&quot;, or &quot;rstring&quot;. The keyword may be preceeded by an
          exclamation mark (&quot;!&quot;) to negate the match. Spaces are allowed
          between the exclamation mark and the keyword. See below for more
          details on the supported keywords.

&lt;pattern&gt; is the pattern to look for. It may be a string or a regular
          expression. If the pattern contains spaces, they must be escaped
          with the usual backslash ('\').</pre>
</div>
<pre class="text">By default, &quot;<a href="#option%20httpchk">option httpchk</a>&quot; considers that response statuses 2xx and 3xx
are valid, and that others are invalid. When &quot;<a href="#http-check%20expect">http-check expect</a>&quot; is used,
it defines what is considered valid or invalid. Only one &quot;<a href="#http-check">http-check</a>&quot;
statement is supported in a backend. If a server fails to respond or times
out, the check obviously fails. The available matches are :

  status &lt;string&gt; : test the exact string match for the HTTP status code.
                    A health check respose will be considered valid if the
                    response's status code is exactly this string. If the
                    &quot;<a href="#status">status</a>&quot; keyword is prefixed with &quot;!&quot;, then the response
                    will be considered invalid if the status code matches.

  rstatus &lt;regex&gt; : test a regular expression for the HTTP status code.
                    A health check respose will be considered valid if the
                    response's status code matches the expression. If the
                    &quot;rstatus&quot; keyword is prefixed with &quot;!&quot;, then the response
                    will be considered invalid if the status code matches.
                    This is mostly used to check for multiple codes.

  string &lt;string&gt; : test the exact string match in the HTTP response body.
                    A health check respose will be considered valid if the
                    response's body contains this exact string. If the
                    &quot;string&quot; keyword is prefixed with &quot;!&quot;, then the response
                    will be considered invalid if the body contains this
                    string. This can be used to look for a mandatory word at
                    the end of a dynamic page, or to detect a failure when a
                    specific error appears on the check page (eg: a stack
                    trace).

  rstring &lt;regex&gt; : test a regular expression on the HTTP response body.
                    A health check respose will be considered valid if the
                    response's body matches this expression. If the &quot;rstring&quot;
                    keyword is prefixed with &quot;!&quot;, then the response will be
                    considered invalid if the body matches the expression.
                    This can be used to look for a mandatory word at the end
                    of a dynamic page, or to detect a failure when a specific
                    error appears on the check page (eg: a stack trace).

It is important to note that the responses will be limited to a certain size
defined by the global &quot;<a href="#tune.chksize">tune.chksize</a>&quot; option, which defaults to 16384 bytes.
Thus, too large responses may not contain the mandatory pattern when using
&quot;string&quot; or &quot;rstring&quot;. If a large response is absolutely required, it is
possible to change the default max size by setting the global variable.
However, it is worth keeping in mind that parsing very large responses can
waste some CPU cycles, especially when regular expressions are used, and that
it is always better to focus the checks on smaller resources.

Last, if &quot;<a href="#http-check%20expect">http-check expect</a>&quot; is combined with &quot;<a href="#http-check%20disable-on-404">http-check disable-on-404</a>&quot;,
then this last one has precedence when the server responds with 404.</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code><span class="comment"># only accept status 200 as valid</span>
http-check expect status 200

<span class="comment"># consider SQL errors as errors</span>
http-check expect ! string SQL\ Error

<span class="comment"># consider status 5xx only as errors</span>
http-check expect ! rstatus ^5

<span class="comment"># check that we have a correct hexadecimal tag before /html</span>
http-check expect rstring &lt;!--tag:[0-9a-f]*&lt;/html&gt;
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httpchk">option httpchk</a>&quot;, &quot;<a href="#http-check%20disable-on-404">http-check disable-on-404</a>&quot;</div>
<a class="anchor" name="http-check"></a><a class="anchor" name="4-http-check"></a><a class="anchor" name="4.2-http-check"></a><a class="anchor" name="http-check (Proxies)"></a><a class="anchor" name="http-check (Alphabetically sorted keywords reference)"></a><a class="anchor" name="http-check send-state"></a><a class="anchor" name="4-http-check send-state"></a><a class="anchor" name="4.2-http-check send-state"></a><a class="anchor" name="http-check send-state (Proxies)"></a><a class="anchor" name="http-check send-state (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="http-check send-state"></a><a href="#4-http-check%20send-state">http-check send-state</a></b></div><pre class="text">Enable emission of a state header with HTTP health checks</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When this option is set, haproxy will systematically send a special header
&quot;X-Haproxy-Server-State&quot; with a list of parameters indicating to each server
how they are seen by haproxy. This can be used for instance when a server is
manipulated without access to haproxy and the operator needs to know whether
haproxy still sees it up or not, or if the server is the last one in a farm.

The header is composed of fields delimited by semi-colons, the first of which
is a word (&quot;UP&quot;, &quot;DOWN&quot;, &quot;NOLB&quot;), possibly followed by a number of valid
checks on the total number before transition, just as appears in the stats
interface. Next headers are in the form &quot;&lt;variable&gt;=&lt;value&gt;&quot;, indicating in
no specific order some values available in the stats interface :
  - a variable &quot;name&quot;, containing the name of the backend followed by a slash
    (&quot;/&quot;) then the name of the server. This can be used when a server is
    checked in multiple backends.

  - a variable &quot;<a href="#node">node</a>&quot; containing the name of the haproxy node, as set in the
    global &quot;<a href="#node">node</a>&quot; variable, otherwise the system's hostname if unspecified.

  - a variable &quot;<a href="#weight">weight</a>&quot; indicating the weight of the server, a slash (&quot;/&quot;)
    and the total weight of the farm (just counting usable servers). This
    helps to know if other servers are available to handle the load when this
    one fails.

  - a variable &quot;scur&quot; indicating the current number of concurrent connections
    on the server, followed by a slash (&quot;/&quot;) then the total number of
    connections on all servers of the same backend.

  - a variable &quot;qcur&quot; indicating the current number of requests in the
    server's queue.

Example of a header received by the application server :
  &gt;&gt;&gt;  X-Haproxy-Server-State: UP 2/3; name=bck/srv2; node=lb1; weight=1/2; \
         scur=13/22; qcur=0</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httpchk">option httpchk</a>&quot;, &quot;<a href="#http-check%20disable-on-404">http-check disable-on-404</a>&quot;</div>
<a class="anchor" name="http-request"></a><a class="anchor" name="4-http-request"></a><a class="anchor" name="4.2-http-request"></a><a class="anchor" name="http-request (Proxies)"></a><a class="anchor" name="http-request (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="http-request"></a><a href="#4-http-request">http-request</a></b> <span style="color: #800">{ allow | deny | auth <span style="color: #008">[realm <span style="color: #080">&lt;realm&gt;</span>]</span> }</span>
             <span style="color: #008">[ <span style="color: #800">{ if | unless }</span> <span style="color: #080">&lt;condition&gt;</span> ]</span></div><pre class="text">Access control for Layer 7 requests</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">These set of options allow to fine control access to a
frontend/listen/backend. Each option may be followed by if/unless and acl.
First option with matched condition (or option without condition) is final.
For &quot;deny&quot; a 403 error will be returned, for &quot;allow&quot; normal processing is
performed, for &quot;auth&quot; a 401/407 error code is returned so the client
should be asked to enter a username and password.

There is no fixed limit to the number of http-request statements per
instance.</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>acl nagios src 192.168.129.3
acl local_net src 192.168.0.0/16
acl auth_ok http_auth(L1)

http-request allow if nagios
http-request allow if local_net auth_ok
http-request auth realm Gimme if local_net auth_ok
http-request deny
</code></pre>
</div><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>acl auth_ok http_auth_group(L1) G1

http-request auth unless auth_ok
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stats%20http-request">stats http-request</a>&quot;, <a href="#3.4">section 3.4</a> about userlists and <a href="#7">section 7</a> about ACL usage.</div>
<a class="anchor" name="http-send-name-header"></a><a class="anchor" name="4-http-send-name-header"></a><a class="anchor" name="4.2-http-send-name-header"></a><a class="anchor" name="http-send-name-header (Proxies)"></a><a class="anchor" name="http-send-name-header (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="http-send-name-header"></a><a href="#4-http-send-name-header">http-send-name-header</a></b> <span style="color: #008">[<span style="color: #080">&lt;header&gt;</span>]</span></div><pre class="text">Add the server name to a request. Use the header string given by &lt;header&gt;</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;header&gt;  The header string to use to send the server name</pre>
</div>
<pre class="text">The &quot;<a href="#http-send-name-header">http-send-name-header</a>&quot; statement causes the name of the target
server to be added to the headers of an HTTP request.  The name
is added with the header string proved.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#server">server</a>&quot;</div>
<a class="anchor" name="id"></a><a class="anchor" name="4-id"></a><a class="anchor" name="4.2-id"></a><a class="anchor" name="id (Proxies)"></a><a class="anchor" name="id (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="id"></a><a href="#4-id">id</a></b> <span style="color: #080">&lt;value&gt;</span></div><pre class="text">Set a persistent ID to a proxy.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">Set a persistent ID for the proxy. This ID must be unique and positive.
An unused ID will automatically be assigned if unset. The first assigned
value will be 1. This ID is currently only returned in statistics.</pre><a class="anchor" name="ignore-persist"></a><a class="anchor" name="4-ignore-persist"></a><a class="anchor" name="4.2-ignore-persist"></a><a class="anchor" name="ignore-persist (Proxies)"></a><a class="anchor" name="ignore-persist (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="ignore-persist"></a><a href="#4-ignore-persist">ignore-persist</a></b> <span style="color: #800">{ if | unless }</span> <span style="color: #080">&lt;condition&gt;</span></div><pre class="text">Declare a condition to ignore persistence</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">By default, when cookie persistence is enabled, every requests containing
the cookie are unconditionally persistent (assuming the target server is up
and running).

The &quot;<a href="#ignore-persist">ignore-persist</a>&quot; statement allows one to declare various ACL-based
conditions which, when met, will cause a request to ignore persistence.
This is sometimes useful to load balance requests for static files, which
oftenly don't require persistence. This can also be used to fully disable
persistence for a specific User-Agent (for example, some web crawler bots).

Combined with &quot;<a href="#appsession">appsession</a>&quot;, it can also help reduce HAProxy memory usage, as
the appsession table won't grow if persistence is ignored.

The persistence is ignored when an &quot;if&quot; condition is met, or unless an
&quot;unless&quot; condition is met.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#force-persist">force-persist</a>&quot;, &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">cookie<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#cookie%20%28Proxies%29">Proxies</a></li><li><a href="#cookie%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;, and <a href="#7">section 7</a> about ACL usage.</div>
<a class="anchor" name="log"></a><a class="anchor" name="4-log"></a><a class="anchor" name="4.2-log"></a><a class="anchor" name="log (Proxies)"></a><a class="anchor" name="log (Alphabetically sorted keywords reference)"></a><a class="anchor" name="log global"></a><a class="anchor" name="4-log global"></a><a class="anchor" name="4.2-log global"></a><a class="anchor" name="log global (Proxies)"></a><a class="anchor" name="log global (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="log global"></a><a href="#4-log%20global">log global</a></b></div><a class="anchor" name="log"></a><a class="anchor" name="4-log"></a><a class="anchor" name="4.2-log"></a><a class="anchor" name="log (Proxies)"></a><a class="anchor" name="log (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="log"></a><a href="#4-log">log</a></b> <span style="color: #080">&lt;address&gt;</span> <span style="color: #080">&lt;facility&gt;</span> <span style="color: #008">[<span style="color: #080">&lt;level&gt;</span> <span style="color: #008">[<span style="color: #080">&lt;minlevel&gt;</span>]</span>]</span></div><pre class="text">Enable per-instance logging of events and traffic.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">global     should be used when the instance's logging parameters are the
           same as the global ones. This is the most common usage. &quot;global&quot;
           replaces &lt;address&gt;, &lt;facility&gt; and &lt;level&gt; with those of the log
           entries found in the &quot;global&quot; section. Only one &quot;<a href="#log%20global">log global</a>&quot;
           statement may be used per instance, and this form takes no other
           parameter.

&lt;address&gt;  indicates where to send the logs. It takes the same format as
           for the &quot;global&quot; section's logs, and can be one of :

           - An IPv4 address optionally followed by a colon (':') and a UDP
             port. If no port is specified, 514 is used by default (the
             standard syslog port).

           - A filesystem path to a UNIX domain socket, keeping in mind
             considerations for chroot (be sure the path is accessible
             inside the chroot) and uid/gid (be sure the path is
             appropriately writeable).

&lt;facility&gt; must be one of the 24 standard syslog facilities :

             kern   user   mail   daemon auth   syslog lpr    news
             uucp   cron   auth2  ftp    ntp    audit  alert  cron2
             local0 local1 local2 local3 local4 local5 local6 local7

&lt;level&gt;    is optional and can be specified to filter outgoing messages. By
           default, all messages are sent. If a level is specified, only
           messages with a severity at least as important as this level
           will be sent. An optional minimum level can be specified. If it
           is set, logs emitted with a more severe level than this one will
           be capped to this level. This is used to avoid sending &quot;emerg&quot;
           messages on all terminals on some default syslog configurations.
           Eight levels are known :

             emerg  alert  crit   err    warning notice info  debug</pre>
</div>
<pre class="text">Note that up to two &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">log<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#log%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#log%20%28Proxies%29">Proxies</a></li></ul></span>&quot; entries may be specified per instance. However, if
&quot;<a href="#log%20global">log global</a>&quot; is used and if the &quot;global&quot; section already contains 2 log
entries, then additional log entries will be ignored.

Also, it is important to keep in mind that it is the frontend which decides
what to log from a connection, and that in case of content switching, the log
entries from the backend will be ignored. Connections are logged at level
&quot;info&quot;.

However, backend log declaration define how and where servers status changes
will be logged. Level &quot;notice&quot; will be used to indicate a server going up,
&quot;warning&quot; will be used for termination signals and definitive service
termination, and &quot;alert&quot; will be used for when a server goes down.

Note : According to RFC3164, messages are truncated to 1024 bytes before
       being emitted.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>log global
log 127.0.0.1:514 local0 notice         <span class="comment"># only send important events</span>
log 127.0.0.1:514 local0 notice notice  <span class="comment"># same but limit output level</span>
</code></pre>
</div><a class="anchor" name="maxconn"></a><a class="anchor" name="4-maxconn"></a><a class="anchor" name="4.2-maxconn"></a><a class="anchor" name="maxconn (Proxies)"></a><a class="anchor" name="maxconn (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="maxconn"></a><a href="#4-maxconn">maxconn</a></b> <span style="color: #080">&lt;conns&gt;</span></div><pre class="text">Fix the maximum number of concurrent connections on a frontend</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;conns&gt;   is the maximum number of concurrent connections the frontend will
          accept to serve. Excess connections will be queued by the system
          in the socket's listen queue and will be served once a connection
          closes.</pre>
</div>
<pre class="text">If the system supports it, it can be useful on big sites to raise this limit
very high so that haproxy manages connection queues, instead of leaving the
clients with unanswered connection attempts. This value should not exceed the
global maxconn. Also, keep in mind that a connection contains two buffers
of 8kB each, as well as some other data resulting in about 17 kB of RAM being
consumed per established connection. That means that a medium system equipped
with 1GB of RAM can withstand around 40000-50000 concurrent connections if
properly tuned.

Also, when &lt;conns&gt; is set to large values, it is possible that the servers
are not sized to accept such loads, and for this reason it is generally wise
to assign them some reasonable connection limits.

By default, this value is set to 2000.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#server">server</a>&quot;, global section's &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#maxconn%20%28Proxies%29">Proxies</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;, &quot;<a href="#fullconn">fullconn</a>&quot;</div>
<a class="anchor" name="mode"></a><a class="anchor" name="4-mode"></a><a class="anchor" name="4.2-mode"></a><a class="anchor" name="mode (Proxies)"></a><a class="anchor" name="mode (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="mode"></a><a href="#4-mode">mode</a></b> <span style="color: #800">{ tcp|http|health }</span></div><pre class="text">Set the running mode or protocol of the instance</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">tcp       The instance will work in pure TCP mode. A full-duplex connection
          will be established between clients and servers, and no layer 7
          examination will be performed. This is the default mode. It
          should be used for SSL, SSH, SMTP, ...

http      The instance will work in HTTP mode. The client request will be
          analyzed in depth before connecting to any server. Any request
          which is not RFC-compliant will be rejected. Layer 7 filtering,
          processing and switching will be possible. This is the mode which
          brings HAProxy most of its value.

health    The instance will work in &quot;health&quot; mode. It will just reply &quot;OK&quot;
          to incoming connections and close the connection. Nothing will be
          logged. This mode is used to reply to external components health
          checks. This mode is deprecated and should not be used anymore as
          it is possible to do the same and even better by combining TCP or
          HTTP modes with the &quot;<a href="#monitor">monitor</a>&quot; keyword.</pre>
</div>
<pre class="text">When doing content switching, it is mandatory that the frontend and the
backend are in the same mode (generally HTTP), otherwise the configuration
will be refused.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>defaults http_instances
    mode http
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#monitor">monitor</a>&quot;, &quot;<a href="#monitor-net">monitor-net</a>&quot;</div>
<a class="anchor" name="monitor"></a><a class="anchor" name="4-monitor"></a><a class="anchor" name="4.2-monitor"></a><a class="anchor" name="monitor (Proxies)"></a><a class="anchor" name="monitor (Alphabetically sorted keywords reference)"></a><a class="anchor" name="monitor fail"></a><a class="anchor" name="4-monitor fail"></a><a class="anchor" name="4.2-monitor fail"></a><a class="anchor" name="monitor fail (Proxies)"></a><a class="anchor" name="monitor fail (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="monitor fail"></a><a href="#4-monitor%20fail">monitor fail</a></b> <span style="color: #800">{ if | unless }</span> <span style="color: #080">&lt;condition&gt;</span></div><pre class="text">Add a condition to report a failure to a monitor HTTP request.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">if &lt;cond&gt;     the monitor request will fail if the condition is satisfied,
              and will succeed otherwise. The condition should describe a
              combined test which must induce a failure if all conditions
              are met, for instance a low number of servers both in a
              backend and its backup.

unless &lt;cond&gt; the monitor request will succeed only if the condition is
              satisfied, and will fail otherwise. Such a condition may be
              based on a test on the presence of a minimum number of active
              servers in a list of backends.</pre>
</div>
<pre class="text">This statement adds a condition which can force the response to a monitor
request to report a failure. By default, when an external component queries
the URI dedicated to monitoring, a 200 response is returned. When one of the
conditions above is met, haproxy will return 503 instead of 200. This is
very useful to report a site failure to an external component which may base
routing advertisements between multiple sites on the availability reported by
haproxy. In this case, one would rely on an ACL involving the &quot;<a href="#nbsrv">nbsrv</a>&quot;
criterion. Note that &quot;<a href="#monitor%20fail">monitor fail</a>&quot; only works in HTTP mode. Both status
messages may be tweaked using &quot;<a href="#errorfile">errorfile</a>&quot; or &quot;<a href="#errorloc">errorloc</a>&quot; if needed.</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>frontend www
   mode http
   acl site_dead nbsrv(dynamic) lt 2
   acl site_dead nbsrv(static)  lt 2
   monitor-uri   /site_alive
   monitor fail  if site_dead
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#monitor-net">monitor-net</a>&quot;, &quot;<a href="#monitor-uri">monitor-uri</a>&quot;, &quot;<a href="#errorfile">errorfile</a>&quot;, &quot;<a href="#errorloc">errorloc</a>&quot;</div>
<a class="anchor" name="monitor-net"></a><a class="anchor" name="4-monitor-net"></a><a class="anchor" name="4.2-monitor-net"></a><a class="anchor" name="monitor-net (Proxies)"></a><a class="anchor" name="monitor-net (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="monitor-net"></a><a href="#4-monitor-net">monitor-net</a></b> <span style="color: #080">&lt;source&gt;</span></div><pre class="text">Declare a source network which is limited to monitor requests</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;source&gt;  is the source IPv4 address or network which will only be able to
          get monitor responses to any request. It can be either an IPv4
          address, a host name, or an address followed by a slash ('/')
          followed by a mask.</pre>
</div>
<pre class="text">In TCP mode, any connection coming from a source matching &lt;source&gt; will cause
the connection to be immediately closed without any log. This allows another
equipment to probe the port and verify that it is still listening, without
forwarding the connection to a remote server.

In HTTP mode, a connection coming from a source matching &lt;source&gt; will be
accepted, the following response will be sent without waiting for a request,
then the connection will be closed : &quot;HTTP/1.0 200 OK&quot;. This is normally
enough for any front-end HTTP probe to detect that the service is UP and
running without forwarding the request to a backend server.

Monitor requests are processed very early. It is not possible to block nor
divert them using ACLs. They cannot be logged either, and it is the intended
purpose. They are only used to report HAProxy's health to an upper component,
nothing more. Right now, it is not possible to set failure conditions on
requests caught by &quot;<a href="#monitor-net">monitor-net</a>&quot;.

Last, please note that only one &quot;<a href="#monitor-net">monitor-net</a>&quot; statement can be specified in
a frontend. If more than one is found, only the last one will be considered.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># addresses .252 and .253 are just probing us.</span>
frontend www
    monitor-net 192.168.0.252/31
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#monitor%20fail">monitor fail</a>&quot;, &quot;<a href="#monitor-uri">monitor-uri</a>&quot;</div>
<a class="anchor" name="monitor-uri"></a><a class="anchor" name="4-monitor-uri"></a><a class="anchor" name="4.2-monitor-uri"></a><a class="anchor" name="monitor-uri (Proxies)"></a><a class="anchor" name="monitor-uri (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="monitor-uri"></a><a href="#4-monitor-uri">monitor-uri</a></b> <span style="color: #080">&lt;uri&gt;</span></div><pre class="text">Intercept a URI used by external components' monitor requests</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;uri&gt;     is the exact URI which we want to intercept to return HAProxy's
          health status instead of forwarding the request.</pre>
</div>
<pre class="text">When an HTTP request referencing &lt;uri&gt; will be received on a frontend,
HAProxy will not forward it nor log it, but instead will return either
&quot;HTTP/1.0 200 OK&quot; or &quot;HTTP/1.0 503 Service unavailable&quot;, depending on failure
conditions defined with &quot;<a href="#monitor%20fail">monitor fail</a>&quot;. This is normally enough for any
front-end HTTP probe to detect that the service is UP and running without
forwarding the request to a backend server. Note that the HTTP method, the
version and all headers are ignored, but the request must at least be valid
at the HTTP level. This keyword may only be used with an HTTP-mode frontend.

Monitor requests are processed very early. It is not possible to block nor
divert them using ACLs. They cannot be logged either, and it is the intended
purpose. They are only used to report HAProxy's health to an upper component,
nothing more. However, it is possible to add any number of conditions using
&quot;<a href="#monitor%20fail">monitor fail</a>&quot; and ACLs so that the result can be adjusted to whatever check
can be imagined (most often the number of available servers in a backend).</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># Use /haproxy_test to report haproxy's status</span>
frontend www
    mode http
    monitor-uri /haproxy_test
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#monitor%20fail">monitor fail</a>&quot;, &quot;<a href="#monitor-net">monitor-net</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option abortonclose"></a><a class="anchor" name="4-option abortonclose"></a><a class="anchor" name="4.2-option abortonclose"></a><a class="anchor" name="option abortonclose (Proxies)"></a><a class="anchor" name="option abortonclose (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option abortonclose"></a><a href="#4-option%20abortonclose">option abortonclose</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option abortonclose"></a><a class="anchor" name="4-no option abortonclose"></a><a class="anchor" name="4.2-no option abortonclose"></a><a class="anchor" name="no option abortonclose (Proxies)"></a><a class="anchor" name="no option abortonclose (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option abortonclose"></a><a href="#4-no%20option%20abortonclose">no option abortonclose</a></b></div><pre class="text">Enable or disable early dropping of aborted requests pending in queues.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">In presence of very high loads, the servers will take some time to respond.
The per-instance connection queue will inflate, and the response time will
increase respective to the size of the queue times the average per-session
response time. When clients will wait for more than a few seconds, they will
often hit the &quot;STOP&quot; button on their browser, leaving a useless request in
the queue, and slowing down other users, and the servers as well, because the
request will eventually be served, then aborted at the first error
encountered while delivering the response.

As there is no way to distinguish between a full STOP and a simple output
close on the client side, HTTP agents should be conservative and consider
that the client might only have closed its output channel while waiting for
the response. However, this introduces risks of congestion when lots of users
do the same, and is completely useless nowadays because probably no client at
all will close the session while waiting for the response. Some HTTP agents
support this behaviour (Squid, Apache, HAProxy), and others do not (TUX, most
hardware-based load balancers). So the probability for a closed input channel
to represent a user hitting the &quot;STOP&quot; button is close to 100%, and the risk
of being the single component to break rare but valid traffic is extremely
low, which adds to the temptation to be able to abort a session early while
still not served and not pollute the servers.

In HAProxy, the user can choose the desired behaviour using the option
&quot;<a href="#option%20abortonclose">abortonclose</a>&quot;. By default (without the option) the behaviour is HTTP
compliant and aborted requests will be served. But when the option is
specified, a session with an incoming channel closed will be aborted while
it is still possible, either pending in the queue for a connection slot, or
during the connection establishment if the server has not yet acknowledged
the connection request. This considerably reduces the queue size and the load
on saturated servers when users are tempted to click on STOP, which in turn
reduces the response time for other users.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#timeout%20queue">timeout queue</a>&quot; and server's &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#maxconn%20%28Proxies%29">Proxies</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; and &quot;<a href="#maxqueue">maxqueue</a>&quot; parameters</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option accept-invalid-http-request"></a><a class="anchor" name="4-option accept-invalid-http-request"></a><a class="anchor" name="4.2-option accept-invalid-http-request"></a><a class="anchor" name="option accept-invalid-http-request (Proxies)"></a><a class="anchor" name="option accept-invalid-http-request (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option accept-invalid-http-request"></a><a href="#4-option%20accept-invalid-http-request">option accept-invalid-http-request</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option accept-invalid-http-request"></a><a class="anchor" name="4-no option accept-invalid-http-request"></a><a class="anchor" name="4.2-no option accept-invalid-http-request"></a><a class="anchor" name="no option accept-invalid-http-request (Proxies)"></a><a class="anchor" name="no option accept-invalid-http-request (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option accept-invalid-http-request"></a><a href="#4-no%20option%20accept-invalid-http-request">no option accept-invalid-http-request</a></b></div><pre class="text">Enable or disable relaxing of HTTP request parsing</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default, HAProxy complies with RFC2616 in terms of message parsing. This
means that invalid characters in header names are not permitted and cause an
error to be returned to the client. This is the desired behaviour as such
forbidden characters are essentially used to build attacks exploiting server
weaknesses, and bypass security filtering. Sometimes, a buggy browser or
server will emit invalid header names for whatever reason (configuration,
implementation) and the issue will not be immediately fixed. In such a case,
it is possible to relax HAProxy's header name parser to accept any character
even if that does not make sense, by specifying this option.

This option should never be enabled by default as it hides application bugs
and open security breaches. It should only be deployed after a problem has
been confirmed.

When this option is enabled, erroneous header names will still be accepted in
requests, but the complete request will be captured in order to permit later
analysis using the &quot;<a href="#show%20errors">show errors</a>&quot; request on the UNIX stats socket. Doing this
also helps confirming that the issue has been solved.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20accept-invalid-http-response">option accept-invalid-http-response</a>&quot; and &quot;<a href="#show%20errors">show errors</a>&quot; on the stats socket.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option accept-invalid-http-response"></a><a class="anchor" name="4-option accept-invalid-http-response"></a><a class="anchor" name="4.2-option accept-invalid-http-response"></a><a class="anchor" name="option accept-invalid-http-response (Proxies)"></a><a class="anchor" name="option accept-invalid-http-response (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option accept-invalid-http-response"></a><a href="#4-option%20accept-invalid-http-response">option accept-invalid-http-response</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option accept-invalid-http-response"></a><a class="anchor" name="4-no option accept-invalid-http-response"></a><a class="anchor" name="4.2-no option accept-invalid-http-response"></a><a class="anchor" name="no option accept-invalid-http-response (Proxies)"></a><a class="anchor" name="no option accept-invalid-http-response (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option accept-invalid-http-response"></a><a href="#4-no%20option%20accept-invalid-http-response">no option accept-invalid-http-response</a></b></div><pre class="text">Enable or disable relaxing of HTTP response parsing</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default, HAProxy complies with RFC2616 in terms of message parsing. This
means that invalid characters in header names are not permitted and cause an
error to be returned to the client. This is the desired behaviour as such
forbidden characters are essentially used to build attacks exploiting server
weaknesses, and bypass security filtering. Sometimes, a buggy browser or
server will emit invalid header names for whatever reason (configuration,
implementation) and the issue will not be immediately fixed. In such a case,
it is possible to relax HAProxy's header name parser to accept any character
even if that does not make sense, by specifying this option.

This option should never be enabled by default as it hides application bugs
and open security breaches. It should only be deployed after a problem has
been confirmed.

When this option is enabled, erroneous header names will still be accepted in
responses, but the complete response will be captured in order to permit
later analysis using the &quot;<a href="#show%20errors">show errors</a>&quot; request on the UNIX stats socket.
Doing this also helps confirming that the issue has been solved.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20accept-invalid-http-request">option accept-invalid-http-request</a>&quot; and &quot;<a href="#show%20errors">show errors</a>&quot; on the stats socket.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option allbackups"></a><a class="anchor" name="4-option allbackups"></a><a class="anchor" name="4.2-option allbackups"></a><a class="anchor" name="option allbackups (Proxies)"></a><a class="anchor" name="option allbackups (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option allbackups"></a><a href="#4-option%20allbackups">option allbackups</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option allbackups"></a><a class="anchor" name="4-no option allbackups"></a><a class="anchor" name="4.2-no option allbackups"></a><a class="anchor" name="no option allbackups (Proxies)"></a><a class="anchor" name="no option allbackups (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option allbackups"></a><a href="#4-no%20option%20allbackups">no option allbackups</a></b></div><pre class="text">Use either all backup servers at a time or only the first one</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default, the first operational backup server gets all traffic when normal
servers are all down. Sometimes, it may be preferred to use multiple backups
at once, because one will not be enough. When &quot;<a href="#option%20allbackups">option allbackups</a>&quot; is enabled,
the load balancing will be performed among all backup servers when all normal
ones are unavailable. The same load balancing algorithm will be used and the
servers' weights will be respected. Thus, there will not be any priority
order between the backup servers anymore.

This option is mostly used with static server farms dedicated to return a
&quot;sorry&quot; page when an application is completely offline.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.</pre><a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option checkcache"></a><a class="anchor" name="4-option checkcache"></a><a class="anchor" name="4.2-option checkcache"></a><a class="anchor" name="option checkcache (Proxies)"></a><a class="anchor" name="option checkcache (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option checkcache"></a><a href="#4-option%20checkcache">option checkcache</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option checkcache"></a><a class="anchor" name="4-no option checkcache"></a><a class="anchor" name="4.2-no option checkcache"></a><a class="anchor" name="no option checkcache (Proxies)"></a><a class="anchor" name="no option checkcache (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option checkcache"></a><a href="#4-no%20option%20checkcache">no option checkcache</a></b></div><pre class="text">Analyze all server responses and block requests with cacheable cookies</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">Some high-level frameworks set application cookies everywhere and do not
always let enough control to the developer to manage how the responses should
be cached. When a session cookie is returned on a cacheable object, there is a
high risk of session crossing or stealing between users traversing the same
caches. In some situations, it is better to block the response than to let
some sensitive session information go in the wild.

The option &quot;<a href="#option%20checkcache">checkcache</a>&quot; enables deep inspection of all server responses for
strict compliance with HTTP specification in terms of cacheability. It
carefully checks &quot;Cache-control&quot;, &quot;Pragma&quot; and &quot;Set-cookie&quot; headers in server
response to check if there's a risk of caching a cookie on a client-side
proxy. When this option is enabled, the only responses which can be delivered
to the client are :
  - all those without &quot;Set-Cookie&quot; header ;
  - all those with a return code other than 200, 203, 206, 300, 301, 410,
    provided that the server has not set a &quot;Cache-control: public&quot; header ;
  - all those that come from a POST request, provided that the server has not
    set a 'Cache-Control: public' header ;
  - those with a 'Pragma: no-cache' header
  - those with a 'Cache-control: private' header
  - those with a 'Cache-control: no-store' header
  - those with a 'Cache-control: max-age=0' header
  - those with a 'Cache-control: s-maxage=0' header
  - those with a 'Cache-control: no-cache' header
  - those with a 'Cache-control: no-cache=&quot;set-cookie&quot;' header
  - those with a 'Cache-control: no-cache=&quot;set-cookie,' header
    (allowing other fields after set-cookie)

If a response doesn't respect these requirements, then it will be blocked
just as if it was from an &quot;<a href="#rspdeny">rspdeny</a>&quot; filter, with an &quot;HTTP 502 bad gateway&quot;.
The session state shows &quot;PH--&quot; meaning that the proxy blocked the response
during headers processing. Additionally, an alert will be sent in the logs so
that admins are informed that there's something to be fixed.

Due to the high impact on the application, the application should be tested
in depth with the option enabled before going to production. It is also a
good practice to always activate it during tests, even if it is not used in
production, as it will report potentially dangerous application behaviours.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.</pre><a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option clitcpka"></a><a class="anchor" name="4-option clitcpka"></a><a class="anchor" name="4.2-option clitcpka"></a><a class="anchor" name="option clitcpka (Proxies)"></a><a class="anchor" name="option clitcpka (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option clitcpka"></a><a href="#4-option%20clitcpka">option clitcpka</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option clitcpka"></a><a class="anchor" name="4-no option clitcpka"></a><a class="anchor" name="4.2-no option clitcpka"></a><a class="anchor" name="no option clitcpka (Proxies)"></a><a class="anchor" name="no option clitcpka (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option clitcpka"></a><a href="#4-no%20option%20clitcpka">no option clitcpka</a></b></div><pre class="text">Enable or disable the sending of TCP keepalive packets on the client side</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When there is a firewall or any session-aware component between a client and
a server, and when the protocol involves very long sessions with long idle
periods (eg: remote desktops), there is a risk that one of the intermediate
components decides to expire a session which has remained idle for too long.

Enabling socket-level TCP keep-alives makes the system regularly send packets
to the other end of the connection, leaving it active. The delay between
keep-alive probes is controlled by the system only and depends both on the
operating system and its tuning parameters.

It is important to understand that keep-alive packets are neither emitted nor
received at the application level. It is only the network stacks which sees
them. For this reason, even if one side of the proxy already uses keep-alives
to maintain its connection alive, those keep-alive packets will not be
forwarded to the other side of the proxy.

Please note that this has nothing to do with HTTP keep-alive.

Using option &quot;<a href="#option%20clitcpka">clitcpka</a>&quot; enables the emission of TCP keep-alive probes on the
client side of a connection, which should help when session expirations are
noticed between HAProxy and a client.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20srvtcpka">option srvtcpka</a>&quot;, &quot;<a href="#option%20tcpka">option tcpka</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option contstats"></a><a class="anchor" name="4-option contstats"></a><a class="anchor" name="4.2-option contstats"></a><a class="anchor" name="option contstats (Proxies)"></a><a class="anchor" name="option contstats (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option contstats"></a><a href="#4-option%20contstats">option contstats</a></b></div><pre class="text">Enable continuous traffic statistics updates</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default, counters used for statistics calculation are incremented
only when a session finishes. It works quite well when serving small
objects, but with big ones (for example large images or archives) or
with A/V streaming, a graph generated from haproxy counters looks like
a hedgehog. With this option enabled counters get incremented continuously,
during a whole session. Recounting touches a hotpath directly so
it is not enabled by default, as it has small performance impact (~0.5%).</pre><a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option dontlog-normal"></a><a class="anchor" name="4-option dontlog-normal"></a><a class="anchor" name="4.2-option dontlog-normal"></a><a class="anchor" name="option dontlog-normal (Proxies)"></a><a class="anchor" name="option dontlog-normal (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option dontlog-normal"></a><a href="#4-option%20dontlog-normal">option dontlog-normal</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option dontlog-normal"></a><a class="anchor" name="4-no option dontlog-normal"></a><a class="anchor" name="4.2-no option dontlog-normal"></a><a class="anchor" name="no option dontlog-normal (Proxies)"></a><a class="anchor" name="no option dontlog-normal (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option dontlog-normal"></a><a href="#4-no%20option%20dontlog-normal">no option dontlog-normal</a></b></div><pre class="text">Enable or disable logging of normal, successful connections</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">There are large sites dealing with several thousand connections per second
and for which logging is a major pain. Some of them are even forced to turn
logs off and cannot debug production issues. Setting this option ensures that
normal connections, those which experience no error, no timeout, no retry nor
redispatch, will not be logged. This leaves disk space for anomalies. In HTTP
mode, the response status code is checked and return codes 5xx will still be
logged.

It is strongly discouraged to use this option as most of the time, the key to
complex issues is in the normal logs which will not be logged here. If you
need to separate logs, see the &quot;<a href="#option%20log-separate-errors">log-separate-errors</a>&quot; option instead.</pre><div class="page-header"><b>See also :</b> &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">log<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#log%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#log%20%28Proxies%29">Proxies</a></li></ul></span>&quot;, &quot;<a href="#option%20dontlognull">dontlognull</a>&quot;, &quot;<a href="#option%20log-separate-errors">log-separate-errors</a>&quot; and <a href="#8">section 8</a> about logging.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option dontlognull"></a><a class="anchor" name="4-option dontlognull"></a><a class="anchor" name="4.2-option dontlognull"></a><a class="anchor" name="option dontlognull (Proxies)"></a><a class="anchor" name="option dontlognull (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option dontlognull"></a><a href="#4-option%20dontlognull">option dontlognull</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option dontlognull"></a><a class="anchor" name="4-no option dontlognull"></a><a class="anchor" name="4.2-no option dontlognull"></a><a class="anchor" name="no option dontlognull (Proxies)"></a><a class="anchor" name="no option dontlognull (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option dontlognull"></a><a href="#4-no%20option%20dontlognull">no option dontlognull</a></b></div><pre class="text">Enable or disable logging of null connections</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">In certain environments, there are components which will regularly connect to
various systems to ensure that they are still alive. It can be the case from
another load balancer as well as from monitoring systems. By default, even a
simple port probe or scan will produce a log. If those connections pollute
the logs too much, it is possible to enable option &quot;<a href="#option%20dontlognull">dontlognull</a>&quot; to indicate
that a connection on which no data has been transferred will not be logged,
which typically corresponds to those probes.

It is generally recommended not to use this option in uncontrolled
environments (eg: internet), otherwise scans and other malicious activities
would not be logged.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.</pre><div class="page-header"><b>See also :</b> &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">log<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#log%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#log%20%28Proxies%29">Proxies</a></li></ul></span>&quot;, &quot;<a href="#monitor-net">monitor-net</a>&quot;, &quot;<a href="#monitor-uri">monitor-uri</a>&quot; and <a href="#8">section 8</a> about logging.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option forceclose"></a><a class="anchor" name="4-option forceclose"></a><a class="anchor" name="4.2-option forceclose"></a><a class="anchor" name="option forceclose (Proxies)"></a><a class="anchor" name="option forceclose (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option forceclose"></a><a href="#4-option%20forceclose">option forceclose</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option forceclose"></a><a class="anchor" name="4-no option forceclose"></a><a class="anchor" name="4.2-no option forceclose"></a><a class="anchor" name="no option forceclose (Proxies)"></a><a class="anchor" name="no option forceclose (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option forceclose"></a><a href="#4-no%20option%20forceclose">no option forceclose</a></b></div><pre class="text">Enable or disable active connection closing after response is transferred.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">Some HTTP servers do not necessarily close the connections when they receive
the &quot;Connection: close&quot; set by &quot;<a href="#option%20httpclose">option httpclose</a>&quot;, and if the client does not
close either, then the connection remains open till the timeout expires. This
causes high number of simultaneous connections on the servers and shows high
global session times in the logs.

When this happens, it is possible to use &quot;<a href="#option%20forceclose">option forceclose</a>&quot;. It will
actively close the outgoing server channel as soon as the server has finished
to respond. This option implicitly enables the &quot;<a href="#option%20httpclose">httpclose</a>&quot; option. Note that
this option also enables the parsing of the full request and response, which
means we can close the connection to the server very quickly, releasing some
resources earlier than with httpclose.

This option may also be combined with &quot;<a href="#option%20http-pretend-keepalive">option http-pretend-keepalive</a>&quot;, which
will disable sending of the &quot;Connection: close&quot; header, but will still cause
the connection to be closed once the whole response is received.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httpclose">option httpclose</a>&quot; and &quot;<a href="#option%20http-pretend-keepalive">option http-pretend-keepalive</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option forwardfor"></a><a class="anchor" name="4-option forwardfor"></a><a class="anchor" name="4.2-option forwardfor"></a><a class="anchor" name="option forwardfor (Proxies)"></a><a class="anchor" name="option forwardfor (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option forwardfor"></a><a href="#4-option%20forwardfor">option forwardfor</a></b> <span style="color: #008">[ except <span style="color: #080">&lt;network&gt;</span> ]</span> <span style="color: #008">[ header <span style="color: #080">&lt;name&gt;</span> ]</span> <span style="color: #008">[ if-none ]</span></div><pre class="text">Enable insertion of the X-Forwarded-For header to requests sent to servers</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;network&gt; is an optional argument used to disable this option for sources
          matching &lt;network&gt;
&lt;name&gt;    an optional argument to specify a different &quot;X-Forwarded-For&quot;
          header name.</pre>
</div>
<pre class="text">Since HAProxy works in reverse-proxy mode, the servers see its IP address as
their client address. This is sometimes annoying when the client's IP address
is expected in server logs. To solve this problem, the well-known HTTP header
&quot;X-Forwarded-For&quot; may be added by HAProxy to all requests sent to the server.
This header contains a value representing the client's IP address. Since this
header is always appended at the end of the existing header list, the server
must be configured to always use the last occurrence of this header only. See
the server's manual to find how to enable use of this standard header. Note
that only the last occurrence of the header must be used, since it is really
possible that the client has already brought one.

The keyword &quot;header&quot; may be used to supply a different header name to replace
the default &quot;X-Forwarded-For&quot;. This can be useful where you might already
have a &quot;X-Forwarded-For&quot; header from a different application (eg: stunnel),
and you need preserve it. Also if your backend server doesn't use the
&quot;X-Forwarded-For&quot; header and requires different one (eg: Zeus Web Servers
require &quot;X-Cluster-Client-IP&quot;).

Sometimes, a same HAProxy instance may be shared between a direct client
access and a reverse-proxy access (for instance when an SSL reverse-proxy is
used to decrypt HTTPS traffic). It is possible to disable the addition of the
header for a known source address or network by adding the &quot;except&quot; keyword
followed by the network address. In this case, any source IP matching the
network will not cause an addition of this header. Most common uses are with
private networks or 127.0.0.1.

Alternatively, the keyword &quot;if-none&quot; states that the header will only be
added if it is not present. This should only be used in perfectly trusted
environment, as this might cause a security issue if headers reaching haproxy
are under the control of the end-user.

This option may be specified either in the frontend or in the backend. If at
least one of them uses it, the header will be added. Note that the backend's
setting of the header subargument takes precedence over the frontend's if
both are defined. In the case of the &quot;if-none&quot; argument, if at least one of
the frontend or the backend does not specify it, it wants the addition to be
mandatory, so it wins.

It is important to note that by default, HAProxy works in tunnel mode and
only inspects the first request of a connection, meaning that only the first
request will have the header appended, which is certainly not what you want.
In order to fix this, ensure that any of the &quot;<a href="#option%20httpclose">httpclose</a>&quot;, &quot;<a href="#option%20forceclose">forceclose</a>&quot; or
&quot;<a href="#option%20http-server-close">http-server-close</a>&quot; options is set when using this option.</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code><span class="comment"># Public HTTP address also used by stunnel on the same machine</span>
frontend www
    mode http
    option forwardfor except 127.0.0.1  <span class="comment"># stunnel already adds the header</span>

<span class="comment"># Those servers want the IP Address in X-Client</span>
backend www
    mode http
    option forwardfor header X-Client
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httpclose">option httpclose</a>&quot;, &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot;, &quot;<a href="#option%20forceclose">option forceclose</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option http-no-delay"></a><a class="anchor" name="4-option http-no-delay"></a><a class="anchor" name="4.2-option http-no-delay"></a><a class="anchor" name="option http-no-delay (Proxies)"></a><a class="anchor" name="option http-no-delay (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option http-no-delay"></a><a href="#4-option%20http-no-delay">option http-no-delay</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option http-no-delay"></a><a class="anchor" name="4-no option http-no-delay"></a><a class="anchor" name="4.2-no option http-no-delay"></a><a class="anchor" name="no option http-no-delay (Proxies)"></a><a class="anchor" name="no option http-no-delay (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option http-no-delay"></a><a href="#4-no%20option%20http-no-delay">no option http-no-delay</a></b></div><pre class="text">Instruct the system to favor low interactive delays over performance in HTTP</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">In HTTP, each payload is unidirectional and has no notion of interactivity.
Any agent is expected to queue data somewhat for a reasonably low delay.
There are some very rare server-to-server applications that abuse the HTTP
protocol and expect the payload phase to be highly interactive, with many
interleaved data chunks in both directions within a single request. This is
absolutely not supported by the HTTP specification and will not work across
most proxies or servers. When such applications attempt to do this through
haproxy, it works but they will experience high delays due to the network
optimizations which favor performance by instructing the system to wait for
enough data to be available in order to only send full packets. Typical
delays are around 200 ms per round trip. Note that this only happens with
abnormal uses. Normal uses such as CONNECT requests nor WebSockets are not
affected.

When &quot;<a href="#option%20http-no-delay">option http-no-delay</a>&quot; is present in either the frontend or the backend
used by a connection, all such optimizations will be disabled in order to
make the exchanges as fast as possible. Of course this offers no guarantee on
the functionality, as it may break at any other place. But if it works via
HAProxy, it will work as fast as possible. This option should never be used
by default, and should never be used at all unless such a buggy application
is discovered. The impact of using this option is an increase of bandwidth
usage and CPU usage, which may significantly lower performance in high
latency environments.</pre><a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option http-pretend-keepalive"></a><a class="anchor" name="4-option http-pretend-keepalive"></a><a class="anchor" name="4.2-option http-pretend-keepalive"></a><a class="anchor" name="option http-pretend-keepalive (Proxies)"></a><a class="anchor" name="option http-pretend-keepalive (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option http-pretend-keepalive"></a><a href="#4-option%20http-pretend-keepalive">option http-pretend-keepalive</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option http-pretend-keepalive"></a><a class="anchor" name="4-no option http-pretend-keepalive"></a><a class="anchor" name="4.2-no option http-pretend-keepalive"></a><a class="anchor" name="no option http-pretend-keepalive (Proxies)"></a><a class="anchor" name="no option http-pretend-keepalive (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option http-pretend-keepalive"></a><a href="#4-no%20option%20http-pretend-keepalive">no option http-pretend-keepalive</a></b></div><pre class="text">Define whether haproxy will announce keepalive to the server or not</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When running with &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot; or &quot;<a href="#option%20forceclose">option forceclose</a>&quot;, haproxy
adds a &quot;Connection: close&quot; header to the request forwarded to the server.
Unfortunately, when some servers see this header, they automatically refrain
from using the chunked encoding for responses of unknown length, while this
is totally unrelated. The immediate effect is that this prevents haproxy from
maintaining the client connection alive. A second effect is that a client or
a cache could receive an incomplete response without being aware of it, and
consider the response complete.

By setting &quot;<a href="#option%20http-pretend-keepalive">option http-pretend-keepalive</a>&quot;, haproxy will make the server
believe it will keep the connection alive. The server will then not fall back
to the abnormal undesired above. When haproxy gets the whole response, it
will close the connection with the server just as it would do with the
&quot;<a href="#option%20forceclose">forceclose</a>&quot; option. That way the client gets a normal response and the
connection is correctly closed on the server side.

It is recommended not to enable this option by default, because most servers
will more efficiently close the connection themselves after the last packet,
and release its buffers slightly earlier. Also, the added packet on the
network could slightly reduce the overall peak performance. However it is
worth noting that when this option is enabled, haproxy will have slightly
less work to do. So if haproxy is the bottleneck on the whole architecture,
enabling this option might save a few CPU cycles.

This option may be set both in a frontend and in a backend. It is enabled if
at least one of the frontend or backend holding a connection has it enabled.
This option may be compbined with &quot;<a href="#option%20httpclose">option httpclose</a>&quot;, which will cause
keepalive to be announced to the server and close to be announced to the
client. This practice is discouraged though.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20forceclose">option forceclose</a>&quot; and &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option http-server-close"></a><a class="anchor" name="4-option http-server-close"></a><a class="anchor" name="4.2-option http-server-close"></a><a class="anchor" name="option http-server-close (Proxies)"></a><a class="anchor" name="option http-server-close (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option http-server-close"></a><a href="#4-option%20http-server-close">option http-server-close</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option http-server-close"></a><a class="anchor" name="4-no option http-server-close"></a><a class="anchor" name="4.2-no option http-server-close"></a><a class="anchor" name="no option http-server-close (Proxies)"></a><a class="anchor" name="no option http-server-close (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option http-server-close"></a><a href="#4-no%20option%20http-server-close">no option http-server-close</a></b></div><pre class="text">Enable or disable HTTP connection closing on the server side</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default, when a client communicates with a server, HAProxy will only
analyze, log, and process the first request of each connection. Setting
&quot;<a href="#option%20http-server-close">option http-server-close</a>&quot; enables HTTP connection-close mode on the server
side while keeping the ability to support HTTP keep-alive and pipelining on
the client side.  This provides the lowest latency on the client side (slow
network) and the fastest session reuse on the server side to save server
resources, similarly to &quot;<a href="#option%20forceclose">option forceclose</a>&quot;. It also permits non-keepalive
capable servers to be served in keep-alive mode to the clients if they
conform to the requirements of RFC2616. Please note that some servers do not
always conform to those requirements when they see &quot;Connection: close&quot; in the
request. The effect will be that keep-alive will never be used. A workaround
consists in enabling &quot;<a href="#option%20http-pretend-keepalive">option http-pretend-keepalive</a>&quot;.

At the moment, logs will not indicate whether requests came from the same
session or not. The accept date reported in the logs corresponds to the end
of the previous request, and the request time corresponds to the time spent
waiting for a new request. The keep-alive request time is still bound to the
timeout defined by &quot;<a href="#timeout%20http-keep-alive">timeout http-keep-alive</a>&quot; or &quot;<a href="#timeout%20http-request">timeout http-request</a>&quot; if
not set.

This option may be set both in a frontend and in a backend. It is enabled if
at least one of the frontend or backend holding a connection has it enabled.
It is worth noting that &quot;<a href="#option%20forceclose">option forceclose</a>&quot; has precedence over &quot;option
http-server-close&quot; and that combining &quot;<a href="#option%20http-server-close">http-server-close</a>&quot; with &quot;<a href="#option%20httpclose">httpclose</a>&quot;
basically achieve the same result as &quot;<a href="#option%20forceclose">forceclose</a>&quot;.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20forceclose">option forceclose</a>&quot;, &quot;<a href="#option%20http-pretend-keepalive">option http-pretend-keepalive</a>&quot;, &quot;<a href="#option%20httpclose">option httpclose</a>&quot; and &quot;1.1. The HTTP transaction model&quot;.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option http-use-proxy-header"></a><a class="anchor" name="4-option http-use-proxy-header"></a><a class="anchor" name="4.2-option http-use-proxy-header"></a><a class="anchor" name="option http-use-proxy-header (Proxies)"></a><a class="anchor" name="option http-use-proxy-header (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option http-use-proxy-header"></a><a href="#4-option%20http-use-proxy-header">option http-use-proxy-header</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option http-use-proxy-header"></a><a class="anchor" name="4-no option http-use-proxy-header"></a><a class="anchor" name="4.2-no option http-use-proxy-header"></a><a class="anchor" name="no option http-use-proxy-header (Proxies)"></a><a class="anchor" name="no option http-use-proxy-header (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option http-use-proxy-header"></a><a href="#4-no%20option%20http-use-proxy-header">no option http-use-proxy-header</a></b></div><pre class="text">Make use of non-standard Proxy-Connection header instead of Connection</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">While RFC2616 explicitly states that HTTP/1.1 agents must use the
Connection header to indicate their wish of persistent or non-persistent
connections, both browsers and proxies ignore this header for proxied
connections and make use of the undocumented, non-standard Proxy-Connection
header instead. The issue begins when trying to put a load balancer between
browsers and such proxies, because there will be a difference between what
haproxy understands and what the client and the proxy agree on.

By setting this option in a frontend, haproxy can automatically switch to use
that non-standard header if it sees proxied requests. A proxied request is
defined here as one where the URI begins with neither a '/' nor a '*'. The
choice of header only affects requests passing through proxies making use of
one of the &quot;<a href="#option%20httpclose">httpclose</a>&quot;, &quot;<a href="#option%20forceclose">forceclose</a>&quot; and &quot;<a href="#option%20http-server-close">http-server-close</a>&quot; options. Note
that this option can only be specified in a frontend and will affect the
request along its whole life.

Also, when this option is set, a request which requires authentication will
automatically switch to use proxy authentication headers if it is itself a
proxied request. That makes it possible to check or enforce authentication in
front of an existing proxy.

This option should normally never be used, except in front of a proxy.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httpclose">option httpclose</a>&quot;, &quot;<a href="#option%20forceclose">option forceclose</a>&quot; and &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot;.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option httpchk"></a><a class="anchor" name="4-option httpchk"></a><a class="anchor" name="4.2-option httpchk"></a><a class="anchor" name="option httpchk (Proxies)"></a><a class="anchor" name="option httpchk (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option httpchk"></a><a href="#4-option%20httpchk">option httpchk</a></b></div><a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option httpchk"></a><a class="anchor" name="4-option httpchk"></a><a class="anchor" name="4.2-option httpchk"></a><a class="anchor" name="option httpchk (Proxies)"></a><a class="anchor" name="option httpchk (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option httpchk"></a><a href="#4-option%20httpchk">option httpchk</a></b> <span style="color: #080">&lt;uri&gt;</span></div><a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option httpchk"></a><a class="anchor" name="4-option httpchk"></a><a class="anchor" name="4.2-option httpchk"></a><a class="anchor" name="option httpchk (Proxies)"></a><a class="anchor" name="option httpchk (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option httpchk"></a><a href="#4-option%20httpchk">option httpchk</a></b> <span style="color: #080">&lt;method&gt;</span> <span style="color: #080">&lt;uri&gt;</span></div><a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option httpchk"></a><a class="anchor" name="4-option httpchk"></a><a class="anchor" name="4.2-option httpchk"></a><a class="anchor" name="option httpchk (Proxies)"></a><a class="anchor" name="option httpchk (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option httpchk"></a><a href="#4-option%20httpchk">option httpchk</a></b> <span style="color: #080">&lt;method&gt;</span> <span style="color: #080">&lt;uri&gt;</span> <span style="color: #080">&lt;version&gt;</span></div><pre class="text">Enable HTTP protocol to check on the servers health</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;method&gt;  is the optional HTTP method used with the requests. When not set,
          the &quot;OPTIONS&quot; method is used, as it generally requires low server
          processing and is easy to filter out from the logs. Any method
          may be used, though it is not recommended to invent non-standard
          ones.

&lt;uri&gt;     is the URI referenced in the HTTP requests. It defaults to &quot; / &quot;
          which is accessible by default on almost any server, but may be
          changed to any other URI. Query strings are permitted.

&lt;version&gt; is the optional HTTP version string. It defaults to &quot;HTTP/1.0&quot;
          but some servers might behave incorrectly in HTTP 1.0, so turning
          it to HTTP/1.1 may sometimes help. Note that the Host field is
          mandatory in HTTP/1.1, and as a trick, it is possible to pass it
          after &quot;\r\n&quot; following the version string.</pre>
</div>
<pre class="text">By default, server health checks only consist in trying to establish a TCP
connection. When &quot;<a href="#option%20httpchk">option httpchk</a>&quot; is specified, a complete HTTP request is
sent once the TCP connection is established, and responses 2xx and 3xx are
considered valid, while all other ones indicate a server failure, including
the lack of any response.

The port and interval are specified in the server configuration.

This option does not necessarily require an HTTP backend, it also works with
plain TCP backends. This is particularly useful to check simple scripts bound
to some dedicated ports using the inetd daemon.</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code><span class="comment"># Relay HTTPS traffic to Apache instance and check service availability</span>
<span class="comment"># using HTTP request &quot;OPTIONS * HTTP/1.1&quot; on port 80.</span>
backend https_relay
    mode tcp
    option httpchk OPTIONS * HTTP/1.1\r\nHost:\ www
    server apache1 192.168.1.1:443 check port 80
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#option%20ssl-hello-chk">option ssl-hello-chk</a>&quot;, &quot;<a href="#option%20smtpchk">option smtpchk</a>&quot;, &quot;<a href="#option%20mysql-check">option mysql-check</a>&quot;, &quot;<a href="#http-check">http-check</a>&quot; and the &quot;<a href="#check">check</a>&quot;, &quot;<a href="#port">port</a>&quot; and &quot;<a href="#inter">inter</a>&quot; server options.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option httpclose"></a><a class="anchor" name="4-option httpclose"></a><a class="anchor" name="4.2-option httpclose"></a><a class="anchor" name="option httpclose (Proxies)"></a><a class="anchor" name="option httpclose (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option httpclose"></a><a href="#4-option%20httpclose">option httpclose</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option httpclose"></a><a class="anchor" name="4-no option httpclose"></a><a class="anchor" name="4.2-no option httpclose"></a><a class="anchor" name="no option httpclose (Proxies)"></a><a class="anchor" name="no option httpclose (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option httpclose"></a><a href="#4-no%20option%20httpclose">no option httpclose</a></b></div><pre class="text">Enable or disable passive HTTP connection closing</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default, when a client communicates with a server, HAProxy will only
analyze, log, and process the first request of each connection. If &quot;option
httpclose&quot; is set, it will check if a &quot;Connection: close&quot; header is already
set in each direction, and will add one if missing. Each end should react to
this by actively closing the TCP connection after each transfer, thus
resulting in a switch to the HTTP close mode. Any &quot;Connection&quot; header
different from &quot;close&quot; will also be removed.

It seldom happens that some servers incorrectly ignore this header and do not
close the connection eventhough they reply &quot;Connection: close&quot;. For this
reason, they are not compatible with older HTTP 1.0 browsers. If this happens
it is possible to use the &quot;<a href="#option%20forceclose">option forceclose</a>&quot; which actively closes the
request connection once the server responds. Option &quot;<a href="#option%20forceclose">forceclose</a>&quot; also
releases the server connection earlier because it does not have to wait for
the client to acknowledge it.

This option may be set both in a frontend and in a backend. It is enabled if
at least one of the frontend or backend holding a connection has it enabled.
If &quot;<a href="#option%20forceclose">option forceclose</a>&quot; is specified too, it has precedence over &quot;<a href="#option%20httpclose">httpclose</a>&quot;.
If &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot; is enabled at the same time as &quot;<a href="#option%20httpclose">httpclose</a>&quot;, it
basically achieves the same result as &quot;<a href="#option%20forceclose">option forceclose</a>&quot;.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20forceclose">option forceclose</a>&quot;, &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot; and &quot;1.1. The HTTP transaction model&quot;.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option httplog"></a><a class="anchor" name="4-option httplog"></a><a class="anchor" name="4.2-option httplog"></a><a class="anchor" name="option httplog (Proxies)"></a><a class="anchor" name="option httplog (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option httplog"></a><a href="#4-option%20httplog">option httplog</a></b> <span style="color: #008">[ clf ]</span></div><pre class="text">Enable logging of HTTP request, session state and timers</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">clf       if the &quot;clf&quot; argument is added, then the output format will be
          the CLF format instead of HAProxy's default HTTP format. You can
          use this when you need to feed HAProxy's logs through a specific
          log analyser which only support the CLF format and which is not
          extensible.</pre>
</div>
<pre class="text">By default, the log output format is very poor, as it only contains the
source and destination addresses, and the instance name. By specifying
&quot;<a href="#option%20httplog">option httplog</a>&quot;, each log line turns into a much richer format including,
but not limited to, the HTTP request, the connection timers, the session
status, the connections numbers, the captured headers and cookies, the
frontend, backend and server name, and of course the source address and
ports.

This option may be set either in the frontend or the backend.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it. Specifying
only &quot;<a href="#option%20httplog">option httplog</a>&quot; will automatically clear the 'clf' mode if it was set
by default.</pre><div class="page-header"><b>See also :</b> <a href="#8">section 8</a> about logging.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option http_proxy"></a><a class="anchor" name="4-option http_proxy"></a><a class="anchor" name="4.2-option http_proxy"></a><a class="anchor" name="option http_proxy (Proxies)"></a><a class="anchor" name="option http_proxy (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option http_proxy"></a><a href="#4-option%20http_proxy">option http_proxy</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option http_proxy"></a><a class="anchor" name="4-no option http_proxy"></a><a class="anchor" name="4.2-no option http_proxy"></a><a class="anchor" name="no option http_proxy (Proxies)"></a><a class="anchor" name="no option http_proxy (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option http_proxy"></a><a href="#4-no%20option%20http_proxy">no option http_proxy</a></b></div><pre class="text">Enable or disable plain HTTP proxy mode</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">It sometimes happens that people need a pure HTTP proxy which understands
basic proxy requests without caching nor any fancy feature. In this case,
it may be worth setting up an HAProxy instance with the &quot;<a href="#option%20http_proxy">option http_proxy</a>&quot;
set. In this mode, no server is declared, and the connection is forwarded to
the IP address and port found in the URL after the &quot;http://&quot; scheme.

No host address resolution is performed, so this only works when pure IP
addresses are passed. Since this option's usage perimeter is rather limited,
it will probably be used only by experts who know they need exactly it. Last,
if the clients are susceptible of sending keep-alive requests, it will be
needed to add &quot;<a href="#option%20httpclose">option httpclose</a>&quot; to ensure that all requests will correctly
be analyzed.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># this backend understands HTTP proxy requests and forwards them directly.</span>
backend direct_forward
    option httpclose
    option http_proxy
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httpclose">option httpclose</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option independant-streams"></a><a class="anchor" name="4-option independant-streams"></a><a class="anchor" name="4.2-option independant-streams"></a><a class="anchor" name="option independant-streams (Proxies)"></a><a class="anchor" name="option independant-streams (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option independant-streams"></a><a href="#4-option%20independant-streams">option independant-streams</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option independant-streams"></a><a class="anchor" name="4-no option independant-streams"></a><a class="anchor" name="4.2-no option independant-streams"></a><a class="anchor" name="no option independant-streams (Proxies)"></a><a class="anchor" name="no option independant-streams (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option independant-streams"></a><a href="#4-no%20option%20independant-streams">no option independant-streams</a></b></div><pre class="text">Enable or disable independant timeout processing for both directions</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default, when data is sent over a socket, both the write timeout and the
read timeout for that socket are refreshed, because we consider that there is
activity on that socket, and we have no other means of guessing if we should
receive data or not.

While this default behaviour is desirable for almost all applications, there
exists a situation where it is desirable to disable it, and only refresh the
read timeout if there are incoming data. This happens on sessions with large
timeouts and low amounts of exchanged data such as telnet session. If the
server suddenly disappears, the output data accumulates in the system's
socket buffers, both timeouts are correctly refreshed, and there is no way
to know the server does not receive them, so we don't timeout. However, when
the underlying protocol always echoes sent data, it would be enough by itself
to detect the issue using the read timeout. Note that this problem does not
happen with more verbose protocols because data won't accumulate long in the
socket buffers.

When this option is set on the frontend, it will disable read timeout updates
on data sent to the client. There probably is little use of this case. When
the option is set on the backend, it will disable read timeout updates on
data sent to the server. Doing so will typically break large HTTP posts from
slow lines, so use it with caution.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#timeout%20client">timeout client</a>&quot; and &quot;<a href="#timeout%20server">timeout server</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option ldap-check"></a><a class="anchor" name="4-option ldap-check"></a><a class="anchor" name="4.2-option ldap-check"></a><a class="anchor" name="option ldap-check (Proxies)"></a><a class="anchor" name="option ldap-check (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option ldap-check"></a><a href="#4-option%20ldap-check">option ldap-check</a></b></div><pre class="text">Use LDAPv3 health checks for server testing</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">It is possible to test that the server correctly talks LDAPv3 instead of just
testing that it accepts the TCP connection. When this option is set, an
LDAPv3 anonymous simple bind message is sent to the server, and the response
is analyzed to find an LDAPv3 bind response message.

The server is considered valid only when the LDAP response contains success
resultCode (http://tools.ietf.org/html/rfc4511#section-4.1.9).

Logging of bind requests is server dependent see your documentation how to
configure it.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>option ldap-check
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httpchk">option httpchk</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option log-health-checks"></a><a class="anchor" name="4-option log-health-checks"></a><a class="anchor" name="4.2-option log-health-checks"></a><a class="anchor" name="option log-health-checks (Proxies)"></a><a class="anchor" name="option log-health-checks (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option log-health-checks"></a><a href="#4-option%20log-health-checks">option log-health-checks</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option log-health-checks"></a><a class="anchor" name="4-no option log-health-checks"></a><a class="anchor" name="4.2-no option log-health-checks"></a><a class="anchor" name="no option log-health-checks (Proxies)"></a><a class="anchor" name="no option log-health-checks (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option log-health-checks"></a><a href="#4-no%20option%20log-health-checks">no option log-health-checks</a></b></div><pre class="text">Enable or disable logging of health checks</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">Enable health checks logging so it possible to check for example what
was happening before a server crash. Failed health check are logged if
server is UP and succeeded health checks if server is DOWN, so the amount
of additional information is limited.

If health check logging is enabled no health check status is printed
when servers is set up UP/DOWN/ENABLED/DISABLED.</pre><div class="page-header"><b>See also:</b> &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">log<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#log%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#log%20%28Proxies%29">Proxies</a></li></ul></span>&quot; and <a href="#8">section 8</a> about logging.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option log-separate-errors"></a><a class="anchor" name="4-option log-separate-errors"></a><a class="anchor" name="4.2-option log-separate-errors"></a><a class="anchor" name="option log-separate-errors (Proxies)"></a><a class="anchor" name="option log-separate-errors (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option log-separate-errors"></a><a href="#4-option%20log-separate-errors">option log-separate-errors</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option log-separate-errors"></a><a class="anchor" name="4-no option log-separate-errors"></a><a class="anchor" name="4.2-no option log-separate-errors"></a><a class="anchor" name="no option log-separate-errors (Proxies)"></a><a class="anchor" name="no option log-separate-errors (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option log-separate-errors"></a><a href="#4-no%20option%20log-separate-errors">no option log-separate-errors</a></b></div><pre class="text">Change log level for non-completely successful connections</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">Sometimes looking for errors in logs is not easy. This option makes haproxy
raise the level of logs containing potentially interesting information such
as errors, timeouts, retries, redispatches, or HTTP status codes 5xx. The
level changes from &quot;info&quot; to &quot;err&quot;. This makes it possible to log them
separately to a different file with most syslog daemons. Be careful not to
remove them from the original file, otherwise you would lose ordering which
provides very important information.

Using this option, large sites dealing with several thousand connections per
second may log normal traffic to a rotating buffer and only archive smaller
error logs.</pre><div class="page-header"><b>See also :</b> &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">log<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#log%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#log%20%28Proxies%29">Proxies</a></li></ul></span>&quot;, &quot;<a href="#option%20dontlognull">dontlognull</a>&quot;, &quot;<a href="#option%20dontlog-normal">dontlog-normal</a>&quot; and <a href="#8">section 8</a> about logging.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option logasap"></a><a class="anchor" name="4-option logasap"></a><a class="anchor" name="4.2-option logasap"></a><a class="anchor" name="option logasap (Proxies)"></a><a class="anchor" name="option logasap (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option logasap"></a><a href="#4-option%20logasap">option logasap</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option logasap"></a><a class="anchor" name="4-no option logasap"></a><a class="anchor" name="4.2-no option logasap"></a><a class="anchor" name="no option logasap (Proxies)"></a><a class="anchor" name="no option logasap (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option logasap"></a><a href="#4-no%20option%20logasap">no option logasap</a></b></div><pre class="text">Enable or disable early logging of HTTP requests</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default, HTTP requests are logged upon termination so that the total
transfer time and the number of bytes appear in the logs. When large objects
are being transferred, it may take a while before the request appears in the
logs. Using &quot;<a href="#option%20logasap">option logasap</a>&quot;, the request gets logged as soon as the server
sends the complete headers. The only missing information in the logs will be
the total number of bytes which will indicate everything except the amount
of data transferred, and the total time which will not take the transfer
time into account. In such a situation, it's a good practice to capture the
&quot;Content-Length&quot; response header so that the logs at least indicate how many
bytes are expected to be transferred.</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code>  listen http_proxy 0.0.0.0:80
      mode http
      option httplog
      option logasap
      log 192.168.2.200 local3

&gt;&gt;&gt; Feb  6 12:14:14 localhost \
      haproxy[14389]: 10.0.1.2:33317 [06/Feb/2009:12:14:14.655] http-in \
      static/srv1 9/10/7/14/+30 200 +243 - - ---- 3/1/1/1/0 1/0 \
      &quot;GET /image.iso HTTP/1.0&quot;
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httplog">option httplog</a>&quot;, &quot;<a href="#capture%20response%20header">capture response header</a>&quot;, and <a href="#8">section 8</a> about logging.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option mysql-check"></a><a class="anchor" name="4-option mysql-check"></a><a class="anchor" name="4.2-option mysql-check"></a><a class="anchor" name="option mysql-check (Proxies)"></a><a class="anchor" name="option mysql-check (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option mysql-check"></a><a href="#4-option%20mysql-check">option mysql-check</a></b> <span style="color: #008">[ user <span style="color: #080">&lt;username&gt;</span> ]</span></div><pre class="text">Use MySQL health checks for server testing</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;username&gt; This is the username which will be used when connecting to MySQL
           server.</pre>
</div>
<pre class="text">If you specify a username, the check consists of sending two MySQL packet,
one Client Authentication packet, and one QUIT packet, to correctly close
MySQL session. We then parse the MySQL Handshake Initialisation packet and/or
Error packet. It is a basic but useful test which does not produce error nor
aborted connect on the server. However, it requires adding an authorization
in the MySQL table, like this :

    USE mysql;
    INSERT INTO user (Host,User) values ('&lt;ip_of_haproxy&gt;','&lt;username&gt;');
    FLUSH PRIVILEGES;

If you don't specify a username (it is deprecated and not recommended), the
check only consists in parsing the Mysql Handshake Initialisation packet or
Error packet, we don't send anything in this mode. It was reported that it
can generate lockout if check is too frequent and/or if there is not enough
traffic. In fact, you need in this case to check MySQL &quot;max_connect_errors&quot;
value as if a connection is established successfully within fewer than MySQL
&quot;max_connect_errors&quot; attempts after a previous connection was interrupted,
the error count for the host is cleared to zero. If HAProxy's server get
blocked, the &quot;FLUSH HOSTS&quot; statement is the only way to unblock it.

Remember that this does not check database presence nor database consistency.
To do this, you can use an external check with xinetd for example.

The check requires MySQL &gt;=3.22, for older version, please use TCP check.

Most often, an incoming MySQL server needs to see the client's IP address for
various purposes, including IP privilege matching and connection logging.
When possible, it is often wise to masquerade the client's IP address when
connecting to the server using the &quot;usesrc&quot; argument of the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#source%20%28Proxies%29">Proxies</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; keyword,
which requires the cttproxy feature to be compiled in, and the MySQL server
to route the client via the machine hosting haproxy.</pre><div class="page-header"><b>See also:</b> &quot;<a href="#option%20httpchk">option httpchk</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option nolinger"></a><a class="anchor" name="4-option nolinger"></a><a class="anchor" name="4.2-option nolinger"></a><a class="anchor" name="option nolinger (Proxies)"></a><a class="anchor" name="option nolinger (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option nolinger"></a><a href="#4-option%20nolinger">option nolinger</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option nolinger"></a><a class="anchor" name="4-no option nolinger"></a><a class="anchor" name="4.2-no option nolinger"></a><a class="anchor" name="no option nolinger (Proxies)"></a><a class="anchor" name="no option nolinger (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option nolinger"></a><a href="#4-no%20option%20nolinger">no option nolinger</a></b></div><pre class="text">Enable or disable immediate session resource cleaning after close</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When clients or servers abort connections in a dirty way (eg: they are
physically disconnected), the session timeouts triggers and the session is
closed. But it will remain in FIN_WAIT1 state for some time in the system,
using some resources and possibly limiting the ability to establish newer
connections.

When this happens, it is possible to activate &quot;<a href="#option%20nolinger">option nolinger</a>&quot; which forces
the system to immediately remove any socket's pending data on close. Thus,
the session is instantly purged from the system's tables. This usually has
side effects such as increased number of TCP resets due to old retransmits
getting immediately rejected. Some firewalls may sometimes complain about
this too.

For this reason, it is not recommended to use this option when not absolutely
needed. You know that you need it when you have thousands of FIN_WAIT1
sessions on your system (TIME_WAIT ones do not count).

This option may be used both on frontends and backends, depending on the side
where it is required. Use it on the frontend for clients, and on the backend
for servers.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.</pre><a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option originalto"></a><a class="anchor" name="4-option originalto"></a><a class="anchor" name="4.2-option originalto"></a><a class="anchor" name="option originalto (Proxies)"></a><a class="anchor" name="option originalto (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option originalto"></a><a href="#4-option%20originalto">option originalto</a></b> <span style="color: #008">[ except <span style="color: #080">&lt;network&gt;</span> ]</span> <span style="color: #008">[ header <span style="color: #080">&lt;name&gt;</span> ]</span></div><pre class="text">Enable insertion of the X-Original-To header to requests sent to servers</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;network&gt; is an optional argument used to disable this option for sources
          matching &lt;network&gt;
&lt;name&gt;    an optional argument to specify a different &quot;X-Original-To&quot;
          header name.</pre>
</div>
<pre class="text">Since HAProxy can work in transparent mode, every request from a client can
be redirected to the proxy and HAProxy itself can proxy every request to a
complex SQUID environment and the destination host from SO_ORIGINAL_DST will
be lost. This is annoying when you want access rules based on destination ip
addresses. To solve this problem, a new HTTP header &quot;X-Original-To&quot; may be
added by HAProxy to all requests sent to the server. This header contains a
value representing the original destination IP address. Since this must be
configured to always use the last occurrence of this header only. Note that
only the last occurrence of the header must be used, since it is really
possible that the client has already brought one.

The keyword &quot;header&quot; may be used to supply a different header name to replace
the default &quot;X-Original-To&quot;. This can be useful where you might already
have a &quot;X-Original-To&quot; header from a different application, and you need
preserve it. Also if your backend server doesn't use the &quot;X-Original-To&quot;
header and requires different one.

Sometimes, a same HAProxy instance may be shared between a direct client
access and a reverse-proxy access (for instance when an SSL reverse-proxy is
used to decrypt HTTPS traffic). It is possible to disable the addition of the
header for a known source address or network by adding the &quot;except&quot; keyword
followed by the network address. In this case, any source IP matching the
network will not cause an addition of this header. Most common uses are with
private networks or 127.0.0.1.

This option may be specified either in the frontend or in the backend. If at
least one of them uses it, the header will be added. Note that the backend's
setting of the header subargument takes precedence over the frontend's if
both are defined.

It is important to note that by default, HAProxy works in tunnel mode and
only inspects the first request of a connection, meaning that only the first
request will have the header appended, which is certainly not what you want.
In order to fix this, ensure that any of the &quot;<a href="#option%20httpclose">httpclose</a>&quot;, &quot;<a href="#option%20forceclose">forceclose</a>&quot; or
&quot;<a href="#option%20http-server-close">http-server-close</a>&quot; options is set when using this option.</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code><span class="comment"># Original Destination address</span>
frontend www
    mode http
    option originalto except 127.0.0.1

<span class="comment"># Those servers want the IP Address in X-Client-Dst</span>
backend www
    mode http
    option originalto header X-Client-Dst
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httpclose">option httpclose</a>&quot;, &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot;, &quot;<a href="#option%20forceclose">option forceclose</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option persist"></a><a class="anchor" name="4-option persist"></a><a class="anchor" name="4.2-option persist"></a><a class="anchor" name="option persist (Proxies)"></a><a class="anchor" name="option persist (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option persist"></a><a href="#4-option%20persist">option persist</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option persist"></a><a class="anchor" name="4-no option persist"></a><a class="anchor" name="4.2-no option persist"></a><a class="anchor" name="no option persist (Proxies)"></a><a class="anchor" name="no option persist (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option persist"></a><a href="#4-no%20option%20persist">no option persist</a></b></div><pre class="text">Enable or disable forced persistence on down servers</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When an HTTP request reaches a backend with a cookie which references a dead
server, by default it is redispatched to another server. It is possible to
force the request to be sent to the dead server first using &quot;<a href="#option%20persist">option persist</a>&quot;
if absolutely needed. A common use case is when servers are under extreme
load and spend their time flapping. In this case, the users would still be
directed to the server they opened the session on, in the hope they would be
correctly served. It is recommended to use &quot;<a href="#option%20redispatch">option redispatch</a>&quot; in conjunction
with this option so that in the event it would not be possible to connect to
the server at all (server definitely dead), the client would finally be
redirected to another valid server.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20redispatch">option redispatch</a>&quot;, &quot;<a href="#retries">retries</a>&quot;, &quot;<a href="#force-persist">force-persist</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option redispatch"></a><a class="anchor" name="4-option redispatch"></a><a class="anchor" name="4.2-option redispatch"></a><a class="anchor" name="option redispatch (Proxies)"></a><a class="anchor" name="option redispatch (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option redispatch"></a><a href="#4-option%20redispatch">option redispatch</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option redispatch"></a><a class="anchor" name="4-no option redispatch"></a><a class="anchor" name="4.2-no option redispatch"></a><a class="anchor" name="no option redispatch (Proxies)"></a><a class="anchor" name="no option redispatch (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option redispatch"></a><a href="#4-no%20option%20redispatch">no option redispatch</a></b></div><pre class="text">Enable or disable session redistribution in case of connection failure</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">In HTTP mode, if a server designated by a cookie is down, clients may
definitely stick to it because they cannot flush the cookie, so they will not
be able to access the service anymore.

Specifying &quot;<a href="#option%20redispatch">option redispatch</a>&quot; will allow the proxy to break their
persistence and redistribute them to a working server.

It also allows to retry last connection to another server in case of multiple
connection failures. Of course, it requires having &quot;<a href="#retries">retries</a>&quot; set to a nonzero
value.

This form is the preferred form, which replaces both the &quot;<a href="#option%20redispatch">redispatch</a>&quot; and
&quot;<a href="#redisp">redisp</a>&quot; keywords.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20redispatch">redispatch</a>&quot;, &quot;<a href="#retries">retries</a>&quot;, &quot;<a href="#force-persist">force-persist</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option smtpchk"></a><a class="anchor" name="4-option smtpchk"></a><a class="anchor" name="4.2-option smtpchk"></a><a class="anchor" name="option smtpchk (Proxies)"></a><a class="anchor" name="option smtpchk (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option smtpchk"></a><a href="#4-option%20smtpchk">option smtpchk</a></b></div><a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option smtpchk"></a><a class="anchor" name="4-option smtpchk"></a><a class="anchor" name="4.2-option smtpchk"></a><a class="anchor" name="option smtpchk (Proxies)"></a><a class="anchor" name="option smtpchk (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option smtpchk"></a><a href="#4-option%20smtpchk">option smtpchk</a></b> <span style="color: #080">&lt;hello&gt;</span> <span style="color: #080">&lt;domain&gt;</span></div><pre class="text">Use SMTP health checks for server testing</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;hello&gt;   is an optional argument. It is the &quot;hello&quot; command to use. It can
          be either &quot;HELO&quot; (for SMTP) or &quot;EHLO&quot; (for ESTMP). All other
          values will be turned into the default command (&quot;HELO&quot;).

&lt;domain&gt;  is the domain name to present to the server. It may only be
          specified (and is mandatory) if the hello command has been
          specified. By default, &quot;localhost&quot; is used.</pre>
</div>
<pre class="text">When &quot;<a href="#option%20smtpchk">option smtpchk</a>&quot; is set, the health checks will consist in TCP
connections followed by an SMTP command. By default, this command is
&quot;HELO localhost&quot;. The server's return code is analyzed and only return codes
starting with a &quot;2&quot; will be considered as valid. All other responses,
including a lack of response will constitute an error and will indicate a
dead server.

This test is meant to be used with SMTP servers or relays. Depending on the
request, it is possible that some servers do not log each connection attempt,
so you may want to experiment to improve the behaviour. Using telnet on port
25 is often easier than adjusting the configuration.

Most often, an incoming SMTP server needs to see the client's IP address for
various purposes, including spam filtering, anti-spoofing and logging. When
possible, it is often wise to masquerade the client's IP address when
connecting to the server using the &quot;usesrc&quot; argument of the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#source%20%28Proxies%29">Proxies</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; keyword,
which requires the cttproxy feature to be compiled in.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>option smtpchk HELO mydomain.org
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httpchk">option httpchk</a>&quot;, &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#source%20%28Proxies%29">Proxies</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option socket-stats"></a><a class="anchor" name="4-option socket-stats"></a><a class="anchor" name="4.2-option socket-stats"></a><a class="anchor" name="option socket-stats (Proxies)"></a><a class="anchor" name="option socket-stats (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option socket-stats"></a><a href="#4-option%20socket-stats">option socket-stats</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option socket-stats"></a><a class="anchor" name="4-no option socket-stats"></a><a class="anchor" name="4.2-no option socket-stats"></a><a class="anchor" name="no option socket-stats (Proxies)"></a><a class="anchor" name="no option socket-stats (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option socket-stats"></a><a href="#4-no%20option%20socket-stats">no option socket-stats</a></b></div><pre class="text">Enable or disable collecting &amp; providing separate statistics for each socket.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option splice-auto"></a><a class="anchor" name="4-option splice-auto"></a><a class="anchor" name="4.2-option splice-auto"></a><a class="anchor" name="option splice-auto (Proxies)"></a><a class="anchor" name="option splice-auto (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option splice-auto"></a><a href="#4-option%20splice-auto">option splice-auto</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option splice-auto"></a><a class="anchor" name="4-no option splice-auto"></a><a class="anchor" name="4.2-no option splice-auto"></a><a class="anchor" name="no option splice-auto (Proxies)"></a><a class="anchor" name="no option splice-auto (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option splice-auto"></a><a href="#4-no%20option%20splice-auto">no option splice-auto</a></b></div><pre class="text">Enable or disable automatic kernel acceleration on sockets in both directions</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When this option is enabled either on a frontend or on a backend, haproxy
will automatically evaluate the opportunity to use kernel tcp splicing to
forward data between the client and the server, in either direction. Haproxy
uses heuristics to estimate if kernel splicing might improve performance or
not. Both directions are handled independently. Note that the heuristics used
are not much aggressive in order to limit excessive use of splicing. This
option requires splicing to be enabled at compile time, and may be globally
disabled with the global option &quot;<a href="#nosplice">nosplice</a>&quot;. Since splice uses pipes, using it
requires that there are enough spare pipes.

Important note: kernel-based TCP splicing is a Linux-specific feature which
first appeared in kernel 2.6.25. It offers kernel-based acceleration to
transfer data between sockets without copying these data to user-space, thus
providing noticeable performance gains and CPU cycles savings. Since many
early implementations are buggy, corrupt data and/or are inefficient, this
feature is not enabled by default, and it should be used with extreme care.
While it is not possible to detect the correctness of an implementation,
2.6.29 is the first version offering a properly working implementation. In
case of doubt, splicing may be globally disabled using the global &quot;<a href="#nosplice">nosplice</a>&quot;
keyword.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>option splice-auto
</code></pre>
</div><pre class="text">If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20splice-request">option splice-request</a>&quot;, &quot;<a href="#option%20splice-response">option splice-response</a>&quot;, and global options &quot;<a href="#nosplice">nosplice</a>&quot; and &quot;<a href="#maxpipes">maxpipes</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option splice-request"></a><a class="anchor" name="4-option splice-request"></a><a class="anchor" name="4.2-option splice-request"></a><a class="anchor" name="option splice-request (Proxies)"></a><a class="anchor" name="option splice-request (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option splice-request"></a><a href="#4-option%20splice-request">option splice-request</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option splice-request"></a><a class="anchor" name="4-no option splice-request"></a><a class="anchor" name="4.2-no option splice-request"></a><a class="anchor" name="no option splice-request (Proxies)"></a><a class="anchor" name="no option splice-request (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option splice-request"></a><a href="#4-no%20option%20splice-request">no option splice-request</a></b></div><pre class="text">Enable or disable automatic kernel acceleration on sockets for requests</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When this option is enabled either on a frontend or on a backend, haproxy
will user kernel tcp splicing whenever possible to forward data going from
the client to the server. It might still use the recv/send scheme if there
are no spare pipes left. This option requires splicing to be enabled at
compile time, and may be globally disabled with the global option &quot;<a href="#nosplice">nosplice</a>&quot;.
Since splice uses pipes, using it requires that there are enough spare pipes.

Important note: see &quot;<a href="#option%20splice-auto">option splice-auto</a>&quot; for usage limitations.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>option splice-request
</code></pre>
</div><pre class="text">If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20splice-auto">option splice-auto</a>&quot;, &quot;<a href="#option%20splice-response">option splice-response</a>&quot;, and global options &quot;<a href="#nosplice">nosplice</a>&quot; and &quot;<a href="#maxpipes">maxpipes</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option splice-response"></a><a class="anchor" name="4-option splice-response"></a><a class="anchor" name="4.2-option splice-response"></a><a class="anchor" name="option splice-response (Proxies)"></a><a class="anchor" name="option splice-response (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option splice-response"></a><a href="#4-option%20splice-response">option splice-response</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option splice-response"></a><a class="anchor" name="4-no option splice-response"></a><a class="anchor" name="4.2-no option splice-response"></a><a class="anchor" name="no option splice-response (Proxies)"></a><a class="anchor" name="no option splice-response (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option splice-response"></a><a href="#4-no%20option%20splice-response">no option splice-response</a></b></div><pre class="text">Enable or disable automatic kernel acceleration on sockets for responses</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When this option is enabled either on a frontend or on a backend, haproxy
will user kernel tcp splicing whenever possible to forward data going from
the server to the client. It might still use the recv/send scheme if there
are no spare pipes left. This option requires splicing to be enabled at
compile time, and may be globally disabled with the global option &quot;<a href="#nosplice">nosplice</a>&quot;.
Since splice uses pipes, using it requires that there are enough spare pipes.

Important note: see &quot;<a href="#option%20splice-auto">option splice-auto</a>&quot; for usage limitations.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>option splice-response
</code></pre>
</div><pre class="text">If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20splice-auto">option splice-auto</a>&quot;, &quot;<a href="#option%20splice-request">option splice-request</a>&quot;, and global options &quot;<a href="#nosplice">nosplice</a>&quot; and &quot;<a href="#maxpipes">maxpipes</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option srvtcpka"></a><a class="anchor" name="4-option srvtcpka"></a><a class="anchor" name="4.2-option srvtcpka"></a><a class="anchor" name="option srvtcpka (Proxies)"></a><a class="anchor" name="option srvtcpka (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option srvtcpka"></a><a href="#4-option%20srvtcpka">option srvtcpka</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option srvtcpka"></a><a class="anchor" name="4-no option srvtcpka"></a><a class="anchor" name="4.2-no option srvtcpka"></a><a class="anchor" name="no option srvtcpka (Proxies)"></a><a class="anchor" name="no option srvtcpka (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option srvtcpka"></a><a href="#4-no%20option%20srvtcpka">no option srvtcpka</a></b></div><pre class="text">Enable or disable the sending of TCP keepalive packets on the server side</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When there is a firewall or any session-aware component between a client and
a server, and when the protocol involves very long sessions with long idle
periods (eg: remote desktops), there is a risk that one of the intermediate
components decides to expire a session which has remained idle for too long.

Enabling socket-level TCP keep-alives makes the system regularly send packets
to the other end of the connection, leaving it active. The delay between
keep-alive probes is controlled by the system only and depends both on the
operating system and its tuning parameters.

It is important to understand that keep-alive packets are neither emitted nor
received at the application level. It is only the network stacks which sees
them. For this reason, even if one side of the proxy already uses keep-alives
to maintain its connection alive, those keep-alive packets will not be
forwarded to the other side of the proxy.

Please note that this has nothing to do with HTTP keep-alive.

Using option &quot;<a href="#option%20srvtcpka">srvtcpka</a>&quot; enables the emission of TCP keep-alive probes on the
server side of a connection, which should help when session expirations are
noticed between HAProxy and a server.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20clitcpka">option clitcpka</a>&quot;, &quot;<a href="#option%20tcpka">option tcpka</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option ssl-hello-chk"></a><a class="anchor" name="4-option ssl-hello-chk"></a><a class="anchor" name="4.2-option ssl-hello-chk"></a><a class="anchor" name="option ssl-hello-chk (Proxies)"></a><a class="anchor" name="option ssl-hello-chk (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option ssl-hello-chk"></a><a href="#4-option%20ssl-hello-chk">option ssl-hello-chk</a></b></div><pre class="text">Use SSLv3 client hello health checks for server testing</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When some SSL-based protocols are relayed in TCP mode through HAProxy, it is
possible to test that the server correctly talks SSL instead of just testing
that it accepts the TCP connection. When &quot;<a href="#option%20ssl-hello-chk">option ssl-hello-chk</a>&quot; is set, pure
SSLv3 client hello messages are sent once the connection is established to
the server, and the response is analyzed to find an SSL server hello message.
The server is considered valid only when the response contains this server
hello message.

All servers tested till there correctly reply to SSLv3 client hello messages,
and most servers tested do not even log the requests containing only hello
messages, which is appreciable.</pre><div class="page-header"><b>See also:</b> &quot;<a href="#option%20httpchk">option httpchk</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option tcp-smart-accept"></a><a class="anchor" name="4-option tcp-smart-accept"></a><a class="anchor" name="4.2-option tcp-smart-accept"></a><a class="anchor" name="option tcp-smart-accept (Proxies)"></a><a class="anchor" name="option tcp-smart-accept (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option tcp-smart-accept"></a><a href="#4-option%20tcp-smart-accept">option tcp-smart-accept</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option tcp-smart-accept"></a><a class="anchor" name="4-no option tcp-smart-accept"></a><a class="anchor" name="4.2-no option tcp-smart-accept"></a><a class="anchor" name="no option tcp-smart-accept (Proxies)"></a><a class="anchor" name="no option tcp-smart-accept (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option tcp-smart-accept"></a><a href="#4-no%20option%20tcp-smart-accept">no option tcp-smart-accept</a></b></div><pre class="text">Enable or disable the saving of one ACK packet during the accept sequence</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When an HTTP connection request comes in, the system acknowledges it on
behalf of HAProxy, then the client immediately sends its request, and the
system acknowledges it too while it is notifying HAProxy about the new
connection. HAProxy then reads the request and responds. This means that we
have one TCP ACK sent by the system for nothing, because the request could
very well be acknowledged by HAProxy when it sends its response.

For this reason, in HTTP mode, HAProxy automatically asks the system to avoid
sending this useless ACK on platforms which support it (currently at least
Linux). It must not cause any problem, because the system will send it anyway
after 40 ms if the response takes more time than expected to come.

During complex network debugging sessions, it may be desirable to disable
this optimization because delayed ACKs can make troubleshooting more complex
when trying to identify where packets are delayed. It is then possible to
fall back to normal behaviour by specifying &quot;<a href="#no%20option%20tcp-smart-accept">no option tcp-smart-accept</a>&quot;.

It is also possible to force it for non-HTTP proxies by simply specifying
&quot;<a href="#option%20tcp-smart-accept">option tcp-smart-accept</a>&quot;. For instance, it can make sense with some services
such as SMTP where the server speaks first.

It is recommended to avoid forcing this option in a defaults section. In case
of doubt, consider setting it back to automatic values by prepending the
&quot;default&quot; keyword before it, or disabling it using the &quot;no&quot; keyword.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20tcp-smart-connect">option tcp-smart-connect</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option tcp-smart-connect"></a><a class="anchor" name="4-option tcp-smart-connect"></a><a class="anchor" name="4.2-option tcp-smart-connect"></a><a class="anchor" name="option tcp-smart-connect (Proxies)"></a><a class="anchor" name="option tcp-smart-connect (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option tcp-smart-connect"></a><a href="#4-option%20tcp-smart-connect">option tcp-smart-connect</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option tcp-smart-connect"></a><a class="anchor" name="4-no option tcp-smart-connect"></a><a class="anchor" name="4.2-no option tcp-smart-connect"></a><a class="anchor" name="no option tcp-smart-connect (Proxies)"></a><a class="anchor" name="no option tcp-smart-connect (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option tcp-smart-connect"></a><a href="#4-no%20option%20tcp-smart-connect">no option tcp-smart-connect</a></b></div><pre class="text">Enable or disable the saving of one ACK packet during the connect sequence</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">On certain systems (at least Linux), HAProxy can ask the kernel not to
immediately send an empty ACK upon a connection request, but to directly
send the buffer request instead. This saves one packet on the network and
thus boosts performance. It can also be useful for some servers, because they
immediately get the request along with the incoming connection.

This feature is enabled when &quot;<a href="#option%20tcp-smart-connect">option tcp-smart-connect</a>&quot; is set in a backend.
It is not enabled by default because it makes network troubleshooting more
complex.

It only makes sense to enable it with protocols where the client speaks first
such as HTTP. In other situations, if there is no data to send in place of
the ACK, a normal ACK is sent.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20tcp-smart-accept">option tcp-smart-accept</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option tcpka"></a><a class="anchor" name="4-option tcpka"></a><a class="anchor" name="4.2-option tcpka"></a><a class="anchor" name="option tcpka (Proxies)"></a><a class="anchor" name="option tcpka (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option tcpka"></a><a href="#4-option%20tcpka">option tcpka</a></b></div><pre class="text">Enable or disable the sending of TCP keepalive packets on both sides</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When there is a firewall or any session-aware component between a client and
a server, and when the protocol involves very long sessions with long idle
periods (eg: remote desktops), there is a risk that one of the intermediate
components decides to expire a session which has remained idle for too long.

Enabling socket-level TCP keep-alives makes the system regularly send packets
to the other end of the connection, leaving it active. The delay between
keep-alive probes is controlled by the system only and depends both on the
operating system and its tuning parameters.

It is important to understand that keep-alive packets are neither emitted nor
received at the application level. It is only the network stacks which sees
them. For this reason, even if one side of the proxy already uses keep-alives
to maintain its connection alive, those keep-alive packets will not be
forwarded to the other side of the proxy.

Please note that this has nothing to do with HTTP keep-alive.

Using option &quot;<a href="#option%20tcpka">tcpka</a>&quot; enables the emission of TCP keep-alive probes on both
the client and server sides of a connection. Note that this is meaningful
only in &quot;defaults&quot; or &quot;listen&quot; sections. If this option is used in a
frontend, only the client side will get keep-alives, and if this option is
used in a backend, only the server side will get keep-alives. For this
reason, it is strongly recommended to explicitly use &quot;<a href="#option%20clitcpka">option clitcpka</a>&quot; and
&quot;<a href="#option%20srvtcpka">option srvtcpka</a>&quot; when the configuration is split between frontends and
backends.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20clitcpka">option clitcpka</a>&quot;, &quot;<a href="#option%20srvtcpka">option srvtcpka</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option tcplog"></a><a class="anchor" name="4-option tcplog"></a><a class="anchor" name="4.2-option tcplog"></a><a class="anchor" name="option tcplog (Proxies)"></a><a class="anchor" name="option tcplog (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option tcplog"></a><a href="#4-option%20tcplog">option tcplog</a></b></div><pre class="text">Enable advanced logging of TCP connections with session state and timers</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default, the log output format is very poor, as it only contains the
source and destination addresses, and the instance name. By specifying
&quot;<a href="#option%20tcplog">option tcplog</a>&quot;, each log line turns into a much richer format including, but
not limited to, the connection timers, the session status, the connections
numbers, the frontend, backend and server name, and of course the source
address and ports. This option is useful for pure TCP proxies in order to
find which of the client or server disconnects or times out. For normal HTTP
proxies, it's better to use &quot;<a href="#option%20httplog">option httplog</a>&quot; which is even more complete.

This option may be set either in the frontend or the backend.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httplog">option httplog</a>&quot;, and <a href="#8">section 8</a> about logging.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option transparent"></a><a class="anchor" name="4-option transparent"></a><a class="anchor" name="4.2-option transparent"></a><a class="anchor" name="option transparent (Proxies)"></a><a class="anchor" name="option transparent (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option transparent"></a><a href="#4-option%20transparent">option transparent</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option transparent"></a><a class="anchor" name="4-no option transparent"></a><a class="anchor" name="4.2-no option transparent"></a><a class="anchor" name="no option transparent (Proxies)"></a><a class="anchor" name="no option transparent (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option transparent"></a><a href="#4-no%20option%20transparent">no option transparent</a></b></div><pre class="text">Enable client-side transparent proxying</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">This option was introduced in order to provide layer 7 persistence to layer 3
load balancers. The idea is to use the OS's ability to redirect an incoming
connection for a remote address to a local process (here HAProxy), and let
this process know what address was initially requested. When this option is
used, sessions without cookies will be forwarded to the original destination
IP address of the incoming request (which should match that of another
equipment), while requests with cookies will still be forwarded to the
appropriate server.

Note that contrary to a common belief, this option does NOT make HAProxy
present the client's IP to the server when establishing the connection.</pre><div class="page-header"><b>See also:</b> the &quot;usesrc&quot; argument of the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#source%20%28Proxies%29">Proxies</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; keyword, and the &quot;<a href="#option%20transparent">transparent</a>&quot; option of the &quot;<a href="#bind">bind</a>&quot; keyword.</div>
<a class="anchor" name="persist"></a><a class="anchor" name="4-persist"></a><a class="anchor" name="4.2-persist"></a><a class="anchor" name="persist (Proxies)"></a><a class="anchor" name="persist (Alphabetically sorted keywords reference)"></a><a class="anchor" name="persist rdp-cookie"></a><a class="anchor" name="4-persist rdp-cookie"></a><a class="anchor" name="4.2-persist rdp-cookie"></a><a class="anchor" name="persist rdp-cookie (Proxies)"></a><a class="anchor" name="persist rdp-cookie (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="persist rdp-cookie"></a><a href="#4-persist%20rdp-cookie">persist rdp-cookie</a></b></div><pre class="text">persist rdp-cookie(name)
  Enable RDP cookie-based persistence</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;name&gt;    is the optional name of the RDP cookie to check. If omitted, the
          default cookie name &quot;msts&quot; will be used. There currently is no
          valid reason to change this name.</pre>
</div>
<pre class="text">This statement enables persistence based on an RDP cookie. The RDP cookie
contains all information required to find the server in the list of known
servers. So when this option is set in the backend, the request is analysed
and if an RDP cookie is found, it is decoded. If it matches a known server
which is still UP (or if &quot;<a href="#option%20persist">option persist</a>&quot; is set), then the connection is
forwarded to this server.

Note that this only makes sense in a TCP backend, but for this to work, the
frontend must have waited long enough to ensure that an RDP cookie is present
in the request buffer. This is the same requirement as with the &quot;rdp-cookie&quot;
load-balancing method. Thus it is highly recommended to put all statements in
a single &quot;listen&quot; section.

Also, it is important to understand that the terminal server will emit this
RDP cookie only if it is configured for &quot;token redirection mode&quot;, which means
that the &quot;IP address redirection&quot; option is disabled.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>listen tse-farm
    bind :3389
    <span class="comment"># wait up to 5s for an RDP cookie in the request</span>
    tcp-request inspect-delay 5s
    tcp-request content accept if RDP_COOKIE
    <span class="comment"># apply RDP cookie persistence</span>
    persist rdp-cookie
    <span class="comment"># if server is unknown, let's balance on the same cookie.</span>
    <span class="comment"># alternatively, &quot;balance leastconn&quot; may be useful too.</span>
    balance rdp-cookie
    server srv1 1.1.1.1:3389
    server srv2 1.1.1.2:3389
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;balance rdp-cookie&quot;, &quot;<a href="#tcp-request">tcp-request</a>&quot; and the &quot;<a href="#req_rdp_cookie">req_rdp_cookie</a>&quot; ACL.</div>
<a class="anchor" name="rate-limit"></a><a class="anchor" name="4-rate-limit"></a><a class="anchor" name="4.2-rate-limit"></a><a class="anchor" name="rate-limit (Proxies)"></a><a class="anchor" name="rate-limit (Alphabetically sorted keywords reference)"></a><a class="anchor" name="rate-limit sessions"></a><a class="anchor" name="4-rate-limit sessions"></a><a class="anchor" name="4.2-rate-limit sessions"></a><a class="anchor" name="rate-limit sessions (Proxies)"></a><a class="anchor" name="rate-limit sessions (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="rate-limit sessions"></a><a href="#4-rate-limit%20sessions">rate-limit sessions</a></b> <span style="color: #080">&lt;rate&gt;</span></div><pre class="text">Set a limit on the number of new sessions accepted per second on a frontend</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;rate&gt;    The &lt;rate&gt; parameter is an integer designating the maximum number
          of new sessions per second to accept on the frontend.</pre>
</div>
<pre class="text">When the frontend reaches the specified number of new sessions per second, it
stops accepting new connections until the rate drops below the limit again.
During this time, the pending sessions will be kept in the socket's backlog
(in system buffers) and haproxy will not even be aware that sessions are
pending. When applying very low limit on a highly loaded service, it may make
sense to increase the socket's backlog using the &quot;<a href="#backlog">backlog</a>&quot; keyword.

This feature is particularly efficient at blocking connection-based attacks
or service abuse on fragile servers. Since the session rate is measured every
millisecond, it is extremely accurate. Also, the limit applies immediately,
no delay is needed at all to detect the threshold.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<div class="example-desc">Limit the connection rate on SMTP to 10 per second max</div><code>listen smtp
    mode tcp
    bind :25
    rate-limit sessions 10
    server 127.0.0.1:1025
</code></pre>
</div><pre class="text">Note : when the maximum rate is reached, the frontend's status appears as
       &quot;FULL&quot; in the statistics, exactly as when it is saturated.</pre><div class="page-header"><b>See also :</b> the &quot;<a href="#backlog">backlog</a>&quot; keyword and the &quot;<a href="#fe_sess_rate">fe_sess_rate</a>&quot; ACL criterion.</div>
<a class="anchor" name="redirect"></a><a class="anchor" name="4-redirect"></a><a class="anchor" name="4.2-redirect"></a><a class="anchor" name="redirect (Proxies)"></a><a class="anchor" name="redirect (Alphabetically sorted keywords reference)"></a><a class="anchor" name="redirect location"></a><a class="anchor" name="4-redirect location"></a><a class="anchor" name="4.2-redirect location"></a><a class="anchor" name="redirect location (Proxies)"></a><a class="anchor" name="redirect location (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="redirect location"></a><a href="#4-redirect%20location">redirect location</a></b> <span style="color: #080">&lt;to&gt;</span> <span style="color: #008">[code <span style="color: #080">&lt;code&gt;</span>]</span> <span style="color: #080">&lt;option&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;condition&gt;</span>]</span></div><a class="anchor" name="redirect"></a><a class="anchor" name="4-redirect"></a><a class="anchor" name="4.2-redirect"></a><a class="anchor" name="redirect (Proxies)"></a><a class="anchor" name="redirect (Alphabetically sorted keywords reference)"></a><a class="anchor" name="redirect prefix"></a><a class="anchor" name="4-redirect prefix"></a><a class="anchor" name="4.2-redirect prefix"></a><a class="anchor" name="redirect prefix (Proxies)"></a><a class="anchor" name="redirect prefix (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="redirect prefix"></a><a href="#4-redirect%20prefix">redirect prefix</a></b>   <span style="color: #080">&lt;to&gt;</span> <span style="color: #008">[code <span style="color: #080">&lt;code&gt;</span>]</span> <span style="color: #080">&lt;option&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;condition&gt;</span>]</span></div><pre class="text">Return an HTTP redirection if/unless a condition is matched</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">If/unless the condition is matched, the HTTP request will lead to a redirect
response. If no condition is specified, the redirect applies unconditionally.</pre><div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;to&gt;      With &quot;<a href="#redirect%20location">redirect location</a>&quot;, the exact value in &lt;to&gt; is placed into
          the HTTP &quot;Location&quot; header. In case of &quot;<a href="#redirect%20prefix">redirect prefix</a>&quot;, the
          &quot;Location&quot; header is built from the concatenation of &lt;to&gt; and the
          complete URI, including the query string, unless the &quot;drop-query&quot;
          option is specified (see below). As a special case, if &lt;to&gt;
          equals exactly &quot;/&quot; in prefix mode, then nothing is inserted
          before the original URI. It allows one to redirect to the same
          URL.

&lt;code&gt;    The code is optional. It indicates which type of HTTP redirection
          is desired. Only codes 301, 302, 303, 307 and 308 are supported,
          with 302 used by default if no code is specified. 301 means
          &quot;Moved permanently&quot;, and a browser may cache the Location. 302
          means &quot;Moved permanently&quot; and means that the browser should not
          cache the redirection. 303 is equivalent to 302 except that the
          browser will fetch the location with a GET method. 307 is just
          like 302 but makes it clear that the same method must be reused.
          Likewise, 308 replaces 301 if the same method must be used.

&lt;option&gt;  There are several options which can be specified to adjust the
          expected behaviour of a redirection :

  - &quot;drop-query&quot;
    When this keyword is used in a prefix-based redirection, then the
    location will be set without any possible query-string, which is useful
    for directing users to a non-secure page for instance. It has no effect
    with a location-type redirect.

  - &quot;append-slash&quot;
    This keyword may be used in conjunction with &quot;drop-query&quot; to redirect
    users who use a URL not ending with a '/' to the same one with the '/'.
    It can be useful to ensure that search engines will only see one URL.
    For this, a return code 301 is preferred.

  - &quot;set-cookie NAME[=value]&quot;
    A &quot;Set-Cookie&quot; header will be added with NAME (and optionally &quot;=value&quot;)
    to the response. This is sometimes used to indicate that a user has
    been seen, for instance to protect against some types of DoS. No other
    cookie option is added, so the cookie will be a session cookie. Note
    that for a browser, a sole cookie name without an equal sign is
    different from a cookie with an equal sign.

  - &quot;clear-cookie NAME[=]&quot;
    A &quot;Set-Cookie&quot; header will be added with NAME (and optionally &quot;=&quot;), but
    with the &quot;Max-Age&quot; attribute set to zero. This will tell the browser to
    delete this cookie. It is useful for instance on logout pages. It is
    important to note that clearing the cookie &quot;NAME&quot; will not remove a
    cookie set with &quot;NAME=value&quot;. You have to clear the cookie &quot;NAME=&quot; for
    that, because the browser makes the difference.</pre>
</div>
<div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<div class="example-desc">Move the login URL only to HTTPS.</div><code>acl clear      dst_port  80
acl secure     dst_port  8080
acl login_page url_beg   /login
acl logout     url_beg   /logout
acl uid_given  url_reg   /login?userid=[^&amp;]+
acl cookie_set hdr_sub(cookie) SEEN=1

redirect prefix   https://mysite.com set-cookie SEEN=1 if !cookie_set
redirect prefix   https://mysite.com           if login_page !secure
redirect prefix   http://mysite.com drop-query if login_page !uid_given
redirect location http://mysite.com/           if !login_page secure
redirect location / clear-cookie USERID=       if logout
</code></pre>
</div><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<div class="example-desc">Send redirects for request for articles without a '/'.</div><code>acl missing_slash path_reg ^/article/[^/]*$
redirect code 301 prefix / drop-query append-slash if missing_slash
</code></pre>
</div><pre class="text">See <a href="#7">section 7</a> about ACL usage.</pre><a class="anchor" name="redisp"></a><a class="anchor" name="4-redisp"></a><a class="anchor" name="4.2-redisp"></a><a class="anchor" name="redisp (Proxies)"></a><a class="anchor" name="redisp (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="redisp"></a><a href="#4-redisp">redisp</a></b> <span class="label label-warning">(deprecated)</span></div><a class="anchor" name="redispatch"></a><a class="anchor" name="4-redispatch"></a><a class="anchor" name="4.2-redispatch"></a><a class="anchor" name="redispatch (Proxies)"></a><a class="anchor" name="redispatch (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="redispatch"></a><a href="#4-redispatch">redispatch</a></b> <span class="label label-warning">(deprecated)</span></div><pre class="text">Enable or disable session redistribution in case of connection failure</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">In HTTP mode, if a server designated by a cookie is down, clients may
definitely stick to it because they cannot flush the cookie, so they will not
be able to access the service anymore.

Specifying &quot;<a href="#option%20redispatch">redispatch</a>&quot; will allow the proxy to break their persistence and
redistribute them to a working server.

It also allows to retry last connection to another server in case of multiple
connection failures. Of course, it requires having &quot;<a href="#retries">retries</a>&quot; set to a nonzero
value.

This form is deprecated, do not use it in any new configuration, use the new
&quot;<a href="#option%20redispatch">option redispatch</a>&quot; instead.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20redispatch">option redispatch</a>&quot;</div>
<a class="anchor" name="reqadd"></a><a class="anchor" name="4-reqadd"></a><a class="anchor" name="4.2-reqadd"></a><a class="anchor" name="reqadd (Proxies)"></a><a class="anchor" name="reqadd (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqadd"></a><a href="#4-reqadd">reqadd</a></b>  <span style="color: #080">&lt;string&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><pre class="text">Add a header at the end of the HTTP request</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;string&gt;  is the complete line to be added. Any space or known delimiter
          must be escaped using a backslash ('\'). Please refer to section
          6 about HTTP header manipulation for more information.

&lt;cond&gt;    is an optional matching condition built from ACLs. It makes it
          possible to ignore this rule when other conditions are not met.</pre>
</div>
<pre class="text">A new line consisting in &lt;string&gt; followed by a line feed will be added after
the last header of an HTTP request.

Header transformations only apply to traffic which passes through HAProxy,
and not to traffic generated by HAProxy, such as health-checks or error
responses.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<div class="example-desc">Add &quot;X-Proto: SSL&quot; to requests coming via port 81</div><code>acl is-ssl  dst_port       81
reqadd      X-Proto:\ SSL  if is-ssl
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#rspadd">rspadd</a>&quot;, <a href="#6">section 6</a> about HTTP header manipulation, and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="reqallow"></a><a class="anchor" name="4-reqallow"></a><a class="anchor" name="4.2-reqallow"></a><a class="anchor" name="reqallow (Proxies)"></a><a class="anchor" name="reqallow (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqallow"></a><a href="#4-reqallow">reqallow</a></b>  <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><a class="anchor" name="reqiallow"></a><a class="anchor" name="4-reqiallow"></a><a class="anchor" name="4.2-reqiallow"></a><a class="anchor" name="reqiallow (Proxies)"></a><a class="anchor" name="reqiallow (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqiallow"></a><a href="#4-reqiallow">reqiallow</a></b> <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span> (ignore case)</div><pre class="text">Definitely allow an HTTP request if a line matches a regular expression</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;search&gt;  is the regular expression applied to HTTP headers and to the
          request line. This is an extended regular expression. Parenthesis
          grouping is supported and no preliminary backslash is required.
          Any space or known delimiter must be escaped using a backslash
          ('\'). The pattern applies to a full line at a time. The
          &quot;<a href="#reqallow">reqallow</a>&quot; keyword strictly matches case while &quot;<a href="#reqiallow">reqiallow</a>&quot;
          ignores case.

&lt;cond&gt;    is an optional matching condition built from ACLs. It makes it
          possible to ignore this rule when other conditions are not met.</pre>
</div>
<pre class="text">A request containing any line which matches extended regular expression
&lt;search&gt; will mark the request as allowed, even if any later test would
result in a deny. The test applies both to the request line and to request
headers. Keep in mind that URLs in request line are case-sensitive while
header names are not.

It is easier, faster and more powerful to use ACLs to write access policies.
Reqdeny, reqallow and reqpass should be avoided in new designs.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># allow www.* but refuse *.local</span>
reqiallow ^Host:\ www\.
reqideny  ^Host:\ .*\.local
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#reqdeny">reqdeny</a>&quot;, &quot;<a href="#block">block</a>&quot;, <a href="#6">section 6</a> about HTTP header manipulation, and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="reqdel"></a><a class="anchor" name="4-reqdel"></a><a class="anchor" name="4.2-reqdel"></a><a class="anchor" name="reqdel (Proxies)"></a><a class="anchor" name="reqdel (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqdel"></a><a href="#4-reqdel">reqdel</a></b>  <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><a class="anchor" name="reqidel"></a><a class="anchor" name="4-reqidel"></a><a class="anchor" name="4.2-reqidel"></a><a class="anchor" name="reqidel (Proxies)"></a><a class="anchor" name="reqidel (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqidel"></a><a href="#4-reqidel">reqidel</a></b> <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span>  (ignore case)</div><pre class="text">Delete all headers matching a regular expression in an HTTP request</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;search&gt;  is the regular expression applied to HTTP headers and to the
          request line. This is an extended regular expression. Parenthesis
          grouping is supported and no preliminary backslash is required.
          Any space or known delimiter must be escaped using a backslash
          ('\'). The pattern applies to a full line at a time. The &quot;<a href="#reqdel">reqdel</a>&quot;
          keyword strictly matches case while &quot;<a href="#reqidel">reqidel</a>&quot; ignores case.

&lt;cond&gt;    is an optional matching condition built from ACLs. It makes it
          possible to ignore this rule when other conditions are not met.</pre>
</div>
<pre class="text">Any header line matching extended regular expression &lt;search&gt; in the request
will be completely deleted. Most common use of this is to remove unwanted
and/or dangerous headers or cookies from a request before passing it to the
next servers.

Header transformations only apply to traffic which passes through HAProxy,
and not to traffic generated by HAProxy, such as health-checks or error
responses. Keep in mind that header names are not case-sensitive.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># remove X-Forwarded-For header and SERVER cookie</span>
reqidel ^X-Forwarded-For:.*
reqidel ^Cookie:.*SERVER=
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#reqadd">reqadd</a>&quot;, &quot;<a href="#reqrep">reqrep</a>&quot;, &quot;<a href="#rspdel">rspdel</a>&quot;, <a href="#6">section 6</a> about HTTP header manipulation, and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="reqdeny"></a><a class="anchor" name="4-reqdeny"></a><a class="anchor" name="4.2-reqdeny"></a><a class="anchor" name="reqdeny (Proxies)"></a><a class="anchor" name="reqdeny (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqdeny"></a><a href="#4-reqdeny">reqdeny</a></b>  <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><a class="anchor" name="reqideny"></a><a class="anchor" name="4-reqideny"></a><a class="anchor" name="4.2-reqideny"></a><a class="anchor" name="reqideny (Proxies)"></a><a class="anchor" name="reqideny (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqideny"></a><a href="#4-reqideny">reqideny</a></b> <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span>  (ignore case)</div><pre class="text">Deny an HTTP request if a line matches a regular expression</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;search&gt;  is the regular expression applied to HTTP headers and to the
          request line. This is an extended regular expression. Parenthesis
          grouping is supported and no preliminary backslash is required.
          Any space or known delimiter must be escaped using a backslash
          ('\'). The pattern applies to a full line at a time. The
          &quot;<a href="#reqdeny">reqdeny</a>&quot; keyword strictly matches case while &quot;<a href="#reqideny">reqideny</a>&quot; ignores
          case.

&lt;cond&gt;    is an optional matching condition built from ACLs. It makes it
          possible to ignore this rule when other conditions are not met.</pre>
</div>
<pre class="text">A request containing any line which matches extended regular expression
&lt;search&gt; will mark the request as denied, even if any later test would
result in an allow. The test applies both to the request line and to request
headers. Keep in mind that URLs in request line are case-sensitive while
header names are not.

A denied request will generate an &quot;HTTP 403 forbidden&quot; response once the
complete request has been parsed. This is consistent with what is practiced
using ACLs.

It is easier, faster and more powerful to use ACLs to write access policies.
Reqdeny, reqallow and reqpass should be avoided in new designs.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># refuse *.local, then allow www.*</span>
reqideny  ^Host:\ .*\.local
reqiallow ^Host:\ www\.
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#reqallow">reqallow</a>&quot;, &quot;<a href="#rspdeny">rspdeny</a>&quot;, &quot;<a href="#block">block</a>&quot;, <a href="#6">section 6</a> about HTTP header manipulation, and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="reqpass"></a><a class="anchor" name="4-reqpass"></a><a class="anchor" name="4.2-reqpass"></a><a class="anchor" name="reqpass (Proxies)"></a><a class="anchor" name="reqpass (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqpass"></a><a href="#4-reqpass">reqpass</a></b>  <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><a class="anchor" name="reqipass"></a><a class="anchor" name="4-reqipass"></a><a class="anchor" name="4.2-reqipass"></a><a class="anchor" name="reqipass (Proxies)"></a><a class="anchor" name="reqipass (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqipass"></a><a href="#4-reqipass">reqipass</a></b> <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span>  (ignore case)</div><pre class="text">Ignore any HTTP request line matching a regular expression in next rules</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;search&gt;  is the regular expression applied to HTTP headers and to the
          request line. This is an extended regular expression. Parenthesis
          grouping is supported and no preliminary backslash is required.
          Any space or known delimiter must be escaped using a backslash
          ('\'). The pattern applies to a full line at a time. The
          &quot;<a href="#reqpass">reqpass</a>&quot; keyword strictly matches case while &quot;<a href="#reqipass">reqipass</a>&quot; ignores
          case.

&lt;cond&gt;    is an optional matching condition built from ACLs. It makes it
          possible to ignore this rule when other conditions are not met.</pre>
</div>
<pre class="text">A request containing any line which matches extended regular expression
&lt;search&gt; will skip next rules, without assigning any deny or allow verdict.
The test applies both to the request line and to request headers. Keep in
mind that URLs in request line are case-sensitive while header names are not.

It is easier, faster and more powerful to use ACLs to write access policies.
Reqdeny, reqallow and reqpass should be avoided in new designs.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># refuse *.local, then allow www.*, but ignore &quot;www.private.local&quot;</span>
reqipass  ^Host:\ www.private\.local
reqideny  ^Host:\ .*\.local
reqiallow ^Host:\ www\.
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#reqallow">reqallow</a>&quot;, &quot;<a href="#reqdeny">reqdeny</a>&quot;, &quot;<a href="#block">block</a>&quot;, <a href="#6">section 6</a> about HTTP header manipulation, and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="reqrep"></a><a class="anchor" name="4-reqrep"></a><a class="anchor" name="4.2-reqrep"></a><a class="anchor" name="reqrep (Proxies)"></a><a class="anchor" name="reqrep (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqrep"></a><a href="#4-reqrep">reqrep</a></b>  <span style="color: #080">&lt;search&gt;</span> <span style="color: #080">&lt;string&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><a class="anchor" name="reqirep"></a><a class="anchor" name="4-reqirep"></a><a class="anchor" name="4.2-reqirep"></a><a class="anchor" name="reqirep (Proxies)"></a><a class="anchor" name="reqirep (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqirep"></a><a href="#4-reqirep">reqirep</a></b> <span style="color: #080">&lt;search&gt;</span> <span style="color: #080">&lt;string&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span>   (ignore case)</div><pre class="text">Replace a regular expression with a string in an HTTP request line</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;search&gt;  is the regular expression applied to HTTP headers and to the
          request line. This is an extended regular expression. Parenthesis
          grouping is supported and no preliminary backslash is required.
          Any space or known delimiter must be escaped using a backslash
          ('\'). The pattern applies to a full line at a time. The &quot;<a href="#reqrep">reqrep</a>&quot;
          keyword strictly matches case while &quot;<a href="#reqirep">reqirep</a>&quot; ignores case.

&lt;string&gt;  is the complete line to be added. Any space or known delimiter
          must be escaped using a backslash ('\'). References to matched
          pattern groups are possible using the common \N form, with N
          being a single digit between 0 and 9. Please refer to section
          6 about HTTP header manipulation for more information.

&lt;cond&gt;    is an optional matching condition built from ACLs. It makes it
          possible to ignore this rule when other conditions are not met.</pre>
</div>
<pre class="text">Any line matching extended regular expression &lt;search&gt; in the request (both
the request line and header lines) will be completely replaced with &lt;string&gt;.
Most common use of this is to rewrite URLs or domain names in &quot;Host&quot; headers.

Header transformations only apply to traffic which passes through HAProxy,
and not to traffic generated by HAProxy, such as health-checks or error
responses. Note that for increased readability, it is suggested to add enough
spaces between the request and the response. Keep in mind that URLs in
request line are case-sensitive while header names are not.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># replace &quot;/static/&quot; with &quot;/&quot; at the beginning of any request path.</span>
reqrep ^([^\ :]*)\ /static/(.*)     \1\ /\2
<span class="comment"># replace &quot;www.mydomain.com&quot; with &quot;www&quot; in the host name.</span>
reqirep ^Host:\ www.mydomain.com   Host:\ www
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#reqadd">reqadd</a>&quot;, &quot;<a href="#reqdel">reqdel</a>&quot;, &quot;<a href="#rsprep">rsprep</a>&quot;, <a href="#6">section 6</a> about HTTP header manipulation, and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="reqtarpit"></a><a class="anchor" name="4-reqtarpit"></a><a class="anchor" name="4.2-reqtarpit"></a><a class="anchor" name="reqtarpit (Proxies)"></a><a class="anchor" name="reqtarpit (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqtarpit"></a><a href="#4-reqtarpit">reqtarpit</a></b>  <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><a class="anchor" name="reqitarpit"></a><a class="anchor" name="4-reqitarpit"></a><a class="anchor" name="4.2-reqitarpit"></a><a class="anchor" name="reqitarpit (Proxies)"></a><a class="anchor" name="reqitarpit (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqitarpit"></a><a href="#4-reqitarpit">reqitarpit</a></b> <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span>  (ignore case)</div><pre class="text">Tarpit an HTTP request containing a line matching a regular expression</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;search&gt;  is the regular expression applied to HTTP headers and to the
          request line. This is an extended regular expression. Parenthesis
          grouping is supported and no preliminary backslash is required.
          Any space or known delimiter must be escaped using a backslash
          ('\'). The pattern applies to a full line at a time. The
          &quot;<a href="#reqtarpit">reqtarpit</a>&quot; keyword strictly matches case while &quot;<a href="#reqitarpit">reqitarpit</a>&quot;
          ignores case.

&lt;cond&gt;    is an optional matching condition built from ACLs. It makes it
          possible to ignore this rule when other conditions are not met.</pre>
</div>
<pre class="text">A request containing any line which matches extended regular expression
&lt;search&gt; will be tarpitted, which means that it will connect to nowhere, will
be kept open for a pre-defined time, then will return an HTTP error 500 so
that the attacker does not suspect it has been tarpitted. The status 500 will
be reported in the logs, but the completion flags will indicate &quot;PT&quot;. The
delay is defined by &quot;<a href="#timeout%20tarpit">timeout tarpit</a>&quot;, or &quot;<a href="#timeout%20connect">timeout connect</a>&quot; if the former is
not set.

The goal of the tarpit is to slow down robots attacking servers with
identifiable requests. Many robots limit their outgoing number of connections
and stay connected waiting for a reply which can take several minutes to
come. Depending on the environment and attack, it may be particularly
efficient at reducing the load on the network and firewalls.</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code><span class="comment"># ignore user-agents reporting any flavour of &quot;Mozilla&quot; or &quot;MSIE&quot;, but</span>
<span class="comment"># block all others.</span>
reqipass   ^User-Agent:\.*(Mozilla|MSIE)
reqitarpit ^User-Agent:

<span class="comment"># block bad guys</span>
acl badguys src 10.1.0.3 172.16.13.20/28
reqitarpit . if badguys
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#reqallow">reqallow</a>&quot;, &quot;<a href="#reqdeny">reqdeny</a>&quot;, &quot;<a href="#reqpass">reqpass</a>&quot;, <a href="#6">section 6</a> about HTTP header manipulation, and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="retries"></a><a class="anchor" name="4-retries"></a><a class="anchor" name="4.2-retries"></a><a class="anchor" name="retries (Proxies)"></a><a class="anchor" name="retries (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="retries"></a><a href="#4-retries">retries</a></b> <span style="color: #080">&lt;value&gt;</span></div><pre class="text">Set the number of retries to perform on a server after a connection failure</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;value&gt;   is the number of times a connection attempt should be retried on
          a server when a connection either is refused or times out. The
          default value is 3.</pre>
</div>
<pre class="text">It is important to understand that this value applies to the number of
connection attempts, not full requests. When a connection has effectively
been established to a server, there will be no more retry.

In order to avoid immediate reconnections to a server which is restarting,
a turn-around timer of 1 second is applied before a retry occurs.

When &quot;<a href="#option%20redispatch">option redispatch</a>&quot; is set, the last retry may be performed on another
server even if a cookie references a different server.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20redispatch">option redispatch</a>&quot;</div>
<a class="anchor" name="rspadd"></a><a class="anchor" name="4-rspadd"></a><a class="anchor" name="4.2-rspadd"></a><a class="anchor" name="rspadd (Proxies)"></a><a class="anchor" name="rspadd (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="rspadd"></a><a href="#4-rspadd">rspadd</a></b> <span style="color: #080">&lt;string&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><pre class="text">Add a header at the end of the HTTP response</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;string&gt;  is the complete line to be added. Any space or known delimiter
          must be escaped using a backslash ('\'). Please refer to section
          6 about HTTP header manipulation for more information.

&lt;cond&gt;    is an optional matching condition built from ACLs. It makes it
          possible to ignore this rule when other conditions are not met.</pre>
</div>
<pre class="text">A new line consisting in &lt;string&gt; followed by a line feed will be added after
the last header of an HTTP response.

Header transformations only apply to traffic which passes through HAProxy,
and not to traffic generated by HAProxy, such as health-checks or error
responses.</pre><div class="page-header"><b>See also:</b> &quot;<a href="#reqadd">reqadd</a>&quot;, <a href="#6">section 6</a> about HTTP header manipulation, and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="rspdel"></a><a class="anchor" name="4-rspdel"></a><a class="anchor" name="4.2-rspdel"></a><a class="anchor" name="rspdel (Proxies)"></a><a class="anchor" name="rspdel (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="rspdel"></a><a href="#4-rspdel">rspdel</a></b>  <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><a class="anchor" name="rspidel"></a><a class="anchor" name="4-rspidel"></a><a class="anchor" name="4.2-rspidel"></a><a class="anchor" name="rspidel (Proxies)"></a><a class="anchor" name="rspidel (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="rspidel"></a><a href="#4-rspidel">rspidel</a></b> <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span>  (ignore case)</div><pre class="text">Delete all headers matching a regular expression in an HTTP response</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;search&gt;  is the regular expression applied to HTTP headers and to the
          response line. This is an extended regular expression, so
          parenthesis grouping is supported and no preliminary backslash
          is required. Any space or known delimiter must be escaped using
          a backslash ('\'). The pattern applies to a full line at a time.
          The &quot;<a href="#rspdel">rspdel</a>&quot; keyword strictly matches case while &quot;<a href="#rspidel">rspidel</a>&quot;
          ignores case.

&lt;cond&gt;    is an optional matching condition built from ACLs. It makes it
          possible to ignore this rule when other conditions are not met.</pre>
</div>
<pre class="text">Any header line matching extended regular expression &lt;search&gt; in the response
will be completely deleted. Most common use of this is to remove unwanted
and/or sensitive headers or cookies from a response before passing it to the
client.

Header transformations only apply to traffic which passes through HAProxy,
and not to traffic generated by HAProxy, such as health-checks or error
responses. Keep in mind that header names are not case-sensitive.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># remove the Server header from responses</span>
reqidel ^Server:.*
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#rspadd">rspadd</a>&quot;, &quot;<a href="#rsprep">rsprep</a>&quot;, &quot;<a href="#reqdel">reqdel</a>&quot;, <a href="#6">section 6</a> about HTTP header manipulation, and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="rspdeny"></a><a class="anchor" name="4-rspdeny"></a><a class="anchor" name="4.2-rspdeny"></a><a class="anchor" name="rspdeny (Proxies)"></a><a class="anchor" name="rspdeny (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="rspdeny"></a><a href="#4-rspdeny">rspdeny</a></b>  <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><a class="anchor" name="rspideny"></a><a class="anchor" name="4-rspideny"></a><a class="anchor" name="4.2-rspideny"></a><a class="anchor" name="rspideny (Proxies)"></a><a class="anchor" name="rspideny (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="rspideny"></a><a href="#4-rspideny">rspideny</a></b> <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span>  (ignore case)</div><pre class="text">Block an HTTP response if a line matches a regular expression</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;search&gt;  is the regular expression applied to HTTP headers and to the
          response line. This is an extended regular expression, so
          parenthesis grouping is supported and no preliminary backslash
          is required. Any space or known delimiter must be escaped using
          a backslash ('\'). The pattern applies to a full line at a time.
          The &quot;<a href="#rspdeny">rspdeny</a>&quot; keyword strictly matches case while &quot;<a href="#rspideny">rspideny</a>&quot;
          ignores case.

&lt;cond&gt;    is an optional matching condition built from ACLs. It makes it
          possible to ignore this rule when other conditions are not met.</pre>
</div>
<pre class="text">A response containing any line which matches extended regular expression
&lt;search&gt; will mark the request as denied. The test applies both to the
response line and to response headers. Keep in mind that header names are not
case-sensitive.

Main use of this keyword is to prevent sensitive information leak and to
block the response before it reaches the client. If a response is denied, it
will be replaced with an HTTP 502 error so that the client never retrieves
any sensitive data.

It is easier, faster and more powerful to use ACLs to write access policies.
Rspdeny should be avoided in new designs.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># Ensure that no content type matching ms-word will leak</span>
rspideny  ^Content-type:\.*/ms-word
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#reqdeny">reqdeny</a>&quot;, &quot;<a href="#acl">acl</a>&quot;, &quot;<a href="#block">block</a>&quot;, <a href="#6">section 6</a> about HTTP header manipulation and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="rsprep"></a><a class="anchor" name="4-rsprep"></a><a class="anchor" name="4.2-rsprep"></a><a class="anchor" name="rsprep (Proxies)"></a><a class="anchor" name="rsprep (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="rsprep"></a><a href="#4-rsprep">rsprep</a></b>  <span style="color: #080">&lt;search&gt;</span> <span style="color: #080">&lt;string&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><a class="anchor" name="rspirep"></a><a class="anchor" name="4-rspirep"></a><a class="anchor" name="4.2-rspirep"></a><a class="anchor" name="rspirep (Proxies)"></a><a class="anchor" name="rspirep (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="rspirep"></a><a href="#4-rspirep">rspirep</a></b> <span style="color: #080">&lt;search&gt;</span> <span style="color: #080">&lt;string&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span>  (ignore case)</div><pre class="text">Replace a regular expression with a string in an HTTP response line</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;search&gt;  is the regular expression applied to HTTP headers and to the
          response line. This is an extended regular expression, so
          parenthesis grouping is supported and no preliminary backslash
          is required. Any space or known delimiter must be escaped using
          a backslash ('\'). The pattern applies to a full line at a time.
          The &quot;<a href="#rsprep">rsprep</a>&quot; keyword strictly matches case while &quot;<a href="#rspirep">rspirep</a>&quot;
          ignores case.

&lt;string&gt;  is the complete line to be added. Any space or known delimiter
          must be escaped using a backslash ('\'). References to matched
          pattern groups are possible using the common \N form, with N
          being a single digit between 0 and 9. Please refer to section
          6 about HTTP header manipulation for more information.

&lt;cond&gt;    is an optional matching condition built from ACLs. It makes it
          possible to ignore this rule when other conditions are not met.</pre>
</div>
<pre class="text">Any line matching extended regular expression &lt;search&gt; in the response (both
the response line and header lines) will be completely replaced with
&lt;string&gt;. Most common use of this is to rewrite Location headers.

Header transformations only apply to traffic which passes through HAProxy,
and not to traffic generated by HAProxy, such as health-checks or error
responses. Note that for increased readability, it is suggested to add enough
spaces between the request and the response. Keep in mind that header names
are not case-sensitive.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># replace &quot;Location: 127.0.0.1:8080&quot; with &quot;Location: www.mydomain.com&quot;</span>
rspirep ^Location:\ 127.0.0.1:8080    Location:\ www.mydomain.com
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#rspadd">rspadd</a>&quot;, &quot;<a href="#rspdel">rspdel</a>&quot;, &quot;<a href="#reqrep">reqrep</a>&quot;, <a href="#6">section 6</a> about HTTP header manipulation, and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="server"></a><a class="anchor" name="4-server"></a><a class="anchor" name="4.2-server"></a><a class="anchor" name="server (Proxies)"></a><a class="anchor" name="server (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="server"></a><a href="#4-server">server</a></b> <span style="color: #080">&lt;name&gt;</span> <span style="color: #080">&lt;address&gt;</span><span style="color: #008">[:port]</span> <span style="color: #008">[param*]</span></div><pre class="text">Declare a server in a backend</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;name&gt;    is the internal name assigned to this server. This name will
          appear in logs and alerts.  If &quot;http-send-server-name&quot; is
          set, it will be added to the request header sent to the server.

&lt;address&gt; is the IPv4 address of the server. Alternatively, a resolvable
          hostname is supported, but this name will be resolved during
          start-up. If no address is specified in front of the port, or if
          address &quot;0.0.0.0&quot; is specified, then the address used will be the
          same as the one used by the incoming connection. This makes it
          possible to relay connections for many IPs on a different port or
          to perform transparent forwarding with connection limitation.

&lt;ports&gt;   is an optional port specification. If set, all connections will
          be sent to this port. If unset, the same port the client
          connected to will be used. The port may also be prefixed by a &quot;+&quot;
          or a &quot;-&quot;. In this case, the server's port will be determined by
          adding this value to the client's port.

&lt;param*&gt;  is a list of parameters for this server. The &quot;<a href="#server">server</a>&quot; keywords
          accepts an important number of options and has a complete section
          dedicated to it. Please refer to <a href="#5">section 5</a> for more details.</pre>
</div>
<div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code>server first  10.1.1.1:1080 cookie first  check inter 1000
server second 10.1.1.2:1080 cookie second check inter 1000
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#default-server">default-server</a>&quot;, &quot;<a href="#http-send-name-header">http-send-name-header</a>&quot; and <a href="#5">section 5</a> about server options</div>
<a class="anchor" name="source"></a><a class="anchor" name="4-source"></a><a class="anchor" name="4.2-source"></a><a class="anchor" name="source (Proxies)"></a><a class="anchor" name="source (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="source"></a><a href="#4-source">source</a></b> <span style="color: #080">&lt;addr&gt;</span><span style="color: #008">[:<span style="color: #080">&lt;port&gt;</span>]</span> <span style="color: #008">[usesrc <span style="color: #800">{ <span style="color: #080">&lt;addr2&gt;</span><span style="color: #008">[:<span style="color: #080">&lt;port2&gt;</span>]</span> | client | clientip }</span> ]</span></div><a class="anchor" name="source"></a><a class="anchor" name="4-source"></a><a class="anchor" name="4.2-source"></a><a class="anchor" name="source (Proxies)"></a><a class="anchor" name="source (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="source"></a><a href="#4-source">source</a></b> <span style="color: #080">&lt;addr&gt;</span><span style="color: #008">[:<span style="color: #080">&lt;port&gt;</span>]</span> <span style="color: #008">[usesrc <span style="color: #800">{ <span style="color: #080">&lt;addr2&gt;</span><span style="color: #008">[:<span style="color: #080">&lt;port2&gt;</span>]</span> | hdr_ip(<span style="color: #080">&lt;hdr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;occ&gt;</span>]</span>) }</span> ]</span></div><a class="anchor" name="source"></a><a class="anchor" name="4-source"></a><a class="anchor" name="4.2-source"></a><a class="anchor" name="source (Proxies)"></a><a class="anchor" name="source (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="source"></a><a href="#4-source">source</a></b> <span style="color: #080">&lt;addr&gt;</span><span style="color: #008">[:<span style="color: #080">&lt;port&gt;</span>]</span> <span style="color: #008">[interface <span style="color: #080">&lt;name&gt;</span>]</span></div><pre class="text">Set the source address for outgoing connections</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;addr&gt;    is the IPv4 address HAProxy will bind to before connecting to a
          server. This address is also used as a source for health checks.
          The default value of 0.0.0.0 means that the system will select
          the most appropriate address to reach its destination.

&lt;port&gt;    is an optional port. It is normally not needed but may be useful
          in some very specific contexts. The default value of zero means
          the system will select a free port. Note that port ranges are not
          supported in the backend. If you want to force port ranges, you
          have to specify them on each &quot;<a href="#server">server</a>&quot; line.

&lt;addr2&gt;   is the IP address to present to the server when connections are
          forwarded in full transparent proxy mode. This is currently only
          supported on some patched Linux kernels. When this address is
          specified, clients connecting to the server will be presented
          with this address, while health checks will still use the address
          &lt;addr&gt;.

&lt;port2&gt;   is the optional port to present to the server when connections
          are forwarded in full transparent proxy mode (see &lt;addr2&gt; above).
          The default value of zero means the system will select a free
          port.

&lt;hdr&gt;     is the name of a HTTP header in which to fetch the IP to bind to.
          This is the name of a comma-separated header list which can
          contain multiple IP addresses. By default, the last occurrence is
          used. This is designed to work with the X-Forwarded-For header
          and to automatically bind to the the client's IP address as seen
          by previous proxy, typically Stunnel. In order to use another
          occurrence from the last one, please see the &lt;occ&gt; parameter
          below. When the header (or occurrence) is not found, no binding
          is performed so that the proxy's default IP address is used. Also
          keep in mind that the header name is case insensitive, as for any
          HTTP header.

&lt;occ&gt;     is the occurrence number of a value to be used in a multi-value
          header. This is to be used in conjunction with &quot;hdr_ip(&lt;hdr&gt;)&quot;,
          in order to specificy which occurrence to use for the source IP
          address. Positive values indicate a position from the first
          occurrence, 1 being the first one. Negative values indicate
          positions relative to the last one, -1 being the last one. This
          is helpful for situations where an X-Forwarded-For header is set
          at the entry point of an infrastructure and must be used several
          proxy layers away. When this value is not specified, -1 is
          assumed. Passing a zero here disables the feature.

&lt;name&gt;    is an optional interface name to which to bind to for outgoing
          traffic. On systems supporting this features (currently, only
          Linux), this allows one to bind all traffic to the server to
          this interface even if it is not the one the system would select
          based on routing tables. This should be used with extreme care.
          Note that using this option requires root privileges.</pre>
</div>
<pre class="text">The &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#source%20%28Proxies%29">Proxies</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; keyword is useful in complex environments where a specific
address only is allowed to connect to the servers. It may be needed when a
private address must be used through a public gateway for instance, and it is
known that the system cannot determine the adequate source address by itself.

An extension which is available on certain patched Linux kernels may be used
through the &quot;usesrc&quot; optional keyword. It makes it possible to connect to the
servers with an IP address which does not belong to the system itself. This
is called &quot;full transparent proxy mode&quot;. For this to work, the destination
servers have to route their traffic back to this address through the machine
running HAProxy, and IP forwarding must generally be enabled on this machine.

In this &quot;full transparent proxy&quot; mode, it is possible to force a specific IP
address to be presented to the servers. This is not much used in fact. A more
common use is to tell HAProxy to present the client's IP address. For this,
there are two methods :

  - present the client's IP and port addresses. This is the most transparent
    mode, but it can cause problems when IP connection tracking is enabled on
    the machine, because a same connection may be seen twice with different
    states. However, this solution presents the huge advantage of not
    limiting the system to the 64k outgoing address+port couples, because all
    of the client ranges may be used.

  - present only the client's IP address and select a spare port. This
    solution is still quite elegant but slightly less transparent (downstream
    firewalls logs will not match upstream's). It also presents the downside
    of limiting the number of concurrent connections to the usual 64k ports.
    However, since the upstream and downstream ports are different, local IP
    connection tracking on the machine will not be upset by the reuse of the
    same session.

Note that depending on the transparent proxy technology used, it may be
required to force the source address. In fact, cttproxy version 2 requires an
IP address in &lt;addr&gt; above, and does not support setting of &quot;0.0.0.0&quot; as the
IP address because it creates NAT entries which much match the exact outgoing
address. Tproxy version 4 and some other kernel patches which work in pure
forwarding mode generally will not have this limitation.

This option sets the default source for all servers in the backend. It may
also be specified in a &quot;defaults&quot; section. Finer source address specification
is possible at the server level using the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#source%20%28Proxies%29">Proxies</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; server option. Refer to
<a href="#5">section 5</a> for more information.</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code>backend private
    <span class="comment"># Connect to the servers using our 192.168.1.200 source address</span>
    source 192.168.1.200

backend transparent_ssl1
    <span class="comment"># Connect to the SSL farm from the client's source address</span>
    source 192.168.1.200 usesrc clientip

backend transparent_ssl2
    <span class="comment"># Connect to the SSL farm from the client's source address and port</span>
    <span class="comment"># not recommended if IP conntrack is present on the local machine.</span>
    source 192.168.1.200 usesrc client

backend transparent_ssl3
    <span class="comment"># Connect to the SSL farm from the client's source address. It</span>
    <span class="comment"># is more conntrack-friendly.</span>
    source 192.168.1.200 usesrc clientip

backend transparent_smtp
    <span class="comment"># Connect to the SMTP farm from the client's source address/port</span>
    <span class="comment"># with Tproxy version 4.</span>
    source 0.0.0.0 usesrc clientip

backend transparent_http
    <span class="comment"># Connect to the servers using the client's IP as seen by previous</span>
    <span class="comment"># proxy.</span>
    source 0.0.0.0 usesrc hdr_ip(x-forwarded-for,-1)
</code></pre>
</div><div class="page-header"><b>See also :</b> the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#source%20%28Proxies%29">Proxies</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; server option in <a href="#5">section 5</a>, the Tproxy patches for the Linux kernel on www.balabit.com, the &quot;<a href="#bind">bind</a>&quot; keyword.</div>
<a class="anchor" name="srvtimeout"></a><a class="anchor" name="4-srvtimeout"></a><a class="anchor" name="4.2-srvtimeout"></a><a class="anchor" name="srvtimeout (Proxies)"></a><a class="anchor" name="srvtimeout (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="srvtimeout"></a><a href="#4-srvtimeout">srvtimeout</a></b> <span style="color: #080">&lt;timeout&gt;</span> <span class="label label-warning">(deprecated)</span></div><pre class="text">Set the maximum inactivity time on the server side.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">The inactivity timeout applies when the server is expected to acknowledge or
send data. In HTTP mode, this timeout is particularly important to consider
during the first phase of the server's response, when it has to send the
headers, as it directly represents the server's processing time for the
request. To find out what value to put there, it's often good to start with
what would be considered as unacceptable response times, then check the logs
to observe the response time distribution, and adjust the value accordingly.

The value is specified in milliseconds by default, but can be in any other
unit if the number is suffixed by the unit, as specified at the top of this
document. In TCP mode (and to a lesser extent, in HTTP mode), it is highly
recommended that the client timeout remains equal to the server timeout in
order to avoid complex situations to debug. Whatever the expected server
response times, it is a good practice to cover at least one or several TCP
packet losses by specifying timeouts that are slightly above multiples of 3
seconds (eg: 4 or 5 seconds minimum).

This parameter is specific to backends, but can be specified once for all in
&quot;defaults&quot; sections. This is in fact one of the easiest solutions not to
forget about it. An unspecified timeout results in an infinite timeout, which
is not recommended. Such a usage is accepted and works but reports a warning
during startup because it may results in accumulation of expired sessions in
the system if the system's timeouts are not configured either.

This parameter is provided for compatibility but is currently deprecated.
Please use &quot;<a href="#timeout%20server">timeout server</a>&quot; instead.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#timeout%20server">timeout server</a>&quot;, &quot;<a href="#timeout%20client">timeout client</a>&quot; and &quot;<a href="#clitimeout">clitimeout</a>&quot;.</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats admin"></a><a class="anchor" name="4-stats admin"></a><a class="anchor" name="4.2-stats admin"></a><a class="anchor" name="stats admin (Proxies)"></a><a class="anchor" name="stats admin (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats admin"></a><a href="#4-stats%20admin">stats admin</a></b> <span style="color: #800">{ if | unless }</span> <span style="color: #080">&lt;cond&gt;</span></div><pre class="text">Enable statistics admin level if/unless a condition is matched</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">This statement enables the statistics admin level if/unless a condition is
matched.

The admin level allows to enable/disable servers from the web interface. By
default, statistics page is read-only for security reasons.

Note : Consider not using this feature in multi-process mode (nbproc &gt; 1)
       unless you know what you do : memory is not shared between the
       processes, which can result in random behaviours.

Currently, the POST request is limited to the buffer size minus the reserved
buffer space, which means that if the list of servers is too long, the
request won't be processed. It is recommended to alter few servers at a
time.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># statistics admin level only for localhost</span>
backend stats_localhost
    stats enable
    stats admin if LOCALHOST
</code></pre>
</div><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># statistics admin level always enabled because of the authentication</span>
backend stats_auth
    stats enable
    stats auth  admin:AdMiN123
    stats admin if TRUE
</code></pre>
</div><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># statistics admin level depends on the authenticated user</span>
userlist stats-auth
    group admin    users admin
    user  admin    insecure-password AdMiN123
    group readonly users haproxy
    user  haproxy  insecure-password haproxy

backend stats_auth
    stats enable
    acl AUTH       http_auth(stats-auth)
    acl AUTH_ADMIN http_auth_group(stats-auth) admin
    stats http-request auth unless AUTH
    stats admin if AUTH_ADMIN
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stats%20enable">stats enable</a>&quot;, &quot;<a href="#stats%20auth">stats auth</a>&quot;, &quot;<a href="#stats%20http-request">stats http-request</a>&quot;, &quot;<a href="#nbproc">nbproc</a>&quot;, &quot;<a href="#bind-process">bind-process</a>&quot;, <a href="#3.4">section 3.4</a> about userlists and <a href="#7">section 7</a> about ACL usage.</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats auth"></a><a class="anchor" name="4-stats auth"></a><a class="anchor" name="4.2-stats auth"></a><a class="anchor" name="stats auth (Proxies)"></a><a class="anchor" name="stats auth (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats auth"></a><a href="#4-stats%20auth">stats auth</a></b> <span style="color: #080">&lt;user&gt;</span>:<span style="color: #080">&lt;passwd&gt;</span></div><pre class="text">Enable statistics with authentication and grant access to an account</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;user&gt;    is a user name to grant access to

&lt;passwd&gt;  is the cleartext password associated to this user</pre>
</div>
<pre class="text">This statement enables statistics with default settings, and restricts access
to declared users only. It may be repeated as many times as necessary to
allow as many users as desired. When a user tries to access the statistics
without a valid account, a &quot;401 Forbidden&quot; response will be returned so that
the browser asks the user to provide a valid user and password. The real
which will be returned to the browser is configurable using &quot;<a href="#stats%20realm">stats realm</a>&quot;.

Since the authentication method is HTTP Basic Authentication, the passwords
circulate in cleartext on the network. Thus, it was decided that the
configuration file would also use cleartext passwords to remind the users
that those ones should not be sensitive and not shared with any other account.

It is also possible to reduce the scope of the proxies which appear in the
report using &quot;<a href="#stats%20scope">stats scope</a>&quot;.

Though this statement alone is enough to enable statistics reporting, it is
recommended to set all other settings in order to avoid relying on default
unobvious parameters.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># public access (limited to this backend only)</span>
backend public_www
    server srv1 192.168.0.1:80
    stats enable
    stats hide-version
    stats scope   .
    stats uri     /admin?stats
    stats realm   Haproxy\ Statistics
    stats auth    admin1:AdMiN123
    stats auth    admin2:AdMiN321

<span class="comment"># internal monitoring access (unlimited)</span>
backend private_monitoring
    stats enable
    stats uri     /admin?stats
    stats refresh 5s
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stats%20enable">stats enable</a>&quot;, &quot;<a href="#stats%20realm">stats realm</a>&quot;, &quot;<a href="#stats%20scope">stats scope</a>&quot;, &quot;<a href="#stats%20uri">stats uri</a>&quot;</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats enable"></a><a class="anchor" name="4-stats enable"></a><a class="anchor" name="4.2-stats enable"></a><a class="anchor" name="stats enable (Proxies)"></a><a class="anchor" name="stats enable (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats enable"></a><a href="#4-stats%20enable">stats enable</a></b></div><pre class="text">Enable statistics reporting with default settings</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">This statement enables statistics reporting with default settings defined
at build time. Unless stated otherwise, these settings are used :
  - stats uri   : /haproxy?stats
  - stats realm : &quot;HAProxy Statistics&quot;
  - stats auth  : no authentication
  - stats scope : no restriction

Though this statement alone is enough to enable statistics reporting, it is
recommended to set all other settings in order to avoid relying on default
unobvious parameters.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># public access (limited to this backend only)</span>
backend public_www
    server srv1 192.168.0.1:80
    stats enable
    stats hide-version
    stats scope   .
    stats uri     /admin?stats
    stats realm   Haproxy\ Statistics
    stats auth    admin1:AdMiN123
    stats auth    admin2:AdMiN321

<span class="comment"># internal monitoring access (unlimited)</span>
backend private_monitoring
    stats enable
    stats uri     /admin?stats
    stats refresh 5s
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stats%20auth">stats auth</a>&quot;, &quot;<a href="#stats%20realm">stats realm</a>&quot;, &quot;<a href="#stats%20uri">stats uri</a>&quot;</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats hide-version"></a><a class="anchor" name="4-stats hide-version"></a><a class="anchor" name="4.2-stats hide-version"></a><a class="anchor" name="stats hide-version (Proxies)"></a><a class="anchor" name="stats hide-version (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats hide-version"></a><a href="#4-stats%20hide-version">stats hide-version</a></b></div><pre class="text">Enable statistics and hide HAProxy version reporting</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default, the stats page reports some useful status information along with
the statistics. Among them is HAProxy's version. However, it is generally
considered dangerous to report precise version to anyone, as it can help them
target known weaknesses with specific attacks. The &quot;<a href="#stats%20hide-version">stats hide-version</a>&quot;
statement removes the version from the statistics report. This is recommended
for public sites or any site with a weak login/password.

Though this statement alone is enough to enable statistics reporting, it is
recommended to set all other settings in order to avoid relying on default
unobvious parameters.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># public access (limited to this backend only)</span>
backend public_www
    server srv1 192.168.0.1:80
    stats enable
    stats hide-version
    stats scope   .
    stats uri     /admin?stats
    stats realm   Haproxy\ Statistics
    stats auth    admin1:AdMiN123
    stats auth    admin2:AdMiN321

<span class="comment"># internal monitoring access (unlimited)</span>
backend private_monitoring
    stats enable
    stats uri     /admin?stats
    stats refresh 5s
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stats%20auth">stats auth</a>&quot;, &quot;<a href="#stats%20enable">stats enable</a>&quot;, &quot;<a href="#stats%20realm">stats realm</a>&quot;, &quot;<a href="#stats%20uri">stats uri</a>&quot;</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats http-request"></a><a class="anchor" name="4-stats http-request"></a><a class="anchor" name="4.2-stats http-request"></a><a class="anchor" name="stats http-request (Proxies)"></a><a class="anchor" name="stats http-request (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats http-request"></a><a href="#4-stats%20http-request">stats http-request</a></b> <span style="color: #800">{ allow | deny | auth <span style="color: #008">[realm <span style="color: #080">&lt;realm&gt;</span>]</span> }</span>
             <span style="color: #008">[ <span style="color: #800">{ if | unless }</span> <span style="color: #080">&lt;condition&gt;</span> ]</span></div><pre class="text">Access control for statistics</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">As &quot;<a href="#http-request">http-request</a>&quot;, these set of options allow to fine control access to
statistics. Each option may be followed by if/unless and acl.
First option with matched condition (or option without condition) is final.
For &quot;deny&quot; a 403 error will be returned, for &quot;allow&quot; normal processing is
performed, for &quot;auth&quot; a 401/407 error code is returned so the client
should be asked to enter a username and password.

There is no fixed limit to the number of http-request statements per
instance.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#http-request">http-request</a>&quot;, <a href="#3.4">section 3.4</a> about userlists and <a href="#7">section 7</a> about ACL usage.</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats realm"></a><a class="anchor" name="4-stats realm"></a><a class="anchor" name="4.2-stats realm"></a><a class="anchor" name="stats realm (Proxies)"></a><a class="anchor" name="stats realm (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats realm"></a><a href="#4-stats%20realm">stats realm</a></b> <span style="color: #080">&lt;realm&gt;</span></div><pre class="text">Enable statistics and set authentication realm</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;realm&gt;   is the name of the HTTP Basic Authentication realm reported to
          the browser. The browser uses it to display it in the pop-up
          inviting the user to enter a valid username and password.</pre>
</div>
<pre class="text">The realm is read as a single word, so any spaces in it should be escaped
using a backslash ('\').

This statement is useful only in conjunction with &quot;<a href="#stats%20auth">stats auth</a>&quot; since it is
only related to authentication.

Though this statement alone is enough to enable statistics reporting, it is
recommended to set all other settings in order to avoid relying on default
unobvious parameters.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># public access (limited to this backend only)</span>
backend public_www
    server srv1 192.168.0.1:80
    stats enable
    stats hide-version
    stats scope   .
    stats uri     /admin?stats
    stats realm   Haproxy\ Statistics
    stats auth    admin1:AdMiN123
    stats auth    admin2:AdMiN321

<span class="comment"># internal monitoring access (unlimited)</span>
backend private_monitoring
    stats enable
    stats uri     /admin?stats
    stats refresh 5s
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stats%20auth">stats auth</a>&quot;, &quot;<a href="#stats%20enable">stats enable</a>&quot;, &quot;<a href="#stats%20uri">stats uri</a>&quot;</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats refresh"></a><a class="anchor" name="4-stats refresh"></a><a class="anchor" name="4.2-stats refresh"></a><a class="anchor" name="stats refresh (Proxies)"></a><a class="anchor" name="stats refresh (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats refresh"></a><a href="#4-stats%20refresh">stats refresh</a></b> <span style="color: #080">&lt;delay&gt;</span></div><pre class="text">Enable statistics with automatic refresh</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;delay&gt;   is the suggested refresh delay, specified in seconds, which will
          be returned to the browser consulting the report page. While the
          browser is free to apply any delay, it will generally respect it
          and refresh the page this every seconds. The refresh interval may
          be specified in any other non-default time unit, by suffixing the
          unit after the value, as explained at the top of this document.</pre>
</div>
<pre class="text">This statement is useful on monitoring displays with a permanent page
reporting the load balancer's activity. When set, the HTML report page will
include a link &quot;refresh&quot;/&quot;stop refresh&quot; so that the user can select whether
he wants automatic refresh of the page or not.

Though this statement alone is enough to enable statistics reporting, it is
recommended to set all other settings in order to avoid relying on default
unobvious parameters.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># public access (limited to this backend only)</span>
backend public_www
    server srv1 192.168.0.1:80
    stats enable
    stats hide-version
    stats scope   .
    stats uri     /admin?stats
    stats realm   Haproxy\ Statistics
    stats auth    admin1:AdMiN123
    stats auth    admin2:AdMiN321

<span class="comment"># internal monitoring access (unlimited)</span>
backend private_monitoring
    stats enable
    stats uri     /admin?stats
    stats refresh 5s
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stats%20auth">stats auth</a>&quot;, &quot;<a href="#stats%20enable">stats enable</a>&quot;, &quot;<a href="#stats%20realm">stats realm</a>&quot;, &quot;<a href="#stats%20uri">stats uri</a>&quot;</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats scope"></a><a class="anchor" name="4-stats scope"></a><a class="anchor" name="4.2-stats scope"></a><a class="anchor" name="stats scope (Proxies)"></a><a class="anchor" name="stats scope (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats scope"></a><a href="#4-stats%20scope">stats scope</a></b> <span style="color: #800">{ <span style="color: #080">&lt;name&gt;</span> | &quot;.&quot; }</span></div><pre class="text">Enable statistics and limit access scope</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;name&gt;    is the name of a listen, frontend or backend section to be
          reported. The special name &quot;.&quot; (a single dot) designates the
          section in which the statement appears.</pre>
</div>
<pre class="text">When this statement is specified, only the sections enumerated with this
statement will appear in the report. All other ones will be hidden. This
statement may appear as many times as needed if multiple sections need to be
reported. Please note that the name checking is performed as simple string
comparisons, and that it is never checked that a give section name really
exists.

Though this statement alone is enough to enable statistics reporting, it is
recommended to set all other settings in order to avoid relying on default
unobvious parameters.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># public access (limited to this backend only)</span>
backend public_www
    server srv1 192.168.0.1:80
    stats enable
    stats hide-version
    stats scope   .
    stats uri     /admin?stats
    stats realm   Haproxy\ Statistics
    stats auth    admin1:AdMiN123
    stats auth    admin2:AdMiN321

<span class="comment"># internal monitoring access (unlimited)</span>
backend private_monitoring
    stats enable
    stats uri     /admin?stats
    stats refresh 5s
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stats%20auth">stats auth</a>&quot;, &quot;<a href="#stats%20enable">stats enable</a>&quot;, &quot;<a href="#stats%20realm">stats realm</a>&quot;, &quot;<a href="#stats%20uri">stats uri</a>&quot;</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats show-desc"></a><a class="anchor" name="4-stats show-desc"></a><a class="anchor" name="4.2-stats show-desc"></a><a class="anchor" name="stats show-desc (Proxies)"></a><a class="anchor" name="stats show-desc (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats show-desc"></a><a href="#4-stats%20show-desc">stats show-desc</a></b> <span style="color: #008">[ <span style="color: #080">&lt;description&gt;</span> ]</span></div><pre class="text">Enable reporting of a description on the statistics page.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">  &lt;name&gt;    is an optional description to be reported. If unspecified, the
            description from global section is automatically used instead.

This statement is useful for users that offer shared services to their
customers, where node or description should be different for each customer.

Though this statement alone is enough to enable statistics reporting, it is
recommended to set all other settings in order to avoid relying on default
unobvious parameters.  By default description is not shown.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># internal monitoring access (unlimited)</span>
backend private_monitoring
    stats enable
    stats show-desc Master node for Europe, Asia, Africa
    stats uri       /admin?stats
    stats refresh   5s
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;show-node&quot;, &quot;<a href="#stats%20enable">stats enable</a>&quot;, &quot;<a href="#stats%20uri">stats uri</a>&quot; and &quot;<a href="#description">description</a>&quot; in global section.</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats show-legends"></a><a class="anchor" name="4-stats show-legends"></a><a class="anchor" name="4.2-stats show-legends"></a><a class="anchor" name="stats show-legends (Proxies)"></a><a class="anchor" name="stats show-legends (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats show-legends"></a><a href="#4-stats%20show-legends">stats show-legends</a></b></div><pre class="text">Enable reporting additional informations on the statistics page :
  - cap: capabilities (proxy)
  - mode: one of tcp, http or health (proxy)
  - id: SNMP ID (proxy, socket, server)
  - IP (socket, server)
  - cookie (backend, server)

Though this statement alone is enough to enable statistics reporting, it is
recommended to set all other settings in order to avoid relying on default
unobvious parameters.  Default behaviour is not to show this information.</pre><div class="page-header"><b>See also:</b> &quot;<a href="#stats%20enable">stats enable</a>&quot;, &quot;<a href="#stats%20uri">stats uri</a>&quot;.</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats show-node"></a><a class="anchor" name="4-stats show-node"></a><a class="anchor" name="4.2-stats show-node"></a><a class="anchor" name="stats show-node (Proxies)"></a><a class="anchor" name="stats show-node (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats show-node"></a><a href="#4-stats%20show-node">stats show-node</a></b> <span style="color: #008">[ <span style="color: #080">&lt;name&gt;</span> ]</span></div><pre class="text">Enable reporting of a host name on the statistics page.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments:</span><pre class="prettyprint arguments">&lt;name&gt;    is an optional name to be reported. If unspecified, the
          node name from global section is automatically used instead.</pre>
</div>
<pre class="text">This statement is useful for users that offer shared services to their
customers, where node or description might be different on a stats page
provided for each customer.  Default behaviour is not to show host name.

Though this statement alone is enough to enable statistics reporting, it is
recommended to set all other settings in order to avoid relying on default
unobvious parameters.</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code><span class="comment"># internal monitoring access (unlimited)</span>
backend private_monitoring
    stats enable
    stats show-node Europe-1
    stats uri       /admin?stats
    stats refresh   5s
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;show-desc&quot;, &quot;<a href="#stats%20enable">stats enable</a>&quot;, &quot;<a href="#stats%20uri">stats uri</a>&quot;, and &quot;<a href="#node">node</a>&quot; in global section.</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats uri"></a><a class="anchor" name="4-stats uri"></a><a class="anchor" name="4.2-stats uri"></a><a class="anchor" name="stats uri (Proxies)"></a><a class="anchor" name="stats uri (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats uri"></a><a href="#4-stats%20uri">stats uri</a></b> <span style="color: #080">&lt;prefix&gt;</span></div><pre class="text">Enable statistics and define the URI prefix to access them</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;prefix&gt;  is the prefix of any URI which will be redirected to stats. This
          prefix may contain a question mark ('?') to indicate part of a
          query string.</pre>
</div>
<pre class="text">The statistics URI is intercepted on the relayed traffic, so it appears as a
page within the normal application. It is strongly advised to ensure that the
selected URI will never appear in the application, otherwise it will never be
possible to reach it in the application.

The default URI compiled in haproxy is &quot;/haproxy?stats&quot;, but this may be
changed at build time, so it's better to always explicitly specify it here.
It is generally a good idea to include a question mark in the URI so that
intermediate proxies refrain from caching the results. Also, since any string
beginning with the prefix will be accepted as a stats request, the question
mark helps ensuring that no valid URI will begin with the same words.

It is sometimes very convenient to use &quot;/&quot; as the URI prefix, and put that
statement in a &quot;listen&quot; instance of its own. That makes it easy to dedicate
an address or a port to statistics only.

Though this statement alone is enough to enable statistics reporting, it is
recommended to set all other settings in order to avoid relying on default
unobvious parameters.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># public access (limited to this backend only)</span>
backend public_www
    server srv1 192.168.0.1:80
    stats enable
    stats hide-version
    stats scope   .
    stats uri     /admin?stats
    stats realm   Haproxy\ Statistics
    stats auth    admin1:AdMiN123
    stats auth    admin2:AdMiN321

<span class="comment"># internal monitoring access (unlimited)</span>
backend private_monitoring
    stats enable
    stats uri     /admin?stats
    stats refresh 5s
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stats%20auth">stats auth</a>&quot;, &quot;<a href="#stats%20enable">stats enable</a>&quot;, &quot;<a href="#stats%20realm">stats realm</a>&quot;</div>
<a class="anchor" name="stick"></a><a class="anchor" name="4-stick"></a><a class="anchor" name="4.2-stick"></a><a class="anchor" name="stick (Proxies)"></a><a class="anchor" name="stick (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stick match"></a><a class="anchor" name="4-stick match"></a><a class="anchor" name="4.2-stick match"></a><a class="anchor" name="stick match (Proxies)"></a><a class="anchor" name="stick match (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stick match"></a><a href="#4-stick%20match">stick match</a></b> <span style="color: #080">&lt;pattern&gt;</span> <span style="color: #008">[table <span style="color: #080">&lt;table&gt;</span>]</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><pre class="text">Define a request pattern matching condition to stick a user to a server</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;pattern&gt;  is a pattern extraction rule as described in <a href="#7.8">section 7.8</a>. It
           describes what elements of the incoming request or connection
           will be analysed in the hope to find a matching entry in a
           stickiness table. This rule is mandatory.

&lt;table&gt;    is an optional stickiness table name. If unspecified, the same
           backend's table is used. A stickiness table is declared using
           the &quot;<a href="#stick-table">stick-table</a>&quot; statement.

&lt;cond&gt;     is an optional matching condition. It makes it possible to match
           on a certain criterion only when other conditions are met (or
           not met). For instance, it could be used to match on a source IP
           address except when a request passes through a known proxy, in
           which case we'd match on a header containing that IP address.</pre>
</div>
<pre class="text">Some protocols or applications require complex stickiness rules and cannot
always simply rely on cookies nor hashing. The &quot;<a href="#stick%20match">stick match</a>&quot; statement
describes a rule to extract the stickiness criterion from an incoming request
or connection. See <a href="#7">section 7</a> for a complete list of possible patterns and
transformation rules.

The table has to be declared using the &quot;<a href="#stick-table">stick-table</a>&quot; statement. It must be of
a type compatible with the pattern. By default it is the one which is present
in the same backend. It is possible to share a table with other backends by
referencing it using the &quot;table&quot; keyword. If another table is referenced,
the server's ID inside the backends are used. By default, all server IDs
start at 1 in each backend, so the server ordering is enough. But in case of
doubt, it is highly recommended to force server IDs using their &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">id<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#id%20%28Proxies%29">Proxies</a></li><li><a href="#id%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; setting.

It is possible to restrict the conditions where a &quot;<a href="#stick%20match">stick match</a>&quot; statement
will apply, using &quot;if&quot; or &quot;unless&quot; followed by a condition. See <a href="#7">section 7</a> for
ACL based conditions.

There is no limit on the number of &quot;<a href="#stick%20match">stick match</a>&quot; statements. The first that
applies and matches will cause the request to be directed to the same server
as was used for the request which created the entry. That way, multiple
matches can be used as fallbacks.

The stick rules are checked after the persistence cookies, so they will not
affect stickiness if a cookie has already been used to select a server. That
way, it becomes very easy to insert cookies and match on IP addresses in
order to maintain stickiness between HTTP and HTTPS.

Note : Consider not using this feature in multi-process mode (nbproc &gt; 1)
       unless you know what you do : memory is not shared between the
       processes, which can result in random behaviours.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># forward SMTP users to the same server they just used for POP in the</span>
<span class="comment"># last 30 minutes</span>
backend pop
    mode tcp
    balance roundrobin
    stick store-request src
    stick-table type ip size 200k expire 30m
    server s1 192.168.1.1:110
    server s2 192.168.1.1:110

backend smtp
    mode tcp
    balance roundrobin
    stick match src table pop
    server s1 192.168.1.1:25
    server s2 192.168.1.1:25
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stick-table">stick-table</a>&quot;, &quot;<a href="#stick%20on">stick on</a>&quot;, &quot;<a href="#nbproc">nbproc</a>&quot;, &quot;<a href="#bind-process">bind-process</a>&quot; and <a href="#7">section 7</a> about ACLs and pattern extraction.</div>
<a class="anchor" name="stick"></a><a class="anchor" name="4-stick"></a><a class="anchor" name="4.2-stick"></a><a class="anchor" name="stick (Proxies)"></a><a class="anchor" name="stick (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stick on"></a><a class="anchor" name="4-stick on"></a><a class="anchor" name="4.2-stick on"></a><a class="anchor" name="stick on (Proxies)"></a><a class="anchor" name="stick on (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stick on"></a><a href="#4-stick%20on">stick on</a></b> <span style="color: #080">&lt;pattern&gt;</span> <span style="color: #008">[table <span style="color: #080">&lt;table&gt;</span>]</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;condition&gt;</span>]</span></div><pre class="text">Define a request pattern to associate a user to a server</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">Note : This form is exactly equivalent to &quot;<a href="#stick%20match">stick match</a>&quot; followed by
       &quot;<a href="#stick%20store-request">stick store-request</a>&quot;, all with the same arguments. Please refer
       to both keywords for details. It is only provided as a convenience
       for writing more maintainable configurations.

Note : Consider not using this feature in multi-process mode (nbproc &gt; 1)
       unless you know what you do : memory is not shared between the
       processes, which can result in random behaviours.</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code><span class="comment"># The following form ...</span>
stick on src table pop if !localhost

<span class="comment"># ...is strictly equivalent to this one :</span>
stick match src table pop if !localhost
stick store-request src table pop if !localhost


<span class="comment"># Use cookie persistence for HTTP, and stick on source address for HTTPS as</span>
<span class="comment"># well as HTTP without cookie. Share the same table between both accesses.</span>
backend http
    mode http
    balance roundrobin
    stick on src table https
    cookie SRV insert indirect nocache
    server s1 192.168.1.1:80 cookie s1
    server s2 192.168.1.1:80 cookie s2

backend https
    mode tcp
    balance roundrobin
    stick-table type ip size 200k expire 30m
    stick on src
    server s1 192.168.1.1:443
    server s2 192.168.1.1:443
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stick%20match">stick match</a>&quot;, &quot;<a href="#stick%20store-request">stick store-request</a>&quot;, &quot;<a href="#nbproc">nbproc</a>&quot; and &quot;<a href="#bind-process">bind-process</a>&quot;.</div>
<a class="anchor" name="stick"></a><a class="anchor" name="4-stick"></a><a class="anchor" name="4.2-stick"></a><a class="anchor" name="stick (Proxies)"></a><a class="anchor" name="stick (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stick store-request"></a><a class="anchor" name="4-stick store-request"></a><a class="anchor" name="4.2-stick store-request"></a><a class="anchor" name="stick store-request (Proxies)"></a><a class="anchor" name="stick store-request (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stick store-request"></a><a href="#4-stick%20store-request">stick store-request</a></b> <span style="color: #080">&lt;pattern&gt;</span> <span style="color: #008">[table <span style="color: #080">&lt;table&gt;</span>]</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;condition&gt;</span>]</span></div><pre class="text">Define a request pattern used to create an entry in a stickiness table</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;pattern&gt;  is a pattern extraction rule as described in <a href="#7.8">section 7.8</a>. It
           describes what elements of the incoming request or connection
           will be analysed, extracted and stored in the table once a
           server is selected.

&lt;table&gt;    is an optional stickiness table name. If unspecified, the same
           backend's table is used. A stickiness table is declared using
           the &quot;<a href="#stick-table">stick-table</a>&quot; statement.

&lt;cond&gt;     is an optional storage condition. It makes it possible to store
           certain criteria only when some conditions are met (or not met).
           For instance, it could be used to store the source IP address
           except when the request passes through a known proxy, in which
           case we'd store a converted form of a header containing that IP
           address.</pre>
</div>
<pre class="text">Some protocols or applications require complex stickiness rules and cannot
always simply rely on cookies nor hashing. The &quot;<a href="#stick%20store-request">stick store-request</a>&quot; statement
describes a rule to decide what to extract from the request and when to do
it, in order to store it into a stickiness table for further requests to
match it using the &quot;<a href="#stick%20match">stick match</a>&quot; statement. Obviously the extracted part must
make sense and have a chance to be matched in a further request. Storing a
client's IP address for instance often makes sense. Storing an ID found in a
URL parameter also makes sense. Storing a source port will almost never make
any sense because it will be randomly matched. See <a href="#7">section 7</a> for a complete
list of possible patterns and transformation rules.

The table has to be declared using the &quot;<a href="#stick-table">stick-table</a>&quot; statement. It must be of
a type compatible with the pattern. By default it is the one which is present
in the same backend. It is possible to share a table with other backends by
referencing it using the &quot;table&quot; keyword. If another table is referenced,
the server's ID inside the backends are used. By default, all server IDs
start at 1 in each backend, so the server ordering is enough. But in case of
doubt, it is highly recommended to force server IDs using their &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">id<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#id%20%28Proxies%29">Proxies</a></li><li><a href="#id%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; setting.

It is possible to restrict the conditions where a &quot;<a href="#stick%20store-request">stick store-request</a>&quot;
statement will apply, using &quot;if&quot; or &quot;unless&quot; followed by a condition. This
condition will be evaluated while parsing the request, so any criteria can be
used. See <a href="#7">section 7</a> for ACL based conditions.

There is no limit on the number of &quot;<a href="#stick%20store-request">stick store-request</a>&quot; statements, but
there is a limit of 8 simultaneous stores per request or response. This
makes it possible to store up to 8 criteria, all extracted from either the
request or the response, regardless of the number of rules. Only the 8 first
ones which match will be kept. Using this, it is possible to feed multiple
tables at once in the hope to increase the chance to recognize a user on
another protocol or access method.

The &quot;store-request&quot; rules are evaluated once the server connection has been
established, so that the table will contain the real server that processed
the request.

Note : Consider not using this feature in multi-process mode (nbproc &gt; 1)
       unless you know what you do : memory is not shared between the
       processes, which can result in random behaviours.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># forward SMTP users to the same server they just used for POP in the</span>
<span class="comment"># last 30 minutes</span>
backend pop
    mode tcp
    balance roundrobin
    stick store-request src
    stick-table type ip size 200k expire 30m
    server s1 192.168.1.1:110
    server s2 192.168.1.1:110

backend smtp
    mode tcp
    balance roundrobin
    stick match src table pop
    server s1 192.168.1.1:25
    server s2 192.168.1.1:25
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stick-table">stick-table</a>&quot;, &quot;<a href="#stick%20on">stick on</a>&quot;, &quot;<a href="#nbproc">nbproc</a>&quot;, &quot;<a href="#bind-process">bind-process</a>&quot; and <a href="#7">section 7</a> about ACLs and pattern extraction.</div>
<a class="anchor" name="stick-table"></a><a class="anchor" name="4-stick-table"></a><a class="anchor" name="4.2-stick-table"></a><a class="anchor" name="stick-table (Proxies)"></a><a class="anchor" name="stick-table (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stick-table type"></a><a class="anchor" name="4-stick-table type"></a><a class="anchor" name="4.2-stick-table type"></a><a class="anchor" name="stick-table type (Proxies)"></a><a class="anchor" name="stick-table type (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stick-table type"></a><a href="#4-stick-table%20type">stick-table type</a></b> <span style="color: #800">{ip | integer | string <span style="color: #008">[len <span style="color: #080">&lt;length&gt;</span>]</span> }</span> size <span style="color: #080">&lt;size&gt;</span>
            <span style="color: #008">[expire <span style="color: #080">&lt;expire&gt;</span>]</span> <span style="color: #008">[nopurge]</span></div><pre class="text">Configure the stickiness table for the current backend</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">ip         a table declared with &quot;type ip&quot; will only store IPv4 addresses.
           This form is very compact (about 50 bytes per entry) and allows
           very fast entry lookup and stores with almost no overhead. This
           is mainly used to store client source IP addresses.

integer    a table declared with &quot;type integer&quot; will store 32bit integers
           which can represent a client identifier found in a request for
           instance.

string     a table declared with &quot;type string&quot; will store substrings of up
           to &lt;len&gt; characters. If the string provided by the pattern
           extractor is larger than &lt;len&gt;, it will be truncated before
           being stored. During matching, at most &lt;len&gt; characters will be
           compared between the string in the table and the extracted
           pattern. When not specified, the string is automatically limited
           to 31 characters.

&lt;length&gt;   is the maximum number of characters that will be stored in a
           &quot;string&quot; type table. See type &quot;string&quot; above. Be careful when
           changing this parameter as memory usage will proportionally
           increase.

&lt;size&gt;     is the maximum number of entries that can fit in the table. This
           value directly impacts memory usage. Count approximately
           50 bytes per entry, plus the size of a string if any. The size
           supports suffixes &quot;k&quot;, &quot;m&quot;, &quot;g&quot; for 2^10, 2^20 and 2^30 factors.

[nopurge]  indicates that we refuse to purge older entries when the table
           is full. When not specified and the table is full when haproxy
           wants to store an entry in it, it will flush a few of the oldest
           entries in order to release some space for the new ones. This is
           most often the desired behaviour. In some specific cases, it
           be desirable to refuse new entries instead of purging the older
           ones. That may be the case when the amount of data to store is
           far above the hardware limits and we prefer not to offer access
           to new clients than to reject the ones already connected. When
           using this parameter, be sure to properly set the &quot;expire&quot;
           parameter (see below).

&lt;expire&gt;   defines the maximum duration of an entry in the table since it
           was last created, refreshed or matched. The expiration delay is
           defined using the standard time format, similarly as the various
           timeouts. The maximum duration is slightly above 24 days. See
           <a href="#2.2">section 2.2</a> for more information. If this delay is not specified,
           the session won't automatically expire, but older entries will
           be removed once full. Be sure not to use the &quot;nopurge&quot; parameter
           if not expiration delay is specified.</pre>
</div>
<pre class="text">The is only one stick-table per backend. At the moment of writing this doc,
it does not seem useful to have multiple tables per backend. If this happens
to be required, simply create a dummy backend with a stick-table in it and
reference it.

It is important to understand that stickiness based on learning information
has some limitations, including the fact that all learned associations are
lost upon restart. In general it can be good as a complement but not always
as an exclusive stickiness.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#stick%20match">stick match</a>&quot;, &quot;<a href="#stick%20on">stick on</a>&quot;, &quot;<a href="#stick%20store-request">stick store-request</a>&quot;, and <a href="#2.2">section 2.2</a> about time format.</div>
<a class="anchor" name="tcp-request"></a><a class="anchor" name="4-tcp-request"></a><a class="anchor" name="4.2-tcp-request"></a><a class="anchor" name="tcp-request (Proxies)"></a><a class="anchor" name="tcp-request (Alphabetically sorted keywords reference)"></a><a class="anchor" name="tcp-request content"></a><a class="anchor" name="4-tcp-request content"></a><a class="anchor" name="4.2-tcp-request content"></a><a class="anchor" name="tcp-request content (Proxies)"></a><a class="anchor" name="tcp-request content (Alphabetically sorted keywords reference)"></a><a class="anchor" name="tcp-request content accept"></a><a class="anchor" name="4-tcp-request content accept"></a><a class="anchor" name="4.2-tcp-request content accept"></a><a class="anchor" name="tcp-request content accept (Proxies)"></a><a class="anchor" name="tcp-request content accept (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="tcp-request content accept"></a><a href="#4-tcp-request%20content%20accept">tcp-request content accept</a></b> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;condition&gt;</span>]</span></div><pre class="text">Accept a connection if/unless a content inspection condition is matched</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<pre class="text">During TCP content inspection, the connection is immediately validated if the
condition is true (when used with &quot;if&quot;) or false (when used with &quot;unless&quot;).
Most of the time during content inspection, a condition will be in an
uncertain state which is neither true nor false. The evaluation immediately
stops when such a condition is encountered. It is important to understand
that &quot;accept&quot; and &quot;reject&quot; rules are evaluated in their exact declaration
order, so that it is possible to build complex rules from them. There is no
specific limit to the number of rules which may be inserted.

Note that the &quot;if/unless&quot; condition is optional. If no condition is set on
the action, it is simply performed unconditionally.

If no &quot;<a href="#tcp-request%20content">tcp-request content</a>&quot; rules are matched, the default action already is
&quot;accept&quot;. Thus, this statement alone does not bring anything without another
&quot;reject&quot; statement.

See <a href="#7">section 7</a> about ACL usage.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#tcp-request%20content%20reject">tcp-request content reject</a>&quot;, &quot;<a href="#tcp-request%20inspect-delay">tcp-request inspect-delay</a>&quot;</div>
<a class="anchor" name="tcp-request"></a><a class="anchor" name="4-tcp-request"></a><a class="anchor" name="4.2-tcp-request"></a><a class="anchor" name="tcp-request (Proxies)"></a><a class="anchor" name="tcp-request (Alphabetically sorted keywords reference)"></a><a class="anchor" name="tcp-request content"></a><a class="anchor" name="4-tcp-request content"></a><a class="anchor" name="4.2-tcp-request content"></a><a class="anchor" name="tcp-request content (Proxies)"></a><a class="anchor" name="tcp-request content (Alphabetically sorted keywords reference)"></a><a class="anchor" name="tcp-request content reject"></a><a class="anchor" name="4-tcp-request content reject"></a><a class="anchor" name="4.2-tcp-request content reject"></a><a class="anchor" name="tcp-request content reject (Proxies)"></a><a class="anchor" name="tcp-request content reject (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="tcp-request content reject"></a><a href="#4-tcp-request%20content%20reject">tcp-request content reject</a></b> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;condition&gt;</span>]</span></div><pre class="text">Reject a connection if/unless a content inspection condition is matched</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<pre class="text">During TCP content inspection, the connection is immediately rejected if the
condition is true (when used with &quot;if&quot;) or false (when used with &quot;unless&quot;).
Most of the time during content inspection, a condition will be in an
uncertain state which is neither true nor false. The evaluation immediately
stops when such a condition is encountered. It is important to understand
that &quot;accept&quot; and &quot;reject&quot; rules are evaluated in their exact declaration
order, so that it is possible to build complex rules from them. There is no
specific limit to the number of rules which may be inserted.

Note that the &quot;if/unless&quot; condition is optional. If no condition is set on
the action, it is simply performed unconditionally.

If no &quot;<a href="#tcp-request%20content">tcp-request content</a>&quot; rules are matched, the default action is set to
&quot;accept&quot;.</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code><span class="comment"># reject SMTP connection if client speaks first</span>
tcp-request inspect-delay 30s
acl content_present req_len gt 0
tcp-request reject if content_present

<span class="comment"># Forward HTTPS connection only if client speaks</span>
tcp-request inspect-delay 30s
acl content_present req_len gt 0
tcp-request accept if content_present
tcp-request reject
</code></pre>
</div><pre class="text">See <a href="#7">section 7</a> about ACL usage.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#tcp-request%20content%20accept">tcp-request content accept</a>&quot;, &quot;<a href="#tcp-request%20inspect-delay">tcp-request inspect-delay</a>&quot;</div>
<a class="anchor" name="tcp-request"></a><a class="anchor" name="4-tcp-request"></a><a class="anchor" name="4.2-tcp-request"></a><a class="anchor" name="tcp-request (Proxies)"></a><a class="anchor" name="tcp-request (Alphabetically sorted keywords reference)"></a><a class="anchor" name="tcp-request inspect-delay"></a><a class="anchor" name="4-tcp-request inspect-delay"></a><a class="anchor" name="4.2-tcp-request inspect-delay"></a><a class="anchor" name="tcp-request inspect-delay (Proxies)"></a><a class="anchor" name="tcp-request inspect-delay (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="tcp-request inspect-delay"></a><a href="#4-tcp-request%20inspect-delay">tcp-request inspect-delay</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><pre class="text">Set the maximum allowed time to wait for data during content inspection</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">People using haproxy primarily as a TCP relay are often worried about the
risk of passing any type of protocol to a server without any analysis. In
order to be able to analyze the request contents, we must first withhold
the data then analyze them. This statement simply enables withholding of
data for at most the specified amount of time.

Note that when performing content inspection, haproxy will evaluate the whole
rules for every new chunk which gets in, taking into account the fact that
those data are partial. If no rule matches before the aforementioned delay,
a last check is performed upon expiration, this time considering that the
contents are definitive. If no delay is set, haproxy will not wait at all
and will immediately apply a verdict based on the available information.
Obviously this is unlikely to be very useful and might even be racy, so such
setups are not recommended.

As soon as a rule matches, the request is released and continues as usual. If
the timeout is reached and no rule matches, the default policy will be to let
it pass through unaffected.

For most protocols, it is enough to set it to a few seconds, as most clients
send the full request immediately upon connection. Add 3 or more seconds to
cover TCP retransmits but that's all. For some protocols, it may make sense
to use large values, for instance to ensure that the client never talks
before the server (eg: SMTP), or to wait for a client to talk before passing
data to the server (eg: SSL). Note that the client timeout must cover at
least the inspection delay, otherwise it will expire first. If the client
closes the connection or if the buffer is full, the delay immediately expires
since the contents will not be able to change anymore.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#tcp-request%20content%20accept">tcp-request content accept</a>&quot;, &quot;<a href="#tcp-request%20content%20reject">tcp-request content reject</a>&quot;, &quot;<a href="#timeout%20client">timeout client</a>&quot;.</div>
<a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout check"></a><a class="anchor" name="4-timeout check"></a><a class="anchor" name="4.2-timeout check"></a><a class="anchor" name="timeout check (Proxies)"></a><a class="anchor" name="timeout check (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout check"></a><a href="#4-timeout%20check">timeout check</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><pre class="text">Set additional check timeout, but only after a connection has been already
established.</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments:</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">If set, haproxy uses min(&quot;<a href="#timeout%20connect">timeout connect</a>&quot;, &quot;<a href="#inter">inter</a>&quot;) as a connect timeout
for check and &quot;<a href="#timeout%20check">timeout check</a>&quot; as an additional read timeout. The &quot;min&quot; is
used so that people running with *very* long &quot;<a href="#timeout%20connect">timeout connect</a>&quot; (eg. those
who needed this due to the queue or tarpit) do not slow down their checks.
(Please also note that there is no valid reason to have such long connect
timeouts, because &quot;<a href="#timeout%20queue">timeout queue</a>&quot; and &quot;<a href="#timeout%20tarpit">timeout tarpit</a>&quot; can always be used to
avoid that).

If &quot;<a href="#timeout%20check">timeout check</a>&quot; is not set haproxy uses &quot;<a href="#inter">inter</a>&quot; for complete check
timeout (connect + read) exactly like all &lt;1.3.15 version.

In most cases check request is much simpler and faster to handle than normal
requests and people may want to kick out laggy servers so this timeout should
be smaller than &quot;<a href="#timeout%20server">timeout server</a>&quot;.

This parameter is specific to backends, but can be specified once for all in
&quot;defaults&quot; sections. This is in fact one of the easiest solutions not to
forget about it.</pre><div class="page-header"><b>See also:</b> &quot;<a href="#timeout%20connect">timeout connect</a>&quot;, &quot;<a href="#timeout%20queue">timeout queue</a>&quot;, &quot;<a href="#timeout%20server">timeout server</a>&quot;, &quot;<a href="#timeout%20tarpit">timeout tarpit</a>&quot;.</div>
<a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout client"></a><a class="anchor" name="4-timeout client"></a><a class="anchor" name="4.2-timeout client"></a><a class="anchor" name="timeout client (Proxies)"></a><a class="anchor" name="timeout client (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout client"></a><a href="#4-timeout%20client">timeout client</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout clitimeout"></a><a class="anchor" name="4-timeout clitimeout"></a><a class="anchor" name="4.2-timeout clitimeout"></a><a class="anchor" name="timeout clitimeout (Proxies)"></a><a class="anchor" name="timeout clitimeout (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout clitimeout"></a><a href="#4-timeout%20clitimeout">timeout clitimeout</a></b> <span style="color: #080">&lt;timeout&gt;</span> <span class="label label-warning">(deprecated)</span></div><pre class="text">Set the maximum inactivity time on the client side.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">The inactivity timeout applies when the client is expected to acknowledge or
send data. In HTTP mode, this timeout is particularly important to consider
during the first phase, when the client sends the request, and during the
response while it is reading data sent by the server. The value is specified
in milliseconds by default, but can be in any other unit if the number is
suffixed by the unit, as specified at the top of this document. In TCP mode
(and to a lesser extent, in HTTP mode), it is highly recommended that the
client timeout remains equal to the server timeout in order to avoid complex
situations to debug. It is a good practice to cover one or several TCP packet
losses by specifying timeouts that are slightly above multiples of 3 seconds
(eg: 4 or 5 seconds).

This parameter is specific to frontends, but can be specified once for all in
&quot;defaults&quot; sections. This is in fact one of the easiest solutions not to
forget about it. An unspecified timeout results in an infinite timeout, which
is not recommended. Such a usage is accepted and works but reports a warning
during startup because it may results in accumulation of expired sessions in
the system if the system's timeouts are not configured either.

This parameter replaces the old, deprecated &quot;<a href="#clitimeout">clitimeout</a>&quot;. It is recommended
to use it to write new configurations. The form &quot;<a href="#timeout%20clitimeout">timeout clitimeout</a>&quot; is
provided only by backwards compatibility but its use is strongly discouraged.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#clitimeout">clitimeout</a>&quot;, &quot;<a href="#timeout%20server">timeout server</a>&quot;.</div>
<a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout connect"></a><a class="anchor" name="4-timeout connect"></a><a class="anchor" name="4.2-timeout connect"></a><a class="anchor" name="timeout connect (Proxies)"></a><a class="anchor" name="timeout connect (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout connect"></a><a href="#4-timeout%20connect">timeout connect</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout contimeout"></a><a class="anchor" name="4-timeout contimeout"></a><a class="anchor" name="4.2-timeout contimeout"></a><a class="anchor" name="timeout contimeout (Proxies)"></a><a class="anchor" name="timeout contimeout (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout contimeout"></a><a href="#4-timeout%20contimeout">timeout contimeout</a></b> <span style="color: #080">&lt;timeout&gt;</span> <span class="label label-warning">(deprecated)</span></div><pre class="text">Set the maximum time to wait for a connection attempt to a server to succeed.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">If the server is located on the same LAN as haproxy, the connection should be
immediate (less than a few milliseconds). Anyway, it is a good practice to
cover one or several TCP packet losses by specifying timeouts that are
slightly above multiples of 3 seconds (eg: 4 or 5 seconds). By default, the
connect timeout also presets both queue and tarpit timeouts to the same value
if these have not been specified.

This parameter is specific to backends, but can be specified once for all in
&quot;defaults&quot; sections. This is in fact one of the easiest solutions not to
forget about it. An unspecified timeout results in an infinite timeout, which
is not recommended. Such a usage is accepted and works but reports a warning
during startup because it may results in accumulation of failed sessions in
the system if the system's timeouts are not configured either.

This parameter replaces the old, deprecated &quot;<a href="#contimeout">contimeout</a>&quot;. It is recommended
to use it to write new configurations. The form &quot;<a href="#timeout%20contimeout">timeout contimeout</a>&quot; is
provided only by backwards compatibility but its use is strongly discouraged.</pre><div class="page-header"><b>See also:</b> &quot;<a href="#timeout%20check">timeout check</a>&quot;, &quot;<a href="#timeout%20queue">timeout queue</a>&quot;, &quot;<a href="#timeout%20server">timeout server</a>&quot;, &quot;<a href="#contimeout">contimeout</a>&quot;, &quot;<a href="#timeout%20tarpit">timeout tarpit</a>&quot;.</div>
<a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout http-keep-alive"></a><a class="anchor" name="4-timeout http-keep-alive"></a><a class="anchor" name="4.2-timeout http-keep-alive"></a><a class="anchor" name="timeout http-keep-alive (Proxies)"></a><a class="anchor" name="timeout http-keep-alive (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout http-keep-alive"></a><a href="#4-timeout%20http-keep-alive">timeout http-keep-alive</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><pre class="text">Set the maximum allowed time to wait for a new HTTP request to appear</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">By default, the time to wait for a new request in case of keep-alive is set
by &quot;<a href="#timeout%20http-request">timeout http-request</a>&quot;. However this is not always convenient because some
people want very short keep-alive timeouts in order to release connections
faster, and others prefer to have larger ones but still have short timeouts
once the request has started to present itself.

The &quot;http-keep-alive&quot; timeout covers these needs. It will define how long to
wait for a new HTTP request to start coming after a response was sent. Once
the first byte of request has been seen, the &quot;<a href="#http-request">http-request</a>&quot; timeout is used
to wait for the complete request to come. Note that empty lines prior to a
new request do not refresh the timeout and are not counted as a new request.

There is also another difference between the two timeouts : when a connection
expires during timeout http-keep-alive, no error is returned, the connection
just closes. If the connection expires in &quot;<a href="#http-request">http-request</a>&quot; while waiting for a
connection to complete, a HTTP 408 error is returned.

In general it is optimal to set this value to a few tens to hundreds of
milliseconds, to allow users to fetch all objects of a page at once but
without waiting for further clicks. Also, if set to a very small value (eg:
1 millisecond) it will probably only accept pipelined requests but not the
non-pipelined ones. It may be a nice trade-off for very large sites running
with tens to hundreds of thousands of clients.

If this parameter is not set, the &quot;<a href="#http-request">http-request</a>&quot; timeout applies, and if both
are not set, &quot;<a href="#timeout%20client">timeout client</a>&quot; still applies at the lower level. It should be
set in the frontend to take effect, unless the frontend is in TCP mode, in
which case the HTTP backend's timeout will be used.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#timeout%20http-request">timeout http-request</a>&quot;, &quot;<a href="#timeout%20client">timeout client</a>&quot;.</div>
<a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout http-request"></a><a class="anchor" name="4-timeout http-request"></a><a class="anchor" name="4.2-timeout http-request"></a><a class="anchor" name="timeout http-request (Proxies)"></a><a class="anchor" name="timeout http-request (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout http-request"></a><a href="#4-timeout%20http-request">timeout http-request</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><pre class="text">Set the maximum allowed time to wait for a complete HTTP request</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">In order to offer DoS protection, it may be required to lower the maximum
accepted time to receive a complete HTTP request without affecting the client
timeout. This helps protecting against established connections on which
nothing is sent. The client timeout cannot offer a good protection against
this abuse because it is an inactivity timeout, which means that if the
attacker sends one character every now and then, the timeout will not
trigger. With the HTTP request timeout, no matter what speed the client
types, the request will be aborted if it does not complete in time.

Note that this timeout only applies to the header part of the request, and
not to any data. As soon as the empty line is received, this timeout is not
used anymore. It is used again on keep-alive connections to wait for a second
request if &quot;<a href="#timeout%20http-keep-alive">timeout http-keep-alive</a>&quot; is not set.

Generally it is enough to set it to a few seconds, as most clients send the
full request immediately upon connection. Add 3 or more seconds to cover TCP
retransmits but that's all. Setting it to very low values (eg: 50 ms) will
generally work on local networks as long as there are no packet losses. This
will prevent people from sending bare HTTP requests using telnet.

If this parameter is not set, the client timeout still applies between each
chunk of the incoming request. It should be set in the frontend to take
effect, unless the frontend is in TCP mode, in which case the HTTP backend's
timeout will be used.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#timeout%20http-keep-alive">timeout http-keep-alive</a>&quot;, &quot;<a href="#timeout%20client">timeout client</a>&quot;.</div>
<a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout queue"></a><a class="anchor" name="4-timeout queue"></a><a class="anchor" name="4.2-timeout queue"></a><a class="anchor" name="timeout queue (Proxies)"></a><a class="anchor" name="timeout queue (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout queue"></a><a href="#4-timeout%20queue">timeout queue</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><pre class="text">Set the maximum time to wait in the queue for a connection slot to be free</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">When a server's maxconn is reached, connections are left pending in a queue
which may be server-specific or global to the backend. In order not to wait
indefinitely, a timeout is applied to requests pending in the queue. If the
timeout is reached, it is considered that the request will almost never be
served, so it is dropped and a 503 error is returned to the client.

The &quot;<a href="#timeout%20queue">timeout queue</a>&quot; statement allows to fix the maximum time for a request to
be left pending in a queue. If unspecified, the same value as the backend's
connection timeout (&quot;<a href="#timeout%20connect">timeout connect</a>&quot;) is used, for backwards compatibility
with older versions with no &quot;<a href="#timeout%20queue">timeout queue</a>&quot; parameter.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#timeout%20connect">timeout connect</a>&quot;, &quot;<a href="#contimeout">contimeout</a>&quot;.</div>
<a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout server"></a><a class="anchor" name="4-timeout server"></a><a class="anchor" name="4.2-timeout server"></a><a class="anchor" name="timeout server (Proxies)"></a><a class="anchor" name="timeout server (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout server"></a><a href="#4-timeout%20server">timeout server</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout srvtimeout"></a><a class="anchor" name="4-timeout srvtimeout"></a><a class="anchor" name="4.2-timeout srvtimeout"></a><a class="anchor" name="timeout srvtimeout (Proxies)"></a><a class="anchor" name="timeout srvtimeout (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout srvtimeout"></a><a href="#4-timeout%20srvtimeout">timeout srvtimeout</a></b> <span style="color: #080">&lt;timeout&gt;</span> <span class="label label-warning">(deprecated)</span></div><pre class="text">Set the maximum inactivity time on the server side.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">The inactivity timeout applies when the server is expected to acknowledge or
send data. In HTTP mode, this timeout is particularly important to consider
during the first phase of the server's response, when it has to send the
headers, as it directly represents the server's processing time for the
request. To find out what value to put there, it's often good to start with
what would be considered as unacceptable response times, then check the logs
to observe the response time distribution, and adjust the value accordingly.

The value is specified in milliseconds by default, but can be in any other
unit if the number is suffixed by the unit, as specified at the top of this
document. In TCP mode (and to a lesser extent, in HTTP mode), it is highly
recommended that the client timeout remains equal to the server timeout in
order to avoid complex situations to debug. Whatever the expected server
response times, it is a good practice to cover at least one or several TCP
packet losses by specifying timeouts that are slightly above multiples of 3
seconds (eg: 4 or 5 seconds minimum).

This parameter is specific to backends, but can be specified once for all in
&quot;defaults&quot; sections. This is in fact one of the easiest solutions not to
forget about it. An unspecified timeout results in an infinite timeout, which
is not recommended. Such a usage is accepted and works but reports a warning
during startup because it may results in accumulation of expired sessions in
the system if the system's timeouts are not configured either.

This parameter replaces the old, deprecated &quot;<a href="#srvtimeout">srvtimeout</a>&quot;. It is recommended
to use it to write new configurations. The form &quot;<a href="#timeout%20srvtimeout">timeout srvtimeout</a>&quot; is
provided only by backwards compatibility but its use is strongly discouraged.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#srvtimeout">srvtimeout</a>&quot;, &quot;<a href="#timeout%20client">timeout client</a>&quot;.</div>
<a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout tarpit"></a><a class="anchor" name="4-timeout tarpit"></a><a class="anchor" name="4.2-timeout tarpit"></a><a class="anchor" name="timeout tarpit (Proxies)"></a><a class="anchor" name="timeout tarpit (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout tarpit"></a><a href="#4-timeout%20tarpit">timeout tarpit</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><pre class="text">Set the duration for which tarpitted connections will be maintained</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the tarpit duration specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">When a connection is tarpitted using &quot;<a href="#reqtarpit">reqtarpit</a>&quot;, it is maintained open with
no activity for a certain amount of time, then closed. &quot;<a href="#timeout%20tarpit">timeout tarpit</a>&quot;
defines how long it will be maintained open.

The value is specified in milliseconds by default, but can be in any other
unit if the number is suffixed by the unit, as specified at the top of this
document. If unspecified, the same value as the backend's connection timeout
(&quot;<a href="#timeout%20connect">timeout connect</a>&quot;) is used, for backwards compatibility with older versions
with no &quot;<a href="#timeout%20tarpit">timeout tarpit</a>&quot; parameter.</pre><div class="page-header"><b>See also :</b> &quot;<a href="#timeout%20connect">timeout connect</a>&quot;, &quot;<a href="#contimeout">contimeout</a>&quot;.</div>
<a class="anchor" name="transparent"></a><a class="anchor" name="4-transparent"></a><a class="anchor" name="4.2-transparent"></a><a class="anchor" name="transparent (Proxies)"></a><a class="anchor" name="transparent (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="transparent"></a><a href="#4-transparent">transparent</a></b> <span class="label label-warning">(deprecated)</span></div><pre class="text">Enable client-side transparent proxying</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">This keyword was introduced in order to provide layer 7 persistence to layer
3 load balancers. The idea is to use the OS's ability to redirect an incoming
connection for a remote address to a local process (here HAProxy), and let
this process know what address was initially requested. When this option is
used, sessions without cookies will be forwarded to the original destination
IP address of the incoming request (which should match that of another
equipment), while requests with cookies will still be forwarded to the
appropriate server.

The &quot;<a href="#option%20transparent">transparent</a>&quot; keyword is deprecated, use &quot;<a href="#option%20transparent">option transparent</a>&quot; instead.

Note that contrary to a common belief, this option does NOT make HAProxy
present the client's IP to the server when establishing the connection.</pre><div class="page-header"><b>See also:</b> &quot;<a href="#option%20transparent">option transparent</a>&quot;</div>
<a class="anchor" name="use_backend"></a><a class="anchor" name="4-use_backend"></a><a class="anchor" name="4.2-use_backend"></a><a class="anchor" name="use_backend (Proxies)"></a><a class="anchor" name="use_backend (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="use_backend"></a><a href="#4-use_backend">use_backend</a></b> <span style="color: #080">&lt;backend&gt;</span> if <span style="color: #080">&lt;condition&gt;</span></div><a class="anchor" name="use_backend"></a><a class="anchor" name="4-use_backend"></a><a class="anchor" name="4.2-use_backend"></a><a class="anchor" name="use_backend (Proxies)"></a><a class="anchor" name="use_backend (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="use_backend"></a><a href="#4-use_backend">use_backend</a></b> <span style="color: #080">&lt;backend&gt;</span> unless <span style="color: #080">&lt;condition&gt;</span></div><pre class="text">Switch to a specific backend if/unless an ACL-based condition is matched.</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;backend&gt;   is the name of a valid backend or &quot;listen&quot; section.

&lt;condition&gt; is a condition composed of ACLs, as described in <a href="#7">section 7</a>.</pre>
</div>
<pre class="text">When doing content-switching, connections arrive on a frontend and are then
dispatched to various backends depending on a number of conditions. The
relation between the conditions and the backends is described with the
&quot;<a href="#use_backend">use_backend</a>&quot; keyword. While it is normally used with HTTP processing, it can
also be used in pure TCP, either without content using stateless ACLs (eg:
source address validation) or combined with a &quot;<a href="#tcp-request">tcp-request</a>&quot; rule to wait for
some payload.

There may be as many &quot;<a href="#use_backend">use_backend</a>&quot; rules as desired. All of these rules are
evaluated in their declaration order, and the first one which matches will
assign the backend.

In the first form, the backend will be used if the condition is met. In the
second form, the backend will be used if the condition is not met. If no
condition is valid, the backend defined with &quot;<a href="#default_backend">default_backend</a>&quot; will be used.
If no default backend is defined, either the servers in the same section are
used (in case of a &quot;listen&quot; section) or, in case of a frontend, no server is
used and a 503 service unavailable response is returned.

Note that it is possible to switch from a TCP frontend to an HTTP backend. In
this case, either the frontend has already checked that the protocol is HTTP,
and backend processing will immediately follow, or the backend will wait for
a complete HTTP request to get in. This feature is useful when a frontend
must decode several protocols on a unique port, one of them being HTTP.</pre><div class="page-header"><b>See also:</b> &quot;<a href="#default_backend">default_backend</a>&quot;, &quot;<a href="#tcp-request">tcp-request</a>&quot;, and <a href="#7">section 7</a> about ACLs.</div>
</div>
<a class="anchor" id="5" name="5"></a>
<div class="page-header"><h1 id="chapter-5" data-target="5"><small><a class="small" href="#5">5.</a></small> Server and default-server options</h1>
</div><div><pre class="text">The &quot;<a href="#server">server</a>&quot; and &quot;<a href="#default-server">default-server</a>&quot; keywords support a certain number of settings
which are all passed as arguments on the server line. The order in which those
arguments appear does not count, and they are all optional. Some of those
settings are single words (booleans) while others expect one or several values
after them. In this case, the values must immediately follow the setting name.
Except default-server, all those settings must be specified after the server's
address if they are used:

  server &lt;name&gt; &lt;address&gt;[:port] [settings ...]
  default-server [settings ...]

The currently supported settings are the following ones.</pre><a class="anchor" name="addr"></a><a class="anchor" name="5-addr"></a><a class="anchor" name="5-addr"></a><a class="anchor" name="addr (Server and default-server options)"></a><a class="anchor" name="addr (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="addr"></a><a href="#5-addr">addr</a></b> <span style="color: #080">&lt;ipv4&gt;</span></div><pre class="text">Using the &quot;<a href="#addr">addr</a>&quot; parameter, it becomes possible to use a different IP address
to send health-checks. On some servers, it may be desirable to dedicate an IP
address to specific component able to perform complex tests which are more
suitable to health-checks than the application. This parameter is ignored if
the &quot;<a href="#check">check</a>&quot; parameter is not set. See also the &quot;<a href="#port">port</a>&quot; parameter.

Supported in default-server: No</pre><a class="anchor" name="backup"></a><a class="anchor" name="5-backup"></a><a class="anchor" name="5-backup"></a><a class="anchor" name="backup (Server and default-server options)"></a><a class="anchor" name="backup (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="backup"></a><a href="#5-backup">backup</a></b></div><pre class="text">When &quot;<a href="#backup">backup</a>&quot; is present on a server line, the server is only used in load
balancing when all other non-backup servers are unavailable. Requests coming
with a persistence cookie referencing the server will always be served
though. By default, only the first operational backup server is used, unless
the &quot;<a href="#option%20allbackups">allbackups</a>&quot; option is set in the backend. See also the &quot;<a href="#option%20allbackups">allbackups</a>&quot;
option.

Supported in default-server: No</pre><a class="anchor" name="check"></a><a class="anchor" name="5-check"></a><a class="anchor" name="5-check"></a><a class="anchor" name="check (Server and default-server options)"></a><a class="anchor" name="check (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="check"></a><a href="#5-check">check</a></b></div><pre class="text">This option enables health checks on the server. By default, a server is
always considered available. If &quot;<a href="#check">check</a>&quot; is set, the server will receive
periodic health checks to ensure that it is really able to serve requests.
The default address and port to send the tests to are those of the server,
and the default source is the same as the one defined in the backend. It is
possible to change the address using the &quot;<a href="#addr">addr</a>&quot; parameter, the port using the
&quot;<a href="#port">port</a>&quot; parameter, the source address using the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#source%20%28Proxies%29">Proxies</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; address, and the
interval and timers using the &quot;<a href="#inter">inter</a>&quot;, &quot;<a href="#rise">rise</a>&quot; and &quot;<a href="#fall">fall</a>&quot; parameters. The
request method is define in the backend using the &quot;<a href="#option%20httpchk">httpchk</a>&quot;, &quot;<a href="#option%20smtpchk">smtpchk</a>&quot;,
&quot;<a href="#option%20mysql-check">mysql-check</a>&quot; and &quot;<a href="#option%20ssl-hello-chk">ssl-hello-chk</a>&quot; options. Please refer to those options and
parameters for more information.

Supported in default-server: No</pre><a class="anchor" name="cookie"></a><a class="anchor" name="5-cookie"></a><a class="anchor" name="5-cookie"></a><a class="anchor" name="cookie (Server and default-server options)"></a><a class="anchor" name="cookie (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="cookie"></a><a href="#5-cookie">cookie</a></b> <span style="color: #080">&lt;value&gt;</span></div><pre class="text">The &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">cookie<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#cookie%20%28Proxies%29">Proxies</a></li><li><a href="#cookie%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; parameter sets the cookie value assigned to the server to
&lt;value&gt;. This value will be checked in incoming requests, and the first
operational server possessing the same value will be selected. In return, in
cookie insertion or rewrite modes, this value will be assigned to the cookie
sent to the client. There is nothing wrong in having several servers sharing
the same cookie value, and it is in fact somewhat common between normal and
backup servers. See also the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">cookie<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#cookie%20%28Proxies%29">Proxies</a></li><li><a href="#cookie%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; keyword in backend section.

Supported in default-server: No</pre><a class="anchor" name="disabled"></a><a class="anchor" name="5-disabled"></a><a class="anchor" name="5-disabled"></a><a class="anchor" name="disabled (Server and default-server options)"></a><a class="anchor" name="disabled (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="disabled"></a><a href="#5-disabled">disabled</a></b></div><pre class="text">The &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">disabled<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#disabled%20%28Proxies%29">Proxies</a></li><li><a href="#disabled%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; keyword starts the server in the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">disabled<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#disabled%20%28Proxies%29">Proxies</a></li><li><a href="#disabled%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; state. That means
that it is marked down in maintenance mode, and no connection other than the
ones allowed by persist mode will reach it. It is very well suited to setup
new servers, because normal traffic will never reach them, while it is still
possible to test the service by making use of the force-persist mechanism.

Supported in default-server: No</pre><a class="anchor" name="error-limit"></a><a class="anchor" name="5-error-limit"></a><a class="anchor" name="5-error-limit"></a><a class="anchor" name="error-limit (Server and default-server options)"></a><a class="anchor" name="error-limit (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="error-limit"></a><a href="#5-error-limit">error-limit</a></b> <span style="color: #080">&lt;count&gt;</span></div><pre class="text">If health observing is enabled, the &quot;<a href="#error-limit">error-limit</a>&quot; parameter specifies the
number of consecutive errors that triggers event selected by the &quot;<a href="#on-error">on-error</a>&quot;
option. By default it is set to 10 consecutive errors.

Supported in default-server: Yes

See also the &quot;<a href="#check">check</a>&quot;, &quot;<a href="#error-limit">error-limit</a>&quot; and &quot;<a href="#on-error">on-error</a>&quot;.</pre><a class="anchor" name="fall"></a><a class="anchor" name="5-fall"></a><a class="anchor" name="5-fall"></a><a class="anchor" name="fall (Server and default-server options)"></a><a class="anchor" name="fall (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="fall"></a><a href="#5-fall">fall</a></b> <span style="color: #080">&lt;count&gt;</span></div><pre class="text">The &quot;<a href="#fall">fall</a>&quot; parameter states that a server will be considered as dead after
&lt;count&gt; consecutive unsuccessful health checks. This value defaults to 3 if
unspecified. See also the &quot;<a href="#check">check</a>&quot;, &quot;<a href="#inter">inter</a>&quot; and &quot;<a href="#rise">rise</a>&quot; parameters.

Supported in default-server: Yes</pre><a class="anchor" name="id"></a><a class="anchor" name="5-id"></a><a class="anchor" name="5-id"></a><a class="anchor" name="id (Server and default-server options)"></a><a class="anchor" name="id (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="id"></a><a href="#5-id">id</a></b> <span style="color: #080">&lt;value&gt;</span></div><pre class="text">Set a persistent ID for the server. This ID must be positive and unique for
the proxy. An unused ID will automatically be assigned if unset. The first
assigned value will be 1. This ID is currently only returned in statistics.

Supported in default-server: No</pre><a class="anchor" name="inter"></a><a class="anchor" name="5-inter"></a><a class="anchor" name="5-inter"></a><a class="anchor" name="inter (Server and default-server options)"></a><a class="anchor" name="inter (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="inter"></a><a href="#5-inter">inter</a></b> <span style="color: #080">&lt;delay&gt;</span></div><a class="anchor" name="fastinter"></a><a class="anchor" name="5-fastinter"></a><a class="anchor" name="5-fastinter"></a><a class="anchor" name="fastinter (Server and default-server options)"></a><a class="anchor" name="fastinter (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="fastinter"></a><a href="#5-fastinter">fastinter</a></b> <span style="color: #080">&lt;delay&gt;</span></div><a class="anchor" name="downinter"></a><a class="anchor" name="5-downinter"></a><a class="anchor" name="5-downinter"></a><a class="anchor" name="downinter (Server and default-server options)"></a><a class="anchor" name="downinter (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="downinter"></a><a href="#5-downinter">downinter</a></b> <span style="color: #080">&lt;delay&gt;</span></div><pre class="text">The &quot;<a href="#inter">inter</a>&quot; parameter sets the interval between two consecutive health checks
to &lt;delay&gt; milliseconds. If left unspecified, the delay defaults to 2000 ms.
It is also possible to use &quot;<a href="#fastinter">fastinter</a>&quot; and &quot;<a href="#downinter">downinter</a>&quot; to optimize delays
between checks depending on the server state :</pre><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>Server state</th><th>Interval used</th></tr></thead>
<tr><td None>UP 100% (non-transitional)</td><td None>&quot;<a href="#inter">inter</a>&quot;</td></tr>
<tr><td None>Transitionally UP (going down),<br />Transitionally DOWN (going up),<br />or yet unchecked.</td><td None>&quot;<a href="#fastinter">fastinter</a>&quot; if set, &quot;<a href="#inter">inter</a>&quot; otherwise.<br /></td></tr>
<tr><td None>DOWN 100% (non-transitional)</td><td None>&quot;<a href="#downinter">downinter</a>&quot; if set, &quot;<a href="#inter">inter</a>&quot; otherwise.</td></tr>
</table><pre class="text">Just as with every other time-based parameter, they can be entered in any
other explicit unit among { us, ms, s, m, h, d }. The &quot;<a href="#inter">inter</a>&quot; parameter also
serves as a timeout for health checks sent to servers if &quot;<a href="#timeout%20check">timeout check</a>&quot; is
not set. In order to reduce &quot;resonance&quot; effects when multiple servers are
hosted on the same hardware, the health-checks of all servers are started
with a small time offset between them. It is also possible to add some random
noise in the health checks interval using the global &quot;<a href="#spread-checks">spread-checks</a>&quot;
keyword. This makes sense for instance when a lot of backends use the same
servers.

Supported in default-server: Yes</pre><a class="anchor" name="maxconn"></a><a class="anchor" name="5-maxconn"></a><a class="anchor" name="5-maxconn"></a><a class="anchor" name="maxconn (Server and default-server options)"></a><a class="anchor" name="maxconn (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="maxconn"></a><a href="#5-maxconn">maxconn</a></b> <span style="color: #080">&lt;maxconn&gt;</span></div><pre class="text">The &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#maxconn%20%28Proxies%29">Proxies</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; parameter specifies the maximal number of concurrent
connections that will be sent to this server. If the number of incoming
concurrent requests goes higher than this value, they will be queued, waiting
for a connection to be released. This parameter is very important as it can
save fragile servers from going down under extreme loads. If a &quot;<a href="#minconn">minconn</a>&quot;
parameter is specified, the limit becomes dynamic. The default value is &quot;0&quot;
which means unlimited. See also the &quot;<a href="#minconn">minconn</a>&quot; and &quot;<a href="#maxqueue">maxqueue</a>&quot; parameters, and
the backend's &quot;<a href="#fullconn">fullconn</a>&quot; keyword.

Supported in default-server: Yes</pre><a class="anchor" name="maxqueue"></a><a class="anchor" name="5-maxqueue"></a><a class="anchor" name="5-maxqueue"></a><a class="anchor" name="maxqueue (Server and default-server options)"></a><a class="anchor" name="maxqueue (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="maxqueue"></a><a href="#5-maxqueue">maxqueue</a></b> <span style="color: #080">&lt;maxqueue&gt;</span></div><pre class="text">The &quot;<a href="#maxqueue">maxqueue</a>&quot; parameter specifies the maximal number of connections which
will wait in the queue for this server. If this limit is reached, next
requests will be redispatched to other servers instead of indefinitely
waiting to be served. This will break persistence but may allow people to
quickly re-log in when the server they try to connect to is dying. The
default value is &quot;0&quot; which means the queue is unlimited. See also the
&quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#maxconn%20%28Proxies%29">Proxies</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; and &quot;<a href="#minconn">minconn</a>&quot; parameters.

Supported in default-server: Yes</pre><a class="anchor" name="minconn"></a><a class="anchor" name="5-minconn"></a><a class="anchor" name="5-minconn"></a><a class="anchor" name="minconn (Server and default-server options)"></a><a class="anchor" name="minconn (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="minconn"></a><a href="#5-minconn">minconn</a></b> <span style="color: #080">&lt;minconn&gt;</span></div><pre class="text">When the &quot;<a href="#minconn">minconn</a>&quot; parameter is set, the maxconn limit becomes a dynamic
limit following the backend's load. The server will always accept at least
&lt;minconn&gt; connections, never more than &lt;maxconn&gt;, and the limit will be on
the ramp between both values when the backend has less than &lt;fullconn&gt;
concurrent connections. This makes it possible to limit the load on the
server during normal loads, but push it further for important loads without
overloading the server during exceptional loads. See also the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#maxconn%20%28Proxies%29">Proxies</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;
and &quot;<a href="#maxqueue">maxqueue</a>&quot; parameters, as well as the &quot;<a href="#fullconn">fullconn</a>&quot; backend keyword.

Supported in default-server: Yes</pre><a class="anchor" name="observe"></a><a class="anchor" name="5-observe"></a><a class="anchor" name="5-observe"></a><a class="anchor" name="observe (Server and default-server options)"></a><a class="anchor" name="observe (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="observe"></a><a href="#5-observe">observe</a></b> <span style="color: #080">&lt;mode&gt;</span></div><pre class="text">This option enables health adjusting based on observing communication with
the server. By default this functionality is disabled and enabling it also
requires to enable health checks. There are two supported modes: &quot;layer4&quot; and
&quot;layer7&quot;. In layer4 mode, only successful/unsuccessful tcp connections are
significant. In layer7, which is only allowed for http proxies, responses
received from server are verified, like valid/wrong http code, unparsable
headers, a timeout, etc. Valid status codes include 100 to 499, 501 and 505.

Supported in default-server: No

See also the &quot;<a href="#check">check</a>&quot;, &quot;<a href="#on-error">on-error</a>&quot; and &quot;<a href="#error-limit">error-limit</a>&quot;.</pre><a class="anchor" name="on-error"></a><a class="anchor" name="5-on-error"></a><a class="anchor" name="5-on-error"></a><a class="anchor" name="on-error (Server and default-server options)"></a><a class="anchor" name="on-error (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="on-error"></a><a href="#5-on-error">on-error</a></b> <span style="color: #080">&lt;mode&gt;</span></div><pre class="text">Select what should happen when enough consecutive errors are detected.
Currently, four modes are available:
- fastinter: force fastinter
- fail-check: simulate a failed check, also forces fastinter (default)
- sudden-death: simulate a pre-fatal failed health check, one more failed
  check will mark a server down, forces fastinter
- mark-down: mark the server immediately down and force fastinter

Supported in default-server: Yes

See also the &quot;<a href="#check">check</a>&quot;, &quot;<a href="#observe">observe</a>&quot; and &quot;<a href="#error-limit">error-limit</a>&quot;.</pre><a class="anchor" name="port"></a><a class="anchor" name="5-port"></a><a class="anchor" name="5-port"></a><a class="anchor" name="port (Server and default-server options)"></a><a class="anchor" name="port (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="port"></a><a href="#5-port">port</a></b> <span style="color: #080">&lt;port&gt;</span></div><pre class="text">Using the &quot;<a href="#port">port</a>&quot; parameter, it becomes possible to use a different port to
send health-checks. On some servers, it may be desirable to dedicate a port
to a specific component able to perform complex tests which are more suitable
to health-checks than the application. It is common to run a simple script in
inetd for instance. This parameter is ignored if the &quot;<a href="#check">check</a>&quot; parameter is not
set. See also the &quot;<a href="#addr">addr</a>&quot; parameter.

Supported in default-server: Yes</pre><a class="anchor" name="redir"></a><a class="anchor" name="5-redir"></a><a class="anchor" name="5-redir"></a><a class="anchor" name="redir (Server and default-server options)"></a><a class="anchor" name="redir (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="redir"></a><a href="#5-redir">redir</a></b> <span style="color: #080">&lt;prefix&gt;</span></div><pre class="text">The &quot;<a href="#redir">redir</a>&quot; parameter enables the redirection mode for all GET and HEAD
requests addressing this server. This means that instead of having HAProxy
forward the request to the server, it will send an &quot;HTTP 302&quot; response with
the &quot;Location&quot; header composed of this prefix immediately followed by the
requested URI beginning at the leading '/' of the path component. That means
that no trailing slash should be used after &lt;prefix&gt;. All invalid requests
will be rejected, and all non-GET or HEAD requests will be normally served by
the server. Note that since the response is completely forged, no header
mangling nor cookie insertion is possible in the response. However, cookies in
requests are still analysed, making this solution completely usable to direct
users to a remote location in case of local disaster. Main use consists in
increasing bandwidth for static servers by having the clients directly
connect to them. Note: never use a relative location here, it would cause a
loop between the client and HAProxy!</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>server srv1 192.168.1.1:80 redir http://image1.mydomain.com check
</code></pre>
</div><pre class="text">Supported in default-server: No</pre><a class="anchor" name="rise"></a><a class="anchor" name="5-rise"></a><a class="anchor" name="5-rise"></a><a class="anchor" name="rise (Server and default-server options)"></a><a class="anchor" name="rise (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="rise"></a><a href="#5-rise">rise</a></b> <span style="color: #080">&lt;count&gt;</span></div><pre class="text">The &quot;<a href="#rise">rise</a>&quot; parameter states that a server will be considered as operational
after &lt;count&gt; consecutive successful health checks. This value defaults to 2
if unspecified. See also the &quot;<a href="#check">check</a>&quot;, &quot;<a href="#inter">inter</a>&quot; and &quot;<a href="#fall">fall</a>&quot; parameters.

Supported in default-server: Yes</pre><a class="anchor" name="slowstart"></a><a class="anchor" name="5-slowstart"></a><a class="anchor" name="5-slowstart"></a><a class="anchor" name="slowstart (Server and default-server options)"></a><a class="anchor" name="slowstart (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="slowstart"></a><a href="#5-slowstart">slowstart</a></b> <span style="color: #080">&lt;start_time_in_ms&gt;</span></div><pre class="text">The &quot;<a href="#slowstart">slowstart</a>&quot; parameter for a server accepts a value in milliseconds which
indicates after how long a server which has just come back up will run at
full speed. Just as with every other time-based parameter, it can be entered
in any other explicit unit among { us, ms, s, m, h, d }. The speed grows
linearly from 0 to 100% during this time. The limitation applies to two
parameters :

- maxconn: the number of connections accepted by the server will grow from 1
  to 100% of the usual dynamic limit defined by (minconn,maxconn,fullconn).

- weight: when the backend uses a dynamic weighted algorithm, the weight
  grows linearly from 1 to 100%. In this case, the weight is updated at every
  health-check. For this reason, it is important that the &quot;<a href="#inter">inter</a>&quot; parameter
  is smaller than the &quot;<a href="#slowstart">slowstart</a>&quot;, in order to maximize the number of steps.

The slowstart never applies when haproxy starts, otherwise it would cause
trouble to running servers. It only applies when a server has been previously
seen as failed.

Supported in default-server: Yes</pre><a class="anchor" name="source"></a><a class="anchor" name="5-source"></a><a class="anchor" name="5-source"></a><a class="anchor" name="source (Server and default-server options)"></a><a class="anchor" name="source (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="source"></a><a href="#5-source">source</a></b> <span style="color: #080">&lt;addr&gt;</span><span style="color: #008">[:<span style="color: #080">&lt;pl&gt;</span><span style="color: #008">[-<span style="color: #080">&lt;ph&gt;</span>]</span>]</span> <span style="color: #008">[usesrc <span style="color: #800">{ <span style="color: #080">&lt;addr2&gt;</span><span style="color: #008">[:<span style="color: #080">&lt;port2&gt;</span>]</span> | client | clientip }</span> ]</span></div><a class="anchor" name="source"></a><a class="anchor" name="5-source"></a><a class="anchor" name="5-source"></a><a class="anchor" name="source (Server and default-server options)"></a><a class="anchor" name="source (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="source"></a><a href="#5-source">source</a></b> <span style="color: #080">&lt;addr&gt;</span><span style="color: #008">[:<span style="color: #080">&lt;port&gt;</span>]</span> <span style="color: #008">[usesrc <span style="color: #800">{ <span style="color: #080">&lt;addr2&gt;</span><span style="color: #008">[:<span style="color: #080">&lt;port2&gt;</span>]</span> | hdr_ip(<span style="color: #080">&lt;hdr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;occ&gt;</span>]</span>) }</span> ]</span></div><a class="anchor" name="source"></a><a class="anchor" name="5-source"></a><a class="anchor" name="5-source"></a><a class="anchor" name="source (Server and default-server options)"></a><a class="anchor" name="source (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="source"></a><a href="#5-source">source</a></b> <span style="color: #080">&lt;addr&gt;</span><span style="color: #008">[:<span style="color: #080">&lt;pl&gt;</span><span style="color: #008">[-<span style="color: #080">&lt;ph&gt;</span>]</span>]</span> <span style="color: #008">[interface <span style="color: #080">&lt;name&gt;</span>]</span> ...</div><pre class="text">The &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#source%20%28Proxies%29">Proxies</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; parameter sets the source address which will be used when
connecting to the server. It follows the exact same parameters and principle
as the backend &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#source%20%28Proxies%29">Proxies</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; keyword, except that it only applies to the server
referencing it. Please consult the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#source%20%28Proxies%29">Proxies</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; keyword for details.

Additionally, the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#source%20%28Proxies%29">Proxies</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; statement on a server line allows one to specify a
source port range by indicating the lower and higher bounds delimited by a
dash ('-'). Some operating systems might require a valid IP address when a
source port range is specified. It is permitted to have the same IP/range for
several servers. Doing so makes it possible to bypass the maximum of 64k
total concurrent connections. The limit will then reach 64k connections per
server.

Supported in default-server: No</pre><a class="anchor" name="track"></a><a class="anchor" name="5-track"></a><a class="anchor" name="5-track"></a><a class="anchor" name="track (Server and default-server options)"></a><a class="anchor" name="track (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="track"></a><a href="#5-track">track</a></b> <span style="color: #008">[<span style="color: #080">&lt;proxy&gt;</span>/]</span><span style="color: #080">&lt;server&gt;</span></div><pre class="text">This option enables ability to set the current state of the server by
tracking another one. Only a server with checks enabled can be tracked
so it is not possible for example to track a server that tracks another
one. If &lt;proxy&gt; is omitted the current one is used. If disable-on-404 is
used, it has to be enabled on both proxies.

Supported in default-server: No</pre><a class="anchor" name="weight"></a><a class="anchor" name="5-weight"></a><a class="anchor" name="5-weight"></a><a class="anchor" name="weight (Server and default-server options)"></a><a class="anchor" name="weight (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="weight"></a><a href="#5-weight">weight</a></b> <span style="color: #080">&lt;weight&gt;</span></div><pre class="text">The &quot;<a href="#weight">weight</a>&quot; parameter is used to adjust the server's weight relative to
other servers. All servers will receive a load proportional to their weight
relative to the sum of all weights, so the higher the weight, the higher the
load. The default weight is 1, and the maximal value is 256. A value of 0
means the server will not participate in load-balancing but will still accept
persistent connections. If this parameter is used to distribute the load
according to server's capacity, it is recommended to start with values which
can both grow and shrink, for instance between 10 and 100 to leave enough
room above and below for later adjustments.

Supported in default-server: Yes</pre></div>
<a class="anchor" id="6" name="6"></a>
<div class="page-header"><h1 id="chapter-6" data-target="6"><small><a class="small" href="#6">6.</a></small> HTTP header manipulation</h1>
</div><div><pre class="text">In HTTP mode, it is possible to rewrite, add or delete some of the request and
response headers based on regular expressions. It is also possible to block a
request or a response if a particular header matches a regular expression,
which is enough to stop most elementary protocol attacks, and to protect
against information leak from the internal network. But there is a limitation
to this : since HAProxy's HTTP engine does not support keep-alive, only headers
passed during the first request of a TCP session will be seen. All subsequent
headers will be considered data only and not analyzed. Furthermore, HAProxy
never touches data contents, it stops analysis at the end of headers.

There is an exception though. If HAProxy encounters an &quot;Informational Response&quot;
(status code 1xx), it is able to process all rsp* rules which can allow, deny,
rewrite or delete a header, but it will refuse to add a header to any such
messages as this is not HTTP-compliant. The reason for still processing headers
in such responses is to stop and/or fix any possible information leak which may
happen, for instance because another downstream equipment would unconditionally
add a header, or if a server name appears there. When such messages are seen,
normal processing still occurs on the next non-informational messages.

This section covers common usage of the following keywords, described in detail
in <a href="#4.2">section 4.2</a> :

  - reqadd     &lt;string&gt;
  - reqallow   &lt;search&gt;
  - reqiallow  &lt;search&gt;
  - reqdel     &lt;search&gt;
  - reqidel    &lt;search&gt;
  - reqdeny    &lt;search&gt;
  - reqideny   &lt;search&gt;
  - reqpass    &lt;search&gt;
  - reqipass   &lt;search&gt;
  - reqrep     &lt;search&gt; &lt;replace&gt;
  - reqirep    &lt;search&gt; &lt;replace&gt;
  - reqtarpit  &lt;search&gt;
  - reqitarpit &lt;search&gt;
  - rspadd     &lt;string&gt;
  - rspdel     &lt;search&gt;
  - rspidel    &lt;search&gt;
  - rspdeny    &lt;search&gt;
  - rspideny   &lt;search&gt;
  - rsprep     &lt;search&gt; &lt;replace&gt;
  - rspirep    &lt;search&gt; &lt;replace&gt;

With all these keywords, the same conventions are used. The &lt;search&gt; parameter
is a POSIX extended regular expression (regex) which supports grouping through
parenthesis (without the backslash). Spaces and other delimiters must be
prefixed with a backslash ('\') to avoid confusion with a field delimiter.
Other characters may be prefixed with a backslash to change their meaning :

  \t   for a tab
  \r   for a carriage return (CR)
  \n   for a new line (LF)
  \    to mark a space and differentiate it from a delimiter
  \#   to mark a sharp and differentiate it from a comment
  \\   to use a backslash in a regex
  \\\\ to use a backslash in the text (*2 for regex, *2 for haproxy)
  \xXX to write the ASCII hex code XX as in the C language

The &lt;replace&gt; parameter contains the string to be used to replace the largest
portion of text matching the regex. It can make use of the special characters
above, and can reference a substring which is delimited by parenthesis in the
regex, by writing a backslash ('\') immediately followed by one digit from 0 to
9 indicating the group position (0 designating the entire line). This practice
is very common to users of the &quot;sed&quot; program.

The &lt;string&gt; parameter represents the string which will systematically be added
after the last header line. It can also use special character sequences above.</pre><h5>Notes related to these keywords :</h5><pre class="text">- these keywords are not always convenient to allow/deny based on header
  contents. It is strongly recommended to use ACLs with the &quot;<a href="#block">block</a>&quot; keyword
  instead, resulting in far more flexible and manageable rules.

- lines are always considered as a whole. It is not possible to reference
  a header name only or a value only. This is important because of the way
  headers are written (notably the number of spaces after the colon).

- the first line is always considered as a header, which makes it possible to
  rewrite or filter HTTP requests URIs or response codes, but in turn makes
  it harder to distinguish between headers and request line. The regex prefix
  ^[^\ \t]*[\ \t] matches any HTTP method followed by a space, and the prefix
  ^[^ \t:]*: matches any header name followed by a colon.

- for performances reasons, the number of characters added to a request or to
  a response is limited at build time to values between 1 and 4 kB. This
  should normally be far more than enough for most usages. If it is too short
  on occasional usages, it is possible to gain some space by removing some
  useless headers before adding new ones.

- keywords beginning with &quot;reqi&quot; and &quot;rspi&quot; are the same as their counterpart
  without the 'i' letter except that they ignore case when matching patterns.

- when a request passes through a frontend then a backend, all req* rules
  from the frontend will be evaluated, then all req* rules from the backend
  will be evaluated. The reverse path is applied to responses.

- req* statements are applied after &quot;<a href="#block">block</a>&quot; statements, so that &quot;<a href="#block">block</a>&quot; is
  always the first one, but before &quot;<a href="#use_backend">use_backend</a>&quot; in order to permit rewriting
  before switching.</pre></div>
<a class="anchor" id="7" name="7"></a>
<div class="page-header"><h1 id="chapter-7" data-target="7"><small><a class="small" href="#7">7.</a></small> Using ACLs and pattern extraction</h1>
</div><div><pre class="text">The use of Access Control Lists (ACL) provides a flexible solution to perform
content switching and generally to take decisions based on content extracted
from the request, the response or any environmental status. The principle is
simple :

  - define test criteria with sets of values
  - perform actions only if a set of tests is valid

The actions generally consist in blocking the request, or selecting a backend.

In order to define a test, the &quot;<a href="#acl">acl</a>&quot; keyword is used. The syntax is :

   acl &lt;aclname&gt; &lt;criterion&gt; [flags] [operator] &lt;value&gt; ...

This creates a new ACL &lt;aclname&gt; or completes an existing one with new tests.
Those tests apply to the portion of request/response specified in &lt;criterion&gt;
and may be adjusted with optional flags [flags]. Some criteria also support
an operator which may be specified before the set of values. The values are
of the type supported by the criterion, and are separated by spaces.

ACL names must be formed from upper and lower case letters, digits, '-' (dash),
'_' (underscore) , '.' (dot) and ':' (colon). ACL names are case-sensitive,
which means that &quot;my_acl&quot; and &quot;My_Acl&quot; are two different ACLs.

There is no enforced limit to the number of ACLs. The unused ones do not affect
performance, they just consume a small amount of memory.

The following ACL flags are currently supported :

   -i : ignore case during matching of all subsequent patterns.
   -f : load patterns from a file.
   -- : force end of flags. Useful when a string looks like one of the flags.

The &quot;-f&quot; flag is special as it loads all of the lines it finds in the file
specified in argument and loads all of them before continuing. It is even
possible to pass multiple &quot;-f&quot; arguments if the patterns are to be loaded from
multiple files. Empty lines as well as lines beginning with a sharp ('#') will
be ignored. All leading spaces and tabs will be stripped. If it is absolutely
needed to insert a valid pattern beginning with a sharp, just prefix it with a
space so that it is not taken for a comment. Depending on the data type and
match method, haproxy may load the lines into a binary tree, allowing very fast
lookups. This is true for IPv4 and exact string matching. In this case,
duplicates will automatically be removed. Also, note that the &quot;-i&quot; flag applies
to subsequent entries and not to entries loaded from files preceeding it. For
instance :

    acl valid-ua hdr(user-agent) -f exact-ua.lst -i -f generic-ua.lst  test

In this example, each line of &quot;exact-ua.lst&quot; will be exactly matched against
the &quot;user-agent&quot; header of the request. Then each line of &quot;generic-ua&quot; will be
case-insensitively matched. Then the word &quot;test&quot; will be insensitively matched
too.

Note that right now it is difficult for the ACL parsers to report errors, so if
a file is unreadable or unparsable, the most you'll get is a parse error in the
ACL. Thus, file-based ACLs should only be produced by reliable processes.

Supported types of values are :

  - integers or integer ranges
  - strings
  - regular expressions
  - IP addresses and networks</pre></div>
<a class="anchor" id="7.1" name="7.1"></a>
<h2 id="chapter-7.1" data-target="7.1"><small><a class="small" href="#7.1">7.1.</a></small> Matching integers</h2>
<div><pre class="text">Matching integers is special in that ranges and operators are permitted. Note
that integer matching only applies to positive values. A range is a value
expressed with a lower and an upper bound separated with a colon, both of which
may be omitted.

For instance, &quot;1024:65535&quot; is a valid range to represent a range of
unprivileged ports, and &quot;1024:&quot; would also work. &quot;0:1023&quot; is a valid
representation of privileged ports, and &quot;:1023&quot; would also work.

As a special case, some ACL functions support decimal numbers which are in fact
two integers separated by a dot. This is used with some version checks for
instance. All integer properties apply to those decimal numbers, including
ranges and operators.

For an easier usage, comparison operators are also supported. Note that using
operators with ranges does not make much sense and is strongly discouraged.
Similarly, it does not make much sense to perform order comparisons with a set
of values.

Available operators for integer matching are :

  eq : true if the tested value equals at least one value
  ge : true if the tested value is greater than or equal to at least one value
  gt : true if the tested value is greater than at least one value
  le : true if the tested value is less than or equal to at least one value
  lt : true if the tested value is less than at least one value

For instance, the following ACL matches any negative Content-Length header :

  acl negative-length hdr_val(content-length) lt 0

This one matches SSL versions between 3.0 and 3.1 (inclusive) :

  acl sslv3 req_ssl_ver 3:3.1</pre></div>
<a class="anchor" id="7.2" name="7.2"></a>
<h2 id="chapter-7.2" data-target="7.2"><small><a class="small" href="#7.2">7.2.</a></small> Matching strings</h2>
<div><pre class="text">String matching applies to verbatim strings as they are passed, with the
exception of the backslash (&quot;\&quot;) which makes it possible to escape some
characters such as the space. If the &quot;-i&quot; flag is passed before the first
string, then the matching will be performed ignoring the case. In order
to match the string &quot;-i&quot;, either set it second, or pass the &quot;--&quot; flag
before the first string. Same applies of course to match the string &quot;--&quot;.</pre></div>
<a class="anchor" id="7.3" name="7.3"></a>
<h2 id="chapter-7.3" data-target="7.3"><small><a class="small" href="#7.3">7.3.</a></small> Matching regular expressions (regexes)</h2>
<div><pre class="text">Just like with string matching, regex matching applies to verbatim strings as
they are passed, with the exception of the backslash (&quot;\&quot;) which makes it
possible to escape some characters such as the space. If the &quot;-i&quot; flag is
passed before the first regex, then the matching will be performed ignoring
the case. In order to match the string &quot;-i&quot;, either set it second, or pass
the &quot;--&quot; flag before the first string. Same principle applies of course to
match the string &quot;--&quot;.</pre></div>
<a class="anchor" id="7.4" name="7.4"></a>
<h2 id="chapter-7.4" data-target="7.4"><small><a class="small" href="#7.4">7.4.</a></small> Matching IPv4 addresses</h2>
<div><pre class="text">IPv4 addresses values can be specified either as plain addresses or with a
netmask appended, in which case the IPv4 address matches whenever it is
within the network. Plain addresses may also be replaced with a resolvable
host name, but this practice is generally discouraged as it makes it more
difficult to read and debug configurations. If hostnames are used, you should
at least ensure that they are present in /etc/hosts so that the configuration
does not depend on any random DNS match at the moment the configuration is
parsed.</pre></div>
<a class="anchor" id="7.5" name="7.5"></a>
<h2 id="chapter-7.5" data-target="7.5"><small><a class="small" href="#7.5">7.5.</a></small> Available matching criteria</h2>
<a class="anchor" id="7.5.1" name="7.5.1"></a>
<h3 id="chapter-7.5.1" data-target="7.5.1"><small><a class="small" href="#7.5.1">7.5.1.</a></small> Matching at Layer 4 and below</h3>
<div><pre class="text">A first set of criteria applies to information which does not require any
analysis of the request or response contents. Those generally include TCP/IP
addresses and ports, as well as internal values independant on the stream.</pre><a class="anchor" name="always_false"></a><a class="anchor" name="7-always_false"></a><a class="anchor" name="7.5.1-always_false"></a><a class="anchor" name="always_false (Using ACLs and pattern extraction)"></a><a class="anchor" name="always_false (Matching at Layer 4 and below)"></a><div class="keyword"><b><a class="anchor" name="always_false"></a><a href="#7-always_false">always_false</a></b></div><pre class="text">This one never matches. All values and flags are ignored. It may be used as
a temporary replacement for another one when adjusting configurations.</pre><a class="anchor" name="always_true"></a><a class="anchor" name="7-always_true"></a><a class="anchor" name="7.5.1-always_true"></a><a class="anchor" name="always_true (Using ACLs and pattern extraction)"></a><a class="anchor" name="always_true (Matching at Layer 4 and below)"></a><div class="keyword"><b><a class="anchor" name="always_true"></a><a href="#7-always_true">always_true</a></b></div><pre class="text">This one always matches. All values and flags are ignored. It may be used as
a temporary replacement for another one when adjusting configurations.</pre><a class="anchor" name="avg_queue"></a><a class="anchor" name="7-avg_queue"></a><a class="anchor" name="7.5.1-avg_queue"></a><a class="anchor" name="avg_queue (Using ACLs and pattern extraction)"></a><a class="anchor" name="avg_queue (Matching at Layer 4 and below)"></a><div class="keyword"><b><a class="anchor" name="avg_queue"></a><a href="#7-avg_queue">avg_queue</a></b> <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">avg_queue(backend) &lt;integer&gt;
  Returns the total number of queued connections of the designated backend
  divided by the number of active servers. This is very similar to &quot;<a href="#queue">queue</a>&quot;
  except that the size of the farm is considered, in order to give a more
  accurate measurement of the time it may take for a new connection to be
  processed. The main usage is to return a sorry page to new users when it
  becomes certain they will get a degraded service. Note that in the event
  there would not be any active server anymore, we would consider twice the
  number of queued connections as the measured value. This is a fair estimate,
  as we expect one server to get back soon anyway, but we still prefer to send
  new traffic to another backend if in better shape. See also the &quot;<a href="#queue">queue</a>&quot;,
  &quot;<a href="#be_conn">be_conn</a>&quot;, and &quot;<a href="#be_sess_rate">be_sess_rate</a>&quot; criteria.</pre><a class="anchor" name="be_conn"></a><a class="anchor" name="7-be_conn"></a><a class="anchor" name="7.5.1-be_conn"></a><a class="anchor" name="be_conn (Using ACLs and pattern extraction)"></a><a class="anchor" name="be_conn (Matching at Layer 4 and below)"></a><div class="keyword"><b><a class="anchor" name="be_conn"></a><a href="#7-be_conn">be_conn</a></b> <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">be_conn(backend) &lt;integer&gt;
  Applies to the number of currently established connections on the backend,
  possibly including the connection being evaluated. If no backend name is
  specified, the current one is used. But it is also possible to check another
  backend. It can be used to use a specific farm when the nominal one is full.
  See also the &quot;<a href="#fe_conn">fe_conn</a>&quot;, &quot;<a href="#queue">queue</a>&quot; and &quot;<a href="#be_sess_rate">be_sess_rate</a>&quot; criteria.</pre><a class="anchor" name="be_id"></a><a class="anchor" name="7-be_id"></a><a class="anchor" name="7.5.1-be_id"></a><a class="anchor" name="be_id (Using ACLs and pattern extraction)"></a><a class="anchor" name="be_id (Matching at Layer 4 and below)"></a><div class="keyword"><b><a class="anchor" name="be_id"></a><a href="#7-be_id">be_id</a></b> <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">Applies to the backend's id. Can be used in frontends to check from which
backend it was called.</pre><a class="anchor" name="be_sess_rate"></a><a class="anchor" name="7-be_sess_rate"></a><a class="anchor" name="7.5.1-be_sess_rate"></a><a class="anchor" name="be_sess_rate (Using ACLs and pattern extraction)"></a><a class="anchor" name="be_sess_rate (Matching at Layer 4 and below)"></a><div class="keyword"><b><a class="anchor" name="be_sess_rate"></a><a href="#7-be_sess_rate">be_sess_rate</a></b> <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">be_sess_rate(backend) &lt;integer&gt;
  Returns true when the sessions creation rate on the backend matches the
  specified values or ranges, in number of new sessions per second. This is
  used to switch to an alternate backend when an expensive or fragile one
  reaches too high a session rate, or to limit abuse of service (eg. prevent
  sucking of an online dictionary).</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># Redirect to an error page if the dictionary is requested too often</span>
backend dynamic
    mode http
    acl being_scanned be_sess_rate gt 100
    redirect location /denied.html if being_scanned
</code></pre>
</div><a class="anchor" name="connslots"></a><a class="anchor" name="7-connslots"></a><a class="anchor" name="7.5.1-connslots"></a><a class="anchor" name="connslots (Using ACLs and pattern extraction)"></a><a class="anchor" name="connslots (Matching at Layer 4 and below)"></a><div class="keyword"><b><a class="anchor" name="connslots"></a><a href="#7-connslots">connslots</a></b> <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">connslots(backend) &lt;integer&gt;
  The basic idea here is to be able to measure the number of connection &quot;slots&quot;
  still available (connection + queue), so that anything beyond that (intended
  usage; see &quot;<a href="#use_backend">use_backend</a>&quot; keyword) can be redirected to a different backend.

  'connslots' = number of available server connection slots, + number of
  available server queue slots.

  Note that while &quot;<a href="#fe_conn">fe_conn</a>&quot; may be used, &quot;<a href="#connslots">connslots</a>&quot; comes in especially
  useful when you have a case of traffic going to one single ip, splitting into
  multiple backends (perhaps using acls to do name-based load balancing) and
  you want to be able to differentiate between different backends, and their
  available &quot;<a href="#connslots">connslots</a>&quot;.  Also, whereas &quot;<a href="#nbsrv">nbsrv</a>&quot; only measures servers that are
  actually *down*, this acl is more fine-grained and looks into the number of
  available connection slots as well. See also &quot;<a href="#queue">queue</a>&quot; and &quot;<a href="#avg_queue">avg_queue</a>&quot;.

  OTHER CAVEATS AND NOTES: at this point in time, the code does not take care
  of dynamic connections. Also, if any of the server maxconn, or maxqueue is 0,
  then this acl clearly does not make sense, in which case the value returned
  will be -1.</pre><a class="anchor" name="dst"></a><a class="anchor" name="7-dst"></a><a class="anchor" name="7.5.1-dst"></a><a class="anchor" name="dst (Using ACLs and pattern extraction)"></a><a class="anchor" name="dst (Matching at Layer 4 and below)"></a><div class="keyword"><b><a class="anchor" name="dst"></a><a href="#7-dst">dst</a></b> <span style="color: #080">&lt;ip_address&gt;</span></div><pre class="text">Applies to the local IPv4 address the client connected to. It can be used to
switch to a different backend for some alternative addresses.</pre><a class="anchor" name="dst_conn"></a><a class="anchor" name="7-dst_conn"></a><a class="anchor" name="7.5.1-dst_conn"></a><a class="anchor" name="dst_conn (Using ACLs and pattern extraction)"></a><a class="anchor" name="dst_conn (Matching at Layer 4 and below)"></a><div class="keyword"><b><a class="anchor" name="dst_conn"></a><a href="#7-dst_conn">dst_conn</a></b> <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">Applies to the number of currently established connections on the same socket
including the one being evaluated. It can be used to either return a sorry
page before hard-blocking, or to use a specific backend to drain new requests
when the socket is considered saturated. This offers the ability to assign
different limits to different listening ports or addresses. See also the
&quot;<a href="#fe_conn">fe_conn</a>&quot; and &quot;<a href="#be_conn">be_conn</a>&quot; criteria.</pre><a class="anchor" name="dst_port"></a><a class="anchor" name="7-dst_port"></a><a class="anchor" name="7.5.1-dst_port"></a><a class="anchor" name="dst_port (Using ACLs and pattern extraction)"></a><a class="anchor" name="dst_port (Matching at Layer 4 and below)"></a><div class="keyword"><b><a class="anchor" name="dst_port"></a><a href="#7-dst_port">dst_port</a></b> <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">Applies to the local port the client connected to. It can be used to switch
to a different backend for some alternative ports.</pre><a class="anchor" name="fe_conn"></a><a class="anchor" name="7-fe_conn"></a><a class="anchor" name="7.5.1-fe_conn"></a><a class="anchor" name="fe_conn (Using ACLs and pattern extraction)"></a><a class="anchor" name="fe_conn (Matching at Layer 4 and below)"></a><div class="keyword"><b><a class="anchor" name="fe_conn"></a><a href="#7-fe_conn">fe_conn</a></b> <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">fe_conn(frontend) &lt;integer&gt;
  Applies to the number of currently established connections on the frontend,
  possibly including the connection being evaluated. If no frontend name is
  specified, the current one is used. But it is also possible to check another
  frontend. It can be used to either return a sorry page before hard-blocking,
  or to use a specific backend to drain new requests when the farm is
  considered saturated. See also the &quot;<a href="#dst_conn">dst_conn</a>&quot;, &quot;<a href="#be_conn">be_conn</a>&quot; and &quot;<a href="#fe_sess_rate">fe_sess_rate</a>&quot;
  criteria.</pre><a class="anchor" name="fe_id"></a><a class="anchor" name="7-fe_id"></a><a class="anchor" name="7.5.1-fe_id"></a><a class="anchor" name="fe_id (Using ACLs and pattern extraction)"></a><a class="anchor" name="fe_id (Matching at Layer 4 and below)"></a><div class="keyword"><b><a class="anchor" name="fe_id"></a><a href="#7-fe_id">fe_id</a></b> <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">Applies to the frontend's id. Can be used in backends to check from which
frontend it was called.</pre><a class="anchor" name="fe_sess_rate"></a><a class="anchor" name="7-fe_sess_rate"></a><a class="anchor" name="7.5.1-fe_sess_rate"></a><a class="anchor" name="fe_sess_rate (Using ACLs and pattern extraction)"></a><a class="anchor" name="fe_sess_rate (Matching at Layer 4 and below)"></a><div class="keyword"><b><a class="anchor" name="fe_sess_rate"></a><a href="#7-fe_sess_rate">fe_sess_rate</a></b> <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">fe_sess_rate(frontend) &lt;integer&gt;
  Returns true when the session creation rate on the current or the named
  frontend matches the specified values or ranges, expressed in new sessions
  per second. This is used to limit the connection rate to acceptable ranges in
  order to prevent abuse of service at the earliest moment. This can be
  combined with layer 4 ACLs in order to force the clients to wait a bit for
  the rate to go down below the limit.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># This frontend limits incoming mails to 10/s with a max of 100</span>
<span class="comment"># concurrent connections. We accept any connection below 10/s, and</span>
<span class="comment"># force excess clients to wait for 100 ms. Since clients are limited to</span>
<span class="comment"># 100 max, there cannot be more than 10 incoming mails per second.</span>
frontend mail
    bind :25
    mode tcp
    maxconn 100
    acl too_fast fe_sess_rate ge 10
    tcp-request inspect-delay 100ms
    tcp-request content accept if ! too_fast
    tcp-request content accept if WAIT_END
</code></pre>
</div><a class="anchor" name="nbsrv"></a><a class="anchor" name="7-nbsrv"></a><a class="anchor" name="7.5.1-nbsrv"></a><a class="anchor" name="nbsrv (Using ACLs and pattern extraction)"></a><a class="anchor" name="nbsrv (Matching at Layer 4 and below)"></a><div class="keyword"><b><a class="anchor" name="nbsrv"></a><a href="#7-nbsrv">nbsrv</a></b> <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">nbsrv(backend) &lt;integer&gt;
  Returns true when the number of usable servers of either the current backend
  or the named backend matches the values or ranges specified. This is used to
  switch to an alternate backend when the number of servers is too low to
  to handle some load. It is useful to report a failure when combined with
  &quot;<a href="#monitor%20fail">monitor fail</a>&quot;.</pre><a class="anchor" name="queue"></a><a class="anchor" name="7-queue"></a><a class="anchor" name="7.5.1-queue"></a><a class="anchor" name="queue (Using ACLs and pattern extraction)"></a><a class="anchor" name="queue (Matching at Layer 4 and below)"></a><div class="keyword"><b><a class="anchor" name="queue"></a><a href="#7-queue">queue</a></b> <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">queue(backend) &lt;integer&gt;
  Returns the total number of queued connections of the designated backend,
  including all the connections in server queues. If no backend name is
  specified, the current one is used, but it is also possible to check another
  one. This can be used to take actions when queuing goes above a known level,
  generally indicating a surge of traffic or a massive slowdown on the servers.
  One possible action could be to reject new users but still accept old ones.
  See also the &quot;<a href="#avg_queue">avg_queue</a>&quot;, &quot;<a href="#be_conn">be_conn</a>&quot;, and &quot;<a href="#be_sess_rate">be_sess_rate</a>&quot; criteria.</pre><a class="anchor" name="so_id"></a><a class="anchor" name="7-so_id"></a><a class="anchor" name="7.5.1-so_id"></a><a class="anchor" name="so_id (Using ACLs and pattern extraction)"></a><a class="anchor" name="so_id (Matching at Layer 4 and below)"></a><div class="keyword"><b><a class="anchor" name="so_id"></a><a href="#7-so_id">so_id</a></b> <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">Applies to the socket's id. Useful in frontends with many bind keywords.</pre><a class="anchor" name="src"></a><a class="anchor" name="7-src"></a><a class="anchor" name="7.5.1-src"></a><a class="anchor" name="src (Using ACLs and pattern extraction)"></a><a class="anchor" name="src (Matching at Layer 4 and below)"></a><div class="keyword"><b><a class="anchor" name="src"></a><a href="#7-src">src</a></b> <span style="color: #080">&lt;ip_address&gt;</span></div><pre class="text">Applies to the client's IPv4 address. It is usually used to limit access to
certain resources such as statistics. Note that it is the TCP-level source
address which is used, and not the address of a client behind a proxy.</pre><a class="anchor" name="src_port"></a><a class="anchor" name="7-src_port"></a><a class="anchor" name="7.5.1-src_port"></a><a class="anchor" name="src_port (Using ACLs and pattern extraction)"></a><a class="anchor" name="src_port (Matching at Layer 4 and below)"></a><div class="keyword"><b><a class="anchor" name="src_port"></a><a href="#7-src_port">src_port</a></b> <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">Applies to the client's TCP source port. This has a very limited usage.</pre><a class="anchor" name="srv_id"></a><a class="anchor" name="7-srv_id"></a><a class="anchor" name="7.5.1-srv_id"></a><a class="anchor" name="srv_id (Using ACLs and pattern extraction)"></a><a class="anchor" name="srv_id (Matching at Layer 4 and below)"></a><div class="keyword"><b><a class="anchor" name="srv_id"></a><a href="#7-srv_id">srv_id</a></b> <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">Applies to the server's id. Can be used in frontends or backends.</pre><a class="anchor" name="srv_is_up"></a><a class="anchor" name="7-srv_is_up"></a><a class="anchor" name="7.5.1-srv_is_up"></a><a class="anchor" name="srv_is_up (Using ACLs and pattern extraction)"></a><a class="anchor" name="srv_is_up (Matching at Layer 4 and below)"></a><div class="keyword"><b><a class="anchor" name="srv_is_up"></a><a href="#7-srv_is_up">srv_is_up</a></b>(<span style="color: #080">&lt;server&gt;</span>)</div><a class="anchor" name="srv_is_up"></a><a class="anchor" name="7-srv_is_up"></a><a class="anchor" name="7.5.1-srv_is_up"></a><a class="anchor" name="srv_is_up (Using ACLs and pattern extraction)"></a><a class="anchor" name="srv_is_up (Matching at Layer 4 and below)"></a><div class="keyword"><b><a class="anchor" name="srv_is_up"></a><a href="#7-srv_is_up">srv_is_up</a></b>(<span style="color: #080">&lt;backend&gt;</span>/<span style="color: #080">&lt;server&gt;</span>)</div><pre class="text">Returns true when the designated server is UP, and false when it is either
DOWN or in maintenance mode. If &lt;backend&gt; is omitted, then the server is
looked up in the current backend. The function takes no arguments since it
is used as a boolean. It is mainly used to take action based on an external
status reported via a health check (eg: a geographical site's availability).
Another possible use which is more of a hack consists in using dummy servers
as boolean variables that can be enabled or disabled from the CLI, so that
rules depending on those ACLs can be tweaked in realtime.</pre></div>
<a class="anchor" id="7.5.2" name="7.5.2"></a>
<h3 id="chapter-7.5.2" data-target="7.5.2"><small><a class="small" href="#7.5.2">7.5.2.</a></small> Matching contents at Layer 4</h3>
<div><pre class="text">A second set of criteria depends on data found in buffers, but which can change
during analysis. This requires that some data has been buffered, for instance
through TCP request content inspection. Please see the &quot;<a href="#tcp-request">tcp-request</a>&quot; keyword
for more detailed information on the subject.</pre><a class="anchor" name="req_len"></a><a class="anchor" name="7-req_len"></a><a class="anchor" name="7.5.2-req_len"></a><a class="anchor" name="req_len (Using ACLs and pattern extraction)"></a><a class="anchor" name="req_len (Matching contents at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="req_len"></a><a href="#7-req_len">req_len</a></b> <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">Returns true when the length of the data in the request buffer matches the
specified range. It is important to understand that this test does not
return false as long as the buffer is changing. This means that a check with
equality to zero will almost always immediately match at the beginning of the
session, while a test for more data will wait for that data to come in and
return false only when haproxy is certain that no more data will come in.
This test was designed to be used with TCP request content inspection.</pre><a class="anchor" name="req_proto_http"></a><a class="anchor" name="7-req_proto_http"></a><a class="anchor" name="7.5.2-req_proto_http"></a><a class="anchor" name="req_proto_http (Using ACLs and pattern extraction)"></a><a class="anchor" name="req_proto_http (Matching contents at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="req_proto_http"></a><a href="#7-req_proto_http">req_proto_http</a></b></div><pre class="text">Returns true when data in the request buffer look like HTTP and correctly
parses as such. It is the same parser as the common HTTP request parser which
is used so there should be no surprises. This test can be used for instance
to direct HTTP traffic to a given port and HTTPS traffic to another one
using TCP request content inspection rules.</pre><a class="anchor" name="req_rdp_cookie"></a><a class="anchor" name="7-req_rdp_cookie"></a><a class="anchor" name="7.5.2-req_rdp_cookie"></a><a class="anchor" name="req_rdp_cookie (Using ACLs and pattern extraction)"></a><a class="anchor" name="req_rdp_cookie (Matching contents at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="req_rdp_cookie"></a><a href="#7-req_rdp_cookie">req_rdp_cookie</a></b>       <span style="color: #080">&lt;string&gt;</span></div><pre class="text">req_rdp_cookie(name) &lt;string&gt;
  Returns true when data in the request buffer look like the RDP protocol, and
  a cookie is present and equal to &lt;string&gt;. By default, any cookie name is
  checked, but a specific cookie name can be specified in parenthesis. The
  parser only checks for the first cookie, as illustrated in the RDP protocol
  specification. The cookie name is case insensitive. This ACL can be useful
  with the &quot;MSTS&quot; cookie, as it can contain the user name of the client
  connecting to the server if properly configured on the client. This can be
  used to restrict access to certain servers to certain users.</pre><a class="anchor" name="req_rdp_cookie_cnt"></a><a class="anchor" name="7-req_rdp_cookie_cnt"></a><a class="anchor" name="7.5.2-req_rdp_cookie_cnt"></a><a class="anchor" name="req_rdp_cookie_cnt (Using ACLs and pattern extraction)"></a><a class="anchor" name="req_rdp_cookie_cnt (Matching contents at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="req_rdp_cookie_cnt"></a><a href="#7-req_rdp_cookie_cnt">req_rdp_cookie_cnt</a></b>       <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">req_rdp_cookie_cnt(name) &lt;integer&gt;
  Returns true when the data in the request buffer look like the RDP protocol
  and the number of RDP cookies matches the specified range (typically zero or
  one). Optionally a specific cookie name can be checked. This is a simple way
  of detecting the RDP protocol, as clients generally send the MSTS or MSTSHASH
  cookies.</pre><a class="anchor" name="req_ssl_ver"></a><a class="anchor" name="7-req_ssl_ver"></a><a class="anchor" name="7.5.2-req_ssl_ver"></a><a class="anchor" name="req_ssl_ver (Using ACLs and pattern extraction)"></a><a class="anchor" name="req_ssl_ver (Matching contents at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="req_ssl_ver"></a><a href="#7-req_ssl_ver">req_ssl_ver</a></b> <span style="color: #080">&lt;decimal&gt;</span></div><pre class="text">Returns true when data in the request buffer look like SSL, with a protocol
version matching the specified range. Both SSLv2 hello messages and SSLv3
messages are supported. The test tries to be strict enough to avoid being
easily fooled. In particular, it waits for as many bytes as announced in the
message header if this header looks valid (bound to the buffer size). Note
that TLSv1 is announced as SSL version 3.1. This test was designed to be used
with TCP request content inspection.</pre><a class="anchor" name="wait_end"></a><a class="anchor" name="7-wait_end"></a><a class="anchor" name="7.5.2-wait_end"></a><a class="anchor" name="wait_end (Using ACLs and pattern extraction)"></a><a class="anchor" name="wait_end (Matching contents at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="wait_end"></a><a href="#7-wait_end">wait_end</a></b></div><pre class="text">Waits for the end of the analysis period to return true. This may be used in
conjunction with content analysis to avoid returning a wrong verdict early.
It may also be used to delay some actions, such as a delayed reject for some
special addresses. Since it either stops the rules evaluation or immediately
returns true, it is recommended to use this acl as the last one in a rule.
Please note that the default ACL &quot;WAIT_END&quot; is always usable without prior
declaration. This test was designed to be used with TCP request content
inspection.</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code><span class="comment"># delay every incoming request by 2 seconds</span>
tcp-request inspect-delay 2s
tcp-request content accept if WAIT_END

<span class="comment"># don't immediately tell bad guys they are rejected</span>
tcp-request inspect-delay 10s
acl goodguys src 10.0.0.0/24
acl badguys  src 10.0.1.0/24
tcp-request content accept if goodguys
tcp-request content reject if badguys WAIT_END
tcp-request content reject
</code></pre>
</div></div>
<a class="anchor" id="7.5.3" name="7.5.3"></a>
<h3 id="chapter-7.5.3" data-target="7.5.3"><small><a class="small" href="#7.5.3">7.5.3.</a></small> Matching at Layer 7</h3>
<div><pre class="text">A third set of criteria applies to information which can be found at the
application layer (layer 7). Those require that a full HTTP request has been
read, and are only evaluated then. They may require slightly more CPU resources
than the layer 4 ones, but not much since the request and response are indexed.</pre><a class="anchor" name="hdr"></a><a class="anchor" name="7-hdr"></a><a class="anchor" name="7.5.3-hdr"></a><a class="anchor" name="hdr (Using ACLs and pattern extraction)"></a><a class="anchor" name="hdr (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="hdr"></a><a href="#7-hdr">hdr</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">hdr(header) &lt;string&gt;
  Note: all the &quot;hdr*&quot; matching criteria either apply to all headers, or to a
  particular header whose name is passed between parenthesis and without any
  space. The header name is not case-sensitive. The header matching complies
  with RFC2616, and treats as separate headers all values delimited by commas.
  Use the shdr() variant for response headers sent by the server.

  The &quot;<a href="#hdr">hdr</a>&quot; criteria returns true if any of the headers matching the criteria
  match any of the strings. This can be used to check exact for values. For
  instance, checking that &quot;connection: close&quot; is set :

     hdr(Connection) -i close</pre><a class="anchor" name="hdr_beg"></a><a class="anchor" name="7-hdr_beg"></a><a class="anchor" name="7.5.3-hdr_beg"></a><a class="anchor" name="hdr_beg (Using ACLs and pattern extraction)"></a><a class="anchor" name="hdr_beg (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="hdr_beg"></a><a href="#7-hdr_beg">hdr_beg</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">hdr_beg(header) &lt;string&gt;
  Returns true when one of the headers begins with one of the strings. See
  &quot;<a href="#hdr">hdr</a>&quot; for more information on header matching. Use the shdr_beg() variant for
  response headers sent by the server.</pre><a class="anchor" name="hdr_cnt"></a><a class="anchor" name="7-hdr_cnt"></a><a class="anchor" name="7.5.3-hdr_cnt"></a><a class="anchor" name="hdr_cnt (Using ACLs and pattern extraction)"></a><a class="anchor" name="hdr_cnt (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="hdr_cnt"></a><a href="#7-hdr_cnt">hdr_cnt</a></b> <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">hdr_cnt(header) &lt;integer&gt;
  Returns true when the number of occurrence of the specified header matches
  the values or ranges specified. It is important to remember that one header
  line may count as several headers if it has several values. This is used to
  detect presence, absence or abuse of a specific header, as well as to block
  request smuggling attacks by rejecting requests which contain more than one
  of certain headers. See &quot;<a href="#hdr">hdr</a>&quot; for more information on header matching. Use
  the shdr_cnt() variant for response headers sent by the server.</pre><a class="anchor" name="hdr_dir"></a><a class="anchor" name="7-hdr_dir"></a><a class="anchor" name="7.5.3-hdr_dir"></a><a class="anchor" name="hdr_dir (Using ACLs and pattern extraction)"></a><a class="anchor" name="hdr_dir (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="hdr_dir"></a><a href="#7-hdr_dir">hdr_dir</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">hdr_dir(header) &lt;string&gt;
  Returns true when one of the headers contains one of the strings either
  isolated or delimited by slashes. This is used to perform filename or
  directory name matching, and may be used with Referer. See &quot;<a href="#hdr">hdr</a>&quot; for more
  information on header matching. Use the shdr_dir() variant for response
  headers sent by the server.</pre><a class="anchor" name="hdr_dom"></a><a class="anchor" name="7-hdr_dom"></a><a class="anchor" name="7.5.3-hdr_dom"></a><a class="anchor" name="hdr_dom (Using ACLs and pattern extraction)"></a><a class="anchor" name="hdr_dom (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="hdr_dom"></a><a href="#7-hdr_dom">hdr_dom</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">hdr_dom(header) &lt;string&gt;
  Returns true when one of the headers contains one of the strings either
  isolated or delimited by dots. This is used to perform domain name matching,
  and may be used with the Host header. See &quot;<a href="#hdr">hdr</a>&quot; for more information on
  header matching. Use the shdr_dom() variant for response headers sent by the
  server.</pre><a class="anchor" name="hdr_end"></a><a class="anchor" name="7-hdr_end"></a><a class="anchor" name="7.5.3-hdr_end"></a><a class="anchor" name="hdr_end (Using ACLs and pattern extraction)"></a><a class="anchor" name="hdr_end (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="hdr_end"></a><a href="#7-hdr_end">hdr_end</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">hdr_end(header) &lt;string&gt;
  Returns true when one of the headers ends with one of the strings. See &quot;<a href="#hdr">hdr</a>&quot;
  for more information on header matching. Use the shdr_end() variant for
  response headers sent by the server.</pre><a class="anchor" name="hdr_ip"></a><a class="anchor" name="7-hdr_ip"></a><a class="anchor" name="7.5.3-hdr_ip"></a><a class="anchor" name="hdr_ip (Using ACLs and pattern extraction)"></a><a class="anchor" name="hdr_ip (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="hdr_ip"></a><a href="#7-hdr_ip">hdr_ip</a></b> <span style="color: #080">&lt;ip_address&gt;</span></div><pre class="text">hdr_ip(header) &lt;ip_address&gt;
  Returns true when one of the headers' values contains an IP address matching
  &lt;ip_address&gt;. This is mainly used with headers such as X-Forwarded-For or
  X-Client-IP. See &quot;<a href="#hdr">hdr</a>&quot; for more information on header matching. Use the
  shdr_ip() variant for response headers sent by the server.</pre><a class="anchor" name="hdr_len"></a><a class="anchor" name="7-hdr_len"></a><a class="anchor" name="7.5.3-hdr_len"></a><a class="anchor" name="hdr_len (Using ACLs and pattern extraction)"></a><a class="anchor" name="hdr_len (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="hdr_len"></a><a href="#7-hdr_len">hdr_len</a></b> <span style="color: #080">&lt;integer&gt;</span></div><a class="anchor" name="hdr_len"></a><a class="anchor" name="7-hdr_len"></a><a class="anchor" name="7.5.3-hdr_len"></a><a class="anchor" name="hdr_len (Using ACLs and pattern extraction)"></a><a class="anchor" name="hdr_len (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="hdr_len"></a><a href="#7-hdr_len">hdr_len</a></b>(<span style="color: #080">&lt;header&gt;</span>) <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">Returns true when at least one of the headers has a length which matches the
values or ranges specified. This may be used to detect empty or too large
headers. See &quot;<a href="#hdr">hdr</a>&quot; for more information on header matching. Use the
shdr_len() variant for response headers sent by the server.</pre><a class="anchor" name="hdr_reg"></a><a class="anchor" name="7-hdr_reg"></a><a class="anchor" name="7.5.3-hdr_reg"></a><a class="anchor" name="hdr_reg (Using ACLs and pattern extraction)"></a><a class="anchor" name="hdr_reg (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="hdr_reg"></a><a href="#7-hdr_reg">hdr_reg</a></b> <span style="color: #080">&lt;regex&gt;</span></div><pre class="text">hdr_reg(header) &lt;regex&gt;
  Returns true when one of the headers matches of the regular expressions. It
  can be used at any time, but it is important to remember that regex matching
  is slower than other methods. See also other &quot;hdr_&quot; criteria, as well as
  &quot;<a href="#hdr">hdr</a>&quot; for more information on header matching. Use the shdr_reg() variant for
  response headers sent by the server.</pre><a class="anchor" name="hdr_sub"></a><a class="anchor" name="7-hdr_sub"></a><a class="anchor" name="7.5.3-hdr_sub"></a><a class="anchor" name="hdr_sub (Using ACLs and pattern extraction)"></a><a class="anchor" name="hdr_sub (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="hdr_sub"></a><a href="#7-hdr_sub">hdr_sub</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">hdr_sub(header) &lt;string&gt;
  Returns true when one of the headers contains one of the strings. See &quot;<a href="#hdr">hdr</a>&quot;
  for more information on header matching. Use the shdr_sub() variant for
  response headers sent by the server.</pre><a class="anchor" name="hdr_val"></a><a class="anchor" name="7-hdr_val"></a><a class="anchor" name="7.5.3-hdr_val"></a><a class="anchor" name="hdr_val (Using ACLs and pattern extraction)"></a><a class="anchor" name="hdr_val (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="hdr_val"></a><a href="#7-hdr_val">hdr_val</a></b> <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">hdr_val(header) &lt;integer&gt;
  Returns true when one of the headers starts with a number which matches the
  values or ranges specified. This may be used to limit content-length to
  acceptable values for example. See &quot;<a href="#hdr">hdr</a>&quot; for more information on header
  matching. Use the shdr_val() variant for response headers sent by the server.

http_auth(userlist)
http_auth_group(userlist) &lt;group&gt; [&lt;group&gt;]*
  Returns true when authentication data received from the client matches
  username &amp; password stored on the userlist. It is also possible to
  use http_auth_group to check if the user is assigned to at least one
  of specified groups.

  Currently only http basic auth is supported.</pre><a class="anchor" name="http_first_req"></a><a class="anchor" name="7-http_first_req"></a><a class="anchor" name="7.5.3-http_first_req"></a><a class="anchor" name="http_first_req (Using ACLs and pattern extraction)"></a><a class="anchor" name="http_first_req (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="http_first_req"></a><a href="#7-http_first_req">http_first_req</a></b></div><pre class="text">Returns true when the request being processed is the first one of the
connection. This can be used to add or remove headers that may be missing
from some requests when a request is not the first one, or even to perform
some specific ACL checks only on the first request.</pre><a class="anchor" name="method"></a><a class="anchor" name="7-method"></a><a class="anchor" name="7.5.3-method"></a><a class="anchor" name="method (Using ACLs and pattern extraction)"></a><a class="anchor" name="method (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="method"></a><a href="#7-method">method</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">Applies to the method in the HTTP request, eg: &quot;GET&quot;. Some predefined ACL
already check for most common methods.</pre><a class="anchor" name="path"></a><a class="anchor" name="7-path"></a><a class="anchor" name="7.5.3-path"></a><a class="anchor" name="path (Using ACLs and pattern extraction)"></a><a class="anchor" name="path (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="path"></a><a href="#7-path">path</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">Returns true when the path part of the request, which starts at the first
slash and ends before the question mark, equals one of the strings. It may be
used to match known files, such as /favicon.ico.</pre><a class="anchor" name="path_beg"></a><a class="anchor" name="7-path_beg"></a><a class="anchor" name="7.5.3-path_beg"></a><a class="anchor" name="path_beg (Using ACLs and pattern extraction)"></a><a class="anchor" name="path_beg (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="path_beg"></a><a href="#7-path_beg">path_beg</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">Returns true when the path begins with one of the strings. This can be used
to send certain directory names to alternative backends.</pre><a class="anchor" name="path_dir"></a><a class="anchor" name="7-path_dir"></a><a class="anchor" name="7.5.3-path_dir"></a><a class="anchor" name="path_dir (Using ACLs and pattern extraction)"></a><a class="anchor" name="path_dir (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="path_dir"></a><a href="#7-path_dir">path_dir</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">Returns true when one of the strings is found isolated or delimited with
slashes in the path. This is used to perform filename or directory name
matching without the risk of wrong match due to colliding prefixes. See also
&quot;<a href="#url_dir">url_dir</a>&quot; and &quot;<a href="#path_sub">path_sub</a>&quot;.</pre><a class="anchor" name="path_dom"></a><a class="anchor" name="7-path_dom"></a><a class="anchor" name="7.5.3-path_dom"></a><a class="anchor" name="path_dom (Using ACLs and pattern extraction)"></a><a class="anchor" name="path_dom (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="path_dom"></a><a href="#7-path_dom">path_dom</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">Returns true when one of the strings is found isolated or delimited with dots
in the path. This may be used to perform domain name matching in proxy
requests. See also &quot;<a href="#path_sub">path_sub</a>&quot; and &quot;<a href="#url_dom">url_dom</a>&quot;.</pre><a class="anchor" name="path_end"></a><a class="anchor" name="7-path_end"></a><a class="anchor" name="7.5.3-path_end"></a><a class="anchor" name="path_end (Using ACLs and pattern extraction)"></a><a class="anchor" name="path_end (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="path_end"></a><a href="#7-path_end">path_end</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">Returns true when the path ends with one of the strings. This may be used to
control file name extension.</pre><a class="anchor" name="path_len"></a><a class="anchor" name="7-path_len"></a><a class="anchor" name="7.5.3-path_len"></a><a class="anchor" name="path_len (Using ACLs and pattern extraction)"></a><a class="anchor" name="path_len (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="path_len"></a><a href="#7-path_len">path_len</a></b> <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">Returns true when the path length matches the values or ranges specified.
This may be used to detect abusive requests for instance.</pre><a class="anchor" name="path_reg"></a><a class="anchor" name="7-path_reg"></a><a class="anchor" name="7.5.3-path_reg"></a><a class="anchor" name="path_reg (Using ACLs and pattern extraction)"></a><a class="anchor" name="path_reg (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="path_reg"></a><a href="#7-path_reg">path_reg</a></b> <span style="color: #080">&lt;regex&gt;</span></div><pre class="text">Returns true when the path matches one of the regular expressions. It can be
used any time, but it is important to remember that regex matching is slower
than other methods. See also &quot;<a href="#url_reg">url_reg</a>&quot; and all &quot;path_&quot; criteria.</pre><a class="anchor" name="path_sub"></a><a class="anchor" name="7-path_sub"></a><a class="anchor" name="7.5.3-path_sub"></a><a class="anchor" name="path_sub (Using ACLs and pattern extraction)"></a><a class="anchor" name="path_sub (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="path_sub"></a><a href="#7-path_sub">path_sub</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">Returns true when the path contains one of the strings. It can be used to
detect particular patterns in paths, such as &quot;../&quot; for example. See also
&quot;<a href="#path_dir">path_dir</a>&quot;.</pre><a class="anchor" name="req_ver"></a><a class="anchor" name="7-req_ver"></a><a class="anchor" name="7.5.3-req_ver"></a><a class="anchor" name="req_ver (Using ACLs and pattern extraction)"></a><a class="anchor" name="req_ver (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="req_ver"></a><a href="#7-req_ver">req_ver</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">Applies to the version string in the HTTP request, eg: &quot;1.0&quot;. Some predefined
ACL already check for versions 1.0 and 1.1.</pre><a class="anchor" name="status"></a><a class="anchor" name="7-status"></a><a class="anchor" name="7.5.3-status"></a><a class="anchor" name="status (Using ACLs and pattern extraction)"></a><a class="anchor" name="status (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="status"></a><a href="#7-status">status</a></b> <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">Applies to the HTTP status code in the HTTP response, eg: &quot;302&quot;. It can be
used to act on responses depending on status ranges, for instance, remove
any Location header if the response is not a 3xx.</pre><a class="anchor" name="url"></a><a class="anchor" name="7-url"></a><a class="anchor" name="7.5.3-url"></a><a class="anchor" name="url (Using ACLs and pattern extraction)"></a><a class="anchor" name="url (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="url"></a><a href="#7-url">url</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">Applies to the whole URL passed in the request. The only real use is to match
&quot;*&quot;, for which there already is a predefined ACL.</pre><a class="anchor" name="url_beg"></a><a class="anchor" name="7-url_beg"></a><a class="anchor" name="7.5.3-url_beg"></a><a class="anchor" name="url_beg (Using ACLs and pattern extraction)"></a><a class="anchor" name="url_beg (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="url_beg"></a><a href="#7-url_beg">url_beg</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">Returns true when the URL begins with one of the strings. This can be used to
check whether a URL begins with a slash or with a protocol scheme.</pre><a class="anchor" name="url_dir"></a><a class="anchor" name="7-url_dir"></a><a class="anchor" name="7.5.3-url_dir"></a><a class="anchor" name="url_dir (Using ACLs and pattern extraction)"></a><a class="anchor" name="url_dir (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="url_dir"></a><a href="#7-url_dir">url_dir</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">Returns true when one of the strings is found isolated or delimited with
slashes in the URL. This is used to perform filename or directory name
matching without the risk of wrong match due to colliding prefixes. See also
&quot;<a href="#path_dir">path_dir</a>&quot; and &quot;<a href="#url_sub">url_sub</a>&quot;.</pre><a class="anchor" name="url_dom"></a><a class="anchor" name="7-url_dom"></a><a class="anchor" name="7.5.3-url_dom"></a><a class="anchor" name="url_dom (Using ACLs and pattern extraction)"></a><a class="anchor" name="url_dom (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="url_dom"></a><a href="#7-url_dom">url_dom</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">Returns true when one of the strings is found isolated or delimited with dots
in the URL. This is used to perform domain name matching without the risk of
wrong match due to colliding prefixes. See also &quot;<a href="#url_sub">url_sub</a>&quot;.</pre><a class="anchor" name="url_end"></a><a class="anchor" name="7-url_end"></a><a class="anchor" name="7.5.3-url_end"></a><a class="anchor" name="url_end (Using ACLs and pattern extraction)"></a><a class="anchor" name="url_end (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="url_end"></a><a href="#7-url_end">url_end</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">Returns true when the URL ends with one of the strings. It has very limited
use. &quot;<a href="#path_end">path_end</a>&quot; should be used instead for filename matching.</pre><a class="anchor" name="url_ip"></a><a class="anchor" name="7-url_ip"></a><a class="anchor" name="7.5.3-url_ip"></a><a class="anchor" name="url_ip (Using ACLs and pattern extraction)"></a><a class="anchor" name="url_ip (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="url_ip"></a><a href="#7-url_ip">url_ip</a></b> <span style="color: #080">&lt;ip_address&gt;</span></div><pre class="text">Applies to the IP address specified in the absolute URI in an HTTP request.
It can be used to prevent access to certain resources such as local network.
It is useful with option &quot;<a href="#option%20http_proxy">http_proxy</a>&quot;.</pre><a class="anchor" name="url_len"></a><a class="anchor" name="7-url_len"></a><a class="anchor" name="7.5.3-url_len"></a><a class="anchor" name="url_len (Using ACLs and pattern extraction)"></a><a class="anchor" name="url_len (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="url_len"></a><a href="#7-url_len">url_len</a></b> <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">Returns true when the url length matches the values or ranges specified. This
may be used to detect abusive requests for instance.</pre><a class="anchor" name="url_port"></a><a class="anchor" name="7-url_port"></a><a class="anchor" name="7.5.3-url_port"></a><a class="anchor" name="url_port (Using ACLs and pattern extraction)"></a><a class="anchor" name="url_port (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="url_port"></a><a href="#7-url_port">url_port</a></b> <span style="color: #080">&lt;integer&gt;</span></div><pre class="text">Applies to the port specified in the absolute URI in an HTTP request. It can
be used to prevent access to certain resources. It is useful with option
&quot;<a href="#option%20http_proxy">http_proxy</a>&quot;. Note that if the port is not specified in the request, port 80
is assumed.</pre><a class="anchor" name="url_reg"></a><a class="anchor" name="7-url_reg"></a><a class="anchor" name="7.5.3-url_reg"></a><a class="anchor" name="url_reg (Using ACLs and pattern extraction)"></a><a class="anchor" name="url_reg (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="url_reg"></a><a href="#7-url_reg">url_reg</a></b> <span style="color: #080">&lt;regex&gt;</span></div><pre class="text">Returns true when the URL matches one of the regular expressions. It can be
used any time, but it is important to remember that regex matching is slower
than other methods. See also &quot;<a href="#path_reg">path_reg</a>&quot; and all &quot;url_&quot; criteria.</pre><a class="anchor" name="url_sub"></a><a class="anchor" name="7-url_sub"></a><a class="anchor" name="7.5.3-url_sub"></a><a class="anchor" name="url_sub (Using ACLs and pattern extraction)"></a><a class="anchor" name="url_sub (Matching at Layer 7)"></a><div class="keyword"><b><a class="anchor" name="url_sub"></a><a href="#7-url_sub">url_sub</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">Returns true when the URL contains one of the strings. It can be used to
detect particular patterns in query strings for example. See also &quot;<a href="#path_sub">path_sub</a>&quot;.</pre></div>
<a class="anchor" id="7.6" name="7.6"></a>
<h2 id="chapter-7.6" data-target="7.6"><small><a class="small" href="#7.6">7.6.</a></small> Pre-defined ACLs</h2>
<div><pre class="text">Some predefined ACLs are hard-coded so that they do not have to be declared in
every frontend which needs them. They all have their names in upper case in
order to avoid confusion. Their equivalence is provided below.</pre><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>ACL name</th><th>Equivalent to</th><th>Usage</th></tr></thead>
<tr><td None>FALSE</td><td None>always_false</td><td None>never match</td></tr>
<tr><td None>HTTP</td><td None>req_proto_http</td><td None>match if protocol is valid HTTP</td></tr>
<tr><td None>HTTP_1.0</td><td None>req_ver 1.0</td><td None>match HTTP version 1.0</td></tr>
<tr><td None>HTTP_1.1</td><td None>req_ver 1.1</td><td None>match HTTP version 1.1</td></tr>
<tr><td None>HTTP_CONTENT</td><td None>hdr_val(content-length) gt 0</td><td None>match an existing content-length</td></tr>
<tr><td None>HTTP_URL_ABS</td><td None>url_reg ^[^/:]*://</td><td None>match absolute URL with scheme</td></tr>
<tr><td None>HTTP_URL_SLASH</td><td None>url_beg /</td><td None>match URL beginning with &quot;/&quot;</td></tr>
<tr><td None>HTTP_URL_STAR</td><td None>url     *</td><td None>match URL equal to &quot;*&quot;</td></tr>
<tr><td None>LOCALHOST</td><td None>src 127.0.0.1/8</td><td None>match connection from local host</td></tr>
<tr><td None>METH_CONNECT</td><td None>method  CONNECT</td><td None>match HTTP CONNECT method</td></tr>
<tr><td None>METH_GET</td><td None>method  GET HEAD</td><td None>match HTTP GET or HEAD method</td></tr>
<tr><td None>METH_HEAD</td><td None>method  HEAD</td><td None>match HTTP HEAD method</td></tr>
<tr><td None>METH_OPTIONS</td><td None>method  OPTIONS</td><td None>match HTTP OPTIONS method</td></tr>
<tr><td None>METH_POST</td><td None>method  POST</td><td None>match HTTP POST method</td></tr>
<tr><td None>METH_TRACE</td><td None>method  TRACE</td><td None>match HTTP TRACE method</td></tr>
<tr><td None>RDP_COOKIE</td><td None>req_rdp_cookie_cnt gt 0</td><td None>match presence of an RDP cookie</td></tr>
<tr><td None>REQ_CONTENT</td><td None>req_len gt 0</td><td None>match data in the request buffer</td></tr>
<tr><td None>TRUE</td><td None>always_true</td><td None>always match</td></tr>
<tr><td None>WAIT_END</td><td None>wait_end</td><td None>wait for end of content analysis</td></tr>
</table></div>
<a class="anchor" id="7.7" name="7.7"></a>
<h2 id="chapter-7.7" data-target="7.7"><small><a class="small" href="#7.7">7.7.</a></small> Using ACLs to form conditions</h2>
<div><pre class="text">Some actions are only performed upon a valid condition. A condition is a
combination of ACLs with operators. 3 operators are supported :

  - AND (implicit)
  - OR  (explicit with the &quot;or&quot; keyword or the &quot;||&quot; operator)
  - Negation with the exclamation mark (&quot;!&quot;)

A condition is formed as a disjunctive form:

   [!]acl1 [!]acl2 ... [!]acln  { or [!]acl1 [!]acl2 ... [!]acln } ...

Such conditions are generally used after an &quot;if&quot; or &quot;unless&quot; statement,
indicating when the condition will trigger the action.

For instance, to block HTTP requests to the &quot;*&quot; URL with methods other than
&quot;OPTIONS&quot;, as well as POST requests without content-length, and GET or HEAD
requests with a content-length greater than 0, and finally every request which
is not either GET/HEAD/POST/OPTIONS !

   acl missing_cl hdr_cnt(Content-length) eq 0
   block if HTTP_URL_STAR !METH_OPTIONS || METH_POST missing_cl
   block if METH_GET HTTP_CONTENT
   block unless METH_GET or METH_POST or METH_OPTIONS

To select a different backend for requests to static contents on the &quot;www&quot; site
and to every request on the &quot;img&quot;, &quot;video&quot;, &quot;download&quot; and &quot;ftp&quot; hosts :

   acl url_static  path_beg         /static /images /img /css
   acl url_static  path_end         .gif .png .jpg .css .js
   acl host_www    hdr_beg(host) -i www
   acl host_static hdr_beg(host) -i img. video. download. ftp.

   # now use backend &quot;static&quot; for all static-only hosts, and for static urls
   # of host &quot;www&quot;. Use backend &quot;www&quot; for the rest.
   use_backend static if host_static or host_www url_static
   use_backend www    if host_www

It is also possible to form rules using &quot;anonymous ACLs&quot;. Those are unnamed ACL
expressions that are built on the fly without needing to be declared. They must
be enclosed between braces, with a space before and after each brace (because</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>The following rule :

    acl missing_cl hdr_cnt(Content-length) eq 0
    block if METH_POST missing_cl

Can also be written that way :

    block if METH_POST { hdr_cnt(Content-length) eq 0 }
</code></pre>
</div><pre class="text">It is generally not recommended to use this construct because it's a lot easier
to leave errors in the configuration when written that way. However, for very
simple rules matching only one source IP address for instance, it can make more
sense to use them than to declare ACLs with random names. Another example of
good use is the following :

   With named ACLs :

        acl site_dead nbsrv(dynamic) lt 2
        acl site_dead nbsrv(static)  lt 2
        monitor fail  if site_dead

   With anonymous ACLs :

        monitor fail if { nbsrv(dynamic) lt 2 } || { nbsrv(static) lt 2 }

See <a href="#4.2">section 4.2</a> for detailed help on the &quot;<a href="#block">block</a>&quot; and &quot;<a href="#use_backend">use_backend</a>&quot; keywords.</pre></div>
<a class="anchor" id="7.8" name="7.8"></a>
<h2 id="chapter-7.8" data-target="7.8"><small><a class="small" href="#7.8">7.8.</a></small> Pattern extraction</h2>
<div><pre class="text">The stickiness features relies on pattern extraction in the request and
response. Sometimes the data needs to be converted first before being stored,
for instance converted from ASCII to IP or upper case to lower case.

All these operations of data extraction and conversion are defined as
&quot;pattern extraction rules&quot;. A pattern rule always has the same format. It
begins with a single pattern fetch word, potentially followed by a list of
arguments within parenthesis then an optional list of transformations. As
much as possible, the pattern fetch functions use the same name as their
equivalent used in ACLs.

The list of currently supported pattern fetch functions is the following :

  src          This is the source IPv4 address of the client of the session.
               It is of type IP and only works with such tables.

  dst          This is the destination IPv4 address of the session on the
               client side, which is the address the client connected to.
               It can be useful when running in transparent mode. It is of
               type IP and only works with such tables.

  dst_port     This is the destination TCP port of the session on the client
               side, which is the port the client connected to. This might be
               used when running in transparent mode or when assigning dynamic
               ports to some clients for a whole application session. It is of
               type integer and only works with such tables.

  hdr(name)    This extracts the last occurrence of header &lt;name&gt; in an HTTP
               request and converts it to an IP address. This IP address is
               then used to match the table. A typical use is with the
               x-forwarded-for header.


The currently available list of transformations include :

  lower        Convert a string pattern to lower case. This can only be placed
               after a string pattern fetch function or after a conversion
               function returning a string type. The result is of type string.

  upper        Convert a string pattern to upper case. This can only be placed
               after a string pattern fetch function or after a conversion
               function returning a string type. The result is of type string.

  ipmask(mask) Apply a mask to an IPv4 address, and use the result for lookups
               and storage. This can be used to make all hosts within a
               certain mask to share the same table entries and as such use
               the same server. The mask can be passed in dotted form (eg:
               255.255.255.0) or in CIDR form (eg: 24).</pre></div>
<a class="anchor" id="8" name="8"></a>
<div class="page-header"><h1 id="chapter-8" data-target="8"><small><a class="small" href="#8">8.</a></small> Logging</h1>
</div><div><pre class="text">One of HAProxy's strong points certainly lies is its precise logs. It probably
provides the finest level of information available for such a product, which is
very important for troubleshooting complex environments. Standard information
provided in logs include client ports, TCP/HTTP state timers, precise session
state at termination and precise termination cause, information about decisions
to direct traffic to a server, and of course the ability to capture arbitrary
headers.

In order to improve administrators reactivity, it offers a great transparency
about encountered problems, both internal and external, and it is possible to
send logs to different sources at the same time with different level filters :

  - global process-level logs (system errors, start/stop, etc..)
  - per-instance system and internal errors (lack of resource, bugs, ...)
  - per-instance external troubles (servers up/down, max connections)
  - per-instance activity (client connections), either at the establishment or
    at the termination.

The ability to distribute different levels of logs to different log servers
allow several production teams to interact and to fix their problems as soon
as possible. For example, the system team might monitor system-wide errors,
while the application team might be monitoring the up/down for their servers in
real time, and the security team might analyze the activity logs with one hour
delay.</pre></div>
<a class="anchor" id="8.1" name="8.1"></a>
<h2 id="chapter-8.1" data-target="8.1"><small><a class="small" href="#8.1">8.1.</a></small> Log levels</h2>
<div><pre class="text">TCP and HTTP connections can be logged with information such as the date, time,
source IP address, destination address, connection duration, response times,
HTTP request, HTTP return code, number of bytes transmitted, conditions
in which the session ended, and even exchanged cookies values. For example
track a particular user's problems. All messages may be sent to up to two
syslog servers. Check the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">log<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#log%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#log%20%28Proxies%29">Proxies</a></li></ul></span>&quot; keyword in <a href="#4.2">section 4.2</a> for more information
about log facilities.</pre></div>
<a class="anchor" id="8.2" name="8.2"></a>
<h2 id="chapter-8.2" data-target="8.2"><small><a class="small" href="#8.2">8.2.</a></small> Log formats</h2>
<div><pre class="text">HAProxy supports 4 log formats. Several fields are common between these formats
and will be detailed in the following sections. A few of them may vary
slightly with the configuration, due to indicators specific to certain
options. The supported formats are as follows :

  - the default format, which is very basic and very rarely used. It only
    provides very basic information about the incoming connection at the moment
    it is accepted : source IP:port, destination IP:port, and frontend-name.
    This mode will eventually disappear so it will not be described to great
    extents.

  - the TCP format, which is more advanced. This format is enabled when &quot;option
    tcplog&quot; is set on the frontend. HAProxy will then usually wait for the
    connection to terminate before logging. This format provides much richer
    information, such as timers, connection counts, queue size, etc... This
    format is recommended for pure TCP proxies.

  - the HTTP format, which is the most advanced for HTTP proxying. This format
    is enabled when &quot;<a href="#option%20httplog">option httplog</a>&quot; is set on the frontend. It provides the
    same information as the TCP format with some HTTP-specific fields such as
    the request, the status code, and captures of headers and cookies. This
    format is recommended for HTTP proxies.

  - the CLF HTTP format, which is equivalent to the HTTP format, but with the
    fields arranged in the same order as the CLF format. In this mode, all
    timers, captures, flags, etc... appear one per field after the end of the
    common fields, in the same order they appear in the standard HTTP format.

Next sections will go deeper into details for each of these formats. Format
specification will be performed on a &quot;field&quot; basis. Unless stated otherwise, a
field is a portion of text delimited by any number of spaces. Since syslog
servers are susceptible of inserting fields at the beginning of a line, it is
always assumed that the first field is the one containing the process name and
identifier.

Note : Since log lines may be quite long, the log examples in sections below
       might be broken into multiple lines. The example log lines will be
       prefixed with 3 closing angle brackets ('&gt;&gt;&gt;') and each time a log is
       broken into multiple lines, each non-final line will end with a
       backslash ('\') and the next line will start indented by two characters.</pre></div>
<a class="anchor" id="8.2.1" name="8.2.1"></a>
<h3 id="chapter-8.2.1" data-target="8.2.1"><small><a class="small" href="#8.2.1">8.2.1.</a></small> Default log format</h3>
<div><pre class="text">This format is used when no specific option is set. The log is emitted as soon
as the connection is accepted. One should note that this currently is the only
format which logs the request's destination IP and ports.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>    listen www
        mode http
        log global
        server srv1 127.0.0.1:8000

&gt;&gt;&gt; Feb  6 12:12:09 localhost \
      haproxy[14385]: Connect from 10.0.1.2:33312 to 10.0.3.31:8012 \
      (www/HTTP)
</code></pre>
</div><pre class="text">  Field   Format                                Extract from the example above
      1   process_name '[' pid ']:'                            haproxy[14385]:
      2   'Connect from'                                          Connect from
      3   source_ip ':' source_port                             10.0.1.2:33312
      4   'to'                                                              to
      5   destination_ip ':' destination_port                   10.0.3.31:8012
      6   '(' frontend_name '/' mode ')'                            (www/HTTP)

Detailed fields description :
  - &quot;source_ip&quot; is the IP address of the client which initiated the connection.
  - &quot;source_port&quot; is the TCP port of the client which initiated the connection.
  - &quot;destination_ip&quot; is the IP address the client connected to.
  - &quot;destination_port&quot; is the TCP port the client connected to.
  - &quot;frontend_name&quot; is the name of the frontend (or listener) which received
    and processed the connection.
  - &quot;mode is the mode the frontend is operating (TCP or HTTP).

It is advised not to use this deprecated format for newer installations as it
will eventually disappear.</pre></div>
<a class="anchor" id="8.2.2" name="8.2.2"></a>
<h3 id="chapter-8.2.2" data-target="8.2.2"><small><a class="small" href="#8.2.2">8.2.2.</a></small> TCP log format</h3>
<div><pre class="text">The TCP format is used when &quot;<a href="#option%20tcplog">option tcplog</a>&quot; is specified in the frontend, and
is the recommended format for pure TCP proxies. It provides a lot of precious
information for troubleshooting. Since this format includes timers and byte
counts, the log is normally emitted at the end of the session. It can be
emitted earlier if &quot;<a href="#option%20logasap">option logasap</a>&quot; is specified, which makes sense in most
environments with long sessions such as remote terminals. Sessions which match
the &quot;<a href="#monitor">monitor</a>&quot; rules are never logged. It is also possible not to emit logs for
sessions for which no data were exchanged between the client and the server, by
specifying &quot;<a href="#option%20dontlognull">option dontlognull</a>&quot; in the frontend. Successful connections will
not be logged if &quot;<a href="#option%20dontlog-normal">option dontlog-normal</a>&quot; is specified in the frontend. A few
fields may slightly vary depending on some configuration options, those are
marked with a star ('*') after the field name below.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>    frontend fnt
        mode tcp
        option tcplog
        log global
        default_backend bck

    backend bck
        server srv1 127.0.0.1:8000

&gt;&gt;&gt; Feb  6 12:12:56 localhost \
      haproxy[14387]: 10.0.1.2:33313 [06/Feb/2009:12:12:51.443] fnt \
      bck/srv1 0/0/5007 212 -- 0/0/0/0/3 0/0
</code></pre>
</div><pre class="text">  Field   Format                                Extract from the example above
      1   process_name '[' pid ']:'                            haproxy[14387]:
      2   client_ip ':' client_port                             10.0.1.2:33313
      3   '[' accept_date ']'                       [06/Feb/2009:12:12:51.443]
      4   frontend_name                                                    fnt
      5   backend_name '/' server_name                                bck/srv1
      6   Tw '/' Tc '/' Tt*                                           0/0/5007
      7   bytes_read*                                                      212
      8   termination_state                                                 --
      9   actconn '/' feconn '/' beconn '/' srv_conn '/' retries*    0/0/0/0/3
     10   srv_queue '/' backend_queue                                      0/0

Detailed fields description :
  - &quot;client_ip&quot; is the IP address of the client which initiated the TCP
    connection to haproxy.

  - &quot;client_port&quot; is the TCP port of the client which initiated the connection.

  - &quot;accept_date&quot; is the exact date when the connection was received by haproxy
    (which might be very slightly different from the date observed on the
    network if there was some queuing in the system's backlog). This is usually
    the same date which may appear in any upstream firewall's log.

  - &quot;frontend_name&quot; is the name of the frontend (or listener) which received
    and processed the connection.

  - &quot;backend_name&quot; is the name of the backend (or listener) which was selected
    to manage the connection to the server. This will be the same as the
    frontend if no switching rule has been applied, which is common for TCP
    applications.

  - &quot;server_name&quot; is the name of the last server to which the connection was
    sent, which might differ from the first one if there were connection errors
    and a redispatch occurred. Note that this server belongs to the backend
    which processed the request. If the connection was aborted before reaching
    a server, &quot;&lt;NOSRV&gt;&quot; is indicated instead of a server name.

  - &quot;Tw&quot; is the total time in milliseconds spent waiting in the various queues.
    It can be &quot;-1&quot; if the connection was aborted before reaching the queue.
    See &quot;Timers&quot; below for more details.

  - &quot;Tc&quot; is the total time in milliseconds spent waiting for the connection to
    establish to the final server, including retries. It can be &quot;-1&quot; if the
    connection was aborted before a connection could be established. See
    &quot;Timers&quot; below for more details.

  - &quot;Tt&quot; is the total time in milliseconds elapsed between the accept and the
    last close. It covers all possible processings. There is one exception, if
    &quot;<a href="#option%20logasap">option logasap</a>&quot; was specified, then the time counting stops at the moment
    the log is emitted. In this case, a '+' sign is prepended before the value,
    indicating that the final one will be larger. See &quot;Timers&quot; below for more
    details.

  - &quot;bytes_read&quot; is the total number of bytes transmitted from the server to
    the client when the log is emitted. If &quot;<a href="#option%20logasap">option logasap</a>&quot; is specified, the
    this value will be prefixed with a '+' sign indicating that the final one
    may be larger. Please note that this value is a 64-bit counter, so log
    analysis tools must be able to handle it without overflowing.

  - &quot;termination_state&quot; is the condition the session was in when the session
    ended. This indicates the session state, which side caused the end of
    session to happen, and for what reason (timeout, error, ...). The normal
    flags should be &quot;--&quot;, indicating the session was closed by either end with
    no data remaining in buffers. See below &quot;Session state at disconnection&quot;
    for more details.

  - &quot;actconn&quot; is the total number of concurrent connections on the process when
    the session was logged. It it useful to detect when some per-process system
    limits have been reached. For instance, if actconn is close to 512 when
    multiple connection errors occur, chances are high that the system limits
    the process to use a maximum of 1024 file descriptors and that all of them
    are used. See <a href="#3">section 3</a> &quot;Global parameters&quot; to find how to tune the system.

  - &quot;feconn&quot; is the total number of concurrent connections on the frontend when
    the session was logged. It is useful to estimate the amount of resource
    required to sustain high loads, and to detect when the frontend's &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#maxconn%20%28Proxies%29">Proxies</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;
    has been reached. Most often when this value increases by huge jumps, it is
    because there is congestion on the backend servers, but sometimes it can be
    caused by a denial of service attack.

  - &quot;beconn&quot; is the total number of concurrent connections handled by the
    backend when the session was logged. It includes the total number of
    concurrent connections active on servers as well as the number of
    connections pending in queues. It is useful to estimate the amount of
    additional servers needed to support high loads for a given application.
    Most often when this value increases by huge jumps, it is because there is
    congestion on the backend servers, but sometimes it can be caused by a
    denial of service attack.

  - &quot;srv_conn&quot; is the total number of concurrent connections still active on
    the server when the session was logged. It can never exceed the server's
    configured &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#maxconn%20%28Proxies%29">Proxies</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; parameter. If this value is very often close or equal
    to the server's &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#maxconn%20%28Proxies%29">Proxies</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;, it means that traffic regulation is involved a
    lot, meaning that either the server's maxconn value is too low, or that
    there aren't enough servers to process the load with an optimal response
    time. When only one of the server's &quot;srv_conn&quot; is high, it usually means
    that this server has some trouble causing the connections to take longer to
    be processed than on other servers.

  - &quot;<a href="#retries">retries</a>&quot; is the number of connection retries experienced by this session
    when trying to connect to the server. It must normally be zero, unless a
    server is being stopped at the same moment the connection was attempted.
    Frequent retries generally indicate either a network problem between
    haproxy and the server, or a misconfigured system backlog on the server
    preventing new connections from being queued. This field may optionally be
    prefixed with a '+' sign, indicating that the session has experienced a
    redispatch after the maximal retry count has been reached on the initial
    server. In this case, the server name appearing in the log is the one the
    connection was redispatched to, and not the first one, though both may
    sometimes be the same in case of hashing for instance. So as a general rule
    of thumb, when a '+' is present in front of the retry count, this count
    should not be attributed to the logged server.

  - &quot;srv_queue&quot; is the total number of requests which were processed before
    this one in the server queue. It is zero when the request has not gone
    through the server queue. It makes it possible to estimate the approximate
    server's response time by dividing the time spent in queue by the number of
    requests in the queue. It is worth noting that if a session experiences a
    redispatch and passes through two server queues, their positions will be
    cumulated. A request should not pass through both the server queue and the
    backend queue unless a redispatch occurs.

  - &quot;backend_queue&quot; is the total number of requests which were processed before
    this one in the backend's global queue. It is zero when the request has not
    gone through the global queue. It makes it possible to estimate the average
    queue length, which easily translates into a number of missing servers when
    divided by a server's &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#maxconn%20%28Proxies%29">Proxies</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; parameter. It is worth noting that if a
    session experiences a redispatch, it may pass twice in the backend's queue,
    and then both positions will be cumulated. A request should not pass
    through both the server queue and the backend queue unless a redispatch
    occurs.</pre></div>
<a class="anchor" id="8.2.3" name="8.2.3"></a>
<h3 id="chapter-8.2.3" data-target="8.2.3"><small><a class="small" href="#8.2.3">8.2.3.</a></small> HTTP log format</h3>
<div><pre class="text">The HTTP format is the most complete and the best suited for HTTP proxies. It
is enabled by when &quot;<a href="#option%20httplog">option httplog</a>&quot; is specified in the frontend. It provides
the same level of information as the TCP format with additional features which
are specific to the HTTP protocol. Just like the TCP format, the log is usually
emitted at the end of the session, unless &quot;<a href="#option%20logasap">option logasap</a>&quot; is specified, which
generally only makes sense for download sites. A session which matches the
&quot;<a href="#monitor">monitor</a>&quot; rules will never logged. It is also possible not to log sessions for
which no data were sent by the client by specifying &quot;<a href="#option%20dontlognull">option dontlognull</a>&quot; in the
frontend. Successful connections will not be logged if &quot;<a href="#option%20dontlog-normal">option dontlog-normal</a>&quot;
is specified in the frontend.

Most fields are shared with the TCP log, some being different. A few fields may
slightly vary depending on some configuration options. Those ones are marked
with a star ('*') after the field name below.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>    frontend http-in
        mode http
        option httplog
        log global
        default_backend bck

    backend static
        server srv1 127.0.0.1:8000

&gt;&gt;&gt; Feb  6 12:14:14 localhost \
      haproxy[14389]: 10.0.1.2:33317 [06/Feb/2009:12:14:14.655] http-in \
      static/srv1 10/0/30/69/109 200 2750 - - ---- 1/1/1/1/0 0/0 {1wt.eu} \
      {} &quot;GET /index.html HTTP/1.1&quot;
</code></pre>
</div><pre class="text">  Field   Format                                Extract from the example above
      1   process_name '[' pid ']:'                            haproxy[14389]:
      2   client_ip ':' client_port                             10.0.1.2:33317
      3   '[' accept_date ']'                       [06/Feb/2009:12:14:14.655]
      4   frontend_name                                                http-in
      5   backend_name '/' server_name                             static/srv1
      6   Tq '/' Tw '/' Tc '/' Tr '/' Tt*                       10/0/30/69/109
      7   status_code                                                      200
      8   bytes_read*                                                     2750
      9   captured_request_cookie                                            -
     10   captured_response_cookie                                           -
     11   termination_state                                               ----
     12   actconn '/' feconn '/' beconn '/' srv_conn '/' retries*    1/1/1/1/0
     13   srv_queue '/' backend_queue                                      0/0
     14   '{' captured_request_headers* '}'                   {haproxy.1wt.eu}
     15   '{' captured_response_headers* '}'                                {}
     16   '&quot;' http_request '&quot;'                      &quot;GET /index.html HTTP/1.1&quot;


Detailed fields description :
  - &quot;client_ip&quot; is the IP address of the client which initiated the TCP
    connection to haproxy.

  - &quot;client_port&quot; is the TCP port of the client which initiated the connection.

  - &quot;accept_date&quot; is the exact date when the TCP connection was received by
    haproxy (which might be very slightly different from the date observed on
    the network if there was some queuing in the system's backlog). This is
    usually the same date which may appear in any upstream firewall's log. This
    does not depend on the fact that the client has sent the request or not.

  - &quot;frontend_name&quot; is the name of the frontend (or listener) which received
    and processed the connection.

  - &quot;backend_name&quot; is the name of the backend (or listener) which was selected
    to manage the connection to the server. This will be the same as the
    frontend if no switching rule has been applied.

  - &quot;server_name&quot; is the name of the last server to which the connection was
    sent, which might differ from the first one if there were connection errors
    and a redispatch occurred. Note that this server belongs to the backend
    which processed the request. If the request was aborted before reaching a
    server, &quot;&lt;NOSRV&gt;&quot; is indicated instead of a server name. If the request was
    intercepted by the stats subsystem, &quot;&lt;STATS&gt;&quot; is indicated instead.

  - &quot;Tq&quot; is the total time in milliseconds spent waiting for the client to send
    a full HTTP request, not counting data. It can be &quot;-1&quot; if the connection
    was aborted before a complete request could be received. It should always
    be very small because a request generally fits in one single packet. Large
    times here generally indicate network trouble between the client and
    haproxy. See &quot;Timers&quot; below for more details.

  - &quot;Tw&quot; is the total time in milliseconds spent waiting in the various queues.
    It can be &quot;-1&quot; if the connection was aborted before reaching the queue.
    See &quot;Timers&quot; below for more details.

  - &quot;Tc&quot; is the total time in milliseconds spent waiting for the connection to
    establish to the final server, including retries. It can be &quot;-1&quot; if the
    request was aborted before a connection could be established. See &quot;Timers&quot;
    below for more details.

  - &quot;Tr&quot; is the total time in milliseconds spent waiting for the server to send
    a full HTTP response, not counting data. It can be &quot;-1&quot; if the request was
    aborted before a complete response could be received. It generally matches
    the server's processing time for the request, though it may be altered by
    the amount of data sent by the client to the server. Large times here on
    &quot;GET&quot; requests generally indicate an overloaded server. See &quot;Timers&quot; below
    for more details.

  - &quot;Tt&quot; is the total time in milliseconds elapsed between the accept and the
    last close. It covers all possible processings. There is one exception, if
    &quot;<a href="#option%20logasap">option logasap</a>&quot; was specified, then the time counting stops at the moment
    the log is emitted. In this case, a '+' sign is prepended before the value,
    indicating that the final one will be larger. See &quot;Timers&quot; below for more
    details.

  - &quot;status_code&quot; is the HTTP status code returned to the client. This status
    is generally set by the server, but it might also be set by haproxy when
    the server cannot be reached or when its response is blocked by haproxy.

  - &quot;bytes_read&quot; is the total number of bytes transmitted to the client when
    the log is emitted. This does include HTTP headers. If &quot;<a href="#option%20logasap">option logasap</a>&quot; is
    specified, the this value will be prefixed with a '+' sign indicating that
    the final one may be larger. Please note that this value is a 64-bit
    counter, so log analysis tools must be able to handle it without
    overflowing.

  - &quot;captured_request_cookie&quot; is an optional &quot;name=value&quot; entry indicating that
    the client had this cookie in the request. The cookie name and its maximum
    length are defined by the &quot;<a href="#capture%20cookie">capture cookie</a>&quot; statement in the frontend
    configuration. The field is a single dash ('-') when the option is not
    set. Only one cookie may be captured, it is generally used to track session
    ID exchanges between a client and a server to detect session crossing
    between clients due to application bugs. For more details, please consult
    the section &quot;Capturing HTTP headers and cookies&quot; below.

  - &quot;captured_response_cookie&quot; is an optional &quot;name=value&quot; entry indicating
    that the server has returned a cookie with its response. The cookie name
    and its maximum length are defined by the &quot;<a href="#capture%20cookie">capture cookie</a>&quot; statement in the
    frontend configuration. The field is a single dash ('-') when the option is
    not set. Only one cookie may be captured, it is generally used to track
    session ID exchanges between a client and a server to detect session
    crossing between clients due to application bugs. For more details, please
    consult the section &quot;Capturing HTTP headers and cookies&quot; below.

  - &quot;termination_state&quot; is the condition the session was in when the session
    ended. This indicates the session state, which side caused the end of
    session to happen, for what reason (timeout, error, ...), just like in TCP
    logs, and information about persistence operations on cookies in the last
    two characters. The normal flags should begin with &quot;--&quot;, indicating the
    session was closed by either end with no data remaining in buffers. See
    below &quot;Session state at disconnection&quot; for more details.

  - &quot;actconn&quot; is the total number of concurrent connections on the process when
    the session was logged. It it useful to detect when some per-process system
    limits have been reached. For instance, if actconn is close to 512 or 1024
    when multiple connection errors occur, chances are high that the system
    limits the process to use a maximum of 1024 file descriptors and that all
    of them are used. See <a href="#3">section 3</a> &quot;Global parameters&quot; to find how to tune the
    system.

  - &quot;feconn&quot; is the total number of concurrent connections on the frontend when
    the session was logged. It is useful to estimate the amount of resource
    required to sustain high loads, and to detect when the frontend's &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#maxconn%20%28Proxies%29">Proxies</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;
    has been reached. Most often when this value increases by huge jumps, it is
    because there is congestion on the backend servers, but sometimes it can be
    caused by a denial of service attack.

  - &quot;beconn&quot; is the total number of concurrent connections handled by the
    backend when the session was logged. It includes the total number of
    concurrent connections active on servers as well as the number of
    connections pending in queues. It is useful to estimate the amount of
    additional servers needed to support high loads for a given application.
    Most often when this value increases by huge jumps, it is because there is
    congestion on the backend servers, but sometimes it can be caused by a
    denial of service attack.

  - &quot;srv_conn&quot; is the total number of concurrent connections still active on
    the server when the session was logged. It can never exceed the server's
    configured &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#maxconn%20%28Proxies%29">Proxies</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; parameter. If this value is very often close or equal
    to the server's &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#maxconn%20%28Proxies%29">Proxies</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;, it means that traffic regulation is involved a
    lot, meaning that either the server's maxconn value is too low, or that
    there aren't enough servers to process the load with an optimal response
    time. When only one of the server's &quot;srv_conn&quot; is high, it usually means
    that this server has some trouble causing the requests to take longer to be
    processed than on other servers.

  - &quot;<a href="#retries">retries</a>&quot; is the number of connection retries experienced by this session
    when trying to connect to the server. It must normally be zero, unless a
    server is being stopped at the same moment the connection was attempted.
    Frequent retries generally indicate either a network problem between
    haproxy and the server, or a misconfigured system backlog on the server
    preventing new connections from being queued. This field may optionally be
    prefixed with a '+' sign, indicating that the session has experienced a
    redispatch after the maximal retry count has been reached on the initial
    server. In this case, the server name appearing in the log is the one the
    connection was redispatched to, and not the first one, though both may
    sometimes be the same in case of hashing for instance. So as a general rule
    of thumb, when a '+' is present in front of the retry count, this count
    should not be attributed to the logged server.

  - &quot;srv_queue&quot; is the total number of requests which were processed before
    this one in the server queue. It is zero when the request has not gone
    through the server queue. It makes it possible to estimate the approximate
    server's response time by dividing the time spent in queue by the number of
    requests in the queue. It is worth noting that if a session experiences a
    redispatch and passes through two server queues, their positions will be
    cumulated. A request should not pass through both the server queue and the
    backend queue unless a redispatch occurs.

  - &quot;backend_queue&quot; is the total number of requests which were processed before
    this one in the backend's global queue. It is zero when the request has not
    gone through the global queue. It makes it possible to estimate the average
    queue length, which easily translates into a number of missing servers when
    divided by a server's &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#maxconn%20%28Proxies%29">Proxies</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; parameter. It is worth noting that if a
    session experiences a redispatch, it may pass twice in the backend's queue,
    and then both positions will be cumulated. A request should not pass
    through both the server queue and the backend queue unless a redispatch
    occurs.

  - &quot;captured_request_headers&quot; is a list of headers captured in the request due
    to the presence of the &quot;<a href="#capture%20request%20header">capture request header</a>&quot; statement in the frontend.
    Multiple headers can be captured, they will be delimited by a vertical bar
    ('|'). When no capture is enabled, the braces do not appear, causing a
    shift of remaining fields. It is important to note that this field may
    contain spaces, and that using it requires a smarter log parser than when
    it's not used. Please consult the section &quot;Capturing HTTP headers and
    cookies&quot; below for more details.

  - &quot;captured_response_headers&quot; is a list of headers captured in the response
    due to the presence of the &quot;<a href="#capture%20response%20header">capture response header</a>&quot; statement in the
    frontend. Multiple headers can be captured, they will be delimited by a
    vertical bar ('|'). When no capture is enabled, the braces do not appear,
    causing a shift of remaining fields. It is important to note that this
    field may contain spaces, and that using it requires a smarter log parser
    than when it's not used. Please consult the section &quot;Capturing HTTP headers
    and cookies&quot; below for more details.

  - &quot;http_request&quot; is the complete HTTP request line, including the method,
    request and HTTP version string. Non-printable characters are encoded (see
    below the section &quot;Non-printable characters&quot;). This is always the last
    field, and it is always delimited by quotes and is the only one which can
    contain quotes. If new fields are added to the log format, they will be
    added before this field. This field might be truncated if the request is
    huge and does not fit in the standard syslog buffer (1024 characters). This
    is the reason why this field must always remain the last one.</pre></div>
<a class="anchor" id="8.3" name="8.3"></a>
<h2 id="chapter-8.3" data-target="8.3"><small><a class="small" href="#8.3">8.3.</a></small> Advanced logging options</h2>
<div><pre class="text">Some advanced logging options are often looked for but are not easy to find out
just by looking at the various options. Here is an entry point for the few
options which can enable better logging. Please refer to the keywords reference
for more information about their usage.</pre></div>
<a class="anchor" id="8.3.1" name="8.3.1"></a>
<h3 id="chapter-8.3.1" data-target="8.3.1"><small><a class="small" href="#8.3.1">8.3.1.</a></small> Disabling logging of external tests</h3>
<div><pre class="text">It is quite common to have some monitoring tools perform health checks on
haproxy. Sometimes it will be a layer 3 load-balancer such as LVS or any
commercial load-balancer, and sometimes it will simply be a more complete
monitoring system such as Nagios. When the tests are very frequent, users often
ask how to disable logging for those checks. There are three possibilities :

  - if connections come from everywhere and are just TCP probes, it is often
    desired to simply disable logging of connections without data exchange, by
    setting &quot;<a href="#option%20dontlognull">option dontlognull</a>&quot; in the frontend. It also disables logging of
    port scans, which may or may not be desired.

  - if the connection come from a known source network, use &quot;<a href="#monitor-net">monitor-net</a>&quot; to
    declare this network as monitoring only. Any host in this network will then
    only be able to perform health checks, and their requests will not be
    logged. This is generally appropriate to designate a list of equipments
    such as other load-balancers.

  - if the tests are performed on a known URI, use &quot;<a href="#monitor-uri">monitor-uri</a>&quot; to declare
    this URI as dedicated to monitoring. Any host sending this request will
    only get the result of a health-check, and the request will not be logged.</pre></div>
<a class="anchor" id="8.3.2" name="8.3.2"></a>
<h3 id="chapter-8.3.2" data-target="8.3.2"><small><a class="small" href="#8.3.2">8.3.2.</a></small> Logging before waiting for the session to terminate</h3>
<div><pre class="text">The problem with logging at end of connection is that you have no clue about
what is happening during very long sessions, such as remote terminal sessions
or large file downloads. This problem can be worked around by specifying
&quot;<a href="#option%20logasap">option logasap</a>&quot; in the frontend. Haproxy will then log as soon as possible,
just before data transfer begins. This means that in case of TCP, it will still
log the connection status to the server, and in case of HTTP, it will log just
after processing the server headers. In this case, the number of bytes reported
is the number of header bytes sent to the client. In order to avoid confusion
with normal logs, the total time field and the number of bytes are prefixed
with a '+' sign which means that real numbers are certainly larger.</pre></div>
<a class="anchor" id="8.3.3" name="8.3.3"></a>
<h3 id="chapter-8.3.3" data-target="8.3.3"><small><a class="small" href="#8.3.3">8.3.3.</a></small> Raising log level upon errors</h3>
<div><pre class="text">Sometimes it is more convenient to separate normal traffic from errors logs,
for instance in order to ease error monitoring from log files. When the option
&quot;<a href="#option%20log-separate-errors">log-separate-errors</a>&quot; is used, connections which experience errors, timeouts,
retries, redispatches or HTTP status codes 5xx will see their syslog level
raised from &quot;info&quot; to &quot;err&quot;. This will help a syslog daemon store the log in
a separate file. It is very important to keep the errors in the normal traffic
file too, so that log ordering is not altered. You should also be careful if
you already have configured your syslog daemon to store all logs higher than
&quot;notice&quot; in an &quot;admin&quot; file, because the &quot;err&quot; level is higher than &quot;notice&quot;.</pre></div>
<a class="anchor" id="8.3.4" name="8.3.4"></a>
<h3 id="chapter-8.3.4" data-target="8.3.4"><small><a class="small" href="#8.3.4">8.3.4.</a></small> Disabling logging of successful connections</h3>
<div><pre class="text">Although this may sound strange at first, some large sites have to deal with
multiple thousands of logs per second and are experiencing difficulties keeping
them intact for a long time or detecting errors within them. If the option
&quot;<a href="#option%20dontlog-normal">dontlog-normal</a>&quot; is set on the frontend, all normal connections will not be
logged. In this regard, a normal connection is defined as one without any
error, timeout, retry nor redispatch. In HTTP, the status code is checked too,
and a response with a status 5xx is not considered normal and will be logged
too. Of course, doing is is really discouraged as it will remove most of the
useful information from the logs. Do this only if you have no other
alternative.</pre></div>
<a class="anchor" id="8.4" name="8.4"></a>
<h2 id="chapter-8.4" data-target="8.4"><small><a class="small" href="#8.4">8.4.</a></small> Timing events</h2>
<div><pre class="text">Timers provide a great help in troubleshooting network problems. All values are
reported in milliseconds (ms). These timers should be used in conjunction with
the session termination flags. In TCP mode with &quot;<a href="#option%20tcplog">option tcplog</a>&quot; set on the
frontend, 3 control points are reported under the form &quot;Tw/Tc/Tt&quot;, and in HTTP
mode, 5 control points are reported under the form &quot;Tq/Tw/Tc/Tr/Tt&quot; :

  - Tq: total time to get the client request (HTTP mode only). It's the time
    elapsed between the moment the client connection was accepted and the
    moment the proxy received the last HTTP header. The value &quot;-1&quot; indicates
    that the end of headers (empty line) has never been seen. This happens when
    the client closes prematurely or times out.

  - Tw: total time spent in the queues waiting for a connection slot. It
    accounts for backend queue as well as the server queues, and depends on the
    queue size, and the time needed for the server to complete previous
    requests. The value &quot;-1&quot; means that the request was killed before reaching
    the queue, which is generally what happens with invalid or denied requests.

  - Tc: total time to establish the TCP connection to the server. It's the time
    elapsed between the moment the proxy sent the connection request, and the
    moment it was acknowledged by the server, or between the TCP SYN packet and
    the matching SYN/ACK packet in return. The value &quot;-1&quot; means that the
    connection never established.

  - Tr: server response time (HTTP mode only). It's the time elapsed between
    the moment the TCP connection was established to the server and the moment
    the server sent its complete response headers. It purely shows its request
    processing time, without the network overhead due to the data transmission.
    It is worth noting that when the client has data to send to the server, for
    instance during a POST request, the time already runs, and this can distort
    apparent response time. For this reason, it's generally wise not to trust
    too much this field for POST requests initiated from clients behind an
    untrusted network. A value of &quot;-1&quot; here means that the last the response
    header (empty line) was never seen, most likely because the server timeout
    stroke before the server managed to process the request.

  - Tt: total session duration time, between the moment the proxy accepted it
    and the moment both ends were closed. The exception is when the &quot;<a href="#option%20logasap">logasap</a>&quot;
    option is specified. In this case, it only equals (Tq+Tw+Tc+Tr), and is
    prefixed with a '+' sign. From this field, we can deduce &quot;Td&quot;, the data
    transmission time, by substracting other timers when valid :

        Td = Tt - (Tq + Tw + Tc + Tr)

    Timers with &quot;-1&quot; values have to be excluded from this equation. In TCP
    mode, &quot;Tq&quot; and &quot;Tr&quot; have to be excluded too. Note that &quot;Tt&quot; can never be
    negative.

These timers provide precious indications on trouble causes. Since the TCP
protocol defines retransmit delays of 3, 6, 12... seconds, we know for sure
that timers close to multiples of 3s are nearly always related to lost packets
due to network problems (wires, negotiation, congestion). Moreover, if &quot;Tt&quot; is
close to a timeout value specified in the configuration, it often means that a
session has been aborted on timeout.

Most common cases :

  - If &quot;Tq&quot; is close to 3000, a packet has probably been lost between the
    client and the proxy. This is very rare on local networks but might happen
    when clients are on far remote networks and send large requests. It may
    happen that values larger than usual appear here without any network cause.
    Sometimes, during an attack or just after a resource starvation has ended,
    haproxy may accept thousands of connections in a few milliseconds. The time
    spent accepting these connections will inevitably slightly delay processing
    of other connections, and it can happen that request times in the order of
    a few tens of milliseconds are measured after a few thousands of new
    connections have been accepted at once. Setting &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot;
    may display larger request times since &quot;Tq&quot; also measures the time spent
    waiting for additional requests.

  - If &quot;Tc&quot; is close to 3000, a packet has probably been lost between the
    server and the proxy during the server connection phase. This value should
    always be very low, such as 1 ms on local networks and less than a few tens
    of ms on remote networks.

  - If &quot;Tr&quot; is nearly always lower than 3000 except some rare values which seem
    to be the average majored by 3000, there are probably some packets lost
    between the proxy and the server.

  - If &quot;Tt&quot; is large even for small byte counts, it generally is because
    neither the client nor the server decides to close the connection, for
    instance because both have agreed on a keep-alive connection mode. In order
    to solve this issue, it will be needed to specify &quot;<a href="#option%20httpclose">option httpclose</a>&quot; on
    either the frontend or the backend. If the problem persists, it means that
    the server ignores the &quot;close&quot; connection mode and expects the client to
    close. Then it will be required to use &quot;<a href="#option%20forceclose">option forceclose</a>&quot;. Having the
    smallest possible 'Tt' is important when connection regulation is used with
    the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#maxconn%20%28Proxies%29">Proxies</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; option on the servers, since no new connection will be sent
    to the server until another one is released.

Other noticeable HTTP log cases ('xx' means any value to be ignored) :

  Tq/Tw/Tc/Tr/+Tt  The &quot;<a href="#option%20logasap">option logasap</a>&quot; is present on the frontend and the log
                   was emitted before the data phase. All the timers are valid
                   except &quot;Tt&quot; which is shorter than reality.

  -1/xx/xx/xx/Tt   The client was not able to send a complete request in time
                   or it aborted too early. Check the session termination flags
                   then &quot;<a href="#timeout%20http-request">timeout http-request</a>&quot; and &quot;<a href="#timeout%20client">timeout client</a>&quot; settings.

  Tq/-1/xx/xx/Tt   It was not possible to process the request, maybe because
                   servers were out of order, because the request was invalid
                   or forbidden by ACL rules. Check the session termination
                   flags.

  Tq/Tw/-1/xx/Tt   The connection could not establish on the server. Either it
                   actively refused it or it timed out after Tt-(Tq+Tw) ms.
                   Check the session termination flags, then check the
                   &quot;<a href="#timeout%20connect">timeout connect</a>&quot; setting. Note that the tarpit action might
                   return similar-looking patterns, with &quot;Tw&quot; equal to the time
                   the client connection was maintained open.

  Tq/Tw/Tc/-1/Tt   The server has accepted the connection but did not return
                   a complete response in time, or it closed its connexion
                   unexpectedly after Tt-(Tq+Tw+Tc) ms. Check the session
                   termination flags, then check the &quot;<a href="#timeout%20server">timeout server</a>&quot; setting.</pre></div>
<a class="anchor" id="8.5" name="8.5"></a>
<h2 id="chapter-8.5" data-target="8.5"><small><a class="small" href="#8.5">8.5.</a></small> Session state at disconnection</h2>
<div><pre class="text">TCP and HTTP logs provide a session termination indicator in the
&quot;termination_state&quot; field, just before the number of active connections. It is
2-characters long in TCP mode, and is extended to 4 characters in HTTP mode,
each of which has a special meaning :

  - On the first character, a code reporting the first event which caused the
    session to terminate :

        C : the TCP session was unexpectedly aborted by the client.

        S : the TCP session was unexpectedly aborted by the server, or the
            server explicitly refused it.

        P : the session was prematurely aborted by the proxy, because of a
            connection limit enforcement, because a DENY filter was matched,
            because of a security check which detected and blocked a dangerous
            error in server response which might have caused information leak
            (eg: cacheable cookie), or because the response was processed by
            the proxy (redirect, stats, etc...).

        R : a resource on the proxy has been exhausted (memory, sockets, source
            ports, ...). Usually, this appears during the connection phase, and
            system logs should contain a copy of the precise error. If this
            happens, it must be considered as a very serious anomaly which
            should be fixed as soon as possible by any means.

        I : an internal error was identified by the proxy during a self-check.
            This should NEVER happen, and you are encouraged to report any log
            containing this, because this would almost certainly be a bug. It
            would be wise to preventively restart the process after such an
            event too, in case it would be caused by memory corruption.

        c : the client-side timeout expired while waiting for the client to
            send or receive data.

        s : the server-side timeout expired while waiting for the server to
            send or receive data.

        - : normal session completion, both the client and the server closed
            with nothing left in the buffers.

  - on the second character, the TCP or HTTP session state when it was closed :

        R : the proxy was waiting for a complete, valid REQUEST from the client
            (HTTP mode only). Nothing was sent to any server.

        Q : the proxy was waiting in the QUEUE for a connection slot. This can
            only happen when servers have a 'maxconn' parameter set. It can
            also happen in the global queue after a redispatch consecutive to
            a failed attempt to connect to a dying server. If no redispatch is
            reported, then no connection attempt was made to any server.

        C : the proxy was waiting for the CONNECTION to establish on the
            server. The server might at most have noticed a connection attempt.

        H : the proxy was waiting for complete, valid response HEADERS from the
            server (HTTP only).

        D : the session was in the DATA phase.

        L : the proxy was still transmitting LAST data to the client while the
            server had already finished. This one is very rare as it can only
            happen when the client dies while receiving the last packets.

        T : the request was tarpitted. It has been held open with the client
            during the whole &quot;<a href="#timeout%20tarpit">timeout tarpit</a>&quot; duration or until the client
            closed, both of which will be reported in the &quot;Tw&quot; timer.

        - : normal session completion after end of data transfer.

  - the third character tells whether the persistence cookie was provided by
    the client (only in HTTP mode) :

        N : the client provided NO cookie. This is usually the case for new
            visitors, so counting the number of occurrences of this flag in the
            logs generally indicate a valid trend for the site frequentation.

        I : the client provided an INVALID cookie matching no known server.
            This might be caused by a recent configuration change, mixed
            cookies between HTTP/HTTPS sites, persistence conditionally
            ignored, or an attack.

        D : the client provided a cookie designating a server which was DOWN,
            so either &quot;<a href="#option%20persist">option persist</a>&quot; was used and the client was sent to
            this server, or it was not set and the client was redispatched to
            another server.

        V : the client provided a VALID cookie, and was sent to the associated
            server.

        E : the client provided a valid cookie, but with a last date which was
            older than what is allowed by the &quot;maxidle&quot; cookie parameter, so
            the cookie is consider EXPIRED and is ignored. The request will be
            redispatched just as if there was no cookie.

        O : the client provided a valid cookie, but with a first date which was
            older than what is allowed by the &quot;maxlife&quot; cookie parameter, so
            the cookie is consider too OLD and is ignored. The request will be
            redispatched just as if there was no cookie.

        - : does not apply (no cookie set in configuration).

  - the last character reports what operations were performed on the persistence
    cookie returned by the server (only in HTTP mode) :

        N : NO cookie was provided by the server, and none was inserted either.

        I : no cookie was provided by the server, and the proxy INSERTED one.
            Note that in &quot;cookie insert&quot; mode, if the server provides a cookie,
            it will still be overwritten and reported as &quot;I&quot; here.

        U : the proxy UPDATED the last date in the cookie that was presented by
            the client. This can only happen in insert mode with &quot;maxidle&quot;. It
            happens everytime there is activity at a different date than the
            date indicated in the cookie. If any other change happens, such as
            a redispatch, then the cookie will be marked as inserted instead.

        P : a cookie was PROVIDED by the server and transmitted as-is.

        R : the cookie provided by the server was REWRITTEN by the proxy, which
            happens in &quot;cookie rewrite&quot; or &quot;cookie prefix&quot; modes.

        D : the cookie provided by the server was DELETED by the proxy.

        - : does not apply (no cookie set in configuration).

The combination of the two first flags gives a lot of information about what
was happening when the session terminated, and why it did terminate. It can be
helpful to detect server saturation, network troubles, local system resource
starvation, attacks, etc...

The most common termination flags combinations are indicated below. They are
alphabetically sorted, with the lowercase set just after the upper case for
easier finding and understanding.

  Flags   Reason

     --   Normal termination.

     CC   The client aborted before the connection could be established to the
          server. This can happen when haproxy tries to connect to a recently
          dead (or unchecked) server, and the client aborts while haproxy is
          waiting for the server to respond or for &quot;<a href="#timeout%20connect">timeout connect</a>&quot; to expire.

     CD   The client unexpectedly aborted during data transfer. This can be
          caused by a browser crash, by an intermediate equipment between the
          client and haproxy which decided to actively break the connection,
          by network routing issues between the client and haproxy, or by a
          keep-alive session between the server and the client terminated first
          by the client.

     cD   The client did not send nor acknowledge any data for as long as the
          &quot;<a href="#timeout%20client">timeout client</a>&quot; delay. This is often caused by network failures on
          the client side, or the client simply leaving the net uncleanly.

     CH   The client aborted while waiting for the server to start responding.
          It might be the server taking too long to respond or the client
          clicking the 'Stop' button too fast.

     cH   The &quot;<a href="#timeout%20client">timeout client</a>&quot; stroke while waiting for client data during a
          POST request. This is sometimes caused by too large TCP MSS values
          for PPPoE networks which cannot transport full-sized packets. It can
          also happen when client timeout is smaller than server timeout and
          the server takes too long to respond.

     CQ   The client aborted while its session was queued, waiting for a server
          with enough empty slots to accept it. It might be that either all the
          servers were saturated or that the assigned server was taking too
          long a time to respond.

     CR   The client aborted before sending a full HTTP request. Most likely
          the request was typed by hand using a telnet client, and aborted
          too early. The HTTP status code is likely a 400 here. Sometimes this
          might also be caused by an IDS killing the connection between haproxy
          and the client.

     cR   The &quot;<a href="#timeout%20http-request">timeout http-request</a>&quot; stroke before the client sent a full HTTP
          request. This is sometimes caused by too large TCP MSS values on the
          client side for PPPoE networks which cannot transport full-sized
          packets, or by clients sending requests by hand and not typing fast
          enough, or forgetting to enter the empty line at the end of the
          request. The HTTP status code is likely a 408 here.

     CT   The client aborted while its session was tarpitted. It is important to
          check if this happens on valid requests, in order to be sure that no
          wrong tarpit rules have been written. If a lot of them happen, it
          might make sense to lower the &quot;<a href="#timeout%20tarpit">timeout tarpit</a>&quot; value to something
          closer to the average reported &quot;Tw&quot; timer, in order not to consume
          resources for just a few attackers.

     SC   The server or an equipment between it and haproxy explicitly refused
          the TCP connection (the proxy received a TCP RST or an ICMP message
          in return). Under some circumstances, it can also be the network
          stack telling the proxy that the server is unreachable (eg: no route,
          or no ARP response on local network). When this happens in HTTP mode,
          the status code is likely a 502 or 503 here.

     sC   The &quot;<a href="#timeout%20connect">timeout connect</a>&quot; stroke before a connection to the server could
          complete. When this happens in HTTP mode, the status code is likely a
          503 or 504 here.

     SD   The connection to the server died with an error during the data
          transfer. This usually means that haproxy has received an RST from
          the server or an ICMP message from an intermediate equipment while
          exchanging data with the server. This can be caused by a server crash
          or by a network issue on an intermediate equipment.

     sD   The server did not send nor acknowledge any data for as long as the
          &quot;<a href="#timeout%20server">timeout server</a>&quot; setting during the data phase. This is often caused
          by too short timeouts on L4 equipments before the server (firewalls,
          load-balancers, ...), as well as keep-alive sessions maintained
          between the client and the server expiring first on haproxy.

     SH   The server aborted before sending its full HTTP response headers, or
          it crashed while processing the request. Since a server aborting at
          this moment is very rare, it would be wise to inspect its logs to
          control whether it crashed and why. The logged request may indicate a
          small set of faulty requests, demonstrating bugs in the application.
          Sometimes this might also be caused by an IDS killing the connection
          between haproxy and the server.

     sH   The &quot;<a href="#timeout%20server">timeout server</a>&quot; stroke before the server could return its
          response headers. This is the most common anomaly, indicating too
          long transactions, probably caused by server or database saturation.
          The immediate workaround consists in increasing the &quot;<a href="#timeout%20server">timeout server</a>&quot;
          setting, but it is important to keep in mind that the user experience
          will suffer from these long response times. The only long term
          solution is to fix the application.

     sQ   The session spent too much time in queue and has been expired. See
          the &quot;<a href="#timeout%20queue">timeout queue</a>&quot; and &quot;<a href="#timeout%20connect">timeout connect</a>&quot; settings to find out how to
          fix this if it happens too often. If it often happens massively in
          short periods, it may indicate general problems on the affected
          servers due to I/O or database congestion, or saturation caused by
          external attacks.

     PC   The proxy refused to establish a connection to the server because the
          process' socket limit has been reached while attempting to connect.
          The global &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="nav-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Global%20parameters%29">Global parameters</a></li><li><a href="#maxconn%20%28Proxies%29">Proxies</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; parameter may be increased in the configuration
          so that it does not happen anymore. This status is very rare and
          might happen when the global &quot;<a href="#ulimit-n">ulimit-n</a>&quot; parameter is forced by hand.

     PD   The proxy blocked an incorrectly formatted chunked encoded message in
          a request or a response, after the server has emitted its headers. In
          most cases, this will indicate an invalid message from the server to
          the client.

     PH   The proxy blocked the server's response, because it was invalid,
          incomplete, dangerous (cache control), or matched a security filter.
          In any case, an HTTP 502 error is sent to the client. One possible
          cause for this error is an invalid syntax in an HTTP header name
          containing unauthorized characters. It is also possible but quite
          rare, that the proxy blocked a chunked-encoding request from the
          client due to an invalid syntax, before the server responded. In this
          case, an HTTP 400 error is sent to the client and reported in the
          logs.

     PR   The proxy blocked the client's HTTP request, either because of an
          invalid HTTP syntax, in which case it returned an HTTP 400 error to
          the client, or because a deny filter matched, in which case it
          returned an HTTP 403 error.

     PT   The proxy blocked the client's request and has tarpitted its
          connection before returning it a 500 server error. Nothing was sent
          to the server. The connection was maintained open for as long as
          reported by the &quot;Tw&quot; timer field.

     RC   A local resource has been exhausted (memory, sockets, source ports)
          preventing the connection to the server from establishing. The error
          logs will tell precisely what was missing. This is very rare and can
          only be solved by proper system tuning.

The combination of the two last flags gives a lot of information about how
persistence was handled by the client, the server and by haproxy. This is very
important to troubleshoot disconnections, when users complain they have to
re-authenticate. The commonly encountered flags are :

     --   Persistence cookie is not enabled.

     NN   No cookie was provided by the client, none was inserted in the
          response. For instance, this can be in insert mode with &quot;postonly&quot;
          set on a GET request.

     II   A cookie designating an invalid server was provided by the client,
          a valid one was inserted in the response. This typically happens when
          a &quot;<a href="#server">server</a>&quot; entry is removed from the configuraton, since its cookie
          value can be presented by a client when no other server knows it.

     NI   No cookie was provided by the client, one was inserted in the
          response. This typically happens for first requests from every user
          in &quot;insert&quot; mode, which makes it an easy way to count real users.

     VN   A cookie was provided by the client, none was inserted in the
          response. This happens for most responses for which the client has
          already got a cookie.

     VU   A cookie was provided by the client, with a last visit date which is
          not completely up-to-date, so an updated cookie was provided in
          response. This can also happen if there was no date at all, or if
          there was a date but the &quot;maxidle&quot; parameter was not set, so that the
          cookie can be switched to unlimited time.

     EI   A cookie was provided by the client, with a last visit date which is
          too old for the &quot;maxidle&quot; parameter, so the cookie was ignored and a
          new cookie was inserted in the response.

     OI   A cookie was provided by the client, with a first visit date which is
          too old for the &quot;maxlife&quot; parameter, so the cookie was ignored and a
          new cookie was inserted in the response.

     DI   The server designated by the cookie was down, a new server was
          selected and a new cookie was emitted in the response.

     VI   The server designated by the cookie was not marked dead but could not
          be reached. A redispatch happened and selected another one, which was
          then advertised in the response.</pre></div>
<a class="anchor" id="8.6" name="8.6"></a>
<h2 id="chapter-8.6" data-target="8.6"><small><a class="small" href="#8.6">8.6.</a></small> Non-printable characters</h2>
<div><pre class="text">In order not to cause trouble to log analysis tools or terminals during log
consulting, non-printable characters are not sent as-is into log files, but are
converted to the two-digits hexadecimal representation of their ASCII code,
prefixed by the character '#'. The only characters that can be logged without
being escaped are comprised between 32 and 126 (inclusive). Obviously, the
escape character '#' itself is also encoded to avoid any ambiguity (&quot;#23&quot;). It
is the same for the character '&quot;' which becomes &quot;#22&quot;, as well as '{', '|' and
'}' when logging headers.

Note that the space character (' ') is not encoded in headers, which can cause
issues for tools relying on space count to locate fields. A typical header
containing spaces is &quot;User-Agent&quot;.

Last, it has been observed that some syslog daemons such as syslog-ng escape
the quote ('&quot;') with a backslash ('\'). The reverse operation can safely be
performed since no quote may appear anywhere else in the logs.</pre></div>
<a class="anchor" id="8.7" name="8.7"></a>
<h2 id="chapter-8.7" data-target="8.7"><small><a class="small" href="#8.7">8.7.</a></small> Capturing HTTP cookies</h2>
<div><pre class="text">Cookie capture simplifies the tracking a complete user session. This can be
achieved using the &quot;<a href="#capture%20cookie">capture cookie</a>&quot; statement in the frontend. Please refer to
<a href="#4.2">section 4.2</a> for more details. Only one cookie can be captured, and the same
cookie will simultaneously be checked in the request (&quot;Cookie:&quot; header) and in
the response (&quot;Set-Cookie:&quot; header). The respective values will be reported in
the HTTP logs at the &quot;captured_request_cookie&quot; and &quot;captured_response_cookie&quot;
locations (see <a href="#8.2.3">section 8.2.3</a> about HTTP log format). When either cookie is
not seen, a dash ('-') replaces the value. This way, it's easy to detect when a
user switches to a new session for example, because the server will reassign it
a new cookie. It is also possible to detect if a server unexpectedly sets a
wrong cookie to a client, leading to session crossing.</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code><span class="comment"># capture the first cookie whose name starts with &quot;ASPSESSION&quot;</span>
capture cookie ASPSESSION len 32

<span class="comment"># capture the first cookie whose name is exactly &quot;vgnvisitor&quot;</span>
capture cookie vgnvisitor= len 32
</code></pre>
</div></div>
<a class="anchor" id="8.8" name="8.8"></a>
<h2 id="chapter-8.8" data-target="8.8"><small><a class="small" href="#8.8">8.8.</a></small> Capturing HTTP headers</h2>
<div><pre class="text">Header captures are useful to track unique request identifiers set by an upper
proxy, virtual host names, user-agents, POST content-length, referrers, etc. In
the response, one can search for information about the response length, how the
server asked the cache to behave, or an object location during a redirection.

Header captures are performed using the &quot;<a href="#capture%20request%20header">capture request header</a>&quot; and &quot;capture
response header&quot; statements in the frontend. Please consult their definition in
<a href="#4.2">section 4.2</a> for more details.

It is possible to include both request headers and response headers at the same
time. Non-existent headers are logged as empty strings, and if one header
appears more than once, only its last occurrence will be logged. Request headers
are grouped within braces '{' and '}' in the same order as they were declared,
and delimited with a vertical bar '|' without any space. Response headers
follow the same representation, but are displayed after a space following the
request headers block. These blocks are displayed just before the HTTP request
in the logs.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>    <span class="comment"># This instance chains to the outgoing proxy</span>
    listen proxy-out
        mode http
        option httplog
        option logasap
        log global
        server cache1 192.168.1.1:3128

        <span class="comment"># log the name of the virtual server</span>
        capture request  header Host len 20

        <span class="comment"># log the amount of data uploaded during a POST</span>
        capture request  header Content-Length len 10

        <span class="comment"># log the beginning of the referrer</span>
        capture request  header Referer len 20

        <span class="comment"># server name (useful for outgoing proxies only)</span>
        capture response header Server len 20

        <span class="comment"># logging the content-length is useful with &quot;<a href="#option%20logasap">option logasap</a>&quot;</span>
        capture response header Content-Length len 10

        <span class="comment"># log the expected cache behaviour on the response</span>
        capture response header Cache-Control len 8

        <span class="comment"># the Via header will report the next proxy's name</span>
        capture response header Via len 20

        <span class="comment"># log the URL location during a redirection</span>
        capture response header Location len 20

&gt;&gt;&gt; Aug  9 20:26:09 localhost \
      haproxy[2022]: 127.0.0.1:34014 [09/Aug/2004:20:26:09] proxy-out \
      proxy-out/cache1 0/0/0/162/+162 200 +350 - - ---- 0/0/0/0/0 0/0 \
      {fr.adserver.yahoo.co||http://fr.f416.mail.} {|864|private||} \
      &quot;GET http://fr.adserver.yahoo.com/&quot;

&gt;&gt;&gt; Aug  9 20:30:46 localhost \
      haproxy[2022]: 127.0.0.1:34020 [09/Aug/2004:20:30:46] proxy-out \
      proxy-out/cache1 0/0/0/182/+182 200 +279 - - ---- 0/0/0/0/0 0/0 \
      {w.ods.org||} {Formilux/0.1.8|3495|||} \
      &quot;GET http://trafic.1wt.eu/ HTTP/1.1&quot;

&gt;&gt;&gt; Aug  9 20:30:46 localhost \
      haproxy[2022]: 127.0.0.1:34028 [09/Aug/2004:20:30:46] proxy-out \
      proxy-out/cache1 0/0/2/126/+128 301 +223 - - ---- 0/0/0/0/0 0/0 \
      {www.sytadin.equipement.gouv.fr||http://trafic.1wt.eu/} \
      {Apache|230|||http://www.sytadin.} \
      &quot;GET http://www.sytadin.equipement.gouv.fr/ HTTP/1.1&quot;
</code></pre>
</div></div>
<a class="anchor" id="8.9" name="8.9"></a>
<h2 id="chapter-8.9" data-target="8.9"><small><a class="small" href="#8.9">8.9.</a></small> Examples of logs</h2>
<div><pre class="text">These are real-world examples of logs accompanied with an explanation. Some of
them have been made up by hand. The syslog part has been removed for better
reading. Their sole purpose is to explain how to decipher them.

    &gt;&gt;&gt; haproxy[674]: 127.0.0.1:33318 [15/Oct/2003:08:31:57.130] px-http \
          px-http/srv1 6559/0/7/147/6723 200 243 - - ---- 5/3/3/1/0 0/0 \
          &quot;HEAD / HTTP/1.0&quot;

    =&gt; long request (6.5s) entered by hand through 'telnet'. The server replied
       in 147 ms, and the session ended normally ('----')

    &gt;&gt;&gt; haproxy[674]: 127.0.0.1:33319 [15/Oct/2003:08:31:57.149] px-http \
          px-http/srv1 6559/1230/7/147/6870 200 243 - - ---- 324/239/239/99/0 \
          0/9 &quot;HEAD / HTTP/1.0&quot;

    =&gt; Idem, but the request was queued in the global queue behind 9 other
       requests, and waited there for 1230 ms.

    &gt;&gt;&gt; haproxy[674]: 127.0.0.1:33320 [15/Oct/2003:08:32:17.654] px-http \
          px-http/srv1 9/0/7/14/+30 200 +243 - - ---- 3/3/3/1/0 0/0 \
          &quot;GET /image.iso HTTP/1.0&quot;

    =&gt; request for a long data transfer. The &quot;<a href="#option%20logasap">logasap</a>&quot; option was specified, so
       the log was produced just before transferring data. The server replied in
       14 ms, 243 bytes of headers were sent to the client, and total time from
       accept to first data byte is 30 ms.

    &gt;&gt;&gt; haproxy[674]: 127.0.0.1:33320 [15/Oct/2003:08:32:17.925] px-http \
          px-http/srv1 9/0/7/14/30 502 243 - - PH-- 3/2/2/0/0 0/0 \
          &quot;GET /cgi-bin/bug.cgi? HTTP/1.0&quot;

    =&gt; the proxy blocked a server response either because of an &quot;<a href="#rspdeny">rspdeny</a>&quot; or
       &quot;<a href="#rspideny">rspideny</a>&quot; filter, or because the response was improperly formatted and
       not HTTP-compliant, or because it blocked sensitive information which
       risked being cached. In this case, the response is replaced with a &quot;502
       bad gateway&quot;. The flags (&quot;PH--&quot;) tell us that it was haproxy who decided
       to return the 502 and not the server.

    &gt;&gt;&gt; haproxy[18113]: 127.0.0.1:34548 [15/Oct/2003:15:18:55.798] px-http \
          px-http/&lt;NOSRV&gt; -1/-1/-1/-1/8490 -1 0 - - CR-- 2/2/2/0/0 0/0 &quot;&quot;

    =&gt; the client never completed its request and aborted itself (&quot;C---&quot;) after
       8.5s, while the proxy was waiting for the request headers (&quot;-R--&quot;).
       Nothing was sent to any server.

    &gt;&gt;&gt; haproxy[18113]: 127.0.0.1:34549 [15/Oct/2003:15:19:06.103] px-http \
         px-http/&lt;NOSRV&gt; -1/-1/-1/-1/50001 408 0 - - cR-- 2/2/2/0/0 0/0 &quot;&quot;

    =&gt; The client never completed its request, which was aborted by the
       time-out (&quot;c---&quot;) after 50s, while the proxy was waiting for the request
       headers (&quot;-R--&quot;).  Nothing was sent to any server, but the proxy could
       send a 408 return code to the client.

    &gt;&gt;&gt; haproxy[18989]: 127.0.0.1:34550 [15/Oct/2003:15:24:28.312] px-tcp \
          px-tcp/srv1 0/0/5007 0 cD 0/0/0/0/0 0/0

    =&gt; This log was produced with &quot;<a href="#option%20tcplog">option tcplog</a>&quot;. The client timed out after
       5 seconds (&quot;c----&quot;).

    &gt;&gt;&gt; haproxy[18989]: 10.0.0.1:34552 [15/Oct/2003:15:26:31.462] px-http \
          px-http/srv1 3183/-1/-1/-1/11215 503 0 - - SC-- 205/202/202/115/3 \
          0/0 &quot;HEAD / HTTP/1.0&quot;

    =&gt; The request took 3s to complete (probably a network problem), and the
       connection to the server failed ('SC--') after 4 attempts of 2 seconds
       (config says 'retries 3'), and no redispatch (otherwise we would have
       seen &quot;/+3&quot;). Status code 503 was returned to the client. There were 115
       connections on this server, 202 connections on this proxy, and 205 on
       the global process. It is possible that the server refused the
       connection because of too many already established.</pre></div>
<a class="anchor" id="9" name="9"></a>
<div class="page-header"><h1 id="chapter-9" data-target="9"><small><a class="small" href="#9">9.</a></small> Statistics and monitoring</h1>
</div><div><pre class="text">It is possible to query HAProxy about its status. The most commonly used
mechanism is the HTTP statistics page. This page also exposes an alternative
CSV output format for monitoring tools. The same format is provided on the
Unix socket.</pre></div>
<a class="anchor" id="9.1" name="9.1"></a>
<h2 id="chapter-9.1" data-target="9.1"><small><a class="small" href="#9.1">9.1.</a></small> CSV format</h2>
<div><pre class="text">The statistics may be consulted either from the unix socket or from the HTTP
page. Both means provide a CSV format whose fields follow.

  0. pxname: proxy name
  1. svname: service name (FRONTEND for frontend, BACKEND for backend, any name
    for server)
  2. qcur: current queued requests
  3. qmax: max queued requests
  4. scur: current sessions
  5. smax: max sessions
  6. slim: sessions limit
  7. stot: total sessions
  8. bin: bytes in
  9. bout: bytes out
 10. dreq: denied requests
 11. dresp: denied responses
 12. ereq: request errors
 13. econ: connection errors
 14. eresp: response errors (among which srv_abrt)
 15. wretr: retries (warning)
 16. wredis: redispatches (warning)
 17. status: status (UP/DOWN/NOLB/MAINT/MAINT(via)...)
 18. weight: server weight (server), total weight (backend)
 19. act: server is active (server), number of active servers (backend)
 20. bck: server is backup (server), number of backup servers (backend)
 21. chkfail: number of failed checks
 22. chkdown: number of UP-&gt;DOWN transitions
 23. lastchg: last status change (in seconds)
 24. downtime: total downtime (in seconds)
 25. qlimit: queue limit
 26. pid: process id (0 for first instance, 1 for second, ...)
 27. iid: unique proxy id
 28. sid: service id (unique inside a proxy)
 29. throttle: warm up status
 30. lbtot: total number of times a server was selected
 31. tracked: id of proxy/server if tracking is enabled
 32. type (0=frontend, 1=backend, 2=server, 3=socket)
 33. rate: number of sessions per second over last elapsed second
 34. rate_lim: limit on new sessions per second
 35. rate_max: max number of new sessions per second
 36. check_status: status of last health check, one of:
        UNK     -&gt; unknown
        INI     -&gt; initializing
        SOCKERR -&gt; socket error
        L4OK    -&gt; check passed on layer 4, no upper layers testing enabled
        L4TMOUT -&gt; layer 1-4 timeout
        L4CON   -&gt; layer 1-4 connection problem, for example
                   &quot;Connection refused&quot; (tcp rst) or &quot;No route to host&quot; (icmp)
        L6OK    -&gt; check passed on layer 6
        L6TOUT  -&gt; layer 6 (SSL) timeout
        L6RSP   -&gt; layer 6 invalid response - protocol error
        L7OK    -&gt; check passed on layer 7
        L7OKC   -&gt; check conditionally passed on layer 7, for example 404 with
                   disable-on-404
        L7TOUT  -&gt; layer 7 (HTTP/SMTP) timeout
        L7RSP   -&gt; layer 7 invalid response - protocol error
        L7STS   -&gt; layer 7 response error, for example HTTP 5xx
 37. check_code: layer5-7 code, if available
 38. check_duration: time in ms took to finish last health check
 39. hrsp_1xx: http responses with 1xx code
 40. hrsp_2xx: http responses with 2xx code
 41. hrsp_3xx: http responses with 3xx code
 42. hrsp_4xx: http responses with 4xx code
 43. hrsp_5xx: http responses with 5xx code
 44. hrsp_other: http responses with other codes (protocol error)
 45. hanafail: failed health checks details
 46. req_rate: HTTP requests per second over last elapsed second
 47. req_rate_max: max number of HTTP requests per second observed
 48. req_tot: total number of HTTP requests received
 49. cli_abrt: number of data transfers aborted by the client
 50. srv_abrt: number of data transfers aborted by the server (inc. in eresp)</pre></div>
<a class="anchor" id="9.2" name="9.2"></a>
<h2 id="chapter-9.2" data-target="9.2"><small><a class="small" href="#9.2">9.2.</a></small> Unix Socket commands</h2>
<div><pre class="text">The following commands are supported on the UNIX stats socket ; all of them
must be terminated by a line feed. The socket supports pipelining, so that it
is possible to chain multiple commands at once provided they are delimited by
a semi-colon or a line feed, although the former is more reliable as it has no
risk of being truncated over the network. The responses themselves will each be
followed by an empty line, so it will be easy for an external script to match a
given response with a given request. By default one command line is processed
then the connection closes, but there is an interactive allowing multiple lines
to be issued one at a time.

It is important to understand that when multiple haproxy processes are started
on the same sockets, any process may pick up the request and will output its
own stats.</pre><a class="anchor" name="clear"></a><a class="anchor" name="9-clear"></a><a class="anchor" name="9.2-clear"></a><a class="anchor" name="clear (Statistics and monitoring)"></a><a class="anchor" name="clear (Unix Socket commands)"></a><a class="anchor" name="clear counters"></a><a class="anchor" name="9-clear counters"></a><a class="anchor" name="9.2-clear counters"></a><a class="anchor" name="clear counters (Statistics and monitoring)"></a><a class="anchor" name="clear counters (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="clear counters"></a><a href="#9-clear%20counters">clear counters</a></b></div><pre class="text">Clear the max values of the statistics counters in each proxy (frontend &amp;
backend) and in each server. The cumulated counters are not affected. This
can be used to get clean counters after an incident, without having to
restart nor to clear traffic counters. This command is restricted and can
only be issued on sockets configured for levels &quot;operator&quot; or &quot;admin&quot;.</pre><a class="anchor" name="clear"></a><a class="anchor" name="9-clear"></a><a class="anchor" name="9.2-clear"></a><a class="anchor" name="clear (Statistics and monitoring)"></a><a class="anchor" name="clear (Unix Socket commands)"></a><a class="anchor" name="clear counters"></a><a class="anchor" name="9-clear counters"></a><a class="anchor" name="9.2-clear counters"></a><a class="anchor" name="clear counters (Statistics and monitoring)"></a><a class="anchor" name="clear counters (Unix Socket commands)"></a><a class="anchor" name="clear counters all"></a><a class="anchor" name="9-clear counters all"></a><a class="anchor" name="9.2-clear counters all"></a><a class="anchor" name="clear counters all (Statistics and monitoring)"></a><a class="anchor" name="clear counters all (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="clear counters all"></a><a href="#9-clear%20counters%20all">clear counters all</a></b></div><pre class="text">Clear all statistics counters in each proxy (frontend &amp; backend) and in each
server. This has the same effect as restarting. This command is restricted
and can only be issued on sockets configured for level &quot;admin&quot;.</pre><a class="anchor" name="disable"></a><a class="anchor" name="9-disable"></a><a class="anchor" name="9.2-disable"></a><a class="anchor" name="disable (Statistics and monitoring)"></a><a class="anchor" name="disable (Unix Socket commands)"></a><a class="anchor" name="disable server"></a><a class="anchor" name="9-disable server"></a><a class="anchor" name="9.2-disable server"></a><a class="anchor" name="disable server (Statistics and monitoring)"></a><a class="anchor" name="disable server (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="disable server"></a><a href="#9-disable%20server">disable server</a></b> <span style="color: #080">&lt;backend&gt;</span>/<span style="color: #080">&lt;server&gt;</span></div><pre class="text">Mark the server DOWN for maintenance. In this mode, no more checks will be
performed on the server until it leaves maintenance.
If the server is tracked by other servers, those servers will be set to DOWN
during the maintenance.

In the statistics page, a server DOWN for maintenance will appear with a
&quot;MAINT&quot; status, its tracking servers with the &quot;MAINT(via)&quot; one.

Both the backend and the server may be specified either by their name or by
their numeric ID, prefixed with a sharp ('#').

This command is restricted and can only be issued on sockets configured for
level &quot;admin&quot;.</pre><a class="anchor" name="enable"></a><a class="anchor" name="9-enable"></a><a class="anchor" name="9.2-enable"></a><a class="anchor" name="enable (Statistics and monitoring)"></a><a class="anchor" name="enable (Unix Socket commands)"></a><a class="anchor" name="enable server"></a><a class="anchor" name="9-enable server"></a><a class="anchor" name="9.2-enable server"></a><a class="anchor" name="enable server (Statistics and monitoring)"></a><a class="anchor" name="enable server (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="enable server"></a><a href="#9-enable%20server">enable server</a></b> <span style="color: #080">&lt;backend&gt;</span>/<span style="color: #080">&lt;server&gt;</span></div><pre class="text">If the server was previously marked as DOWN for maintenance, this marks the
server UP and checks are re-enabled.

Both the backend and the server may be specified either by their name or by
their numeric ID, prefixed with a sharp ('#').

This command is restricted and can only be issued on sockets configured for
level &quot;admin&quot;.</pre><a class="anchor" name="get"></a><a class="anchor" name="9-get"></a><a class="anchor" name="9.2-get"></a><a class="anchor" name="get (Statistics and monitoring)"></a><a class="anchor" name="get (Unix Socket commands)"></a><a class="anchor" name="get weight"></a><a class="anchor" name="9-get weight"></a><a class="anchor" name="9.2-get weight"></a><a class="anchor" name="get weight (Statistics and monitoring)"></a><a class="anchor" name="get weight (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="get weight"></a><a href="#9-get%20weight">get weight</a></b> <span style="color: #080">&lt;backend&gt;</span>/<span style="color: #080">&lt;server&gt;</span></div><pre class="text">Report the current weight and the initial weight of server &lt;server&gt; in
backend &lt;backend&gt; or an error if either doesn't exist. The initial weight is
the one that appears in the configuration file. Both are normally equal
unless the current weight has been changed. Both the backend and the server
may be specified either by their name or by their numeric ID, prefixed with a
sharp ('#').</pre><a class="anchor" name="help"></a><a class="anchor" name="9-help"></a><a class="anchor" name="9.2-help"></a><a class="anchor" name="help (Statistics and monitoring)"></a><a class="anchor" name="help (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="help"></a><a href="#9-help">help</a></b></div><pre class="text">Print the list of known keywords and their basic usage. The same help screen
is also displayed for unknown commands.</pre><a class="anchor" name="prompt"></a><a class="anchor" name="9-prompt"></a><a class="anchor" name="9.2-prompt"></a><a class="anchor" name="prompt (Statistics and monitoring)"></a><a class="anchor" name="prompt (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="prompt"></a><a href="#9-prompt">prompt</a></b></div><pre class="text">Toggle the prompt at the beginning of the line and enter or leave interactive
mode. In interactive mode, the connection is not closed after a command
completes. Instead, the prompt will appear again, indicating the user that
the interpreter is waiting for a new command. The prompt consists in a right
angle bracket followed by a space &quot;&gt; &quot;. This mode is particularly convenient
when one wants to periodically check information such as stats or errors.
It is also a good idea to enter interactive mode before issuing a &quot;<a href="#help">help</a>&quot;
command.</pre><a class="anchor" name="quit"></a><a class="anchor" name="9-quit"></a><a class="anchor" name="9.2-quit"></a><a class="anchor" name="quit (Statistics and monitoring)"></a><a class="anchor" name="quit (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="quit"></a><a href="#9-quit">quit</a></b></div><pre class="text">Close the connection when in interactive mode.</pre><a class="anchor" name="set"></a><a class="anchor" name="9-set"></a><a class="anchor" name="9.2-set"></a><a class="anchor" name="set (Statistics and monitoring)"></a><a class="anchor" name="set (Unix Socket commands)"></a><a class="anchor" name="set timeout"></a><a class="anchor" name="9-set timeout"></a><a class="anchor" name="9.2-set timeout"></a><a class="anchor" name="set timeout (Statistics and monitoring)"></a><a class="anchor" name="set timeout (Unix Socket commands)"></a><a class="anchor" name="set timeout cli"></a><a class="anchor" name="9-set timeout cli"></a><a class="anchor" name="9.2-set timeout cli"></a><a class="anchor" name="set timeout cli (Statistics and monitoring)"></a><a class="anchor" name="set timeout cli (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="set timeout cli"></a><a href="#9-set%20timeout%20cli">set timeout cli</a></b> <span style="color: #080">&lt;delay&gt;</span></div><pre class="text">Change the CLI interface timeout for current connection. This can be useful
during long debugging sessions where the user needs to constantly inspect
some indicators without being disconnected. The delay is passed in seconds.</pre><a class="anchor" name="set"></a><a class="anchor" name="9-set"></a><a class="anchor" name="9.2-set"></a><a class="anchor" name="set (Statistics and monitoring)"></a><a class="anchor" name="set (Unix Socket commands)"></a><a class="anchor" name="set weight"></a><a class="anchor" name="9-set weight"></a><a class="anchor" name="9.2-set weight"></a><a class="anchor" name="set weight (Statistics and monitoring)"></a><a class="anchor" name="set weight (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="set weight"></a><a href="#9-set%20weight">set weight</a></b> <span style="color: #080">&lt;backend&gt;</span>/<span style="color: #080">&lt;server&gt;</span> <span style="color: #080">&lt;weight&gt;</span><span style="color: #008">[%]</span></div><pre class="text">Change a server's weight to the value passed in argument. If the value ends
with the '%' sign, then the new weight will be relative to the initially
configured weight. Relative weights are only permitted between 0 and 100%,
and absolute weights are permitted between 0 and 256. Servers which are part
of a farm running a static load-balancing algorithm have stricter limitations
because the weight cannot change once set. Thus for these servers, the only
accepted values are 0 and 100% (or 0 and the initial weight). Changes take
effect immediately, though certain LB algorithms require a certain amount of
requests to consider changes. A typical usage of this command is to disable
a server during an update by setting its weight to zero, then to enable it
again after the update by setting it back to 100%. This command is restricted
and can only be issued on sockets configured for level &quot;admin&quot;. Both the
backend and the server may be specified either by their name or by their
numeric ID, prefixed with a sharp ('#').</pre><a class="anchor" name="show"></a><a class="anchor" name="9-show"></a><a class="anchor" name="9.2-show"></a><a class="anchor" name="show (Statistics and monitoring)"></a><a class="anchor" name="show (Unix Socket commands)"></a><a class="anchor" name="show errors"></a><a class="anchor" name="9-show errors"></a><a class="anchor" name="9.2-show errors"></a><a class="anchor" name="show errors (Statistics and monitoring)"></a><a class="anchor" name="show errors (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="show errors"></a><a href="#9-show%20errors">show errors</a></b> <span style="color: #008">[<span style="color: #080">&lt;iid&gt;</span>]</span></div><pre class="text">Dump last known request and response errors collected by frontends and
backends. If &lt;iid&gt; is specified, the limit the dump to errors concerning
either frontend or backend whose ID is &lt;iid&gt;. This command is restricted
and can only be issued on sockets configured for levels &quot;operator&quot; or
&quot;admin&quot;.

The errors which may be collected are the last request and response errors
caused by protocol violations, often due to invalid characters in header
names. The report precisely indicates what exact character violated the
protocol. Other important information such as the exact date the error was
detected, frontend and backend names, the server name (when known), the
internal session ID and the source address which has initiated the session
are reported too.

All characters are returned, and non-printable characters are encoded. The
most common ones (\t = 9, \n = 10, \r = 13 and \e = 27) are encoded as one
letter following a backslash. The backslash itself is encoded as '\\' to
avoid confusion. Other non-printable characters are encoded '\xNN' where
NN is the two-digits hexadecimal representation of the character's ASCII
code.

Lines are prefixed with the position of their first character, starting at 0
for the beginning of the buffer. At most one input line is printed per line,
and large lines will be broken into multiple consecutive output lines so that
the output never goes beyond 79 characters wide. It is easy to detect if a
line was broken, because it will not end with '\n' and the next line's offset
will be followed by a '+' sign, indicating it is a continuation of previous
line.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>&gt;&gt;&gt; $ echo &quot;<a href="#show%20errors">show errors</a>&quot; | socat stdio /tmp/sock1
    [04/Mar/2009:15:46:56.081] backend http-in (<span class="comment">#2) : invalid response</span>
      src 127.0.0.1, session <span class="comment">#54, frontend fe-eth0 (#1), server s2 (#1)</span>
      response length 213 bytes, error at position 23:

      00000  HTTP/1.0 200 OK\r\n
      00017  header/bizarre:blah\r\n
      00038  Location: blah\r\n
      00054  Long-line: this is a very long line which should b
      00104+ e broken into multiple lines on the output buffer,
      00154+  otherwise it would be too large to print in a ter
      00204+ minal\r\n
      00211  \r\n

In the example above, we see that the backend &quot;http-in&quot; which has internal
ID 2 has blocked an invalid response from its server s2 which has internal
ID 1. The request was on session 54 initiated by source 127.0.0.1 and
received by frontend fe-eth0 whose ID is 1. The total response length was
213 bytes when the error was detected, and the error was at byte 23. This
is the slash ('/') in header name &quot;header/bizarre&quot;, which is not a valid
HTTP character for a header name.
</code></pre>
</div><a class="anchor" name="show"></a><a class="anchor" name="9-show"></a><a class="anchor" name="9.2-show"></a><a class="anchor" name="show (Statistics and monitoring)"></a><a class="anchor" name="show (Unix Socket commands)"></a><a class="anchor" name="show info"></a><a class="anchor" name="9-show info"></a><a class="anchor" name="9.2-show info"></a><a class="anchor" name="show info (Statistics and monitoring)"></a><a class="anchor" name="show info (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="show info"></a><a href="#9-show%20info">show info</a></b></div><pre class="text">Dump info about haproxy status on current process.</pre><a class="anchor" name="show"></a><a class="anchor" name="9-show"></a><a class="anchor" name="9.2-show"></a><a class="anchor" name="show (Statistics and monitoring)"></a><a class="anchor" name="show (Unix Socket commands)"></a><a class="anchor" name="show sess"></a><a class="anchor" name="9-show sess"></a><a class="anchor" name="9.2-show sess"></a><a class="anchor" name="show sess (Statistics and monitoring)"></a><a class="anchor" name="show sess (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="show sess"></a><a href="#9-show%20sess">show sess</a></b></div><pre class="text">Dump all known sessions. Avoid doing this on slow connections as this can
be huge. This command is restricted and can only be issued on sockets
configured for levels &quot;operator&quot; or &quot;admin&quot;.</pre><a class="anchor" name="show"></a><a class="anchor" name="9-show"></a><a class="anchor" name="9.2-show"></a><a class="anchor" name="show (Statistics and monitoring)"></a><a class="anchor" name="show (Unix Socket commands)"></a><a class="anchor" name="show sess"></a><a class="anchor" name="9-show sess"></a><a class="anchor" name="9.2-show sess"></a><a class="anchor" name="show sess (Statistics and monitoring)"></a><a class="anchor" name="show sess (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="show sess"></a><a href="#9-show%20sess">show sess</a></b> <span style="color: #080">&lt;id&gt;</span></div><pre class="text">Display a lot of internal information about the specified session identifier.
This identifier is the first field at the beginning of the lines in the dumps
of &quot;<a href="#show%20sess">show sess</a>&quot; (it corresponds to the session pointer). Those information are
useless to most users but may be used by haproxy developers to troubleshoot a
complex bug. The output format is intentionally not documented so that it can
freely evolve depending on demands.</pre><a class="anchor" name="show"></a><a class="anchor" name="9-show"></a><a class="anchor" name="9.2-show"></a><a class="anchor" name="show (Statistics and monitoring)"></a><a class="anchor" name="show (Unix Socket commands)"></a><a class="anchor" name="show stat"></a><a class="anchor" name="9-show stat"></a><a class="anchor" name="9.2-show stat"></a><a class="anchor" name="show stat (Statistics and monitoring)"></a><a class="anchor" name="show stat (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="show stat"></a><a href="#9-show%20stat">show stat</a></b> <span style="color: #008">[<span style="color: #080">&lt;iid&gt;</span> <span style="color: #080">&lt;type&gt;</span> <span style="color: #080">&lt;sid&gt;</span>]</span></div><pre class="text">Dump statistics in the CSV format. By passing &lt;id&gt;, &lt;type&gt; and &lt;sid&gt;, it is
possible to dump only selected items :
  - &lt;iid&gt; is a proxy ID, -1 to dump everything
  - &lt;type&gt; selects the type of dumpable objects : 1 for frontends, 2 for
     backends, 4 for servers, -1 for everything. These values can be ORed,
     for example:
        1 + 2     = 3   -&gt; frontend + backend.
        1 + 2 + 4 = 7   -&gt; frontend + backend + server.
  - &lt;sid&gt; is a server ID, -1 to dump everything from the selected proxy.</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>&gt;&gt;&gt; $ echo &quot;show info;show stat&quot; | socat stdio unix-connect:/tmp/sock1
    Name: HAProxy
    Version: 1.4-dev2-49
    Release_date: 2009/09/23
    Nbproc: 1
    Process_num: 1
    (...)

    <span class="comment"># pxname,svname,qcur,qmax,scur,smax,slim,stot,bin,bout,dreq,  (...)</span>
    stats,FRONTEND,,,0,0,1000,0,0,0,0,0,0,,,,,OPEN,,,,,,,,,1,1,0, (...)
    stats,BACKEND,0,0,0,0,1000,0,0,0,0,0,,0,0,0,0,UP,0,0,0,,0,250,(...)
    (...)
    www1,BACKEND,0,0,0,0,1000,0,0,0,0,0,,0,0,0,0,UP,1,1,0,,0,250, (...)

    $

Here, two commands have been issued at once. That way it's easy to find
which process the stats apply to in multi-process mode. Notice the empty
line after the information output which marks the end of the first block.
A similar empty line appears at the end of the second block (stats) so that
the reader knows the output has not been truncated.
</code></pre>
</div>
</div>

				</div>
			</div>
		</div>

		<script src="js/jquery.min.js?0.2.0-2"></script>
		<script src="bootstrap/js/bootstrap.min.js?0.2.0-2"></script>

		<script>
			/* Keyword search */
			var keywords = [
				"acl",
				"addr",
				"always_false",
				"always_true",
				"appsession",
				"avg_queue",
				"backlog",
				"backup",
				"balance",
				"balance url_param",
				"be_conn",
				"be_id",
				"be_sess_rate",
				"bind",
				"bind-process",
				"block",
				"capture",
				"capture cookie",
				"capture request",
				"capture request header",
				"capture response",
				"capture response header",
				"check",
				"chroot",
				"clear",
				"clear counters",
				"clear counters all",
				"clitimeout",
				"connslots",
				"contimeout",
				"cookie (Proxies)",
				"cookie (Server and default-server options)",
				"daemon",
				"debug",
				"default-server",
				"default_backend",
				"description",
				"disable",
				"disable server",
				"disabled (Proxies)",
				"disabled (Server and default-server options)",
				"dispatch",
				"downinter",
				"dst",
				"dst_conn",
				"dst_port",
				"enable",
				"enable server",
				"enabled",
				"error-limit",
				"errorfile",
				"errorloc",
				"errorloc302",
				"errorloc303",
				"fall",
				"fastinter",
				"fe_conn",
				"fe_id",
				"fe_sess_rate",
				"force-persist",
				"fullconn",
				"get",
				"get weight",
				"gid",
				"grace",
				"group",
				"hash-type",
				"hdr",
				"hdr_beg",
				"hdr_cnt",
				"hdr_dir",
				"hdr_dom",
				"hdr_end",
				"hdr_ip",
				"hdr_len",
				"hdr_reg",
				"hdr_sub",
				"hdr_val",
				"help",
				"http-check",
				"http-check disable-on-404",
				"http-check expect",
				"http-check send-state",
				"http-request",
				"http-send-name-header",
				"http_first_req",
				"id (Proxies)",
				"id (Server and default-server options)",
				"ignore-persist",
				"inter",
				"log (Global parameters)",
				"log (Proxies)",
				"log global",
				"log-send-hostname",
				"log-tag",
				"maxconn (Global parameters)",
				"maxconn (Proxies)",
				"maxconn (Server and default-server options)",
				"maxpipes",
				"maxqueue",
				"method",
				"minconn",
				"mode",
				"monitor",
				"monitor fail",
				"monitor-net",
				"monitor-uri",
				"nbproc",
				"nbsrv",
				"no option",
				"no option abortonclose",
				"no option accept-invalid-http-request",
				"no option accept-invalid-http-response",
				"no option allbackups",
				"no option checkcache",
				"no option clitcpka",
				"no option dontlog-normal",
				"no option dontlognull",
				"no option forceclose",
				"no option http-no-delay",
				"no option http-pretend-keepalive",
				"no option http-server-close",
				"no option http-use-proxy-header",
				"no option http_proxy",
				"no option httpclose",
				"no option independant-streams",
				"no option log-health-checks",
				"no option log-separate-errors",
				"no option logasap",
				"no option nolinger",
				"no option persist",
				"no option redispatch",
				"no option socket-stats",
				"no option splice-auto",
				"no option splice-request",
				"no option splice-response",
				"no option srvtcpka",
				"no option tcp-smart-accept",
				"no option tcp-smart-connect",
				"no option transparent",
				"node",
				"noepoll",
				"nokqueue",
				"nopoll",
				"nosepoll",
				"nosplice",
				"observe",
				"on-error",
				"option",
				"option abortonclose",
				"option accept-invalid-http-request",
				"option accept-invalid-http-response",
				"option allbackups",
				"option checkcache",
				"option clitcpka",
				"option contstats",
				"option dontlog-normal",
				"option dontlognull",
				"option forceclose",
				"option forwardfor",
				"option http-no-delay",
				"option http-pretend-keepalive",
				"option http-server-close",
				"option http-use-proxy-header",
				"option http_proxy",
				"option httpchk",
				"option httpclose",
				"option httplog",
				"option independant-streams",
				"option ldap-check",
				"option log-health-checks",
				"option log-separate-errors",
				"option logasap",
				"option mysql-check",
				"option nolinger",
				"option originalto",
				"option persist",
				"option redispatch",
				"option smtpchk",
				"option socket-stats",
				"option splice-auto",
				"option splice-request",
				"option splice-response",
				"option srvtcpka",
				"option ssl-hello-chk",
				"option tcp-smart-accept",
				"option tcp-smart-connect",
				"option tcpka",
				"option tcplog",
				"option transparent",
				"path",
				"path_beg",
				"path_dir",
				"path_dom",
				"path_end",
				"path_len",
				"path_reg",
				"path_sub",
				"persist",
				"persist rdp-cookie",
				"pidfile",
				"port",
				"prompt",
				"queue",
				"quiet",
				"quit",
				"rate-limit",
				"rate-limit sessions",
				"redir",
				"redirect",
				"redirect location",
				"redirect prefix",
				"redisp",
				"redispatch",
				"req_len",
				"req_proto_http",
				"req_rdp_cookie",
				"req_rdp_cookie_cnt",
				"req_ssl_ver",
				"req_ver",
				"reqadd",
				"reqallow",
				"reqdel",
				"reqdeny",
				"reqiallow",
				"reqidel",
				"reqideny",
				"reqipass",
				"reqirep",
				"reqitarpit",
				"reqpass",
				"reqrep",
				"reqtarpit",
				"retries",
				"rise",
				"rspadd",
				"rspdel",
				"rspdeny",
				"rspidel",
				"rspideny",
				"rspirep",
				"rsprep",
				"server",
				"set",
				"set timeout",
				"set timeout cli",
				"set weight",
				"show",
				"show errors",
				"show info",
				"show sess",
				"show stat",
				"slowstart",
				"so_id",
				"source (Proxies)",
				"source (Server and default-server options)",
				"spread-checks",
				"src",
				"src_port",
				"srv_id",
				"srv_is_up",
				"srvtimeout",
				"stats",
				"stats admin",
				"stats auth",
				"stats enable",
				"stats hide-version",
				"stats http-request",
				"stats maxconn",
				"stats realm",
				"stats refresh",
				"stats scope",
				"stats show-desc",
				"stats show-legends",
				"stats show-node",
				"stats socket",
				"stats timeout",
				"stats uri",
				"status",
				"stick",
				"stick match",
				"stick on",
				"stick store-request",
				"stick-table",
				"stick-table type",
				"tcp-request",
				"tcp-request content",
				"tcp-request content accept",
				"tcp-request content reject",
				"tcp-request inspect-delay",
				"timeout",
				"timeout check",
				"timeout client",
				"timeout clitimeout",
				"timeout connect",
				"timeout contimeout",
				"timeout http-keep-alive",
				"timeout http-request",
				"timeout queue",
				"timeout server",
				"timeout srvtimeout",
				"timeout tarpit",
				"track",
				"transparent",
				"tune.bufsize",
				"tune.chksize",
				"tune.maxaccept",
				"tune.maxpollevents",
				"tune.maxrewrite",
				"tune.rcvbuf.client",
				"tune.rcvbuf.server",
				"tune.sndbuf.client",
				"tune.sndbuf.server",
				"uid",
				"ulimit-n",
				"url",
				"url_beg",
				"url_dir",
				"url_dom",
				"url_end",
				"url_ip",
				"url_len",
				"url_port",
				"url_reg",
				"url_sub",
				"use_backend",
				"user",
				"userlist",
				"wait_end",
				"weight"
			]

			function search(keyword) {
				if (keyword) {
					if (!!~$.inArray(keyword, keywords)) {
						window.location.hash = keyword
						$("#error").html('')
					} else {
						var error = $('<div/>', {
							class: "alert alert-error"
						}).html('							<a class="close" href="#" data-dismiss="alert">&times;</a>							<strong>Unknown keyword !</strong>							<p>The keyword <strong class="unknown"></strong> you\'re looking for doesn\'t exist or is not detected by the documentation converter.</p>						')
						error.find(".unknown").text(keyword)

						$("#error").html(error)
					}
				}
			}
			
			$('#searchKeyword').typeahead({
				source: keywords,
				updater: function(item) {
					search(item)
					return item
				}
			})

			/* EXPERIMENTAL - Previous/Next navigation */
			var headings = $(":header")
			var previousTarget = false
			var nextTarget = false
			function refreshNavigation() {
				var previous = false
				var next = false
				$.each(headings, function(item, value) {
					var el = $(value)

					// TODO : avoid target recalculation on each refresh
					var target = el.attr('data-target')
					if (! target) return true

					var target_el = $('#' + target.replace(/\./, "\\."))
					if (! target_el.attr('id')) return true

					if (target_el.offset().top < $(window).scrollTop()) {
						previous = el
					}
					if (target_el.offset().top - 1 > $(window).scrollTop()) {
						next = el
					}
					if (next) return false
				})
				previousTarget = previous ? previous.attr('data-target') : 'top'
				$('#previous').html(
					previous && previousTarget ? '<a href="#' + previousTarget + '">&larr; ' + previous.text() + '</a>' : '<a href="#top">&larr; Top</a>'
				)
				nextTarget = next ? next.attr('data-target') : 'bottom'
				$('#next').html(
					next && nextTarget ? '<a href="#' + nextTarget + '">' + next.text() + ' &rarr;</a>' : '<a href="#bottom">Bottom &rarr;</a>'
				)
			}

			$(window).scroll(function () {
				refreshNavigation()
			});
			$(document).ready(function() {
				refreshNavigation()
			});

			/* EXPERIMENTAL - Enable keyboard navigation */
			$(document).keydown(function(e){
				switch(e.which) {
					case 37: // left
					window.location.hash = previousTarget ? previousTarget : 'top'
					break

					case 39: // right
					window.location.hash = nextTarget ? nextTarget : 'bottom'
					break

					default: return // exit this handler for other keys
				}
				e.preventDefault()
			})
		</script>
		<!-- Piwik -->
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://stats.cdncdn.net/" : "http://stats.cdncdn.net/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 4);
piwikTracker.setCustomVariable (1, 'HaproxyVersion', 'version 1.4.23', 'page');
piwikTracker.setCustomVariable (2, 'HaproxyDconvVersion', '0.2.0-2', 'page');
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img src="http://stats.cdncdn.net/piwik.php?idsite=4" style="border:0" alt="" /></p></noscript>
<!-- End Piwik Tracking Code -->

		<a class="anchor" name="bottom"></a>
	</body>
</html>

