<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>HAProxy version 1.6-dev0 - Configuration Manual</title>
		<link href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet" />
		<link href="../css/page.css?0.3.1-20" rel="stylesheet" />
	</head>
	<body>
		<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#menu">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="../index.html">HAProxy <small>Configuration Manual</small></a>
			</div>
			<!-- /.navbar-header -->

			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse" id="menu">
				<ul class="nav navbar-nav">
					<li><a href="https://haproxy.1wt.eu/">HAProxy home page</a></li>
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown">Versions <b class="caret"></b></a>
						<ul class="dropdown-menu">
							<li class="dropdown-header">HAProxy 1.4</li>
							<li><a href="../configuration-1.4.html">Configuration Manual <small>(stable)</small></a></li>
							<li><a href="../snapshot/configuration-1.4.html">Configuration Manual <small>(snapshot)</small></a></li>
							<li><a href="http://git.1wt.eu/git/haproxy-1.4.git/">GIT Repository</a></li>
							<li><a href="http://haproxy.1wt.eu/git/?p=haproxy-1.4.git">Browse repository</a></li>
							<li><a href="http://haproxy.1wt.eu/download/1.4/">Browse directory</a></li>
							<li class="divider"></li>
							<li class="dropdown-header">HAProxy 1.5</li>
							<li><a href="../configuration-1.5.html">Configuration Manual <small>(stable)</small></a></li>
							<li><a href="../snapshot/configuration-1.5.html">Configuration Manual <small>(snapshot)</small></a></li>
							<li><a href="http://git.1wt.eu/git/haproxy-1.5.git/">GIT Repository</a></li>
							<li><a href="http://haproxy.1wt.eu/git/?p=haproxy-1.5.git">Browse repository</a></li>
							<li><a href="http://haproxy.1wt.eu/download/1.5/">Browse directory</a></li>
                            <li class="divider"></li>
                            <li class="dropdown-header">HAProxy 1.6</li>
                            <li><a href="../configuration-1.6.html">Configuration Manual <small>(stable)</small></a></li>
                            <li><a href="../snapshot/configuration-1.6.html">Configuration Manual <small>(snapshot)</small></a></li>
                            <li><a href="http://git.1wt.eu/git/haproxy.git/">GIT Repository</a></li>
                            <li><a href="http://haproxy.1wt.eu/git/?p=haproxy.git">Browse repository</a></li>
                            <li><a href="http://haproxy.1wt.eu/download/1.6/">Browse directory</a></li>
						</ul>
					</li>
				</ul>
			</div>
		</nav>
		<!-- /.navbar-static-side -->

		<div id="wrapper">

			<div id="sidebar">
				<form onsubmit="search(this.keyword.value); return false" role="form">
					<div id="searchKeyword" class="form-group">
						<input type="text" class="form-control typeahead" id="keyword" name="keyword" placeholder="Search..." autocomplete="off">
					</div>
				</form>
				<p>
					Keyboard navigation&nbsp;: <span id="keyboardNavStatus"></span>
				</p>
				<p>
					When enabled, you can use <strong>left</strong> and <strong>right</strong> arrow keys to navigate between chapters.<br>
					The feature is automatically disabled when the search field is focused.
				</p>
				<p class="text-right">
					<small>Converted with <a href="https://github.com/cbonte/haproxy-dconv">haproxy-dconv</a> v<b>0.3.1-20</b> on <b>2014/06/19</b></small>
				</p>
			</div>
			<!-- /.sidebar -->

			<div id="page-wrapper">
				<div class="row">
					<div class="col-lg-12">
						<div class="text-center">
							<h1>HAProxy</h1>
							<h2>Configuration Manual</h2>
							<p><strong>version 1.6-dev0</strong></p>
							<p>
								<a href="http://haproxy.1wt.eu/" title="HAProxy Home Page"><img src="http://haproxy.1wt.eu/img/logo-med.png" /></a><br>
								willy tarreau<br>
								2014/06/19
							</p>
						</div>

						<div><pre class="text">This document covers the configuration language as implemented in the version
specified above. It does not provide any hint, example or advice. For such
documentation, please refer to the Reference Manual or the Architecture Manual.
The summary below is meant to help you search sections by name and navigate
through the document.

Note to documentation contributors :
    This document is formatted with 80 columns per line, with even number of
    spaces for indentation and without tabs. Please follow these rules strictly
    so that it remains easily printable everywhere. If a line needs to be
    printed verbatim and does not fit, please end each line with a backslash
    ('\') and continue on next line, indented by two characters. It is also
    sometimes useful to prefix all output lines (logs, console outs) with 3
    closing angle brackets ('&gt;&gt;&gt;') in order to help get the difference between
    inputs and outputs when it can become ambiguous. If you add sections,
    please update the summary below for easier searching.
</pre></div>
<a class="anchor" id="summary" name="summary"></a>
<div class="page-header">
	<h1 id="chapter-summary" data-target="summary">Summary</h1>
</div>
<div class="row">
	<div class="col-md-6">
		
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><b><small>1.</small></b></div>
					<div class="col-md-10 noheight">
							<a href="#1"><b>Quick reminder about HTTP</b></a>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>1.1.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#1.1">The HTTP transaction model</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>1.2.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#1.2">HTTP request</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>1.2.1.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#1.2.1">The Request line</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>1.2.2.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#1.2.2">The request headers</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>1.3.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#1.3">HTTP response</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>1.3.1.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#1.3.1">The Response line</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>1.3.2.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#1.3.2">The response headers</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
					<br />
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><b><small>2.</small></b></div>
					<div class="col-md-10 noheight">
							<a href="#2"><b>Configuring HAProxy</b></a>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>2.1.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#2.1">Configuration file format</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>2.2.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#2.2">Time format</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>2.3.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#2.3">Examples</a>
							</div>
					</div>
				</div>
				
			
				
					<br />
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><b><small>3.</small></b></div>
					<div class="col-md-10 noheight">
							<a href="#3"><b>Global parameters</b></a>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>3.1.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#3.1">Process management and security</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>3.2.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#3.2">Performance tuning</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>3.3.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#3.3">Debugging</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>3.4.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#3.4">Userlists</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>3.5.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#3.5">Peers</a>
							</div>
					</div>
				</div>
				
			
				
					<br />
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><b><small>4.</small></b></div>
					<div class="col-md-10 noheight">
							<a href="#4"><b>Proxies</b></a>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>4.1.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#4.1">Proxy keywords matrix</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>4.2.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#4.2">Alphabetically sorted keywords reference</a>
							</div>
					</div>
				</div>
				
			
				
					<br />
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><b><small>5.</small></b></div>
					<div class="col-md-10 noheight">
							<a href="#5"><b>Bind and Server options</b></a>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>5.1.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#5.1">Bind options</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>5.2.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#5.2">Server and default-server options</a>
							</div>
					</div>
				</div>
				
			
				
					<br />
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><b><small>6.</small></b></div>
					<div class="col-md-10 noheight">
							<a href="#6"><b>HTTP header manipulation</b></a>
					</div>
				</div>
				
			
				
					</div><div class="col-md-6">
					
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><b><small>7.</small></b></div>
					<div class="col-md-10 noheight">
							<a href="#7"><b>Using ACLs and fetching samples</b></a>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>7.1.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#7.1">ACL basics</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>7.1.1.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#7.1.1">Matching booleans</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>7.1.2.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#7.1.2">Matching integers</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>7.1.3.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#7.1.3">Matching strings</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>7.1.4.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#7.1.4">Matching regular expressions (regexes)</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>7.1.5.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#7.1.5">Matching arbitrary data blocks</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>7.1.6.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#7.1.6">Matching IPv4 and IPv6 addresses</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>7.2.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#7.2">Using ACLs to form conditions</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>7.3.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#7.3">Fetching samples</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>7.3.1.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#7.3.1">Converters</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>7.3.2.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#7.3.2">Fetching samples from internal states</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>7.3.3.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#7.3.3">Fetching samples at Layer 4</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>7.3.4.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#7.3.4">Fetching samples at Layer 5</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>7.3.5.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#7.3.5">Fetching samples from buffer contents (Layer 6)</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>7.3.6.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#7.3.6">Fetching HTTP samples (Layer 7)</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>7.4.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#7.4">Pre-defined ACLs</a>
							</div>
					</div>
				</div>
				
			
				
					<br />
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><b><small>8.</small></b></div>
					<div class="col-md-10 noheight">
							<a href="#8"><b>Logging</b></a>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>8.1.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#8.1">Log levels</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>8.2.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#8.2">Log formats</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>8.2.1.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#8.2.1">Default log format</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>8.2.2.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#8.2.2">TCP log format</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>8.2.3.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#8.2.3">HTTP log format</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>8.2.4.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#8.2.4">Custom log format</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>8.2.5.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#8.2.5">Error log format</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>8.3.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#8.3">Advanced logging options</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>8.3.1.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#8.3.1">Disabling logging of external tests</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>8.3.2.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#8.3.2">Logging before waiting for the session to terminate</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>8.3.3.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#8.3.3">Raising log level upon errors</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>8.3.4.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<div class="tab">
							<a href="#8.3.4">Disabling logging of successful connections</a>
							</div>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>8.4.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#8.4">Timing events</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>8.5.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#8.5">Session state at disconnection</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>8.6.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#8.6">Non-printable characters</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>8.7.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#8.7">Capturing HTTP cookies</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>8.8.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#8.8">Capturing HTTP headers</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>8.9.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#8.9">Examples of logs</a>
							</div>
					</div>
				</div>
				
			
				
					<br />
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><b><small>9.</small></b></div>
					<div class="col-md-10 noheight">
							<a href="#9"><b>Statistics and monitoring</b></a>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>9.1.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#9.1">CSV format</a>
							</div>
					</div>
				</div>
				
			
				
				<div class="row">
					<div class="col-md-2 pagination-right noheight"><small>9.2.</small></div>
					<div class="col-md-10 noheight">
							<div class="tab">
							<a href="#9.2">Unix Socket commands</a>
							</div>
					</div>
				</div>
				
	</div>
</div>

<a class="anchor" id="1" name="1"></a>
<div class="page-header"><h1 id="chapter-1" data-target="1"><small><a class="small" href="#1">1.</a></small> Quick reminder about HTTP</h1>
</div><div><pre class="text">When haproxy is running in HTTP mode, both the request and the response are
fully analyzed and indexed, thus it becomes possible to build matching criteria
on almost anything found in the contents.

However, it is important to understand how HTTP requests and responses are
formed, and how HAProxy decomposes them. It will then become easier to write
correct rules and to debug existing configurations.
</pre></div>
<a class="anchor" id="1.1" name="1.1"></a>
<h2 id="chapter-1.1" data-target="1.1"><small><a class="small" href="#1.1">1.1.</a></small> The HTTP transaction model</h2>
<div><pre class="text">The HTTP protocol is transaction-driven. This means that each request will lead
to one and only one response. Traditionally, a TCP connection is established
from the client to the server, a request is sent by the client on the
connection, the server responds and the connection is closed. A new request
will involve a new connection :

  [CON1] [REQ1] ... [RESP1] [CLO1] [CON2] [REQ2] ... [RESP2] [CLO2] ...

In this mode, called the &quot;HTTP close&quot; mode, there are as many connection
establishments as there are HTTP transactions. Since the connection is closed
by the server after the response, the client does not need to know the content
length.

Due to the transactional nature of the protocol, it was possible to improve it
to avoid closing a connection between two subsequent transactions. In this mode
however, it is mandatory that the server indicates the content length for each
response so that the client does not wait indefinitely. For this, a special
header is used: &quot;Content-length&quot;. This mode is called the &quot;keep-alive&quot; mode :

  [CON] [REQ1] ... [RESP1] [REQ2] ... [RESP2] [CLO] ...

Its advantages are a reduced latency between transactions, and less processing
power required on the server side. It is generally better than the close mode,
but not always because the clients often limit their concurrent connections to
a smaller value.

A last improvement in the communications is the pipelining mode. It still uses
keep-alive, but the client does not wait for the first response to send the
second request. This is useful for fetching large number of images composing a
page :

  [CON] [REQ1] [REQ2] ... [RESP1] [RESP2] [CLO] ...

This can obviously have a tremendous benefit on performance because the network
latency is eliminated between subsequent requests. Many HTTP agents do not
correctly support pipelining since there is no way to associate a response with
the corresponding request in HTTP. For this reason, it is mandatory for the
server to reply in the exact same order as the requests were received.

By default HAProxy operates in keep-alive mode with regards to persistent
connections: for each connection it processes each request and response, and
leaves the connection idle on both sides between the end of a response and the
start of a new request.

HAProxy supports 5 connection modes :
  - keep alive    : all requests and responses are processed (default)
  - tunnel        : only the first request and response are processed,
                    everything else is forwarded with no analysis.
  - passive close : tunnel with &quot;Connection: close&quot; added in both directions.
  - server close  : the server-facing connection is closed after the response.
  - forced close  : the connection is actively closed after end of response.
</pre></div>
<a class="anchor" id="1.2" name="1.2"></a>
<h2 id="chapter-1.2" data-target="1.2"><small><a class="small" href="#1.2">1.2.</a></small> HTTP request</h2>
<div><pre class="text">First, let's consider this HTTP request :

  Line     Contents
  number
     1     GET /serv/login.php?lang=en&amp;profile=2 HTTP/1.1
     2     Host: www.mydomain.com
     3     User-agent: my small browser
     4     Accept: image/jpeg, image/gif
     5     Accept: image/png
</pre></div>
<a class="anchor" id="1.2.1" name="1.2.1"></a>
<h3 id="chapter-1.2.1" data-target="1.2.1"><small><a class="small" href="#1.2.1">1.2.1.</a></small> The Request line</h3>
<div><pre class="text">Line 1 is the &quot;request line&quot;. It is always composed of 3 fields :

  - a METHOD      : GET
  - a URI         : /serv/login.php?lang=en&amp;profile=2
  - a version tag : HTTP/1.1

All of them are delimited by what the standard calls LWS (linear white spaces),
which are commonly spaces, but can also be tabs or line feeds/carriage returns
followed by spaces/tabs. The method itself cannot contain any colon (':') and
is limited to alphabetic letters. All those various combinations make it
desirable that HAProxy performs the splitting itself rather than leaving it to
the user to write a complex or inaccurate regular expression.

The URI itself can have several forms :

  - A &quot;relative URI&quot; :

      /serv/login.php?lang=en&amp;profile=2

    It is a complete URL without the host part. This is generally what is
    received by servers, reverse proxies and transparent proxies.

  - An &quot;absolute URI&quot;, also called a &quot;URL&quot; :

      http://192.168.0.12:8080/serv/login.php?lang=en&amp;profile=2

    It is composed of a &quot;scheme&quot; (the protocol name followed by '://'), a host
    name or address, optionally a colon (':') followed by a port number, then
    a relative URI beginning at the first slash ('/') after the address part.
    This is generally what proxies receive, but a server supporting HTTP/1.1
    must accept this form too.

  - a star ('*') : this form is only accepted in association with the OPTIONS
    method and is not relayable. It is used to inquiry a next hop's
    capabilities.

  - an address:port combination : 192.168.0.12:80
    This is used with the CONNECT method, which is used to establish TCP
    tunnels through HTTP proxies, generally for HTTPS, but sometimes for
    other protocols too.

In a relative URI, two sub-parts are identified. The part before the question
mark is called the &quot;<a href="#path">path</a>&quot;. It is typically the relative path to static objects
on the server. The part after the question mark is called the &quot;query string&quot;.
It is mostly used with GET requests sent to dynamic scripts and is very
specific to the language, framework or application in use.
</pre></div>
<a class="anchor" id="1.2.2" name="1.2.2"></a>
<h3 id="chapter-1.2.2" data-target="1.2.2"><small><a class="small" href="#1.2.2">1.2.2.</a></small> The request headers</h3>
<div><pre class="text">The headers start at the second line. They are composed of a name at the
beginning of the line, immediately followed by a colon (':'). Traditionally,
an LWS is added after the colon but that's not required. Then come the values.
Multiple identical headers may be folded into one single line, delimiting the
values with commas, provided that their order is respected. This is commonly
encountered in the &quot;Cookie:&quot; field. A header may span over multiple lines if
the subsequent lines begin with an LWS. In the example in 1.2, lines 4 and 5
define a total of 3 values for the &quot;Accept:&quot; header.

Contrary to a common mis-conception, header names are not case-sensitive, and
their values are not either if they refer to other header names (such as the
&quot;Connection:&quot; header).

The end of the headers is indicated by the first empty line. People often say
that it's a double line feed, which is not exact, even if a double line feed
is one valid form of empty line.

Fortunately, HAProxy takes care of all these complex combinations when indexing
headers, checking values and counting them, so there is no reason to worry
about the way they could be written, but it is important not to accuse an
application of being buggy if it does unusual, valid things.

Important note:
   As suggested by RFC2616, HAProxy normalizes headers by replacing line breaks
   in the middle of headers by LWS in order to join multi-line headers. This
   is necessary for proper analysis and helps less capable HTTP parsers to work
   correctly and not to be fooled by such complex constructs.
</pre></div>
<a class="anchor" id="1.3" name="1.3"></a>
<h2 id="chapter-1.3" data-target="1.3"><small><a class="small" href="#1.3">1.3.</a></small> HTTP response</h2>
<div><pre class="text">An HTTP response looks very much like an HTTP request. Both are called HTTP
messages. Let's consider this HTTP response :

  Line     Contents
  number
     1     HTTP/1.1 200 OK
     2     Content-length: 350
     3     Content-Type: text/html

As a special case, HTTP supports so called &quot;Informational responses&quot; as status
codes 1xx. These messages are special in that they don't convey any part of the
response, they're just used as sort of a signaling message to ask a client to
continue to post its request for instance. In the case of a status 100 response
the requested information will be carried by the next non-100 response message
following the informational one. This implies that multiple responses may be
sent to a single request, and that this only works when keep-alive is enabled
(1xx messages are HTTP/1.1 only). HAProxy handles these messages and is able to
correctly forward and skip them, and only process the next non-100 response. As
such, these messages are neither logged nor transformed, unless explicitly
state otherwise. Status 101 messages indicate that the protocol is changing
over the same connection and that haproxy must switch to tunnel mode, just as
if a CONNECT had occurred. Then the Upgrade header would contain additional
information about the type of protocol the connection is switching to.
</pre></div>
<a class="anchor" id="1.3.1" name="1.3.1"></a>
<h3 id="chapter-1.3.1" data-target="1.3.1"><small><a class="small" href="#1.3.1">1.3.1.</a></small> The Response line</h3>
<div><pre class="text">Line 1 is the &quot;response line&quot;. It is always composed of 3 fields :

  - a version tag : HTTP/1.1
  - a status code : 200
  - a reason      : OK

The status code is always 3-digit. The first digit indicates a general status :
 - 1xx = informational message to be skipped (eg: 100, 101)
 - 2xx = OK, content is following   (eg: 200, 206)
 - 3xx = OK, no content following   (eg: 302, 304)
 - 4xx = error caused by the client (eg: 401, 403, 404)
 - 5xx = error caused by the server (eg: 500, 502, 503)

Please refer to RFC2616 for the detailed meaning of all such codes. The
&quot;reason&quot; field is just a hint, but is not parsed by clients. Anything can be
found there, but it's a common practice to respect the well-established
messages. It can be composed of one or multiple words, such as &quot;OK&quot;, &quot;Found&quot;,
or &quot;Authentication Required&quot;.

Haproxy may emit the following status codes by itself :

  Code  When / reason
   200  access to stats page, and when replying to monitoring requests
   301  when performing a redirection, depending on the configured code
   302  when performing a redirection, depending on the configured code
   303  when performing a redirection, depending on the configured code
   307  when performing a redirection, depending on the configured code
   308  when performing a redirection, depending on the configured code
   400  for an invalid or too large request
   401  when an authentication is required to perform the action (when
        accessing the stats page)
   403  when a request is forbidden by a &quot;<a href="#block">block</a>&quot; ACL or &quot;<a href="#reqdeny">reqdeny</a>&quot; filter
   408  when the request timeout strikes before the request is complete
   500  when haproxy encounters an unrecoverable internal error, such as a
        memory allocation failure, which should never happen
   502  when the server returns an empty, invalid or incomplete response, or
        when an &quot;<a href="#rspdeny">rspdeny</a>&quot; filter blocks the response.
   503  when no server was available to handle the request, or in response to
        monitoring requests which match the &quot;<a href="#monitor%20fail">monitor fail</a>&quot; condition
   504  when the response timeout strikes before the server responds

The error 4xx and 5xx codes above may be customized (see &quot;<a href="#errorloc">errorloc</a>&quot; in section
4.2).
</pre></div>
<a class="anchor" id="1.3.2" name="1.3.2"></a>
<h3 id="chapter-1.3.2" data-target="1.3.2"><small><a class="small" href="#1.3.2">1.3.2.</a></small> The response headers</h3>
<div><pre class="text">Response headers work exactly like request headers, and as such, HAProxy uses
the same parsing function for both. Please refer to paragraph 1.2.2 for more
details.
</pre></div>
<a class="anchor" id="2" name="2"></a>
<div class="page-header"><h1 id="chapter-2" data-target="2"><small><a class="small" href="#2">2.</a></small> Configuring HAProxy</h1>
</div><a class="anchor" id="2.1" name="2.1"></a>
<h2 id="chapter-2.1" data-target="2.1"><small><a class="small" href="#2.1">2.1.</a></small> Configuration file format</h2>
<div><pre class="text">HAProxy's configuration process involves 3 major sources of parameters :

  - the arguments from the command-line, which always take precedence
  - the &quot;global&quot; section, which sets process-wide parameters
  - the proxies sections which can take form of &quot;defaults&quot;, &quot;listen&quot;,
    &quot;frontend&quot; and &quot;backend&quot;.

The configuration file syntax consists in lines beginning with a keyword
referenced in this manual, optionally followed by one or several parameters
delimited by spaces. If spaces have to be entered in strings, then they must be
preceded by a backslash ('\') to be escaped. Backslashes also have to be
escaped by doubling them.
</pre></div>
<a class="anchor" id="2.2" name="2.2"></a>
<h2 id="chapter-2.2" data-target="2.2"><small><a class="small" href="#2.2">2.2.</a></small> Time format</h2>
<div><pre class="text">Some parameters involve values representing time, such as timeouts. These
values are generally expressed in milliseconds (unless explicitly stated
otherwise) but may be expressed in any other unit by suffixing the unit to the
numeric value. It is important to consider this because it will not be repeated
for every keyword. Supported units are :

  - us : microseconds. 1 microsecond = 1/1000000 second
  - ms : milliseconds. 1 millisecond = 1/1000 second. This is the default.
  - s  : seconds. 1s = 1000ms
  - m  : minutes. 1m = 60s = 60000ms
  - h  : hours.   1h = 60m = 3600s = 3600000ms
  - d  : days.    1d = 24h = 1440m = 86400s = 86400000ms
</pre></div>
<a class="anchor" id="2.3" name="2.3"></a>
<h2 id="chapter-2.3" data-target="2.3"><small><a class="small" href="#2.3">2.3.</a></small> Examples</h2>
<div><pre class="text">    # Simple configuration for an HTTP proxy listening on port 80 on all
    # interfaces and forwarding requests to a single backend &quot;servers&quot; with a
    # single server &quot;server1&quot; listening on 127.0.0.1:8000
    global
        daemon
        maxconn 256

    defaults
        mode http
        timeout connect 5000ms
        timeout client 50000ms
        timeout server 50000ms

    frontend http-in
        bind *:80
        default_backend servers

    backend servers
        server server1 127.0.0.1:8000 maxconn 32


    # The same configuration defined with a single listen block. Shorter but
    # less expressive, especially in HTTP mode.
    global
        daemon
        maxconn 256

    defaults
        mode http
        timeout connect 5000ms
        timeout client 50000ms
        timeout server 50000ms

    listen http-in
        bind *:80
        server server1 127.0.0.1:8000 maxconn 32


Assuming haproxy is in $PATH, test these configurations in a shell with:

    $ sudo haproxy -f configuration.conf -c
</pre></div>
<a class="anchor" id="3" name="3"></a>
<div class="page-header"><h1 id="chapter-3" data-target="3"><small><a class="small" href="#3">3.</a></small> Global parameters</h1>
</div><div><pre class="text">Parameters in the &quot;global&quot; section are process-wide and often OS-specific. They
are generally set once for all and do not need being changed once correct. Some
of them have command-line equivalents.

The following keywords are supported in the &quot;global&quot; section :

 * Process management and security
   - <a href="#ca-base">ca-base</a>
   - <a href="#chroot">chroot</a>
   - <a href="#crt-base">crt-base</a>
   - <a href="#daemon">daemon</a>
   - <a href="#gid">gid</a>
   - <a href="#group">group</a>
   - <a href="#log">log</a>
   - <a href="#log-send-hostname">log-send-hostname</a>
   - <a href="#nbproc">nbproc</a>
   - <a href="#pidfile">pidfile</a>
   - <a href="#uid">uid</a>
   - <a href="#ulimit-n">ulimit-n</a>
   - <a href="#user">user</a>
   - <a href="#stats">stats</a>
   - <a href="#ssl-server-verify">ssl-server-verify</a>
   - <a href="#node">node</a>
   - <a href="#description">description</a>
   - <a href="#unix-bind">unix-bind</a>

 * Performance tuning
   - <a href="#max-spread-checks">max-spread-checks</a>
   - <a href="#maxconn">maxconn</a>
   - <a href="#maxconnrate">maxconnrate</a>
   - <a href="#maxcomprate">maxcomprate</a>
   - <a href="#maxcompcpuusage">maxcompcpuusage</a>
   - <a href="#maxpipes">maxpipes</a>
   - <a href="#maxsessrate">maxsessrate</a>
   - <a href="#maxsslconn">maxsslconn</a>
   - <a href="#maxsslrate">maxsslrate</a>
   - <a href="#noepoll">noepoll</a>
   - <a href="#nokqueue">nokqueue</a>
   - <a href="#nopoll">nopoll</a>
   - <a href="#nosplice">nosplice</a>
   - <a href="#nogetaddrinfo">nogetaddrinfo</a>
   - <a href="#spread-checks">spread-checks</a>
   - <a href="#tune.bufsize">tune.bufsize</a>
   - <a href="#tune.chksize">tune.chksize</a>
   - <a href="#tune.comp.maxlevel">tune.comp.maxlevel</a>
   - <a href="#tune.http.cookielen">tune.http.cookielen</a>
   - <a href="#tune.http.maxhdr">tune.http.maxhdr</a>
   - <a href="#tune.idletimer">tune.idletimer</a>
   - <a href="#tune.maxaccept">tune.maxaccept</a>
   - <a href="#tune.maxpollevents">tune.maxpollevents</a>
   - <a href="#tune.maxrewrite">tune.maxrewrite</a>
   - <a href="#tune.pipesize">tune.pipesize</a>
   - <a href="#tune.rcvbuf.client">tune.rcvbuf.client</a>
   - <a href="#tune.rcvbuf.server">tune.rcvbuf.server</a>
   - <a href="#tune.sndbuf.client">tune.sndbuf.client</a>
   - <a href="#tune.sndbuf.server">tune.sndbuf.server</a>
   - <a href="#tune.ssl.cachesize">tune.ssl.cachesize</a>
   - <a href="#tune.ssl.lifetime">tune.ssl.lifetime</a>
   - <a href="#tune.ssl.force-private-cache">tune.ssl.force-private-cache</a>
   - <a href="#tune.ssl.maxrecord">tune.ssl.maxrecord</a>
   - <a href="#tune.ssl.default-dh-param">tune.ssl.default-dh-param</a>
   - <a href="#tune.zlib.memlevel">tune.zlib.memlevel</a>
   - <a href="#tune.zlib.windowsize">tune.zlib.windowsize</a>

 * Debugging
   - <a href="#debug">debug</a>
   - <a href="#quiet">quiet</a>
</pre></div>
<a class="anchor" id="3.1" name="3.1"></a>
<h2 id="chapter-3.1" data-target="3.1"><small><a class="small" href="#3.1">3.1.</a></small> Process management and security</h2>
<div><a class="anchor" name="ca-base"></a><a class="anchor" name="3-ca-base"></a><a class="anchor" name="3.1-ca-base"></a><a class="anchor" name="ca-base (Global parameters)"></a><a class="anchor" name="ca-base (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="ca-base"></a><a href="#3.1-ca-base">ca-base</a></b> <span style="color: #080">&lt;dir&gt;</span></div><pre class="text">Assigns a default directory to fetch SSL CA certificates and CRLs from when a
relative path is used with &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">ca-file<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#ca-file%20%28Bind%20options%29">Bind options</a></li><li><a href="#ca-file%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; or &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">crl-file<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#crl-file%20%28Bind%20options%29">Bind options</a></li><li><a href="#crl-file%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; directives. Absolute
locations specified in &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">ca-file<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#ca-file%20%28Bind%20options%29">Bind options</a></li><li><a href="#ca-file%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; and &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">crl-file<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#crl-file%20%28Bind%20options%29">Bind options</a></li><li><a href="#crl-file%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; prevail and ignore &quot;<a href="#ca-base">ca-base</a>&quot;.
</pre><a class="anchor" name="chroot"></a><a class="anchor" name="3-chroot"></a><a class="anchor" name="3.1-chroot"></a><a class="anchor" name="chroot (Global parameters)"></a><a class="anchor" name="chroot (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="chroot"></a><a href="#3.1-chroot">chroot</a></b> <span style="color: #080">&lt;jail dir&gt;</span></div><pre class="text">Changes current directory to &lt;jail dir&gt; and performs a chroot() there before
dropping privileges. This increases the security level in case an unknown
vulnerability would be exploited, since it would make it very hard for the
attacker to exploit the system. This only works when the process is started
with superuser privileges. It is important to ensure that &lt;jail_dir&gt; is both
empty and unwritable to anyone.
</pre><a class="anchor" name="cpu-map"></a><a class="anchor" name="3-cpu-map"></a><a class="anchor" name="3.1-cpu-map"></a><a class="anchor" name="cpu-map (Global parameters)"></a><a class="anchor" name="cpu-map (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="cpu-map"></a><a href="#3.1-cpu-map">cpu-map</a></b> <span style="color: #080">&lt;&quot;all&quot;|&quot;odd&quot;|&quot;even&quot;|process_num&gt;</span> <span style="color: #080">&lt;cpu-set&gt;</span>...</div><pre class="text">On Linux 2.6 and above, it is possible to bind a process to a specific CPU
set. This means that the process will never run on other CPUs. The &quot;<a href="#cpu-map">cpu-map</a>&quot;
directive specifies CPU sets for process sets. The first argument is the
process number to bind. This process must have a number between 1 and 32 or
64, depending on the machine's word size, and any process IDs above nbproc
are ignored. It is possible to specify all processes at once using &quot;all&quot;,
only odd numbers using &quot;odd&quot; or even numbers using &quot;even&quot;, just like with the
&quot;<a href="#bind-process">bind-process</a>&quot; directive. The second and forthcoming arguments are CPU sets.
Each CPU set is either a unique number between 0 and 31 or 63 or a range with
two such numbers delimited by a dash ('-'). Multiple CPU numbers or ranges
may be specified, and the processes will be allowed to bind to all of them.
Obviously, multiple &quot;<a href="#cpu-map">cpu-map</a>&quot; directives may be specified. Each &quot;<a href="#cpu-map">cpu-map</a>&quot;
directive will replace the previous ones when they overlap.
</pre><a class="anchor" name="crt-base"></a><a class="anchor" name="3-crt-base"></a><a class="anchor" name="3.1-crt-base"></a><a class="anchor" name="crt-base (Global parameters)"></a><a class="anchor" name="crt-base (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="crt-base"></a><a href="#3.1-crt-base">crt-base</a></b> <span style="color: #080">&lt;dir&gt;</span></div><pre class="text">Assigns a default directory to fetch SSL certificates from when a relative
path is used with &quot;crtfile&quot; directives. Absolute locations specified after
&quot;crtfile&quot; prevail and ignore &quot;<a href="#crt-base">crt-base</a>&quot;.
</pre><a class="anchor" name="daemon"></a><a class="anchor" name="3-daemon"></a><a class="anchor" name="3.1-daemon"></a><a class="anchor" name="daemon (Global parameters)"></a><a class="anchor" name="daemon (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="daemon"></a><a href="#3.1-daemon">daemon</a></b></div><pre class="text">Makes the process fork into background. This is the recommended mode of
operation. It is equivalent to the command line &quot;-D&quot; argument. It can be
disabled by the command line &quot;-db&quot; argument.
</pre><a class="anchor" name="gid"></a><a class="anchor" name="3-gid"></a><a class="anchor" name="3.1-gid"></a><a class="anchor" name="gid (Global parameters)"></a><a class="anchor" name="gid (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="gid"></a><a href="#3.1-gid">gid</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Changes the process' group ID to &lt;number&gt;. It is recommended that the group
ID is dedicated to HAProxy or to a small set of similar daemons. HAProxy must
be started with a user belonging to this group, or with superuser privileges.
Note that if haproxy is started from a user having supplementary groups, it
will only be able to drop these groups if started with superuser privileges.
See also &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">group<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#group%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#group%20%28Userlists%29">Userlists</a></li><li><a href="#group%20%28Bind%20options%29">Bind options</a></li></ul></span>&quot; and &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">uid<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#uid%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#uid%20%28Bind%20options%29">Bind options</a></li></ul></span>&quot;.
</pre><a class="anchor" name="group"></a><a class="anchor" name="3-group"></a><a class="anchor" name="3.1-group"></a><a class="anchor" name="group (Global parameters)"></a><a class="anchor" name="group (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="group"></a><a href="#3.1-group">group</a></b> <span style="color: #080">&lt;group name&gt;</span></div><pre class="text">Similar to &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">gid<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#gid%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#gid%20%28Bind%20options%29">Bind options</a></li></ul></span>&quot; but uses the GID of group name &lt;group name&gt; from /etc/group.
See also &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">gid<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#gid%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#gid%20%28Bind%20options%29">Bind options</a></li></ul></span>&quot; and &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">user<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#user%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#user%20%28Userlists%29">Userlists</a></li><li><a href="#user%20%28Bind%20options%29">Bind options</a></li></ul></span>&quot;.
</pre><a class="anchor" name="log"></a><a class="anchor" name="3-log"></a><a class="anchor" name="3.1-log"></a><a class="anchor" name="log (Global parameters)"></a><a class="anchor" name="log (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="log"></a><a href="#3.1-log">log</a></b> <span style="color: #080">&lt;address&gt;</span> <span style="color: #080">&lt;facility&gt;</span> <span style="color: #008">[max level <span style="color: #008">[min level]</span>]</span></div><pre class="text">Adds a global syslog server. Up to two global servers can be defined. They
will receive logs for startups and exits, as well as all logs from proxies
configured with &quot;<a href="#log%20global">log global</a>&quot;.

&lt;address&gt; can be one of:

      - An IPv4 address optionally followed by a colon and a UDP port. If
        no port is specified, 514 is used by default (the standard syslog
        port).

      - An IPv6 address followed by a colon and optionally a UDP port. If
        no port is specified, 514 is used by default (the standard syslog
        port).

      - A filesystem path to a UNIX domain socket, keeping in mind
        considerations for chroot (be sure the path is accessible inside
        the chroot) and uid/gid (be sure the path is appropriately
        writeable).

      Any part of the address string may reference any number of environment
      variables by preceding their name with a dollar sign ('$') and
      optionally enclosing them with braces ('{}'), similarly to what is done
      in Bourne shell.

&lt;facility&gt; must be one of the 24 standard syslog facilities :

        kern   user   mail   daemon auth   syslog lpr    news
        uucp   cron   auth2  ftp    ntp    audit  alert  cron2
        local0 local1 local2 local3 local4 local5 local6 local7

An optional level can be specified to filter outgoing messages. By default,
all messages are sent. If a maximum level is specified, only messages with a
severity at least as important as this level will be sent. An optional minimum
level can be specified. If it is set, logs emitted with a more severe level
than this one will be capped to this level. This is used to avoid sending
&quot;emerg&quot; messages on all terminals on some default syslog configurations.
Eight levels are known :

        emerg  alert  crit   err    warning notice info  debug
</pre><a class="anchor" name="log-send-hostname"></a><a class="anchor" name="3-log-send-hostname"></a><a class="anchor" name="3.1-log-send-hostname"></a><a class="anchor" name="log-send-hostname (Global parameters)"></a><a class="anchor" name="log-send-hostname (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="log-send-hostname"></a><a href="#3.1-log-send-hostname">log-send-hostname</a></b> <span style="color: #008">[<span style="color: #080">&lt;string&gt;</span>]</span></div><pre class="text">Sets the hostname field in the syslog header. If optional &quot;string&quot; parameter
is set the header is set to the string contents, otherwise uses the hostname
of the system. Generally used if one is not relaying logs through an
intermediate syslog server or for simply customizing the hostname printed in
the logs.
</pre><a class="anchor" name="log-tag"></a><a class="anchor" name="3-log-tag"></a><a class="anchor" name="3.1-log-tag"></a><a class="anchor" name="log-tag (Global parameters)"></a><a class="anchor" name="log-tag (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="log-tag"></a><a href="#3.1-log-tag">log-tag</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">Sets the tag field in the syslog header to this string. It defaults to the
program name as launched from the command line, which usually is &quot;haproxy&quot;.
Sometimes it can be useful to differentiate between multiple processes
running on the same host.
</pre><a class="anchor" name="nbproc"></a><a class="anchor" name="3-nbproc"></a><a class="anchor" name="3.1-nbproc"></a><a class="anchor" name="nbproc (Global parameters)"></a><a class="anchor" name="nbproc (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="nbproc"></a><a href="#3.1-nbproc">nbproc</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Creates &lt;number&gt; processes when going daemon. This requires the &quot;<a href="#daemon">daemon</a>&quot;
mode. By default, only one process is created, which is the recommended mode
of operation. For systems limited to small sets of file descriptors per
process, it may be needed to fork multiple daemons. USING MULTIPLE PROCESSES
IS HARDER TO DEBUG AND IS REALLY DISCOURAGED. See also &quot;<a href="#daemon">daemon</a>&quot;.
</pre><a class="anchor" name="pidfile"></a><a class="anchor" name="3-pidfile"></a><a class="anchor" name="3.1-pidfile"></a><a class="anchor" name="pidfile (Global parameters)"></a><a class="anchor" name="pidfile (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="pidfile"></a><a href="#3.1-pidfile">pidfile</a></b> <span style="color: #080">&lt;pidfile&gt;</span></div><pre class="text">Writes pids of all daemons into file &lt;pidfile&gt;. This option is equivalent to
the &quot;-p&quot; command line argument. The file must be accessible to the user
starting the process. See also &quot;<a href="#daemon">daemon</a>&quot;.
</pre><a class="anchor" name="stats"></a><a class="anchor" name="3-stats"></a><a class="anchor" name="3.1-stats"></a><a class="anchor" name="stats (Global parameters)"></a><a class="anchor" name="stats (Process management and security)"></a><a class="anchor" name="stats bind-process"></a><a class="anchor" name="3-stats bind-process"></a><a class="anchor" name="3.1-stats bind-process"></a><a class="anchor" name="stats bind-process (Global parameters)"></a><a class="anchor" name="stats bind-process (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="stats bind-process"></a><a href="#3.1-stats%20bind-process">stats bind-process</a></b> <span style="color: #008">[ all | odd | even | <span style="color: #080">&lt;number 1-64&gt;</span><span style="color: #008">[-<span style="color: #080">&lt;number 1-64&gt;</span>]</span> ]</span> ...</div><pre class="text">Limits the stats socket to a certain set of processes numbers. By default the
stats socket is bound to all processes, causing a warning to be emitted when
nbproc is greater than 1 because there is no way to select the target process
when connecting. However, by using this setting, it becomes possible to pin
the stats socket to a specific set of processes, typically the first one. The
warning will automatically be disabled when this setting is used, whatever
the number of processes used. The maximum process ID depends on the machine's
word size (32 or 64). A better option consists in using the &quot;<a href="#process">process</a>&quot; setting
of the &quot;<a href="#stats%20socket">stats socket</a>&quot; line to force the process on each line.
</pre><a class="anchor" name="ssl-default-bind-ciphers"></a><a class="anchor" name="3-ssl-default-bind-ciphers"></a><a class="anchor" name="3.1-ssl-default-bind-ciphers"></a><a class="anchor" name="ssl-default-bind-ciphers (Global parameters)"></a><a class="anchor" name="ssl-default-bind-ciphers (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="ssl-default-bind-ciphers"></a><a href="#3.1-ssl-default-bind-ciphers">ssl-default-bind-ciphers</a></b> <span style="color: #080">&lt;ciphers&gt;</span></div><pre class="text">This setting is only available when support for OpenSSL was built in. It sets
the default string describing the list of cipher algorithms (&quot;cipher suite&quot;)
that are negotiated during the SSL/TLS handshake for all &quot;<a href="#bind">bind</a>&quot; lines which
do not explicitly define theirs. The format of the string is defined in
&quot;man 1 ciphers&quot; from OpenSSL man pages, and can be for instance a string such
as &quot;AES:ALL:!aNULL:!eNULL:+RC4:@STRENGTH&quot; (without quotes). Please check the
&quot;<a href="#bind">bind</a>&quot; keyword for more information.
</pre><a class="anchor" name="ssl-default-server-ciphers"></a><a class="anchor" name="3-ssl-default-server-ciphers"></a><a class="anchor" name="3.1-ssl-default-server-ciphers"></a><a class="anchor" name="ssl-default-server-ciphers (Global parameters)"></a><a class="anchor" name="ssl-default-server-ciphers (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="ssl-default-server-ciphers"></a><a href="#3.1-ssl-default-server-ciphers">ssl-default-server-ciphers</a></b> <span style="color: #080">&lt;ciphers&gt;</span></div><pre class="text">This setting is only available when support for OpenSSL was built in. It
sets the default string describing the list of cipher algorithms that are
negotiated during the SSL/TLS handshake with the server, for all &quot;<a href="#server">server</a>&quot;
lines which do not explicitly define theirs. The format of the string is
defined in &quot;man 1 ciphers&quot;. Please check the &quot;<a href="#server">server</a>&quot; keyword for more
information.
</pre><a class="anchor" name="ssl-server-verify"></a><a class="anchor" name="3-ssl-server-verify"></a><a class="anchor" name="3.1-ssl-server-verify"></a><a class="anchor" name="ssl-server-verify (Global parameters)"></a><a class="anchor" name="ssl-server-verify (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="ssl-server-verify"></a><a href="#3.1-ssl-server-verify">ssl-server-verify</a></b> <span style="color: #008">[none|required]</span></div><pre class="text">The default behavior for SSL verify on servers side. If specified to 'none',
servers certificates are not verified. The default is 'required' except if
forced using cmdline option '-dV'.
</pre><a class="anchor" name="stats"></a><a class="anchor" name="3-stats"></a><a class="anchor" name="3.1-stats"></a><a class="anchor" name="stats (Global parameters)"></a><a class="anchor" name="stats (Process management and security)"></a><a class="anchor" name="stats socket"></a><a class="anchor" name="3-stats socket"></a><a class="anchor" name="3.1-stats socket"></a><a class="anchor" name="stats socket (Global parameters)"></a><a class="anchor" name="stats socket (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="stats socket"></a><a href="#3.1-stats%20socket">stats socket</a></b> <span style="color: #008">[<span style="color: #080">&lt;address:port&gt;</span>|<span style="color: #080">&lt;path&gt;</span>]</span> <span style="color: #008">[param*]</span></div><pre class="text">Binds a UNIX socket to &lt;path&gt; or a TCPv4/v6 address to &lt;address:port&gt;.
Connections to this socket will return various statistics outputs and even
allow some commands to be issued to change some runtime settings. Please
consult <a href="#9.2">section 9.2</a> &quot;Unix Socket commands&quot; for more details.

All parameters supported by &quot;<a href="#bind">bind</a>&quot; lines are supported, for instance to
restrict access to some users or their access rights. Please consult
<a href="#5.1">section 5.1</a> for more information.
</pre><a class="anchor" name="stats"></a><a class="anchor" name="3-stats"></a><a class="anchor" name="3.1-stats"></a><a class="anchor" name="stats (Global parameters)"></a><a class="anchor" name="stats (Process management and security)"></a><a class="anchor" name="stats timeout"></a><a class="anchor" name="3-stats timeout"></a><a class="anchor" name="3.1-stats timeout"></a><a class="anchor" name="stats timeout (Global parameters)"></a><a class="anchor" name="stats timeout (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="stats timeout"></a><a href="#3.1-stats%20timeout">stats timeout</a></b> <span style="color: #080">&lt;timeout, in milliseconds&gt;</span></div><pre class="text">The default timeout on the stats socket is set to 10 seconds. It is possible
to change this value with &quot;<a href="#stats%20timeout">stats timeout</a>&quot;. The value must be passed in
milliseconds, or be suffixed by a time unit among { us, ms, s, m, h, d }.
</pre><a class="anchor" name="stats"></a><a class="anchor" name="3-stats"></a><a class="anchor" name="3.1-stats"></a><a class="anchor" name="stats (Global parameters)"></a><a class="anchor" name="stats (Process management and security)"></a><a class="anchor" name="stats maxconn"></a><a class="anchor" name="3-stats maxconn"></a><a class="anchor" name="3.1-stats maxconn"></a><a class="anchor" name="stats maxconn (Global parameters)"></a><a class="anchor" name="stats maxconn (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="stats maxconn"></a><a href="#3.1-stats%20maxconn">stats maxconn</a></b> <span style="color: #080">&lt;connections&gt;</span></div><pre class="text">By default, the stats socket is limited to 10 concurrent connections. It is
possible to change this value with &quot;<a href="#stats%20maxconn">stats maxconn</a>&quot;.
</pre><a class="anchor" name="uid"></a><a class="anchor" name="3-uid"></a><a class="anchor" name="3.1-uid"></a><a class="anchor" name="uid (Global parameters)"></a><a class="anchor" name="uid (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="uid"></a><a href="#3.1-uid">uid</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Changes the process' user ID to &lt;number&gt;. It is recommended that the user ID
is dedicated to HAProxy or to a small set of similar daemons. HAProxy must
be started with superuser privileges in order to be able to switch to another
one. See also &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">gid<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#gid%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#gid%20%28Bind%20options%29">Bind options</a></li></ul></span>&quot; and &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">user<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#user%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#user%20%28Userlists%29">Userlists</a></li><li><a href="#user%20%28Bind%20options%29">Bind options</a></li></ul></span>&quot;.
</pre><a class="anchor" name="ulimit-n"></a><a class="anchor" name="3-ulimit-n"></a><a class="anchor" name="3.1-ulimit-n"></a><a class="anchor" name="ulimit-n (Global parameters)"></a><a class="anchor" name="ulimit-n (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="ulimit-n"></a><a href="#3.1-ulimit-n">ulimit-n</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the maximum number of per-process file-descriptors to &lt;number&gt;. By
default, it is automatically computed, so it is recommended not to use this
option.
</pre><a class="anchor" name="unix-bind"></a><a class="anchor" name="3-unix-bind"></a><a class="anchor" name="3.1-unix-bind"></a><a class="anchor" name="unix-bind (Global parameters)"></a><a class="anchor" name="unix-bind (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="unix-bind"></a><a href="#3.1-unix-bind">unix-bind</a></b> <span style="color: #008">[ prefix <span style="color: #080">&lt;prefix&gt;</span> ]</span> <span style="color: #008">[ mode <span style="color: #080">&lt;mode&gt;</span> ]</span> <span style="color: #008">[ user <span style="color: #080">&lt;user&gt;</span> ]</span> <span style="color: #008">[ uid <span style="color: #080">&lt;uid&gt;</span> ]</span>
          <span style="color: #008">[ group <span style="color: #080">&lt;group&gt;</span> ]</span> <span style="color: #008">[ gid <span style="color: #080">&lt;gid&gt;</span> ]</span></div><pre class="text">Fixes common settings to UNIX listening sockets declared in &quot;<a href="#bind">bind</a>&quot; statements.
This is mainly used to simplify declaration of those UNIX sockets and reduce
the risk of errors, since those settings are most commonly required but are
also process-specific. The &lt;prefix&gt; setting can be used to force all socket
path to be relative to that directory. This might be needed to access another
component's chroot. Note that those paths are resolved before haproxy chroots
itself, so they are absolute. The &lt;mode&gt;, &lt;user&gt;, &lt;uid&gt;, &lt;group&gt; and &lt;gid&gt;
all have the same meaning as their homonyms used by the &quot;<a href="#bind">bind</a>&quot; statement. If
both are specified, the &quot;<a href="#bind">bind</a>&quot; statement has priority, meaning that the
&quot;<a href="#unix-bind">unix-bind</a>&quot; settings may be seen as process-wide default settings.
</pre><a class="anchor" name="user"></a><a class="anchor" name="3-user"></a><a class="anchor" name="3.1-user"></a><a class="anchor" name="user (Global parameters)"></a><a class="anchor" name="user (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="user"></a><a href="#3.1-user">user</a></b> <span style="color: #080">&lt;user name&gt;</span></div><pre class="text">Similar to &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">uid<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#uid%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#uid%20%28Bind%20options%29">Bind options</a></li></ul></span>&quot; but uses the UID of user name &lt;user name&gt; from /etc/passwd.
See also &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">uid<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#uid%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#uid%20%28Bind%20options%29">Bind options</a></li></ul></span>&quot; and &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">group<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#group%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#group%20%28Userlists%29">Userlists</a></li><li><a href="#group%20%28Bind%20options%29">Bind options</a></li></ul></span>&quot;.
</pre><a class="anchor" name="node"></a><a class="anchor" name="3-node"></a><a class="anchor" name="3.1-node"></a><a class="anchor" name="node (Global parameters)"></a><a class="anchor" name="node (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="node"></a><a href="#3.1-node">node</a></b> <span style="color: #080">&lt;name&gt;</span></div><pre class="text">Only letters, digits, hyphen and underscore are allowed, like in DNS names.

This statement is useful in HA configurations where two or more processes or
servers share the same IP address. By setting a different node-name on all
nodes, it becomes easy to immediately spot what server is handling the
traffic.
</pre><a class="anchor" name="description"></a><a class="anchor" name="3-description"></a><a class="anchor" name="3.1-description"></a><a class="anchor" name="description (Global parameters)"></a><a class="anchor" name="description (Process management and security)"></a><div class="keyword"><b><a class="anchor" name="description"></a><a href="#3.1-description">description</a></b> <span style="color: #080">&lt;text&gt;</span></div><pre class="text">Add a text that describes the instance.

Please note that it is required to escape certain characters (# for example)
and this text is inserted into a html page so you should avoid using
&quot;&lt;&quot; and &quot;&gt;&quot; characters.
</pre></div>
<a class="anchor" id="3.2" name="3.2"></a>
<h2 id="chapter-3.2" data-target="3.2"><small><a class="small" href="#3.2">3.2.</a></small> Performance tuning</h2>
<div><a class="anchor" name="max-spread-checks"></a><a class="anchor" name="3-max-spread-checks"></a><a class="anchor" name="3.2-max-spread-checks"></a><a class="anchor" name="max-spread-checks (Global parameters)"></a><a class="anchor" name="max-spread-checks (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="max-spread-checks"></a><a href="#3.2-max-spread-checks">max-spread-checks</a></b> <span style="color: #080">&lt;delay in milliseconds&gt;</span></div><pre class="text">By default, haproxy tries to spread the start of health checks across the
smallest health check interval of all the servers in a farm. The principle is
to avoid hammering services running on the same server. But when using large
check intervals (10 seconds or more), the last servers in the farm take some
time before starting to be tested, which can be a problem. This parameter is
used to enforce an upper bound on delay between the first and the last check,
even if the servers' check intervals are larger. When servers run with
shorter intervals, their intervals will be respected though.
</pre><a class="anchor" name="maxconn"></a><a class="anchor" name="3-maxconn"></a><a class="anchor" name="3.2-maxconn"></a><a class="anchor" name="maxconn (Global parameters)"></a><a class="anchor" name="maxconn (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="maxconn"></a><a href="#3.2-maxconn">maxconn</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the maximum per-process number of concurrent connections to &lt;number&gt;. It
is equivalent to the command-line argument &quot;-n&quot;. Proxies will stop accepting
connections when this limit is reached. The &quot;<a href="#ulimit-n">ulimit-n</a>&quot; parameter is
automatically adjusted according to this value. See also &quot;<a href="#ulimit-n">ulimit-n</a>&quot;. Note:
the &quot;select&quot; poller cannot reliably use more than 1024 file descriptors on
some platforms. If your platform only supports select and reports &quot;select
FAILED&quot; on startup, you need to reduce maxconn until it works (slightly
below 500 in general).
</pre><a class="anchor" name="maxconnrate"></a><a class="anchor" name="3-maxconnrate"></a><a class="anchor" name="3.2-maxconnrate"></a><a class="anchor" name="maxconnrate (Global parameters)"></a><a class="anchor" name="maxconnrate (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="maxconnrate"></a><a href="#3.2-maxconnrate">maxconnrate</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the maximum per-process number of connections per second to &lt;number&gt;.
Proxies will stop accepting connections when this limit is reached. It can be
used to limit the global capacity regardless of each frontend capacity. It is
important to note that this can only be used as a service protection measure,
as there will not necessarily be a fair share between frontends when the
limit is reached, so it's a good idea to also limit each frontend to some
value close to its expected share. Also, lowering tune.maxaccept can improve
fairness.
</pre><a class="anchor" name="maxcomprate"></a><a class="anchor" name="3-maxcomprate"></a><a class="anchor" name="3.2-maxcomprate"></a><a class="anchor" name="maxcomprate (Global parameters)"></a><a class="anchor" name="maxcomprate (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="maxcomprate"></a><a href="#3.2-maxcomprate">maxcomprate</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the maximum per-process input compression rate to &lt;number&gt; kilobytes
per second.  For each session, if the maximum is reached, the compression
level will be decreased during the session. If the maximum is reached at the
beginning of a session, the session will not compress at all. If the maximum
is not reached, the compression level will be increased up to
tune.comp.maxlevel.  A value of zero means there is no limit, this is the
default value.
</pre><a class="anchor" name="maxcompcpuusage"></a><a class="anchor" name="3-maxcompcpuusage"></a><a class="anchor" name="3.2-maxcompcpuusage"></a><a class="anchor" name="maxcompcpuusage (Global parameters)"></a><a class="anchor" name="maxcompcpuusage (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="maxcompcpuusage"></a><a href="#3.2-maxcompcpuusage">maxcompcpuusage</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the maximum CPU usage HAProxy can reach before stopping the compression
for new requests or decreasing the compression level of current requests.
It works like 'maxcomprate' but measures CPU usage instead of incoming data
bandwidth. The value is expressed in percent of the CPU used by haproxy. In
case of multiple processes (nbproc &gt; 1), each process manages its individual
usage. A value of 100 disable the limit. The default value is 100. Setting
a lower value will prevent the compression work from slowing the whole
process down and from introducing high latencies.
</pre><a class="anchor" name="maxpipes"></a><a class="anchor" name="3-maxpipes"></a><a class="anchor" name="3.2-maxpipes"></a><a class="anchor" name="maxpipes (Global parameters)"></a><a class="anchor" name="maxpipes (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="maxpipes"></a><a href="#3.2-maxpipes">maxpipes</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the maximum per-process number of pipes to &lt;number&gt;. Currently, pipes
are only used by kernel-based tcp splicing. Since a pipe contains two file
descriptors, the &quot;<a href="#ulimit-n">ulimit-n</a>&quot; value will be increased accordingly. The default
value is maxconn/4, which seems to be more than enough for most heavy usages.
The splice code dynamically allocates and releases pipes, and can fall back
to standard copy, so setting this value too low may only impact performance.
</pre><a class="anchor" name="maxsessrate"></a><a class="anchor" name="3-maxsessrate"></a><a class="anchor" name="3.2-maxsessrate"></a><a class="anchor" name="maxsessrate (Global parameters)"></a><a class="anchor" name="maxsessrate (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="maxsessrate"></a><a href="#3.2-maxsessrate">maxsessrate</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the maximum per-process number of sessions per second to &lt;number&gt;.
Proxies will stop accepting connections when this limit is reached. It can be
used to limit the global capacity regardless of each frontend capacity. It is
important to note that this can only be used as a service protection measure,
as there will not necessarily be a fair share between frontends when the
limit is reached, so it's a good idea to also limit each frontend to some
value close to its expected share. Also, lowering tune.maxaccept can improve
fairness.
</pre><a class="anchor" name="maxsslconn"></a><a class="anchor" name="3-maxsslconn"></a><a class="anchor" name="3.2-maxsslconn"></a><a class="anchor" name="maxsslconn (Global parameters)"></a><a class="anchor" name="maxsslconn (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="maxsslconn"></a><a href="#3.2-maxsslconn">maxsslconn</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the maximum per-process number of concurrent SSL connections to
&lt;number&gt;. By default there is no SSL-specific limit, which means that the
global maxconn setting will apply to all connections. Setting this limit
avoids having openssl use too much memory and crash when malloc returns NULL
(since it unfortunately does not reliably check for such conditions). Note
that the limit applies both to incoming and outgoing connections, so one
connection which is deciphered then ciphered accounts for 2 SSL connections.
</pre><a class="anchor" name="maxsslrate"></a><a class="anchor" name="3-maxsslrate"></a><a class="anchor" name="3.2-maxsslrate"></a><a class="anchor" name="maxsslrate (Global parameters)"></a><a class="anchor" name="maxsslrate (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="maxsslrate"></a><a href="#3.2-maxsslrate">maxsslrate</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the maximum per-process number of SSL sessions per second to &lt;number&gt;.
SSL listeners will stop accepting connections when this limit is reached. It
can be used to limit the global SSL CPU usage regardless of each frontend
capacity. It is important to note that this can only be used as a service
protection measure, as there will not necessarily be a fair share between
frontends when the limit is reached, so it's a good idea to also limit each
frontend to some value close to its expected share. It is also important to
note that the sessions are accounted before they enter the SSL stack and not
after, which also protects the stack against bad handshakes. Also, lowering
tune.maxaccept can improve fairness.
</pre><a class="anchor" name="maxzlibmem"></a><a class="anchor" name="3-maxzlibmem"></a><a class="anchor" name="3.2-maxzlibmem"></a><a class="anchor" name="maxzlibmem (Global parameters)"></a><a class="anchor" name="maxzlibmem (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="maxzlibmem"></a><a href="#3.2-maxzlibmem">maxzlibmem</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the maximum amount of RAM in megabytes per process usable by the zlib.
When the maximum amount is reached, future sessions will not compress as long
as RAM is unavailable. When sets to 0, there is no limit.
The default value is 0. The value is available in bytes on the UNIX socket
with &quot;<a href="#show%20info">show info</a>&quot; on the line &quot;MaxZlibMemUsage&quot;, the memory used by zlib is
&quot;ZlibMemUsage&quot; in bytes.
</pre><a class="anchor" name="noepoll"></a><a class="anchor" name="3-noepoll"></a><a class="anchor" name="3.2-noepoll"></a><a class="anchor" name="noepoll (Global parameters)"></a><a class="anchor" name="noepoll (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="noepoll"></a><a href="#3.2-noepoll">noepoll</a></b></div><pre class="text">Disables the use of the &quot;epoll&quot; event polling system on Linux. It is
equivalent to the command-line argument &quot;-de&quot;. The next polling system
used will generally be &quot;poll&quot;. See also &quot;<a href="#nopoll">nopoll</a>&quot;.
</pre><a class="anchor" name="nokqueue"></a><a class="anchor" name="3-nokqueue"></a><a class="anchor" name="3.2-nokqueue"></a><a class="anchor" name="nokqueue (Global parameters)"></a><a class="anchor" name="nokqueue (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="nokqueue"></a><a href="#3.2-nokqueue">nokqueue</a></b></div><pre class="text">Disables the use of the &quot;kqueue&quot; event polling system on BSD. It is
equivalent to the command-line argument &quot;-dk&quot;. The next polling system
used will generally be &quot;poll&quot;. See also &quot;<a href="#nopoll">nopoll</a>&quot;.
</pre><a class="anchor" name="nopoll"></a><a class="anchor" name="3-nopoll"></a><a class="anchor" name="3.2-nopoll"></a><a class="anchor" name="nopoll (Global parameters)"></a><a class="anchor" name="nopoll (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="nopoll"></a><a href="#3.2-nopoll">nopoll</a></b></div><pre class="text">Disables the use of the &quot;poll&quot; event polling system. It is equivalent to the
command-line argument &quot;-dp&quot;. The next polling system used will be &quot;select&quot;.
It should never be needed to disable &quot;poll&quot; since it's available on all
platforms supported by HAProxy. See also &quot;<a href="#nokqueue">nokqueue</a>&quot; and &quot;<a href="#noepoll">noepoll</a>&quot;.
</pre><a class="anchor" name="nosplice"></a><a class="anchor" name="3-nosplice"></a><a class="anchor" name="3.2-nosplice"></a><a class="anchor" name="nosplice (Global parameters)"></a><a class="anchor" name="nosplice (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="nosplice"></a><a href="#3.2-nosplice">nosplice</a></b></div><pre class="text">Disables the use of kernel tcp splicing between sockets on Linux. It is
equivalent to the command line argument &quot;-dS&quot;.  Data will then be copied
using conventional and more portable recv/send calls. Kernel tcp splicing is
limited to some very recent instances of kernel 2.6. Most versions between
2.6.25 and 2.6.28 are buggy and will forward corrupted data, so they must not
be used. This option makes it easier to globally disable kernel splicing in
case of doubt. See also &quot;<a href="#option%20splice-auto">option splice-auto</a>&quot;, &quot;<a href="#option%20splice-request">option splice-request</a>&quot; and
&quot;<a href="#option%20splice-response">option splice-response</a>&quot;.
</pre><a class="anchor" name="nogetaddrinfo"></a><a class="anchor" name="3-nogetaddrinfo"></a><a class="anchor" name="3.2-nogetaddrinfo"></a><a class="anchor" name="nogetaddrinfo (Global parameters)"></a><a class="anchor" name="nogetaddrinfo (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="nogetaddrinfo"></a><a href="#3.2-nogetaddrinfo">nogetaddrinfo</a></b></div><pre class="text">Disables the use of getaddrinfo(3) for name resolving. It is equivalent to
the command line argument &quot;-dG&quot;. Deprecated gethostbyname(3) will be used.
</pre><a class="anchor" name="spread-checks"></a><a class="anchor" name="3-spread-checks"></a><a class="anchor" name="3.2-spread-checks"></a><a class="anchor" name="spread-checks (Global parameters)"></a><a class="anchor" name="spread-checks (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="spread-checks"></a><a href="#3.2-spread-checks">spread-checks</a></b> <span style="color: #080">&lt;0..50, in percent&gt;</span></div><pre class="text">Sometimes it is desirable to avoid sending agent and health checks to
servers at exact intervals, for instance when many logical servers are
located on the same physical server. With the help of this parameter, it
becomes possible to add some randomness in the check interval between 0
and +/- 50%. A value between 2 and 5 seems to show good results. The
default value remains at 0.
</pre><a class="anchor" name="tune.bufsize"></a><a class="anchor" name="3-tune.bufsize"></a><a class="anchor" name="3.2-tune.bufsize"></a><a class="anchor" name="tune.bufsize (Global parameters)"></a><a class="anchor" name="tune.bufsize (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.bufsize"></a><a href="#3.2-tune.bufsize">tune.bufsize</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the buffer size to this size (in bytes). Lower values allow more
sessions to coexist in the same amount of RAM, and higher values allow some
applications with very large cookies to work. The default value is 16384 and
can be changed at build time. It is strongly recommended not to change this
from the default value, as very low values will break some services such as
statistics, and values larger than default size will increase memory usage,
possibly causing the system to run out of memory. At least the global maxconn
parameter should be decreased by the same factor as this one is increased.
If HTTP request is larger than (tune.bufsize - tune.maxrewrite), haproxy will
return HTTP 400 (Bad Request) error. Similarly if an HTTP response is larger
than this size, haproxy will return HTTP 502 (Bad Gateway).
</pre><a class="anchor" name="tune.chksize"></a><a class="anchor" name="3-tune.chksize"></a><a class="anchor" name="3.2-tune.chksize"></a><a class="anchor" name="tune.chksize (Global parameters)"></a><a class="anchor" name="tune.chksize (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.chksize"></a><a href="#3.2-tune.chksize">tune.chksize</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the check buffer size to this size (in bytes). Higher values may help
find string or regex patterns in very large pages, though doing so may imply
more memory and CPU usage. The default value is 16384 and can be changed at
build time. It is not recommended to change this value, but to use better
checks whenever possible.
</pre><a class="anchor" name="tune.comp.maxlevel"></a><a class="anchor" name="3-tune.comp.maxlevel"></a><a class="anchor" name="3.2-tune.comp.maxlevel"></a><a class="anchor" name="tune.comp.maxlevel (Global parameters)"></a><a class="anchor" name="tune.comp.maxlevel (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.comp.maxlevel"></a><a href="#3.2-tune.comp.maxlevel">tune.comp.maxlevel</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the maximum compression level. The compression level affects CPU
usage during compression. This value affects CPU usage during compression.
Each session using compression initializes the compression algorithm with
this value. The default value is 1.
</pre><a class="anchor" name="tune.http.cookielen"></a><a class="anchor" name="3-tune.http.cookielen"></a><a class="anchor" name="3.2-tune.http.cookielen"></a><a class="anchor" name="tune.http.cookielen (Global parameters)"></a><a class="anchor" name="tune.http.cookielen (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.http.cookielen"></a><a href="#3.2-tune.http.cookielen">tune.http.cookielen</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the maximum length of captured cookies. This is the maximum value that
the &quot;capture cookie xxx len yyy&quot; will be allowed to take, and any upper value
will automatically be truncated to this one. It is important not to set too
high a value because all cookie captures still allocate this size whatever
their configured value (they share a same pool). This value is per request
per response, so the memory allocated is twice this value per connection.
When not specified, the limit is set to 63 characters. It is recommended not
to change this value.
</pre><a class="anchor" name="tune.http.maxhdr"></a><a class="anchor" name="3-tune.http.maxhdr"></a><a class="anchor" name="3.2-tune.http.maxhdr"></a><a class="anchor" name="tune.http.maxhdr (Global parameters)"></a><a class="anchor" name="tune.http.maxhdr (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.http.maxhdr"></a><a href="#3.2-tune.http.maxhdr">tune.http.maxhdr</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the maximum number of headers in a request. When a request comes with a
number of headers greater than this value (including the first line), it is
rejected with a &quot;400 Bad Request&quot; status code. Similarly, too large responses
are blocked with &quot;502 Bad Gateway&quot;. The default value is 101, which is enough
for all usages, considering that the widely deployed Apache server uses the
same limit. It can be useful to push this limit further to temporarily allow
a buggy application to work by the time it gets fixed. Keep in mind that each
new header consumes 32bits of memory for each session, so don't push this
limit too high.
</pre><a class="anchor" name="tune.idletimer"></a><a class="anchor" name="3-tune.idletimer"></a><a class="anchor" name="3.2-tune.idletimer"></a><a class="anchor" name="tune.idletimer (Global parameters)"></a><a class="anchor" name="tune.idletimer (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.idletimer"></a><a href="#3.2-tune.idletimer">tune.idletimer</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><pre class="text">Sets the duration after which haproxy will consider that an empty buffer is
probably associated with an idle stream. This is used to optimally adjust
some packet sizes while forwarding large and small data alternatively. The
decision to use splice() or to send large buffers in SSL is modulated by this
parameter. The value is in milliseconds between 0 and 65535. A value of zero
means that haproxy will not try to detect idle streams. The default is 1000,
which seems to correctly detect end user pauses (eg: read a page before
clicking). There should be not reason for changing this value. Please check
tune.ssl.maxrecord below.
</pre><a class="anchor" name="tune.maxaccept"></a><a class="anchor" name="3-tune.maxaccept"></a><a class="anchor" name="3.2-tune.maxaccept"></a><a class="anchor" name="tune.maxaccept (Global parameters)"></a><a class="anchor" name="tune.maxaccept (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.maxaccept"></a><a href="#3.2-tune.maxaccept">tune.maxaccept</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the maximum number of consecutive connections a process may accept in a
row before switching to other work. In single process mode, higher numbers
give better performance at high connection rates. However in multi-process
modes, keeping a bit of fairness between processes generally is better to
increase performance. This value applies individually to each listener, so
that the number of processes a listener is bound to is taken into account.
This value defaults to 64. In multi-process mode, it is divided by twice
the number of processes the listener is bound to. Setting this value to -1
completely disables the limitation. It should normally not be needed to tweak
this value.
</pre><a class="anchor" name="tune.maxpollevents"></a><a class="anchor" name="3-tune.maxpollevents"></a><a class="anchor" name="3.2-tune.maxpollevents"></a><a class="anchor" name="tune.maxpollevents (Global parameters)"></a><a class="anchor" name="tune.maxpollevents (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.maxpollevents"></a><a href="#3.2-tune.maxpollevents">tune.maxpollevents</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the maximum amount of events that can be processed at once in a call to
the polling system. The default value is adapted to the operating system. It
has been noticed that reducing it below 200 tends to slightly decrease
latency at the expense of network bandwidth, and increasing it above 200
tends to trade latency for slightly increased bandwidth.
</pre><a class="anchor" name="tune.maxrewrite"></a><a class="anchor" name="3-tune.maxrewrite"></a><a class="anchor" name="3.2-tune.maxrewrite"></a><a class="anchor" name="tune.maxrewrite (Global parameters)"></a><a class="anchor" name="tune.maxrewrite (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.maxrewrite"></a><a href="#3.2-tune.maxrewrite">tune.maxrewrite</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the reserved buffer space to this size in bytes. The reserved space is
used for header rewriting or appending. The first reads on sockets will never
fill more than bufsize-maxrewrite. Historically it has defaulted to half of
bufsize, though that does not make much sense since there are rarely large
numbers of headers to add. Setting it too high prevents processing of large
requests or responses. Setting it too low prevents addition of new headers
to already large requests or to POST requests. It is generally wise to set it
to about 1024. It is automatically readjusted to half of bufsize if it is
larger than that. This means you don't have to worry about it when changing
bufsize.
</pre><a class="anchor" name="tune.pipesize"></a><a class="anchor" name="3-tune.pipesize"></a><a class="anchor" name="3.2-tune.pipesize"></a><a class="anchor" name="tune.pipesize (Global parameters)"></a><a class="anchor" name="tune.pipesize (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.pipesize"></a><a href="#3.2-tune.pipesize">tune.pipesize</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the kernel pipe buffer size to this size (in bytes). By default, pipes
are the default size for the system. But sometimes when using TCP splicing,
it can improve performance to increase pipe sizes, especially if it is
suspected that pipes are not filled and that many calls to splice() are
performed. This has an impact on the kernel's memory footprint, so this must
not be changed if impacts are not understood.
</pre><a class="anchor" name="tune.rcvbuf.client"></a><a class="anchor" name="3-tune.rcvbuf.client"></a><a class="anchor" name="3.2-tune.rcvbuf.client"></a><a class="anchor" name="tune.rcvbuf.client (Global parameters)"></a><a class="anchor" name="tune.rcvbuf.client (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.rcvbuf.client"></a><a href="#3.2-tune.rcvbuf.client">tune.rcvbuf.client</a></b> <span style="color: #080">&lt;number&gt;</span></div><a class="anchor" name="tune.rcvbuf.server"></a><a class="anchor" name="3-tune.rcvbuf.server"></a><a class="anchor" name="3.2-tune.rcvbuf.server"></a><a class="anchor" name="tune.rcvbuf.server (Global parameters)"></a><a class="anchor" name="tune.rcvbuf.server (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.rcvbuf.server"></a><a href="#3.2-tune.rcvbuf.server">tune.rcvbuf.server</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Forces the kernel socket receive buffer size on the client or the server side
to the specified value in bytes. This value applies to all TCP/HTTP frontends
and backends. It should normally never be set, and the default size (0) lets
the kernel autotune this value depending on the amount of available memory.
However it can sometimes help to set it to very low values (eg: 4096) in
order to save kernel memory by preventing it from buffering too large amounts
of received data. Lower values will significantly increase CPU usage though.
</pre><a class="anchor" name="tune.sndbuf.client"></a><a class="anchor" name="3-tune.sndbuf.client"></a><a class="anchor" name="3.2-tune.sndbuf.client"></a><a class="anchor" name="tune.sndbuf.client (Global parameters)"></a><a class="anchor" name="tune.sndbuf.client (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.sndbuf.client"></a><a href="#3.2-tune.sndbuf.client">tune.sndbuf.client</a></b> <span style="color: #080">&lt;number&gt;</span></div><a class="anchor" name="tune.sndbuf.server"></a><a class="anchor" name="3-tune.sndbuf.server"></a><a class="anchor" name="3.2-tune.sndbuf.server"></a><a class="anchor" name="tune.sndbuf.server (Global parameters)"></a><a class="anchor" name="tune.sndbuf.server (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.sndbuf.server"></a><a href="#3.2-tune.sndbuf.server">tune.sndbuf.server</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Forces the kernel socket send buffer size on the client or the server side to
the specified value in bytes. This value applies to all TCP/HTTP frontends
and backends. It should normally never be set, and the default size (0) lets
the kernel autotune this value depending on the amount of available memory.
However it can sometimes help to set it to very low values (eg: 4096) in
order to save kernel memory by preventing it from buffering too large amounts
of received data. Lower values will significantly increase CPU usage though.
Another use case is to prevent write timeouts with extremely slow clients due
to the kernel waiting for a large part of the buffer to be read before
notifying haproxy again.
</pre><a class="anchor" name="tune.ssl.cachesize"></a><a class="anchor" name="3-tune.ssl.cachesize"></a><a class="anchor" name="3.2-tune.ssl.cachesize"></a><a class="anchor" name="tune.ssl.cachesize (Global parameters)"></a><a class="anchor" name="tune.ssl.cachesize (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.ssl.cachesize"></a><a href="#3.2-tune.ssl.cachesize">tune.ssl.cachesize</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the size of the global SSL session cache, in a number of blocks. A block
is large enough to contain an encoded session without peer certificate.
An encoded session with peer certificate is stored in multiple blocks
depending on the size of the peer certificate. A block uses approximately
200 bytes of memory. The default value may be forced at build time, otherwise
defaults to 20000.  When the cache is full, the most idle entries are purged
and reassigned. Higher values reduce the occurrence of such a purge, hence
the number of CPU-intensive SSL handshakes by ensuring that all users keep
their session as long as possible. All entries are pre-allocated upon startup
and are shared between all processes if &quot;<a href="#nbproc">nbproc</a>&quot; is greater than 1. Setting
this value to 0 disables the SSL session cache.
</pre><a class="anchor" name="tune.ssl.force-private-cache"></a><a class="anchor" name="3-tune.ssl.force-private-cache"></a><a class="anchor" name="3.2-tune.ssl.force-private-cache"></a><a class="anchor" name="tune.ssl.force-private-cache (Global parameters)"></a><a class="anchor" name="tune.ssl.force-private-cache (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.ssl.force-private-cache"></a><a href="#3.2-tune.ssl.force-private-cache">tune.ssl.force-private-cache</a></b></div><pre class="text">This boolean disables SSL session cache sharing between all processes. It
should normally not be used since it will force many renegotiations due to
clients hitting a random process. But it may be required on some operating
systems where none of the SSL cache synchronization method may be used. In
this case, adding a first layer of hash-based load balancing before the SSL
layer might limit the impact of the lack of session sharing.
</pre><a class="anchor" name="tune.ssl.lifetime"></a><a class="anchor" name="3-tune.ssl.lifetime"></a><a class="anchor" name="3.2-tune.ssl.lifetime"></a><a class="anchor" name="tune.ssl.lifetime (Global parameters)"></a><a class="anchor" name="tune.ssl.lifetime (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.ssl.lifetime"></a><a href="#3.2-tune.ssl.lifetime">tune.ssl.lifetime</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><pre class="text">Sets how long a cached SSL session may remain valid. This time is expressed
in seconds and defaults to 300 (5 min). It is important to understand that it
does not guarantee that sessions will last that long, because if the cache is
full, the longest idle sessions will be purged despite their configured
lifetime. The real usefulness of this setting is to prevent sessions from
being used for too long.
</pre><a class="anchor" name="tune.ssl.maxrecord"></a><a class="anchor" name="3-tune.ssl.maxrecord"></a><a class="anchor" name="3.2-tune.ssl.maxrecord"></a><a class="anchor" name="tune.ssl.maxrecord (Global parameters)"></a><a class="anchor" name="tune.ssl.maxrecord (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.ssl.maxrecord"></a><a href="#3.2-tune.ssl.maxrecord">tune.ssl.maxrecord</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the maximum amount of bytes passed to SSL_write() at a time. Default
value 0 means there is no limit. Over SSL/TLS, the client can decipher the
data only once it has received a full record. With large records, it means
that clients might have to download up to 16kB of data before starting to
process them. Limiting the value can improve page load times on browsers
located over high latency or low bandwidth networks. It is suggested to find
optimal values which fit into 1 or 2 TCP segments (generally 1448 bytes over
Ethernet with TCP timestamps enabled, or 1460 when timestamps are disabled),
keeping in mind that SSL/TLS add some overhead. Typical values of 1419 and
2859 gave good results during tests. Use &quot;strace -e trace=write&quot; to find the
best value. Haproxy will automatically switch to this setting after an idle
stream has been detected (see tune.idletimer above).
</pre><a class="anchor" name="tune.ssl.default-dh-param"></a><a class="anchor" name="3-tune.ssl.default-dh-param"></a><a class="anchor" name="3.2-tune.ssl.default-dh-param"></a><a class="anchor" name="tune.ssl.default-dh-param (Global parameters)"></a><a class="anchor" name="tune.ssl.default-dh-param (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.ssl.default-dh-param"></a><a href="#3.2-tune.ssl.default-dh-param">tune.ssl.default-dh-param</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the maximum size of the Diffie-Hellman parameters used for generating
the ephemeral/temporary Diffie-Hellman key in case of DHE key exchange. The
final size will try to match the size of the server's RSA (or DSA) key (e.g,
a 2048 bits temporary DH key for a 2048 bits RSA key), but will not exceed
this maximum value. Default value if 1024. Only 1024 or higher values are
allowed. Higher values will increase the CPU load, and values greater than
1024 bits are not supported by Java 7 and earlier clients. This value is not
used if static Diffie-Hellman parameters are supplied via the certificate file.
</pre><a class="anchor" name="tune.zlib.memlevel"></a><a class="anchor" name="3-tune.zlib.memlevel"></a><a class="anchor" name="3.2-tune.zlib.memlevel"></a><a class="anchor" name="tune.zlib.memlevel (Global parameters)"></a><a class="anchor" name="tune.zlib.memlevel (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.zlib.memlevel"></a><a href="#3.2-tune.zlib.memlevel">tune.zlib.memlevel</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the memLevel parameter in zlib initialization for each session. It
defines how much memory should be allocated for the internal compression
state. A value of 1 uses minimum memory but is slow and reduces compression
ratio, a value of 9 uses maximum memory for optimal speed.  Can be a value
between 1 and 9. The default value is 8.
</pre><a class="anchor" name="tune.zlib.windowsize"></a><a class="anchor" name="3-tune.zlib.windowsize"></a><a class="anchor" name="3.2-tune.zlib.windowsize"></a><a class="anchor" name="tune.zlib.windowsize (Global parameters)"></a><a class="anchor" name="tune.zlib.windowsize (Performance tuning)"></a><div class="keyword"><b><a class="anchor" name="tune.zlib.windowsize"></a><a href="#3.2-tune.zlib.windowsize">tune.zlib.windowsize</a></b> <span style="color: #080">&lt;number&gt;</span></div><pre class="text">Sets the window size (the size of the history buffer) as a parameter of the
zlib initialization for each session. Larger values of this parameter result
in better compression at the expense of memory usage.  Can be a value between
8 and 15.  The default value is 15.
</pre></div>
<a class="anchor" id="3.3" name="3.3"></a>
<h2 id="chapter-3.3" data-target="3.3"><small><a class="small" href="#3.3">3.3.</a></small> Debugging</h2>
<div><a class="anchor" name="debug"></a><a class="anchor" name="3-debug"></a><a class="anchor" name="3.3-debug"></a><a class="anchor" name="debug (Global parameters)"></a><a class="anchor" name="debug (Debugging)"></a><div class="keyword"><b><a class="anchor" name="debug"></a><a href="#3.3-debug">debug</a></b></div><pre class="text">Enables debug mode which dumps to stdout all exchanges, and disables forking
into background. It is the equivalent of the command-line argument &quot;-d&quot;. It
should never be used in a production configuration since it may prevent full
system startup.
</pre><a class="anchor" name="quiet"></a><a class="anchor" name="3-quiet"></a><a class="anchor" name="3.3-quiet"></a><a class="anchor" name="quiet (Global parameters)"></a><a class="anchor" name="quiet (Debugging)"></a><div class="keyword"><b><a class="anchor" name="quiet"></a><a href="#3.3-quiet">quiet</a></b></div><pre class="text">Do not display any message during startup. It is equivalent to the command-
line argument &quot;-q&quot;.
</pre></div>
<a class="anchor" id="3.4" name="3.4"></a>
<h2 id="chapter-3.4" data-target="3.4"><small><a class="small" href="#3.4">3.4.</a></small> Userlists</h2>
<div><pre class="text">It is possible to control access to frontend/backend/listen sections or to
http stats by allowing only authenticated and authorized users. To do this,
it is required to create at least one userlist and to define users.
</pre><a class="anchor" name="userlist"></a><a class="anchor" name="3-userlist"></a><a class="anchor" name="3.4-userlist"></a><a class="anchor" name="userlist (Global parameters)"></a><a class="anchor" name="userlist (Userlists)"></a><div class="keyword"><b><a class="anchor" name="userlist"></a><a href="#3.4-userlist">userlist</a></b> <span style="color: #080">&lt;listname&gt;</span></div><pre class="text">Creates new userlist with name &lt;listname&gt;. Many independent userlists can be
used to store authentication &amp; authorization data for independent customers.
</pre><a class="anchor" name="group"></a><a class="anchor" name="3-group"></a><a class="anchor" name="3.4-group"></a><a class="anchor" name="group (Global parameters)"></a><a class="anchor" name="group (Userlists)"></a><div class="keyword"><b><a class="anchor" name="group"></a><a href="#3.4-group">group</a></b> <span style="color: #080">&lt;groupname&gt;</span> <span style="color: #008">[users <span style="color: #080">&lt;user&gt;</span>,<span style="color: #080">&lt;user&gt;</span>,(...)]</span></div><pre class="text">Adds group &lt;groupname&gt; to the current userlist. It is also possible to
attach users to this group by using a comma separated list of names
proceeded by &quot;users&quot; keyword.
</pre><a class="anchor" name="user"></a><a class="anchor" name="3-user"></a><a class="anchor" name="3.4-user"></a><a class="anchor" name="user (Global parameters)"></a><a class="anchor" name="user (Userlists)"></a><div class="keyword"><b><a class="anchor" name="user"></a><a href="#3.4-user">user</a></b> <span style="color: #080">&lt;username&gt;</span> <span style="color: #008">[password|insecure-password <span style="color: #080">&lt;password&gt;</span>]</span>
                <span style="color: #008">[groups <span style="color: #080">&lt;group&gt;</span>,<span style="color: #080">&lt;group&gt;</span>,(...)]</span></div><pre class="text">Adds user &lt;username&gt; to the current userlist. Both secure (encrypted) and
insecure (unencrypted) passwords can be used. Encrypted passwords are
evaluated using the crypt(3) function so depending of the system's
capabilities, different algorithms are supported. For example modern Glibc
based Linux system supports MD5, SHA-256, SHA-512 and of course classic,
DES-based method of encrypting passwords.
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>userlist L1
  group G1 users tiger,scott
  group G2 users xdb,scott

  user tiger password $6$k6y3o.eP$JlKBx9za9667qe4(...)xHSwRv6J.C0/D7cV91
  user scott insecure-password elgato
  user xdb insecure-password hello

userlist L2
  group G1
  group G2

  user tiger password $6$k6y3o.eP$JlKBx(...)xHSwRv6J.C0/D7cV91 groups G1
  user scott insecure-password elgato groups G1,G2
  user xdb insecure-password hello groups G2
</code></pre>
</div><pre class="text">Please note that both lists are functionally identical.
</pre></div>
<a class="anchor" id="3.5" name="3.5"></a>
<h2 id="chapter-3.5" data-target="3.5"><small><a class="small" href="#3.5">3.5.</a></small> Peers</h2>
<div><pre class="text">It is possible to synchronize server entries in stick tables between several
haproxy instances over TCP connections in a multi-master fashion. Each instance
pushes its local updates and insertions to remote peers. Server IDs are used to
identify servers remotely, so it is important that configurations look similar
or at least that the same IDs are forced on each server on all participants.
Interrupted exchanges are automatically detected and recovered from the last
known point. In addition, during a soft restart, the old process connects to
the new one using such a TCP connection to push all its entries before the new
process tries to connect to other peers. That ensures very fast replication
during a reload, it typically takes a fraction of a second even for large
tables.
</pre><a class="anchor" name="peers"></a><a class="anchor" name="3-peers"></a><a class="anchor" name="3.5-peers"></a><a class="anchor" name="peers (Global parameters)"></a><a class="anchor" name="peers (Peers)"></a><div class="keyword"><b><a class="anchor" name="peers"></a><a href="#3.5-peers">peers</a></b> <span style="color: #080">&lt;peersect&gt;</span></div><pre class="text">Creates a new peer list with name &lt;peersect&gt;. It is an independent section,
which is referenced by one or more stick-tables.
</pre><a class="anchor" name="peer"></a><a class="anchor" name="3-peer"></a><a class="anchor" name="3.5-peer"></a><a class="anchor" name="peer (Global parameters)"></a><a class="anchor" name="peer (Peers)"></a><div class="keyword"><b><a class="anchor" name="peer"></a><a href="#3.5-peer">peer</a></b> <span style="color: #080">&lt;peername&gt;</span> <span style="color: #080">&lt;ip&gt;</span>:<span style="color: #080">&lt;port&gt;</span></div><pre class="text">Defines a peer inside a peers section.
If &lt;peername&gt; is set to the local peer name (by default hostname, or forced
using &quot;-L&quot; command line option), haproxy will listen for incoming remote peer
connection on &lt;ip&gt;:&lt;port&gt;. Otherwise, &lt;ip&gt;:&lt;port&gt; defines where to connect to
to join the remote peer, and &lt;peername&gt; is used at the protocol level to
identify and validate the remote peer on the server side.

During a soft restart, local peer &lt;ip&gt;:&lt;port&gt; is used by the old instance to
connect the new one and initiate a complete replication (teaching process).

It is strongly recommended to have the exact same peers declaration on all
peers and to only rely on the &quot;-L&quot; command line argument to change the local
peer name. This makes it easier to maintain coherent configuration files
across all peers.

Any part of the address string may reference any number of environment
variables by preceding their name with a dollar sign ('$') and optionally
enclosing them with braces ('{}'), similarly to what is done in Bourne shell.
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>peers mypeers
    peer haproxy1 192.168.0.1:1024
    peer haproxy2 192.168.0.2:1024
    peer haproxy3 10.2.0.1:1024

backend mybackend
    mode tcp
    balance roundrobin
    stick-table type ip size 20k peers mypeers
    stick on src

    server srv1 192.168.0.30:80
    server srv2 192.168.0.31:80
</code></pre>
</div></div>
<a class="anchor" id="4" name="4"></a>
<div class="page-header"><h1 id="chapter-4" data-target="4"><small><a class="small" href="#4">4.</a></small> Proxies</h1>
</div><div><pre class="text">Proxy configuration can be located in a set of sections :
 - defaults &lt;name&gt;
 - frontend &lt;name&gt;
 - backend  &lt;name&gt;
 - listen   &lt;name&gt;

A &quot;defaults&quot; section sets default parameters for all other sections following
its declaration. Those default parameters are reset by the next &quot;defaults&quot;
section. See below for the list of parameters which can be set in a &quot;defaults&quot;
section. The name is optional but its use is encouraged for better readability.

A &quot;frontend&quot; section describes a set of listening sockets accepting client
connections.

A &quot;backend&quot; section describes a set of servers to which the proxy will connect
to forward incoming connections.

A &quot;listen&quot; section defines a complete proxy with its frontend and backend
parts combined in one section. It is generally useful for TCP-only traffic.

All proxy names must be formed from upper and lower case letters, digits,
'-' (dash), '_' (underscore) , '.' (dot) and ':' (colon). ACL names are
case-sensitive, which means that &quot;www&quot; and &quot;WWW&quot; are two different proxies.

Historically, all proxy names could overlap, it just caused troubles in the
logs. Since the introduction of content switching, it is mandatory that two
proxies with overlapping capabilities (frontend/backend) have different names.
However, it is still permitted that a frontend and a backend share the same
name, as this configuration seems to be commonly encountered.

Right now, two major proxy modes are supported : &quot;tcp&quot;, also known as layer 4,
and &quot;http&quot;, also known as layer 7. In layer 4 mode, HAProxy simply forwards
bidirectional traffic between two sides. In layer 7 mode, HAProxy analyzes the
protocol, and can interact with it by allowing, blocking, switching, adding,
modifying, or removing arbitrary contents in requests or responses, based on
arbitrary criteria.

In HTTP mode, the processing applied to requests and responses flowing over
a connection depends in the combination of the frontend's HTTP options and
the backend's. HAProxy supports 5 connection modes :

  - KAL : keep alive (&quot;<a href="#option%20http-keep-alive">option http-keep-alive</a>&quot;) which is the default mode : all
    requests and responses are processed, and connections remain open but idle
    between responses and new requests.

  - TUN: tunnel (&quot;<a href="#option%20http-tunnel">option http-tunnel</a>&quot;) : this was the default mode for versions
    1.0 to 1.5-dev21 : only the first request and response are processed, and
    everything else is forwarded with no analysis at all. This mode should not
    be used as it creates lots of trouble with logging and HTTP processing.

  - PCL: passive close (&quot;<a href="#option%20httpclose">option httpclose</a>&quot;) : exactly the same as tunnel mode,
    but with &quot;Connection: close&quot; appended in both directions to try to make
    both ends close after the first request/response exchange.

  - SCL: server close (&quot;<a href="#option%20http-server-close">option http-server-close</a>&quot;) : the server-facing
    connection is closed after the end of the response is received, but the
    client-facing connection remains open.

  - FCL: forced close (&quot;<a href="#option%20forceclose">option forceclose</a>&quot;) : the connection is actively closed
    after the end of the response.

The effective mode that will be applied to a connection passing through a
frontend and a backend can be determined by both proxy modes according to the
following matrix, but in short, the modes are symmetric, keep-alive is the
weakest option and force close is the strongest.

                          Backend mode

                | KAL | TUN | PCL | SCL | FCL
            ----+-----+-----+-----+-----+----
            KAL | KAL | TUN | PCL | SCL | FCL
            ----+-----+-----+-----+-----+----
            TUN | TUN | TUN | PCL | SCL | FCL
 Frontend   ----+-----+-----+-----+-----+----
   mode     PCL | PCL | PCL | PCL | FCL | FCL
            ----+-----+-----+-----+-----+----
            SCL | SCL | SCL | FCL | SCL | FCL
            ----+-----+-----+-----+-----+----
            FCL | FCL | FCL | FCL | FCL | FCL
</pre></div>
<a class="anchor" id="4.1" name="4.1"></a>
<h2 id="chapter-4.1" data-target="4.1"><small><a class="small" href="#4.1">4.1.</a></small> Proxy keywords matrix</h2>
<div><pre class="text">The following list of keywords is supported. Most of them may only be used in a
limited set of section types. Some of them are marked as &quot;deprecated&quot; because
they are inherited from an old syntax which may be confusing or functionally
limited, and there are new recommended keywords to replace them. Keywords
marked with &quot;(*)&quot; can be optionally inverted using the &quot;no&quot; prefix, eg. &quot;no
option contstats&quot;. This makes sense when the option has been enabled by default
and must be disabled for a specific instance. Such options may also be prefixed
with &quot;default&quot; in order to restore default settings regardless of what has been
specified in a previous &quot;defaults&quot; section.
</pre><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>keyword</th><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td None><a href="#4-acl">acl</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-appsession">appsession</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-backlog">backlog</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-balance">balance</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-bind">bind</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-bind-process">bind-process</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-block">block</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-capture%20cookie">capture cookie</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-capture%20request%20header">capture request header</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-capture%20response%20header">capture response header</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-clitimeout"><span class="pull-right"><span class="label label-warning">(deprecated)</span></span>clitimeout</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-compression">compression</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-contimeout"><span class="pull-right"><span class="label label-warning">(deprecated)</span></span>contimeout</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-cookie">cookie</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-default-server">default-server</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-default_backend">default_backend</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-description">description</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-disabled">disabled</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-dispatch">dispatch</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-enabled">enabled</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<thead><tr><th>keyword</th><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td None><a href="#4-errorfile">errorfile</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-errorloc">errorloc</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-errorloc302">errorloc302</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-errorloc303">errorloc303</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-force-persist">force-persist</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-fullconn">fullconn</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-grace">grace</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-hash-type">hash-type</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-http-check%20disable-on-404">http-check disable-on-404</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-http-check%20expect">http-check expect</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-http-check%20send-state">http-check send-state</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-http-request">http-request</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-http-response">http-response</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-http-send-name-header">http-send-name-header</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-id">id</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-ignore-persist">ignore-persist</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-log"><span class="pull-right"><span>(*)</span></span>log</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-max-keep-alive-queue">max-keep-alive-queue</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-maxconn">maxconn</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-mode">mode</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<thead><tr><th>keyword</th><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td None><a href="#4-monitor%20fail">monitor fail</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-monitor-net">monitor-net</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-monitor-uri">monitor-uri</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-option%20abortonclose"><span class="pull-right"><span>(*)</span></span>option abortonclose</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20accept-invalid-http-request"><span class="pull-right"><span>(*)</span></span>option accept-invalid-http-request</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-option%20accept-invalid-http-response"><span class="pull-right"><span>(*)</span></span>option accept-invalid-http-response</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20allbackups"><span class="pull-right"><span>(*)</span></span>option allbackups</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20checkcache"><span class="pull-right"><span>(*)</span></span>option checkcache</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20clitcpka"><span class="pull-right"><span>(*)</span></span>option clitcpka</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-option%20contstats"><span class="pull-right"><span>(*)</span></span>option contstats</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-option%20dontlog-normal"><span class="pull-right"><span>(*)</span></span>option dontlog-normal</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-option%20dontlognull"><span class="pull-right"><span>(*)</span></span>option dontlognull</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-option%20forceclose"><span class="pull-right"><span>(*)</span></span>option forceclose</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20forwardfor">option forwardfor</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20http-keep-alive"><span class="pull-right"><span>(*)</span></span>option http-keep-alive</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20http-no-delay"><span class="pull-right"><span>(*)</span></span>option http-no-delay</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20http-pretend-keepalive"><span class="pull-right"><span>(*)</span></span>option http-pretend-keepalive</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20http-server-close"><span class="pull-right"><span>(*)</span></span>option http-server-close</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20http-tunnel"><span class="pull-right"><span>(*)</span></span>option http-tunnel</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20http-use-proxy-header"><span class="pull-right"><span>(*)</span></span>option http-use-proxy-header</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<thead><tr><th>keyword</th><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td None><a href="#4-option%20httpchk">option httpchk</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20httpclose"><span class="pull-right"><span>(*)</span></span>option httpclose</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20httplog">option httplog</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20http_proxy"><span class="pull-right"><span>(*)</span></span>option http_proxy</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20independent-streams"><span class="pull-right"><span>(*)</span></span>option independent-streams</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20ldap-check">option ldap-check</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20log-health-checks"><span class="pull-right"><span>(*)</span></span>option log-health-checks</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20log-separate-errors"><span class="pull-right"><span>(*)</span></span>option log-separate-errors</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-option%20logasap"><span class="pull-right"><span>(*)</span></span>option logasap</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-option%20mysql-check">option mysql-check</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20pgsql-check">option pgsql-check</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20nolinger"><span class="pull-right"><span>(*)</span></span>option nolinger</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20originalto">option originalto</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20persist"><span class="pull-right"><span>(*)</span></span>option persist</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20redispatch"><span class="pull-right"><span>(*)</span></span>option redispatch</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20redis-check">option redis-check</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20smtpchk">option smtpchk</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20socket-stats"><span class="pull-right"><span>(*)</span></span>option socket-stats</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-option%20splice-auto"><span class="pull-right"><span>(*)</span></span>option splice-auto</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20splice-request"><span class="pull-right"><span>(*)</span></span>option splice-request</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<thead><tr><th>keyword</th><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td None><a href="#4-option%20splice-response"><span class="pull-right"><span>(*)</span></span>option splice-response</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20srvtcpka"><span class="pull-right"><span>(*)</span></span>option srvtcpka</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20ssl-hello-chk">option ssl-hello-chk</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20tcp-check">option tcp-check</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20tcp-smart-accept"><span class="pull-right"><span>(*)</span></span>option tcp-smart-accept</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-option%20tcp-smart-connect"><span class="pull-right"><span>(*)</span></span>option tcp-smart-connect</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20tcpka">option tcpka</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20tcplog">option tcplog</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-option%20transparent"><span class="pull-right"><span>(*)</span></span>option transparent</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-persist%20rdp-cookie">persist rdp-cookie</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-rate-limit%20sessions">rate-limit sessions</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-redirect">redirect</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-redisp"><span class="pull-right"><span class="label label-warning">(deprecated)</span></span>redisp</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-redispatch"><span class="pull-right"><span class="label label-warning">(deprecated)</span></span>redispatch</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqadd">reqadd</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqallow">reqallow</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqdel">reqdel</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqdeny">reqdeny</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqiallow">reqiallow</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqidel">reqidel</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<thead><tr><th>keyword</th><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td None><a href="#4-reqideny">reqideny</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqipass">reqipass</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqirep">reqirep</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqisetbe">reqisetbe</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqitarpit">reqitarpit</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqpass">reqpass</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqrep">reqrep</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqsetbe">reqsetbe</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-reqtarpit">reqtarpit</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-retries">retries</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-rspadd">rspadd</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-rspdel">rspdel</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-rspdeny">rspdeny</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-rspidel">rspidel</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-rspideny">rspideny</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-rspirep">rspirep</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-rsprep">rsprep</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-server">server</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-source">source</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-srvtimeout"><span class="pull-right"><span class="label label-warning">(deprecated)</span></span>srvtimeout</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<thead><tr><th>keyword</th><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td None><a href="#4-stats%20admin">stats admin</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stats%20auth">stats auth</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stats%20enable">stats enable</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stats%20hide-version">stats hide-version</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stats%20http-request">stats http-request</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stats%20realm">stats realm</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stats%20refresh">stats refresh</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stats%20scope">stats scope</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stats%20show-desc">stats show-desc</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stats%20show-legends">stats show-legends</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stats%20show-node">stats show-node</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stats%20uri">stats uri</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stick%20match">stick match</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stick%20on">stick on</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stick%20store-request">stick store-request</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stick%20store-response">stick store-response</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-stick-table">stick-table</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-tcp-check%20connect">tcp-check connect</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-tcp-check%20expect">tcp-check expect</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-tcp-check%20send">tcp-check send</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<thead><tr><th>keyword</th><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td None><a href="#4-tcp-check%20send-binary">tcp-check send-binary</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-tcp-request%20connection">tcp-request connection</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-tcp-request%20content">tcp-request content</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-tcp-request%20inspect-delay">tcp-request inspect-delay</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-tcp-response%20content">tcp-response content</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-tcp-response%20inspect-delay">tcp-response inspect-delay</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-timeout%20check">timeout check</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-timeout%20client">timeout client</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-timeout%20client-fin">timeout client-fin</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-timeout%20clitimeout"><span class="pull-right"><span class="label label-warning">(deprecated)</span></span>timeout clitimeout</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-timeout%20connect">timeout connect</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-timeout%20contimeout"><span class="pull-right"><span class="label label-warning">(deprecated)</span></span>timeout contimeout</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-timeout%20http-keep-alive">timeout http-keep-alive</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-timeout%20http-request">timeout http-request</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-timeout%20queue">timeout queue</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-timeout%20server">timeout server</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-timeout%20server-fin">timeout server-fin</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-timeout%20srvtimeout"><span class="pull-right"><span class="label label-warning">(deprecated)</span></span>timeout srvtimeout</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-timeout%20tarpit">timeout tarpit</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-timeout%20tunnel">timeout tunnel</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<thead><tr><th>keyword</th><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td None><a href="#4-transparent"><span class="pull-right"><span class="label label-warning">(deprecated)</span></span>transparent</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
<tr><td None><a href="#4-unique-id-format">unique-id-format</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-unique-id-header">unique-id-header</a></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-use_backend">use_backend</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered">&nbsp;</td></tr>
<tr><td None><a href="#4-use-server">use-server</a></td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered">&nbsp;</td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td><td class="pagination-centered"><img src="css/check.png" alt="X" title="yes" /></td></tr>
</table></div>
<a class="anchor" id="4.2" name="4.2"></a>
<h2 id="chapter-4.2" data-target="4.2"><small><a class="small" href="#4.2">4.2.</a></small> Alphabetically sorted keywords reference</h2>
<div><pre class="text">This section provides a description of each keyword and its usage.
</pre><a class="anchor" name="acl"></a><a class="anchor" name="4-acl"></a><a class="anchor" name="4.2-acl"></a><a class="anchor" name="acl (Proxies)"></a><a class="anchor" name="acl (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="acl"></a><a href="#4.2-acl">acl</a></b> <span style="color: #080">&lt;aclname&gt;</span> <span style="color: #080">&lt;criterion&gt;</span> <span style="color: #008">[flags]</span> <span style="color: #008">[operator]</span> <span style="color: #080">&lt;value&gt;</span> ...</div><pre class="text">Declare or complete an access list.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>acl invalid_src  src          0.0.0.0/7 224.0.0.0/3
acl invalid_src  src_port     0:1023
acl local_dst    hdr(host) -i localhost
</code></pre>
</div><pre class="text">See <a href="#7">section 7</a> about ACL usage.
</pre><a class="anchor" name="appsession"></a><a class="anchor" name="4-appsession"></a><a class="anchor" name="4.2-appsession"></a><a class="anchor" name="appsession (Proxies)"></a><a class="anchor" name="appsession (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="appsession"></a><a href="#4.2-appsession">appsession</a></b> <span style="color: #080">&lt;cookie&gt;</span> len <span style="color: #080">&lt;length&gt;</span> timeout <span style="color: #080">&lt;holdtime&gt;</span>
           <span style="color: #008">[request-learn]</span> <span style="color: #008">[prefix]</span> <span style="color: #008">[mode <span style="color: #080">&lt;path-parameters|query-string&gt;</span>]</span></div><pre class="text">Define session stickiness on an existing application cookie.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;cookie&gt;   this is the name of the cookie used by the application and which
           HAProxy will have to learn for each new session.

&lt;length&gt;   this is the max number of characters that will be memorized and
           checked in each cookie value.

&lt;holdtime&gt; this is the time after which the cookie will be removed from
           memory if unused. If no unit is specified, this time is in
           milliseconds.

request-learn
           If this option is specified, then haproxy will be able to learn
           the cookie found in the request in case the server does not
           specify any in response. This is typically what happens with
           PHPSESSID cookies, or when haproxy's session expires before
           the application's session and the correct server is selected.
           It is recommended to specify this option to improve reliability.

prefix     When this option is specified, haproxy will match on the cookie
           prefix (or URL parameter prefix). The appsession value is the
           data following this prefix.

           Example :
           appsession ASPSESSIONID len 64 timeout 3h prefix

           This will match the cookie ASPSESSIONIDXXXX=XXXXX,
           the appsession value will be XXXX=XXXXX.

mode       This option allows to change the URL parser mode.
           2 modes are currently supported :
           - path-parameters :
             The parser looks for the appsession in the path parameters
             part (each parameter is separated by a semi-colon), which is
             convenient for JSESSIONID for example.
             This is the default mode if the option is not set.
           - query-string :
             In this mode, the parser will look for the appsession in the
             query string.</pre>
</div>
<pre class="text">When an application cookie is defined in a backend, HAProxy will check when
the server sets such a cookie, and will store its value in a table, and
associate it with the server's identifier. Up to &lt;length&gt; characters from
the value will be retained. On each connection, haproxy will look for this
cookie both in the &quot;Cookie:&quot; headers, and as a URL parameter (depending on
the mode used). If a known value is found, the client will be directed to the
server associated with this value. Otherwise, the load balancing algorithm is
applied. Cookies are automatically removed from memory when they have been
unused for a duration longer than &lt;holdtime&gt;.

The definition of an application cookie is limited to one per backend.

Note : Consider not using this feature in multi-process mode (nbproc &gt; 1)
       unless you know what you do : memory is not shared between the
       processes, which can result in random behaviours.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>appsession JSESSIONID len 52 timeout 3h
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">cookie<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#cookie%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#cookie%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li><li><a href="#cookie%20%28Fetching%20HTTP%20samples%20%28Layer%207%29%29">Fetching HTTP samples (Layer 7)</a></li></ul></span>&quot;, &quot;<a href="#capture%20cookie">capture cookie</a>&quot;, &quot;<a href="#balance">balance</a>&quot;, &quot;<a href="#stick">stick</a>&quot;, &quot;<a href="#stick-table">stick-table</a>&quot;, &quot;<a href="#ignore-persist">ignore-persist</a>&quot;, &quot;<a href="#nbproc">nbproc</a>&quot; and &quot;<a href="#bind-process">bind-process</a>&quot;.</div>
<a class="anchor" name="backlog"></a><a class="anchor" name="4-backlog"></a><a class="anchor" name="4.2-backlog"></a><a class="anchor" name="backlog (Proxies)"></a><a class="anchor" name="backlog (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="backlog"></a><a href="#4.2-backlog">backlog</a></b> <span style="color: #080">&lt;conns&gt;</span></div><pre class="text">Give hints to the system about the approximate listen backlog desired size
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;conns&gt;   is the number of pending connections. Depending on the operating
          system, it may represent the number of already acknowledged
          connections, of non-acknowledged ones, or both.</pre>
</div>
<pre class="text">In order to protect against SYN flood attacks, one solution is to increase
the system's SYN backlog size. Depending on the system, sometimes it is just
tunable via a system parameter, sometimes it is not adjustable at all, and
sometimes the system relies on hints given by the application at the time of
the listen() syscall. By default, HAProxy passes the frontend's maxconn value
to the listen() syscall. On systems which can make use of this value, it can
sometimes be useful to be able to specify a different value, hence this
backlog parameter.

On Linux 2.4, the parameter is ignored by the system. On Linux 2.6, it is
used as a hint and the system accepts up to the smallest greater power of
two, and never more than some limits (usually 32768).
</pre><div class="page-header"><b>See also :</b> &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Performance%20tuning%29">Performance tuning</a></li><li><a href="#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#maxconn%20%28Bind%20options%29">Bind options</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; and the target operating system's tuning guide.</div>
<a class="anchor" name="balance"></a><a class="anchor" name="4-balance"></a><a class="anchor" name="4.2-balance"></a><a class="anchor" name="balance (Proxies)"></a><a class="anchor" name="balance (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="balance"></a><a href="#4.2-balance">balance</a></b> <span style="color: #080">&lt;algorithm&gt;</span> <span style="color: #008">[ <span style="color: #080">&lt;arguments&gt;</span> ]</span></div><a class="anchor" name="balance"></a><a class="anchor" name="4-balance"></a><a class="anchor" name="4.2-balance"></a><a class="anchor" name="balance (Proxies)"></a><a class="anchor" name="balance (Alphabetically sorted keywords reference)"></a><a class="anchor" name="balance url_param"></a><a class="anchor" name="4-balance url_param"></a><a class="anchor" name="4.2-balance url_param"></a><a class="anchor" name="balance url_param (Proxies)"></a><a class="anchor" name="balance url_param (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="balance url_param"></a><a href="#4.2-balance%20url_param">balance url_param</a></b> <span style="color: #080">&lt;param&gt;</span> <span style="color: #008">[check_post]</span></div><pre class="text">Define the load balancing algorithm to be used in a backend.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;algorithm&gt; is the algorithm used to select a server when doing load
            balancing. This only applies when no persistence information
            is available, or when a connection is redispatched to another
            server. &lt;algorithm&gt; may be one of the following :

  roundrobin  Each server is used in turns, according to their weights.
              This is the smoothest and fairest algorithm when the server's
              processing time remains equally distributed. This algorithm
              is dynamic, which means that server weights may be adjusted
              on the fly for slow starts for instance. It is limited by
              design to 4095 active servers per backend. Note that in some
              large farms, when a server becomes up after having been down
              for a very short time, it may sometimes take a few hundreds
              requests for it to be re-integrated into the farm and start
              receiving traffic. This is normal, though very rare. It is
              indicated here in case you would have the chance to observe
              it, so that you don't worry.

  static-rr   Each server is used in turns, according to their weights.
              This algorithm is as similar to roundrobin except that it is
              static, which means that changing a server's weight on the
              fly will have no effect. On the other hand, it has no design
              limitation on the number of servers, and when a server goes
              up, it is always immediately reintroduced into the farm, once
              the full map is recomputed. It also uses slightly less CPU to
              run (around -1%).

  leastconn   The server with the lowest number of connections receives the
              connection. Round-robin is performed within groups of servers
              of the same load to ensure that all servers will be used. Use
              of this algorithm is recommended where very long sessions are
              expected, such as LDAP, SQL, TSE, etc... but is not very well
              suited for protocols using short sessions such as HTTP. This
              algorithm is dynamic, which means that server weights may be
              adjusted on the fly for slow starts for instance.

  first       The first server with available connection slots receives the
              connection. The servers are chosen from the lowest numeric
              identifier to the highest (see server parameter &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">id<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#id%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#id%20%28Bind%20options%29">Bind options</a></li><li><a href="#id%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;), which
              defaults to the server's position in the farm. Once a server
              reaches its maxconn value, the next server is used. It does
              not make sense to use this algorithm without setting maxconn.
              The purpose of this algorithm is to always use the smallest
              number of servers so that extra servers can be powered off
              during non-intensive hours. This algorithm ignores the server
              weight, and brings more benefit to long session such as RDP
              or IMAP than HTTP, though it can be useful there too. In
              order to use this algorithm efficiently, it is recommended
              that a cloud controller regularly checks server usage to turn
              them off when unused, and regularly checks backend queue to
              turn new servers on when the queue inflates. Alternatively,
              using &quot;<a href="#http-check%20send-state">http-check send-state</a>&quot; may inform servers on the load.

  source      The source IP address is hashed and divided by the total
              weight of the running servers to designate which server will
              receive the request. This ensures that the same client IP
              address will always reach the same server as long as no
              server goes down or up. If the hash result changes due to the
              number of running servers changing, many clients will be
              directed to a different server. This algorithm is generally
              used in TCP mode where no cookie may be inserted. It may also
              be used on the Internet to provide a best-effort stickiness
              to clients which refuse session cookies. This algorithm is
              static by default, which means that changing a server's
              weight on the fly will have no effect, but this can be
              changed using &quot;<a href="#hash-type">hash-type</a>&quot;.

  uri         This algorithm hashes either the left part of the URI (before
              the question mark) or the whole URI (if the &quot;whole&quot; parameter
              is present) and divides the hash value by the total weight of
              the running servers. The result designates which server will
              receive the request. This ensures that the same URI will
              always be directed to the same server as long as no server
              goes up or down. This is used with proxy caches and
              anti-virus proxies in order to maximize the cache hit rate.
              Note that this algorithm may only be used in an HTTP backend.
              This algorithm is static by default, which means that
              changing a server's weight on the fly will have no effect,
              but this can be changed using &quot;<a href="#hash-type">hash-type</a>&quot;.

              This algorithm supports two optional parameters &quot;len&quot; and
              &quot;depth&quot;, both followed by a positive integer number. These
              options may be helpful when it is needed to balance servers
              based on the beginning of the URI only. The &quot;len&quot; parameter
              indicates that the algorithm should only consider that many
              characters at the beginning of the URI to compute the hash.
              Note that having &quot;len&quot; set to 1 rarely makes sense since most
              URIs start with a leading &quot;/&quot;.

              The &quot;depth&quot; parameter indicates the maximum directory depth
              to be used to compute the hash. One level is counted for each
              slash in the request. If both parameters are specified, the
              evaluation stops when either is reached.

  url_param   The URL parameter specified in argument will be looked up in
              the query string of each HTTP GET request.

              If the modifier &quot;check_post&quot; is used, then an HTTP POST
              request entity will be searched for the parameter argument,
              when it is not found in a query string after a question mark
              ('?') in the URL. The message body will only start to be
              analyzed once either the advertised amount of data has been
              received or the request buffer is full. In the unlikely event
              that chunked encoding is used, only the first chunk is
              scanned. Parameter values separated by a chunk boundary, may
              be randomly balanced if at all. This keyword used to support
              an optional &lt;max_wait&gt; parameter which is now ignored.

              If the parameter is found followed by an equal sign ('=') and
              a value, then the value is hashed and divided by the total
              weight of the running servers. The result designates which
              server will receive the request.

              This is used to track user identifiers in requests and ensure
              that a same user ID will always be sent to the same server as
              long as no server goes up or down. If no value is found or if
              the parameter is not found, then a round robin algorithm is
              applied. Note that this algorithm may only be used in an HTTP
              backend. This algorithm is static by default, which means
              that changing a server's weight on the fly will have no
              effect, but this can be changed using &quot;<a href="#hash-type">hash-type</a>&quot;.

  hdr(&lt;name&gt;) The HTTP header &lt;name&gt; will be looked up in each HTTP
              request. Just as with the equivalent ACL 'hdr()' function,
              the header name in parenthesis is not case sensitive. If the
              header is absent or if it does not contain any value, the
              roundrobin algorithm is applied instead.

              An optional 'use_domain_only' parameter is available, for
              reducing the hash algorithm to the main domain part with some
              specific headers such as 'Host'. For instance, in the Host
              value &quot;haproxy.1wt.eu&quot;, only &quot;1wt&quot; will be considered.

              This algorithm is static by default, which means that
              changing a server's weight on the fly will have no effect,
              but this can be changed using &quot;<a href="#hash-type">hash-type</a>&quot;.

  rdp-cookie
  rdp-cookie(&lt;name&gt;)
              The RDP cookie &lt;name&gt; (or &quot;mstshash&quot; if omitted) will be
              looked up and hashed for each incoming TCP request. Just as
              with the equivalent ACL 'req_rdp_cookie()' function, the name
              is not case-sensitive. This mechanism is useful as a degraded
              persistence mode, as it makes it possible to always send the
              same user (or the same session ID) to the same server. If the
              cookie is not found, the normal roundrobin algorithm is
              used instead.

              Note that for this to work, the frontend must ensure that an
              RDP cookie is already present in the request buffer. For this
              you must use 'tcp-request content accept' rule combined with
              a 'req_rdp_cookie_cnt' ACL.

              This algorithm is static by default, which means that
              changing a server's weight on the fly will have no effect,
              but this can be changed using &quot;<a href="#hash-type">hash-type</a>&quot;.

              See also the rdp_cookie pattern fetch function.

&lt;arguments&gt; is an optional list of arguments which may be needed by some
            algorithms. Right now, only &quot;<a href="#url_param">url_param</a>&quot; and &quot;uri&quot; support an
            optional argument.</pre>
</div>
<pre class="text">The load balancing algorithm of a backend is set to roundrobin when no other
algorithm, mode nor option have been set. The algorithm may only be set once
for each backend.
</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code>balance roundrobin
balance url_param userid
balance url_param session_id check_post 64
balance hdr(User-Agent)
balance hdr(host)
balance hdr(Host) use_domain_only
</code></pre>
</div><pre class="text">Note: the following caveats and limitations on using the &quot;check_post&quot;
extension with &quot;<a href="#url_param">url_param</a>&quot; must be considered :

  - all POST requests are eligible for consideration, because there is no way
    to determine if the parameters will be found in the body or entity which
    may contain binary data. Therefore another method may be required to
    restrict consideration of POST requests that have no URL parameters in
    the body. (see acl reqideny http_end)

  - using a &lt;max_wait&gt; value larger than the request buffer size does not
    make sense and is useless. The buffer size is set at build time, and
    defaults to 16 kB.

  - Content-Encoding is not supported, the parameter search will probably
    fail; and load balancing will fall back to Round Robin.

  - Expect: 100-continue is not supported, load balancing will fall back to
    Round Robin.

  - Transfer-Encoding (RFC2616 3.6.1) is only supported in the first chunk.
    If the entire parameter value is not present in the first chunk, the
    selection of server is undefined (actually, defined by how little
    actually appeared in the first chunk).

  - This feature does not support generation of a 100, 411 or 501 response.

  - In some cases, requesting &quot;check_post&quot; MAY attempt to scan the entire
    contents of a message body. Scanning normally terminates when linear
    white space or control characters are found, indicating the end of what
    might be a URL parameter list. This is probably not a concern with SGML
    type message bodies.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#dispatch">dispatch</a>&quot;, &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">cookie<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#cookie%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#cookie%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li><li><a href="#cookie%20%28Fetching%20HTTP%20samples%20%28Layer%207%29%29">Fetching HTTP samples (Layer 7)</a></li></ul></span>&quot;, &quot;<a href="#appsession">appsession</a>&quot;, &quot;<a href="#option%20transparent">transparent</a>&quot;, &quot;<a href="#hash-type">hash-type</a>&quot; and &quot;<a href="#option%20http_proxy">http_proxy</a>&quot;.</div>
<a class="anchor" name="bind"></a><a class="anchor" name="4-bind"></a><a class="anchor" name="4.2-bind"></a><a class="anchor" name="bind (Proxies)"></a><a class="anchor" name="bind (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="bind"></a><a href="#4.2-bind">bind</a></b> <span style="color: #008">[<span style="color: #080">&lt;address&gt;</span>]</span>:<span style="color: #080">&lt;port_range&gt;</span> <span style="color: #008">[, ...]</span> <span style="color: #008">[param*]</span></div><a class="anchor" name="bind"></a><a class="anchor" name="4-bind"></a><a class="anchor" name="4.2-bind"></a><a class="anchor" name="bind (Proxies)"></a><a class="anchor" name="bind (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="bind"></a><a href="#4.2-bind">bind</a></b> /<span style="color: #080">&lt;path&gt;</span> <span style="color: #008">[, ...]</span> <span style="color: #008">[param*]</span></div><pre class="text">Define one or several listening addresses and/or ports in a frontend.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;address&gt;     is optional and can be a host name, an IPv4 address, an IPv6
              address, or '*'. It designates the address the frontend will
              listen on. If unset, all IPv4 addresses of the system will be
              listened on. The same will apply for '*' or the system's
              special address &quot;0.0.0.0&quot;. The IPv6 equivalent is '::'.
              Optionally, an address family prefix may be used before the
              address to force the family regardless of the address format,
              which can be useful to specify a path to a unix socket with
              no slash ('/'). Currently supported prefixes are :
                - 'ipv4@'  -&gt; address is always IPv4
                - 'ipv6@'  -&gt; address is always IPv6
                - 'unix@'  -&gt; address is a path to a local unix socket
                - 'abns@'  -&gt; address is in abstract namespace (Linux only)
                - 'fd@&lt;n&gt;' -&gt; use file descriptor &lt;n&gt; inherited from the
                  parent. The fd must be bound and may or may not already
                  be listening.
              Any part of the address string may reference any number of
              environment variables by preceding their name with a dollar
              sign ('$') and optionally enclosing them with braces ('{}'),
              similarly to what is done in Bourne shell.

&lt;port_range&gt;  is either a unique TCP port, or a port range for which the
              proxy will accept connections for the IP address specified
              above. The port is mandatory for TCP listeners. Note that in
              the case of an IPv6 address, the port is always the number
              after the last colon (':'). A range can either be :
               - a numerical port (ex: '80')
               - a dash-delimited ports range explicitly stating the lower
                 and upper bounds (ex: '2000-2100') which are included in
                 the range.

              Particular care must be taken against port ranges, because
              every &lt;address:port&gt; couple consumes one socket (= a file
              descriptor), so it's easy to consume lots of descriptors
              with a simple range, and to run out of sockets. Also, each
              &lt;address:port&gt; couple must be used only once among all
              instances running on a same system. Please note that binding
              to ports lower than 1024 generally require particular
              privileges to start the program, which are independent of
              the 'uid' parameter.

&lt;path&gt;        is a UNIX socket path beginning with a slash ('/'). This is
              alternative to the TCP listening port. Haproxy will then
              receive UNIX connections on the socket located at this place.
              The path must begin with a slash and by default is absolute.
              It can be relative to the prefix defined by &quot;<a href="#unix-bind">unix-bind</a>&quot; in
              the global section. Note that the total length of the prefix
              followed by the socket path cannot exceed some system limits
              for UNIX sockets, which commonly are set to 107 characters.

&lt;param*&gt;      is a list of parameters common to all sockets declared on the
              same line. These numerous parameters depend on OS and build
              options and have a complete section dedicated to them. Please
              refer to <a href="#5">section 5</a> to for more details.</pre>
</div>
<pre class="text">It is possible to specify a list of address:port combinations delimited by
commas. The frontend will then listen on all of these addresses. There is no
fixed limit to the number of addresses and ports which can be listened on in
a frontend, as well as there is no limit to the number of &quot;<a href="#bind">bind</a>&quot; statements
in a frontend.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>listen http_proxy
    bind :80,:443
    bind 10.0.0.1:10080,10.0.0.1:10443
    bind /var/run/ssl-frontend.sock user root mode 600 accept-proxy

listen http_https_proxy
    bind :80
    bind :443 ssl crt /etc/haproxy/site.pem

listen http_https_proxy_explicit
    bind ipv6@:80
    bind ipv4@public_ssl:443 ssl crt /etc/haproxy/site.pem
    bind unix@ssl-frontend.sock user root mode 600 accept-proxy

listen external_bind_app1
    bind fd@${FD_APP1}
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#source%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;, &quot;<a href="#option%20forwardfor">option forwardfor</a>&quot;, &quot;<a href="#unix-bind">unix-bind</a>&quot; and the PROXY protocol documentation, and <a href="#5">section 5</a> about bind options.</div>
<a class="anchor" name="bind-process"></a><a class="anchor" name="4-bind-process"></a><a class="anchor" name="4.2-bind-process"></a><a class="anchor" name="bind-process (Proxies)"></a><a class="anchor" name="bind-process (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="bind-process"></a><a href="#4.2-bind-process">bind-process</a></b> <span style="color: #008">[ all | odd | even | <span style="color: #080">&lt;number 1-64&gt;</span><span style="color: #008">[-<span style="color: #080">&lt;number 1-64&gt;</span>]</span> ]</span> ...</div><pre class="text">Limit visibility of an instance to a certain set of processes numbers.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">all           All process will see this instance. This is the default. It
              may be used to override a default value.

odd           This instance will be enabled on processes 1,3,5,...63. This
              option may be combined with other numbers.

even          This instance will be enabled on processes 2,4,6,...64. This
              option may be combined with other numbers. Do not use it
              with less than 2 processes otherwise some instances might be
              missing from all processes.

number        The instance will be enabled on this process number or range,
              whose values must all be between 1 and 32 or 64 depending on
              the machine's word size. If a proxy is bound to process
              numbers greater than the configured global.nbproc, it will
              either be forced to process #1 if a single process was
              specified, or to all processes otherwise.</pre>
</div>
<pre class="text">This keyword limits binding of certain instances to certain processes. This
is useful in order not to have too many processes listening to the same
ports. For instance, on a dual-core machine, it might make sense to set
'nbproc 2' in the global section, then distributes the listeners among 'odd'
and 'even' instances.

At the moment, it is not possible to reference more than 32 or 64 processes
using this keyword, but this should be more than enough for most setups.
Please note that 'all' really means all processes regardless of the machine's
word size, and is not limited to the first 32 or 64.

Each &quot;<a href="#bind">bind</a>&quot; line may further be limited to a subset of the proxy's processes,
please consult the &quot;<a href="#process">process</a>&quot; bind keyword in <a href="#5.1">section 5.1</a>.

If some backends are referenced by frontends bound to other processes, the
backend automatically inherits the frontend's processes.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>listen app_ip1
    bind 10.0.0.1:80
    bind-process odd

listen app_ip2
    bind 10.0.0.2:80
    bind-process even

listen management
    bind 10.0.0.3:80
    bind-process 1 2 3 4

listen management
    bind 10.0.0.4:80
    bind-process 1-4
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#nbproc">nbproc</a>&quot; in global section, and &quot;<a href="#process">process</a>&quot; in <a href="#5.1">section 5.1</a>.</div>
<a class="anchor" name="block"></a><a class="anchor" name="4-block"></a><a class="anchor" name="4.2-block"></a><a class="anchor" name="block (Proxies)"></a><a class="anchor" name="block (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="block"></a><a href="#4.2-block">block</a></b> <span style="color: #800">{ if | unless }</span> <span style="color: #080">&lt;condition&gt;</span></div><pre class="text">Block a layer 7 request if/unless a condition is matched
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">The HTTP request will be blocked very early in the layer 7 processing
if/unless &lt;condition&gt; is matched. A 403 error will be returned if the request
is blocked. The condition has to reference ACLs (see <a href="#7">section 7</a>). This is
typically used to deny access to certain sensitive resources if some
conditions are met or not met. There is no fixed limit to the number of
&quot;<a href="#block">block</a>&quot; statements per instance.
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>acl invalid_src  src          0.0.0.0/7 224.0.0.0/3
acl invalid_src  src_port     0:1023
acl local_dst    hdr(host) -i localhost
block if invalid_src || local_dst
</code></pre>
</div><pre class="text">See <a href="#7">section 7</a> about ACL usage.
</pre><a class="anchor" name="capture"></a><a class="anchor" name="4-capture"></a><a class="anchor" name="4.2-capture"></a><a class="anchor" name="capture (Proxies)"></a><a class="anchor" name="capture (Alphabetically sorted keywords reference)"></a><a class="anchor" name="capture cookie"></a><a class="anchor" name="4-capture cookie"></a><a class="anchor" name="4.2-capture cookie"></a><a class="anchor" name="capture cookie (Proxies)"></a><a class="anchor" name="capture cookie (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="capture cookie"></a><a href="#4.2-capture%20cookie">capture cookie</a></b> <span style="color: #080">&lt;name&gt;</span> len <span style="color: #080">&lt;length&gt;</span></div><pre class="text">Capture and log a cookie in the request and in the response.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;name&gt;    is the beginning of the name of the cookie to capture. In order
          to match the exact name, simply suffix the name with an equal
          sign ('='). The full name will appear in the logs, which is
          useful with application servers which adjust both the cookie name
          and value (eg: ASPSESSIONXXXXX).

&lt;length&gt;  is the maximum number of characters to report in the logs, which
          include the cookie name, the equal sign and the value, all in the
          standard &quot;name=value&quot; form. The string will be truncated on the
          right if it exceeds &lt;length&gt;.</pre>
</div>
<pre class="text">Only the first cookie is captured. Both the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">cookie<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#cookie%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#cookie%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li><li><a href="#cookie%20%28Fetching%20HTTP%20samples%20%28Layer%207%29%29">Fetching HTTP samples (Layer 7)</a></li></ul></span>&quot; request headers and the
&quot;<a href="#set-cookie">set-cookie</a>&quot; response headers are monitored. This is particularly useful to
check for application bugs causing session crossing or stealing between
users, because generally the user's cookies can only change on a login page.

When the cookie was not presented by the client, the associated log column
will report &quot;-&quot;. When a request does not cause a cookie to be assigned by the
server, a &quot;-&quot; is reported in the response column.

The capture is performed in the frontend only because it is necessary that
the log format does not change for a given frontend depending on the
backends. This may change in the future. Note that there can be only one
&quot;<a href="#capture%20cookie">capture cookie</a>&quot; statement in a frontend. The maximum capture length is set
by the global &quot;<a href="#tune.http.cookielen">tune.http.cookielen</a>&quot; setting and defaults to 63 characters. It
is not possible to specify a capture in a &quot;defaults&quot; section.
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>capture cookie ASPSESSION len 32
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#capture%20request%20header">capture request header</a>&quot;, &quot;<a href="#capture%20response%20header">capture response header</a>&quot; as well as <a href="#8">section 8</a> about logging.</div>
<a class="anchor" name="capture"></a><a class="anchor" name="4-capture"></a><a class="anchor" name="4.2-capture"></a><a class="anchor" name="capture (Proxies)"></a><a class="anchor" name="capture (Alphabetically sorted keywords reference)"></a><a class="anchor" name="capture request"></a><a class="anchor" name="4-capture request"></a><a class="anchor" name="4.2-capture request"></a><a class="anchor" name="capture request (Proxies)"></a><a class="anchor" name="capture request (Alphabetically sorted keywords reference)"></a><a class="anchor" name="capture request header"></a><a class="anchor" name="4-capture request header"></a><a class="anchor" name="4.2-capture request header"></a><a class="anchor" name="capture request header (Proxies)"></a><a class="anchor" name="capture request header (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="capture request header"></a><a href="#4.2-capture%20request%20header">capture request header</a></b> <span style="color: #080">&lt;name&gt;</span> len <span style="color: #080">&lt;length&gt;</span></div><pre class="text">Capture and log the last occurrence of the specified request header.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;name&gt;    is the name of the header to capture. The header names are not
          case-sensitive, but it is a common practice to write them as they
          appear in the requests, with the first letter of each word in
          upper case. The header name will not appear in the logs, only the
          value is reported, but the position in the logs is respected.

&lt;length&gt;  is the maximum number of characters to extract from the value and
          report in the logs. The string will be truncated on the right if
          it exceeds &lt;length&gt;.</pre>
</div>
<pre class="text">The complete value of the last occurrence of the header is captured. The
value will be added to the logs between braces ('{}'). If multiple headers
are captured, they will be delimited by a vertical bar ('|') and will appear
in the same order they were declared in the configuration. Non-existent
headers will be logged just as an empty string. Common uses for request
header captures include the &quot;Host&quot; field in virtual hosting environments, the
&quot;Content-length&quot; when uploads are supported, &quot;User-agent&quot; to quickly
differentiate between real users and robots, and &quot;X-Forwarded-For&quot; in proxied
environments to find where the request came from.

Note that when capturing headers such as &quot;User-agent&quot;, some spaces may be
logged, making the log analysis more difficult. Thus be careful about what
you log if you know your log parser is not smart enough to rely on the
braces.

There is no limit to the number of captured request headers nor to their
length, though it is wise to keep them low to limit memory usage per session.
In order to keep log format consistent for a same frontend, header captures
can only be declared in a frontend. It is not possible to specify a capture
in a &quot;defaults&quot; section.
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>capture request header Host len 15
capture request header X-Forwarded-For len 15
capture request header Referrer len 15
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#capture%20cookie">capture cookie</a>&quot;, &quot;<a href="#capture%20response%20header">capture response header</a>&quot; as well as <a href="#8">section 8</a> about logging.</div>
<a class="anchor" name="capture"></a><a class="anchor" name="4-capture"></a><a class="anchor" name="4.2-capture"></a><a class="anchor" name="capture (Proxies)"></a><a class="anchor" name="capture (Alphabetically sorted keywords reference)"></a><a class="anchor" name="capture response"></a><a class="anchor" name="4-capture response"></a><a class="anchor" name="4.2-capture response"></a><a class="anchor" name="capture response (Proxies)"></a><a class="anchor" name="capture response (Alphabetically sorted keywords reference)"></a><a class="anchor" name="capture response header"></a><a class="anchor" name="4-capture response header"></a><a class="anchor" name="4.2-capture response header"></a><a class="anchor" name="capture response header (Proxies)"></a><a class="anchor" name="capture response header (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="capture response header"></a><a href="#4.2-capture%20response%20header">capture response header</a></b> <span style="color: #080">&lt;name&gt;</span> len <span style="color: #080">&lt;length&gt;</span></div><pre class="text">Capture and log the last occurrence of the specified response header.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;name&gt;    is the name of the header to capture. The header names are not
          case-sensitive, but it is a common practice to write them as they
          appear in the response, with the first letter of each word in
          upper case. The header name will not appear in the logs, only the
          value is reported, but the position in the logs is respected.

&lt;length&gt;  is the maximum number of characters to extract from the value and
          report in the logs. The string will be truncated on the right if
          it exceeds &lt;length&gt;.</pre>
</div>
<pre class="text">The complete value of the last occurrence of the header is captured. The
result will be added to the logs between braces ('{}') after the captured
request headers. If multiple headers are captured, they will be delimited by
a vertical bar ('|') and will appear in the same order they were declared in
the configuration. Non-existent headers will be logged just as an empty
string. Common uses for response header captures include the &quot;Content-length&quot;
header which indicates how many bytes are expected to be returned, the
&quot;Location&quot; header to track redirections.

There is no limit to the number of captured response headers nor to their
length, though it is wise to keep them low to limit memory usage per session.
In order to keep log format consistent for a same frontend, header captures
can only be declared in a frontend. It is not possible to specify a capture
in a &quot;defaults&quot; section.
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>capture response header Content-length len 9
capture response header Location len 15
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#capture%20cookie">capture cookie</a>&quot;, &quot;<a href="#capture%20request%20header">capture request header</a>&quot; as well as <a href="#8">section 8</a> about logging.</div>
<a class="anchor" name="clitimeout"></a><a class="anchor" name="4-clitimeout"></a><a class="anchor" name="4.2-clitimeout"></a><a class="anchor" name="clitimeout (Proxies)"></a><a class="anchor" name="clitimeout (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="clitimeout"></a><a href="#4.2-clitimeout">clitimeout</a></b> <span style="color: #080">&lt;timeout&gt;</span> <span class="label label-warning">(deprecated)</span></div><pre class="text">Set the maximum inactivity time on the client side.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value is specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">The inactivity timeout applies when the client is expected to acknowledge or
send data. In HTTP mode, this timeout is particularly important to consider
during the first phase, when the client sends the request, and during the
response while it is reading data sent by the server. The value is specified
in milliseconds by default, but can be in any other unit if the number is
suffixed by the unit, as specified at the top of this document. In TCP mode
(and to a lesser extent, in HTTP mode), it is highly recommended that the
client timeout remains equal to the server timeout in order to avoid complex
situations to debug. It is a good practice to cover one or several TCP packet
losses by specifying timeouts that are slightly above multiples of 3 seconds
(eg: 4 or 5 seconds).

This parameter is specific to frontends, but can be specified once for all in
&quot;defaults&quot; sections. This is in fact one of the easiest solutions not to
forget about it. An unspecified timeout results in an infinite timeout, which
is not recommended. Such a usage is accepted and works but reports a warning
during startup because it may results in accumulation of expired sessions in
the system if the system's timeouts are not configured either.

This parameter is provided for compatibility but is currently deprecated.
Please use &quot;<a href="#timeout%20client">timeout client</a>&quot; instead.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#timeout%20client">timeout client</a>&quot;, &quot;<a href="#timeout%20http-request">timeout http-request</a>&quot;, &quot;<a href="#timeout%20server">timeout server</a>&quot;, and &quot;<a href="#srvtimeout">srvtimeout</a>&quot;.</div>
<a class="anchor" name="compression"></a><a class="anchor" name="4-compression"></a><a class="anchor" name="4.2-compression"></a><a class="anchor" name="compression (Proxies)"></a><a class="anchor" name="compression (Alphabetically sorted keywords reference)"></a><a class="anchor" name="compression algo"></a><a class="anchor" name="4-compression algo"></a><a class="anchor" name="4.2-compression algo"></a><a class="anchor" name="compression algo (Proxies)"></a><a class="anchor" name="compression algo (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="compression algo"></a><a href="#4.2-compression%20algo">compression algo</a></b> <span style="color: #080">&lt;algorithm&gt;</span> ...</div><a class="anchor" name="compression"></a><a class="anchor" name="4-compression"></a><a class="anchor" name="4.2-compression"></a><a class="anchor" name="compression (Proxies)"></a><a class="anchor" name="compression (Alphabetically sorted keywords reference)"></a><a class="anchor" name="compression type"></a><a class="anchor" name="4-compression type"></a><a class="anchor" name="4.2-compression type"></a><a class="anchor" name="compression type (Proxies)"></a><a class="anchor" name="compression type (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="compression type"></a><a href="#4.2-compression%20type">compression type</a></b> <span style="color: #080">&lt;mime type&gt;</span> ...</div><a class="anchor" name="compression"></a><a class="anchor" name="4-compression"></a><a class="anchor" name="4.2-compression"></a><a class="anchor" name="compression (Proxies)"></a><a class="anchor" name="compression (Alphabetically sorted keywords reference)"></a><a class="anchor" name="compression offload"></a><a class="anchor" name="4-compression offload"></a><a class="anchor" name="4.2-compression offload"></a><a class="anchor" name="compression offload (Proxies)"></a><a class="anchor" name="compression offload (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="compression offload"></a><a href="#4.2-compression%20offload">compression offload</a></b></div><pre class="text">Enable HTTP compression.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">algo     is followed by the list of supported compression algorithms.
type     is followed by the list of MIME types that will be compressed.
offload  makes haproxy work as a compression offloader only (see notes).</pre>
</div>
<pre class="text">The currently supported algorithms are :
  identity  this is mostly for debugging, and it was useful for developing
            the compression feature. Identity does not apply any change on
            data.

  gzip      applies gzip compression. This setting is only available when
            support for zlib was built in.

  deflate   same as gzip, but with deflate algorithm and zlib format.
            Note that this algorithm has ambiguous support on many browsers
            and no support at all from recent ones. It is strongly
            recommended not to use it for anything else than experimentation.
            This setting is only available when support for zlib was built
            in.

Compression will be activated depending on the Accept-Encoding request
header. With identity, it does not take care of that header.
If backend servers support HTTP compression, these directives
will be no-op: haproxy will see the compressed response and will not
compress again. If backend servers do not support HTTP compression and
there is Accept-Encoding header in request, haproxy will compress the
matching response.

The &quot;offload&quot; setting makes haproxy remove the Accept-Encoding header to
prevent backend servers from compressing responses. It is strongly
recommended not to do this because this means that all the compression work
will be done on the single point where haproxy is located. However in some
deployment scenarios, haproxy may be installed in front of a buggy gateway
with broken HTTP compression implementation which can't be turned off.
In that case haproxy can be used to prevent that gateway from emitting
invalid payloads. In this case, simply removing the header in the
configuration does not work because it applies before the header is parsed,
so that prevents haproxy from compressing. The &quot;offload&quot; setting should
then be used for such scenarios.

Compression is disabled when:
  * the request does not advertise a supported compression algorithm in the
    &quot;Accept-Encoding&quot; header
  * the response message is not HTTP/1.1
  * HTTP status code is not 200
  * response header &quot;Transfer-Encoding&quot; contains &quot;chunked&quot; (Temporary
    Workaround)
  * response contain neither a &quot;Content-Length&quot; header nor a
    &quot;Transfer-Encoding&quot; whose last value is &quot;chunked&quot;
  * response contains a &quot;Content-Type&quot; header whose first value starts with
    &quot;multipart&quot;
  * the response contains the &quot;no-transform&quot; value in the &quot;Cache-control&quot;
    header
  * User-Agent matches &quot;Mozilla/4&quot; unless it is MSIE 6 with XP SP2, or MSIE 7
    and later
  * The response contains a &quot;Content-Encoding&quot; header, indicating that the
    response is already compressed (see compression offload)

Note: The compression does not rewrite Etag headers, and does not emit the
      Warning header.
</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code>compression algo gzip
compression type text/html text/plain
</code></pre>
</div><a class="anchor" name="contimeout"></a><a class="anchor" name="4-contimeout"></a><a class="anchor" name="4.2-contimeout"></a><a class="anchor" name="contimeout (Proxies)"></a><a class="anchor" name="contimeout (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="contimeout"></a><a href="#4.2-contimeout">contimeout</a></b> <span style="color: #080">&lt;timeout&gt;</span> <span class="label label-warning">(deprecated)</span></div><pre class="text">Set the maximum time to wait for a connection attempt to a server to succeed.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value is specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">If the server is located on the same LAN as haproxy, the connection should be
immediate (less than a few milliseconds). Anyway, it is a good practice to
cover one or several TCP packet losses by specifying timeouts that are
slightly above multiples of 3 seconds (eg: 4 or 5 seconds). By default, the
connect timeout also presets the queue timeout to the same value if this one
has not been specified. Historically, the contimeout was also used to set the
tarpit timeout in a listen section, which is not possible in a pure frontend.

This parameter is specific to backends, but can be specified once for all in
&quot;defaults&quot; sections. This is in fact one of the easiest solutions not to
forget about it. An unspecified timeout results in an infinite timeout, which
is not recommended. Such a usage is accepted and works but reports a warning
during startup because it may results in accumulation of failed sessions in
the system if the system's timeouts are not configured either.

This parameter is provided for backwards compatibility but is currently
deprecated. Please use &quot;<a href="#timeout%20connect">timeout connect</a>&quot;, &quot;<a href="#timeout%20queue">timeout queue</a>&quot; or &quot;<a href="#timeout%20tarpit">timeout tarpit</a>&quot;
instead.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#timeout%20connect">timeout connect</a>&quot;, &quot;<a href="#timeout%20queue">timeout queue</a>&quot;, &quot;<a href="#timeout%20tarpit">timeout tarpit</a>&quot;, &quot;<a href="#timeout%20server">timeout server</a>&quot;, &quot;<a href="#contimeout">contimeout</a>&quot;.</div>
<a class="anchor" name="cookie"></a><a class="anchor" name="4-cookie"></a><a class="anchor" name="4.2-cookie"></a><a class="anchor" name="cookie (Proxies)"></a><a class="anchor" name="cookie (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="cookie"></a><a href="#4.2-cookie">cookie</a></b> <span style="color: #080">&lt;name&gt;</span> <span style="color: #008">[ rewrite | insert | prefix ]</span> <span style="color: #008">[ indirect ]</span> <span style="color: #008">[ nocache ]</span>
              <span style="color: #008">[ postonly ]</span> <span style="color: #008">[ preserve ]</span> <span style="color: #008">[ httponly ]</span> <span style="color: #008">[ secure ]</span>
              <span style="color: #008">[ domain <span style="color: #080">&lt;domain&gt;</span> ]</span>* <span style="color: #008">[ maxidle <span style="color: #080">&lt;idle&gt;</span> ]</span> <span style="color: #008">[ maxlife <span style="color: #080">&lt;life&gt;</span> ]</span></div><pre class="text">Enable cookie-based persistence in a backend.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;name&gt;    is the name of the cookie which will be monitored, modified or
          inserted in order to bring persistence. This cookie is sent to
          the client via a &quot;Set-Cookie&quot; header in the response, and is
          brought back by the client in a &quot;Cookie&quot; header in all requests.
          Special care should be taken to choose a name which does not
          conflict with any likely application cookie. Also, if the same
          backends are subject to be used by the same clients (eg:
          HTTP/HTTPS), care should be taken to use different cookie names
          between all backends if persistence between them is not desired.

rewrite   This keyword indicates that the cookie will be provided by the
          server and that haproxy will have to modify its value to set the
          server's identifier in it. This mode is handy when the management
          of complex combinations of &quot;Set-cookie&quot; and &quot;Cache-control&quot;
          headers is left to the application. The application can then
          decide whether or not it is appropriate to emit a persistence
          cookie. Since all responses should be monitored, this mode only
          works in HTTP close mode. Unless the application behaviour is
          very complex and/or broken, it is advised not to start with this
          mode for new deployments. This keyword is incompatible with
          &quot;insert&quot; and &quot;prefix&quot;.

insert    This keyword indicates that the persistence cookie will have to
          be inserted by haproxy in server responses if the client did not

          already have a cookie that would have permitted it to access this
          server. When used without the &quot;preserve&quot; option, if the server
          emits a cookie with the same name, it will be remove before
          processing.  For this reason, this mode can be used to upgrade
          existing configurations running in the &quot;rewrite&quot; mode. The cookie
          will only be a session cookie and will not be stored on the
          client's disk. By default, unless the &quot;indirect&quot; option is added,
          the server will see the cookies emitted by the client. Due to
          caching effects, it is generally wise to add the &quot;nocache&quot; or
          &quot;postonly&quot; keywords (see below). The &quot;insert&quot; keyword is not
          compatible with &quot;rewrite&quot; and &quot;prefix&quot;.

prefix    This keyword indicates that instead of relying on a dedicated
          cookie for the persistence, an existing one will be completed.
          This may be needed in some specific environments where the client
          does not support more than one single cookie and the application
          already needs it. In this case, whenever the server sets a cookie
          named &lt;name&gt;, it will be prefixed with the server's identifier
          and a delimiter. The prefix will be removed from all client
          requests so that the server still finds the cookie it emitted.
          Since all requests and responses are subject to being modified,
          this mode requires the HTTP close mode. The &quot;prefix&quot; keyword is
          not compatible with &quot;rewrite&quot; and &quot;insert&quot;. Note: it is highly
          recommended not to use &quot;indirect&quot; with &quot;prefix&quot;, otherwise server
          cookie updates would not be sent to clients.

indirect  When this option is specified, no cookie will be emitted to a
          client which already has a valid one for the server which has
          processed the request. If the server sets such a cookie itself,
          it will be removed, unless the &quot;preserve&quot; option is also set. In
          &quot;insert&quot; mode, this will additionally remove cookies from the
          requests transmitted to the server, making the persistence
          mechanism totally transparent from an application point of view.
          Note: it is highly recommended not to use &quot;indirect&quot; with
          &quot;prefix&quot;, otherwise server cookie updates would not be sent to
          clients.

nocache   This option is recommended in conjunction with the insert mode
          when there is a cache between the client and HAProxy, as it
          ensures that a cacheable response will be tagged non-cacheable if
          a cookie needs to be inserted. This is important because if all
          persistence cookies are added on a cacheable home page for
          instance, then all customers will then fetch the page from an
          outer cache and will all share the same persistence cookie,
          leading to one server receiving much more traffic than others.
          See also the &quot;insert&quot; and &quot;postonly&quot; options.

postonly  This option ensures that cookie insertion will only be performed
          on responses to POST requests. It is an alternative to the
          &quot;nocache&quot; option, because POST responses are not cacheable, so
          this ensures that the persistence cookie will never get cached.
          Since most sites do not need any sort of persistence before the
          first POST which generally is a login request, this is a very
          efficient method to optimize caching without risking to find a
          persistence cookie in the cache.
          See also the &quot;insert&quot; and &quot;nocache&quot; options.

preserve  This option may only be used with &quot;insert&quot; and/or &quot;indirect&quot;. It
          allows the server to emit the persistence cookie itself. In this
          case, if a cookie is found in the response, haproxy will leave it
          untouched. This is useful in order to end persistence after a
          logout request for instance. For this, the server just has to
          emit a cookie with an invalid value (eg: empty) or with a date in
          the past. By combining this mechanism with the &quot;disable-on-404&quot;
          check option, it is possible to perform a completely graceful
          shutdown because users will definitely leave the server after
          they logout.

httponly  This option tells haproxy to add an &quot;HttpOnly&quot; cookie attribute
          when a cookie is inserted. This attribute is used so that a
          user agent doesn't share the cookie with non-HTTP components.
          Please check RFC6265 for more information on this attribute.

secure    This option tells haproxy to add a &quot;Secure&quot; cookie attribute when
          a cookie is inserted. This attribute is used so that a user agent
          never emits this cookie over non-secure channels, which means
          that a cookie learned with this flag will be presented only over
          SSL/TLS connections. Please check RFC6265 for more information on
          this attribute.

domain    This option allows to specify the domain at which a cookie is
          inserted. It requires exactly one parameter: a valid domain
          name. If the domain begins with a dot, the browser is allowed to
          use it for any host ending with that name. It is also possible to
          specify several domain names by invoking this option multiple
          times. Some browsers might have small limits on the number of
          domains, so be careful when doing that. For the record, sending
          10 domains to MSIE 6 or Firefox 2 works as expected.

maxidle   This option allows inserted cookies to be ignored after some idle
          time. It only works with insert-mode cookies. When a cookie is
          sent to the client, the date this cookie was emitted is sent too.
          Upon further presentations of this cookie, if the date is older
          than the delay indicated by the parameter (in seconds), it will
          be ignored. Otherwise, it will be refreshed if needed when the
          response is sent to the client. This is particularly useful to
          prevent users who never close their browsers from remaining for
          too long on the same server (eg: after a farm size change). When
          this option is set and a cookie has no date, it is always
          accepted, but gets refreshed in the response. This maintains the
          ability for admins to access their sites. Cookies that have a
          date in the future further than 24 hours are ignored. Doing so
          lets admins fix timezone issues without risking kicking users off
          the site.

maxlife   This option allows inserted cookies to be ignored after some life
          time, whether they're in use or not. It only works with insert
          mode cookies. When a cookie is first sent to the client, the date
          this cookie was emitted is sent too. Upon further presentations
          of this cookie, if the date is older than the delay indicated by
          the parameter (in seconds), it will be ignored. If the cookie in
          the request has no date, it is accepted and a date will be set.
          Cookies that have a date in the future further than 24 hours are
          ignored. Doing so lets admins fix timezone issues without risking
          kicking users off the site. Contrary to maxidle, this value is
          not refreshed, only the first visit date counts. Both maxidle and
          maxlife may be used at the time. This is particularly useful to
          prevent users who never close their browsers from remaining for
          too long on the same server (eg: after a farm size change). This
          is stronger than the maxidle method in that it forces a
          redispatch after some absolute delay.</pre>
</div>
<pre class="text">There can be only one persistence cookie per HTTP backend, and it can be
declared in a defaults section. The value of the cookie will be the value
indicated after the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">cookie<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#cookie%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#cookie%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li><li><a href="#cookie%20%28Fetching%20HTTP%20samples%20%28Layer%207%29%29">Fetching HTTP samples (Layer 7)</a></li></ul></span>&quot; keyword in a &quot;<a href="#server">server</a>&quot; statement. If no cookie
is declared for a given server, the cookie is not set.
</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code>cookie JSESSIONID prefix
cookie SRV insert indirect nocache
cookie SRV insert postonly indirect
cookie SRV insert indirect nocache maxidle 30m maxlife 8h
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#appsession">appsession</a>&quot;, &quot;balance source&quot;, &quot;<a href="#capture%20cookie">capture cookie</a>&quot;, &quot;<a href="#server">server</a>&quot; and &quot;<a href="#ignore-persist">ignore-persist</a>&quot;.</div>
<a class="anchor" name="default-server"></a><a class="anchor" name="4-default-server"></a><a class="anchor" name="4.2-default-server"></a><a class="anchor" name="default-server (Proxies)"></a><a class="anchor" name="default-server (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="default-server"></a><a href="#4.2-default-server">default-server</a></b> <span style="color: #008">[param*]</span></div><pre class="text">Change default options for a server in a backend
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments:</span><pre class="prettyprint arguments">&lt;param*&gt;  is a list of parameters for this server. The &quot;<a href="#default-server">default-server</a>&quot;
          keyword accepts an important number of options and has a complete
          section dedicated to it. Please refer to <a href="#5">section 5</a> for more
          details.</pre>
</div>
<div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>default-server inter 1000 weight 13
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#server">server</a>&quot; and <a href="#5">section 5</a> about server options</div>
<a class="anchor" name="default_backend"></a><a class="anchor" name="4-default_backend"></a><a class="anchor" name="4.2-default_backend"></a><a class="anchor" name="default_backend (Proxies)"></a><a class="anchor" name="default_backend (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="default_backend"></a><a href="#4.2-default_backend">default_backend</a></b> <span style="color: #080">&lt;backend&gt;</span></div><pre class="text">Specify the backend to use when no &quot;<a href="#use_backend">use_backend</a>&quot; rule has been matched.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;backend&gt; is the name of the backend to use.</pre>
</div>
<pre class="text">When doing content-switching between frontend and backends using the
&quot;<a href="#use_backend">use_backend</a>&quot; keyword, it is often useful to indicate which backend will be
used when no rule has matched. It generally is the dynamic backend which
will catch all undetermined requests.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>use_backend     dynamic  if  url_dyn
use_backend     static   if  url_css url_img extension_img
default_backend dynamic
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#use_backend">use_backend</a>&quot;, &quot;reqsetbe&quot;, &quot;reqisetbe&quot;</div>
<a class="anchor" name="description"></a><a class="anchor" name="4-description"></a><a class="anchor" name="4.2-description"></a><a class="anchor" name="description (Proxies)"></a><a class="anchor" name="description (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="description"></a><a href="#4.2-description">description</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">Describe a listen, frontend or backend.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> string
</div>
<pre class="text">Allows to add a sentence to describe the related object in the HAProxy HTML
stats page. The description will be printed on the right of the object name
it describes.
No need to backslash spaces in the &lt;string&gt; arguments.
</pre><a class="anchor" name="disabled"></a><a class="anchor" name="4-disabled"></a><a class="anchor" name="4.2-disabled"></a><a class="anchor" name="disabled (Proxies)"></a><a class="anchor" name="disabled (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="disabled"></a><a href="#4.2-disabled">disabled</a></b></div><pre class="text">Disable a proxy, frontend or backend.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">The &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">disabled<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#disabled%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#disabled%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; keyword is used to disable an instance, mainly in order to
liberate a listening port or to temporarily disable a service. The instance
will still be created and its configuration will be checked, but it will be
created in the &quot;stopped&quot; state and will appear as such in the statistics. It
will not receive any traffic nor will it send any health-checks or logs. It
is possible to disable many instances at once by adding the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">disabled<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#disabled%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#disabled%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;
keyword in a &quot;defaults&quot; section.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#enabled">enabled</a>&quot;</div>
<a class="anchor" name="dispatch"></a><a class="anchor" name="4-dispatch"></a><a class="anchor" name="4.2-dispatch"></a><a class="anchor" name="dispatch (Proxies)"></a><a class="anchor" name="dispatch (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="dispatch"></a><a href="#4.2-dispatch">dispatch</a></b> <span style="color: #080">&lt;address&gt;</span>:<span style="color: #080">&lt;port&gt;</span></div><pre class="text">Set a default server address
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;address&gt; is the IPv4 address of the default server. Alternatively, a
          resolvable hostname is supported, but this name will be resolved
          during start-up.

&lt;ports&gt;   is a mandatory port specification. All connections will be sent
          to this port, and it is not permitted to use port offsets as is
          possible with normal servers.</pre>
</div>
<pre class="text">The &quot;<a href="#dispatch">dispatch</a>&quot; keyword designates a default server for use when no other
server can take the connection. In the past it was used to forward non
persistent connections to an auxiliary load balancer. Due to its simple
syntax, it has also been used for simple TCP relays. It is recommended not to
use it for more clarity, and to use the &quot;<a href="#server">server</a>&quot; directive instead.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#server">server</a>&quot;</div>
<a class="anchor" name="enabled"></a><a class="anchor" name="4-enabled"></a><a class="anchor" name="4.2-enabled"></a><a class="anchor" name="enabled (Proxies)"></a><a class="anchor" name="enabled (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="enabled"></a><a href="#4.2-enabled">enabled</a></b></div><pre class="text">Enable a proxy, frontend or backend.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">The &quot;<a href="#enabled">enabled</a>&quot; keyword is used to explicitly enable an instance, when the
defaults has been set to &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">disabled<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#disabled%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#disabled%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;. This is very rarely used.
</pre><div class="page-header"><b>See also :</b> &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">disabled<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#disabled%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#disabled%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;</div>
<a class="anchor" name="errorfile"></a><a class="anchor" name="4-errorfile"></a><a class="anchor" name="4.2-errorfile"></a><a class="anchor" name="errorfile (Proxies)"></a><a class="anchor" name="errorfile (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="errorfile"></a><a href="#4.2-errorfile">errorfile</a></b> <span style="color: #080">&lt;code&gt;</span> <span style="color: #080">&lt;file&gt;</span></div><pre class="text">Return a file contents instead of errors generated by HAProxy
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;code&gt;    is the HTTP status code. Currently, HAProxy is capable of
          generating codes 200, 400, 403, 408, 500, 502, 503, and 504.

&lt;file&gt;    designates a file containing the full HTTP response. It is
          recommended to follow the common practice of appending &quot;.http&quot; to
          the filename so that people do not confuse the response with HTML
          error pages, and to use absolute paths, since files are read
          before any chroot is performed.</pre>
</div>
<pre class="text">It is important to understand that this keyword is not meant to rewrite
errors returned by the server, but errors detected and returned by HAProxy.
This is why the list of supported errors is limited to a small set.

Code 200 is emitted in response to requests matching a &quot;<a href="#monitor-uri">monitor-uri</a>&quot; rule.

The files are returned verbatim on the TCP socket. This allows any trick such
as redirections to another URL or site, as well as tricks to clean cookies,
force enable or disable caching, etc... The package provides default error
files returning the same contents as default errors.

The files should not exceed the configured buffer size (BUFSIZE), which
generally is 8 or 16 kB, otherwise they will be truncated. It is also wise
not to put any reference to local contents (eg: images) in order to avoid
loops between the client and HAProxy when all servers are down, causing an
error to be returned instead of an image. For better HTTP compliance, it is
recommended that all header lines end with CR-LF and not LF alone.

The files are read at the same time as the configuration and kept in memory.
For this reason, the errors continue to be returned even when the process is
chrooted, and no file change is considered while the process is running. A
simple method for developing those files consists in associating them to the
403 status code and interrogating a blocked URL.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#errorloc">errorloc</a>&quot;, &quot;<a href="#errorloc302">errorloc302</a>&quot;, &quot;<a href="#errorloc303">errorloc303</a>&quot;</div>
<div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>errorfile 400 /etc/haproxy/errorfiles/400badreq.http
errorfile 408 /dev/null  <span class="comment"># workaround Chrome pre-connect bug</span>
errorfile 403 /etc/haproxy/errorfiles/403forbid.http
errorfile 503 /etc/haproxy/errorfiles/503sorry.http
</code></pre>
</div><a class="anchor" name="errorloc"></a><a class="anchor" name="4-errorloc"></a><a class="anchor" name="4.2-errorloc"></a><a class="anchor" name="errorloc (Proxies)"></a><a class="anchor" name="errorloc (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="errorloc"></a><a href="#4.2-errorloc">errorloc</a></b> <span style="color: #080">&lt;code&gt;</span> <span style="color: #080">&lt;url&gt;</span></div><a class="anchor" name="errorloc302"></a><a class="anchor" name="4-errorloc302"></a><a class="anchor" name="4.2-errorloc302"></a><a class="anchor" name="errorloc302 (Proxies)"></a><a class="anchor" name="errorloc302 (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="errorloc302"></a><a href="#4.2-errorloc302">errorloc302</a></b> <span style="color: #080">&lt;code&gt;</span> <span style="color: #080">&lt;url&gt;</span></div><pre class="text">Return an HTTP redirection to a URL instead of errors generated by HAProxy
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;code&gt;    is the HTTP status code. Currently, HAProxy is capable of
          generating codes 200, 400, 403, 408, 500, 502, 503, and 504.

&lt;url&gt;     it is the exact contents of the &quot;Location&quot; header. It may contain
          either a relative URI to an error page hosted on the same site,
          or an absolute URI designating an error page on another site.
          Special care should be given to relative URIs to avoid redirect
          loops if the URI itself may generate the same error (eg: 500).</pre>
</div>
<pre class="text">It is important to understand that this keyword is not meant to rewrite
errors returned by the server, but errors detected and returned by HAProxy.
This is why the list of supported errors is limited to a small set.

Code 200 is emitted in response to requests matching a &quot;<a href="#monitor-uri">monitor-uri</a>&quot; rule.

Note that both keyword return the HTTP 302 status code, which tells the
client to fetch the designated URL using the same HTTP method. This can be
quite problematic in case of non-GET methods such as POST, because the URL
sent to the client might not be allowed for something other than GET. To
workaround this problem, please use &quot;<a href="#errorloc303">errorloc303</a>&quot; which send the HTTP 303
status code, indicating to the client that the URL must be fetched with a GET
request.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#errorfile">errorfile</a>&quot;, &quot;<a href="#errorloc303">errorloc303</a>&quot;</div>
<a class="anchor" name="errorloc303"></a><a class="anchor" name="4-errorloc303"></a><a class="anchor" name="4.2-errorloc303"></a><a class="anchor" name="errorloc303 (Proxies)"></a><a class="anchor" name="errorloc303 (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="errorloc303"></a><a href="#4.2-errorloc303">errorloc303</a></b> <span style="color: #080">&lt;code&gt;</span> <span style="color: #080">&lt;url&gt;</span></div><pre class="text">Return an HTTP redirection to a URL instead of errors generated by HAProxy
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;code&gt;    is the HTTP status code. Currently, HAProxy is capable of
          generating codes 400, 403, 408, 500, 502, 503, and 504.

&lt;url&gt;     it is the exact contents of the &quot;Location&quot; header. It may contain
          either a relative URI to an error page hosted on the same site,
          or an absolute URI designating an error page on another site.
          Special care should be given to relative URIs to avoid redirect
          loops if the URI itself may generate the same error (eg: 500).</pre>
</div>
<pre class="text">It is important to understand that this keyword is not meant to rewrite
errors returned by the server, but errors detected and returned by HAProxy.
This is why the list of supported errors is limited to a small set.

Code 200 is emitted in response to requests matching a &quot;<a href="#monitor-uri">monitor-uri</a>&quot; rule.

Note that both keyword return the HTTP 303 status code, which tells the
client to fetch the designated URL using the same HTTP GET method. This
solves the usual problems associated with &quot;<a href="#errorloc">errorloc</a>&quot; and the 302 code. It is
possible that some very old browsers designed before HTTP/1.1 do not support
it, but no such problem has been reported till now.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#errorfile">errorfile</a>&quot;, &quot;<a href="#errorloc">errorloc</a>&quot;, &quot;<a href="#errorloc302">errorloc302</a>&quot;</div>
<a class="anchor" name="force-persist"></a><a class="anchor" name="4-force-persist"></a><a class="anchor" name="4.2-force-persist"></a><a class="anchor" name="force-persist (Proxies)"></a><a class="anchor" name="force-persist (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="force-persist"></a><a href="#4.2-force-persist">force-persist</a></b> <span style="color: #800">{ if | unless }</span> <span style="color: #080">&lt;condition&gt;</span></div><pre class="text">Declare a condition to force persistence on down servers
</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">By default, requests are not dispatched to down servers. It is possible to
force this using &quot;<a href="#option%20persist">option persist</a>&quot;, but it is unconditional and redispatches
to a valid server if &quot;<a href="#option%20redispatch">option redispatch</a>&quot; is set. That leaves with very little
possibilities to force some requests to reach a server which is artificially
marked down for maintenance operations.

The &quot;<a href="#force-persist">force-persist</a>&quot; statement allows one to declare various ACL-based
conditions which, when met, will cause a request to ignore the down status of
a server and still try to connect to it. That makes it possible to start a
server, still replying an error to the health checks, and run a specially
configured browser to test the service. Among the handy methods, one could
use a specific source IP address, or a specific cookie. The cookie also has
the advantage that it can easily be added/removed on the browser from a test
page. Once the service is validated, it is then possible to open the service
to the world by returning a valid response to health checks.

The forced persistence is enabled when an &quot;if&quot; condition is met, or unless an
&quot;unless&quot; condition is met. The final redispatch is always disabled when this
is used.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20redispatch">option redispatch</a>&quot;, &quot;<a href="#ignore-persist">ignore-persist</a>&quot;, &quot;<a href="#option%20persist">persist</a>&quot;, and <a href="#7">section 7</a> about ACL usage.</div>
<a class="anchor" name="fullconn"></a><a class="anchor" name="4-fullconn"></a><a class="anchor" name="4.2-fullconn"></a><a class="anchor" name="fullconn (Proxies)"></a><a class="anchor" name="fullconn (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="fullconn"></a><a href="#4.2-fullconn">fullconn</a></b> <span style="color: #080">&lt;conns&gt;</span></div><pre class="text">Specify at what backend load the servers will reach their maxconn
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;conns&gt;   is the number of connections on the backend which will make the
          servers use the maximal number of connections.</pre>
</div>
<pre class="text">When a server has a &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Performance%20tuning%29">Performance tuning</a></li><li><a href="#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#maxconn%20%28Bind%20options%29">Bind options</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; parameter specified, it means that its number
of concurrent connections will never go higher. Additionally, if it has a
&quot;<a href="#minconn">minconn</a>&quot; parameter, it indicates a dynamic limit following the backend's
load. The server will then always accept at least &lt;minconn&gt; connections,
never more than &lt;maxconn&gt;, and the limit will be on the ramp between both
values when the backend has less than &lt;conns&gt; concurrent connections. This
makes it possible to limit the load on the servers during normal loads, but
push it further for important loads without overloading the servers during
exceptional loads.

Since it's hard to get this value right, haproxy automatically sets it to
10% of the sum of the maxconns of all frontends that may branch to this
backend (based on &quot;<a href="#use_backend">use_backend</a>&quot; and &quot;<a href="#default_backend">default_backend</a>&quot; rules). That way it's
safe to leave it unset. However, &quot;<a href="#use_backend">use_backend</a>&quot; involving dynamic names are
not counted since there is no way to know if they could match or not.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># The servers will accept between 100 and 1000 concurrent connections each</span>
<span class="comment"># and the maximum of 1000 will be reached when the backend reaches 10000</span>
<span class="comment"># connections.</span>
backend dynamic
   fullconn   10000
   server     srv1   dyn1:80 minconn 100 maxconn 1000
   server     srv2   dyn2:80 minconn 100 maxconn 1000
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Performance%20tuning%29">Performance tuning</a></li><li><a href="#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#maxconn%20%28Bind%20options%29">Bind options</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;, &quot;<a href="#server">server</a>&quot;</div>
<a class="anchor" name="grace"></a><a class="anchor" name="4-grace"></a><a class="anchor" name="4.2-grace"></a><a class="anchor" name="grace (Proxies)"></a><a class="anchor" name="grace (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="grace"></a><a href="#4.2-grace">grace</a></b> <span style="color: #080">&lt;time&gt;</span></div><pre class="text">Maintain a proxy operational for some time after a soft stop
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;time&gt;    is the time (by default in milliseconds) for which the instance
          will remain operational with the frontend sockets still listening
          when a soft-stop is received via the SIGUSR1 signal.</pre>
</div>
<pre class="text">This may be used to ensure that the services disappear in a certain order.
This was designed so that frontends which are dedicated to monitoring by an
external equipment fail immediately while other ones remain up for the time
needed by the equipment to detect the failure.

Note that currently, there is very little benefit in using this parameter,
and it may in fact complicate the soft-reconfiguration process more than
simplify it.
</pre><a class="anchor" name="hash-type"></a><a class="anchor" name="4-hash-type"></a><a class="anchor" name="4.2-hash-type"></a><a class="anchor" name="hash-type (Proxies)"></a><a class="anchor" name="hash-type (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="hash-type"></a><a href="#4.2-hash-type">hash-type</a></b> <span style="color: #080">&lt;method&gt;</span> <span style="color: #080">&lt;function&gt;</span> <span style="color: #080">&lt;modifier&gt;</span></div><pre class="text">Specify a method to use for mapping hashes to servers
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;method&gt; is the method used to select a server from the hash computed by
         the &lt;function&gt; :

  map-based   the hash table is a static array containing all alive servers.
              The hashes will be very smooth, will consider weights, but
              will be static in that weight changes while a server is up
              will be ignored. This means that there will be no slow start.
              Also, since a server is selected by its position in the array,
              most mappings are changed when the server count changes. This
              means that when a server goes up or down, or when a server is
              added to a farm, most connections will be redistributed to
              different servers. This can be inconvenient with caches for
              instance.

  consistent  the hash table is a tree filled with many occurrences of each
              server. The hash key is looked up in the tree and the closest
              server is chosen. This hash is dynamic, it supports changing
              weights while the servers are up, so it is compatible with the
              slow start feature. It has the advantage that when a server
              goes up or down, only its associations are moved. When a
              server is added to the farm, only a few part of the mappings
              are redistributed, making it an ideal method for caches.
              However, due to its principle, the distribution will never be
              very smooth and it may sometimes be necessary to adjust a
              server's weight or its ID to get a more balanced distribution.
              In order to get the same distribution on multiple load
              balancers, it is important that all servers have the exact
              same IDs. Note: consistent hash uses sdbm and avalanche if no
              hash function is specified.

&lt;function&gt; is the hash function to be used :

   sdbm   this function was created initially for sdbm (a public-domain
          reimplementation of ndbm) database library. It was found to do
          well in scrambling bits, causing better distribution of the keys
          and fewer splits. It also happens to be a good general hashing
          function with good distribution, unless the total server weight
          is a multiple of 64, in which case applying the avalanche
          modifier may help.

   djb2   this function was first proposed by Dan Bernstein many years ago
          on comp.lang.c. Studies have shown that for certain workload this
          function provides a better distribution than sdbm. It generally
          works well with text-based inputs though it can perform extremely
          poorly with numeric-only input or when the total server weight is
          a multiple of 33, unless the avalanche modifier is also used.

   wt6    this function was designed for haproxy while testing other
          functions in the past. It is not as smooth as the other ones, but
          is much less sensible to the input data set or to the number of
          servers. It can make sense as an alternative to sdbm+avalanche or
          djb2+avalanche for consistent hashing or when hashing on numeric
          data such as a source IP address or a visitor identifier in a URL
          parameter.

&lt;modifier&gt; indicates an optional method applied after hashing the key :

   avalanche   This directive indicates that the result from the hash
               function above should not be used in its raw form but that
               a 4-byte full avalanche hash must be applied first. The
               purpose of this step is to mix the resulting bits from the
               previous hash in order to avoid any undesired effect when
               the input contains some limited values or when the number of
               servers is a multiple of one of the hash's components (64
               for SDBM, 33 for DJB2). Enabling avalanche tends to make the
               result less predictable, but it's also not as smooth as when
               using the original function. Some testing might be needed
               with some workloads. This hash is one of the many proposed
               by Bob Jenkins.</pre>
</div>
<pre class="text">The default hash type is &quot;map-based&quot; and is recommended for most usages. The
default function is &quot;sdbm&quot;, the selection of a function should be based on
the range of the values being hashed.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#balance">balance</a>&quot;, &quot;<a href="#server">server</a>&quot;</div>
<a class="anchor" name="http-check"></a><a class="anchor" name="4-http-check"></a><a class="anchor" name="4.2-http-check"></a><a class="anchor" name="http-check (Proxies)"></a><a class="anchor" name="http-check (Alphabetically sorted keywords reference)"></a><a class="anchor" name="http-check disable-on-404"></a><a class="anchor" name="4-http-check disable-on-404"></a><a class="anchor" name="4.2-http-check disable-on-404"></a><a class="anchor" name="http-check disable-on-404 (Proxies)"></a><a class="anchor" name="http-check disable-on-404 (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="http-check disable-on-404"></a><a href="#4.2-http-check%20disable-on-404">http-check disable-on-404</a></b></div><pre class="text">Enable a maintenance mode upon HTTP/404 response to health-checks
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When this option is set, a server which returns an HTTP code 404 will be
excluded from further load-balancing, but will still receive persistent
connections. This provides a very convenient method for Web administrators
to perform a graceful shutdown of their servers. It is also important to note
that a server which is detected as failed while it was in this mode will not
generate an alert, just a notice. If the server responds 2xx or 3xx again, it
will immediately be reinserted into the farm. The status on the stats page
reports &quot;NOLB&quot; for a server in this mode. It is important to note that this
option only works in conjunction with the &quot;<a href="#option%20httpchk">httpchk</a>&quot; option. If this option
is used with &quot;<a href="#http-check%20expect">http-check expect</a>&quot;, then it has precedence over it so that 404
responses will still be considered as soft-stop.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httpchk">option httpchk</a>&quot;, &quot;<a href="#http-check%20expect">http-check expect</a>&quot;</div>
<a class="anchor" name="http-check"></a><a class="anchor" name="4-http-check"></a><a class="anchor" name="4.2-http-check"></a><a class="anchor" name="http-check (Proxies)"></a><a class="anchor" name="http-check (Alphabetically sorted keywords reference)"></a><a class="anchor" name="http-check expect"></a><a class="anchor" name="4-http-check expect"></a><a class="anchor" name="4.2-http-check expect"></a><a class="anchor" name="http-check expect (Proxies)"></a><a class="anchor" name="http-check expect (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="http-check expect"></a><a href="#4.2-http-check%20expect">http-check expect</a></b> <span style="color: #008">[!]</span> <span style="color: #080">&lt;match&gt;</span> <span style="color: #080">&lt;pattern&gt;</span></div><pre class="text">Make HTTP health checks consider response contents or specific status codes
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;match&gt;   is a keyword indicating how to look for a specific pattern in the
          response. The keyword may be one of &quot;<a href="#status">status</a>&quot;, &quot;rstatus&quot;,
          &quot;string&quot;, or &quot;rstring&quot;. The keyword may be preceded by an
          exclamation mark (&quot;!&quot;) to negate the match. Spaces are allowed
          between the exclamation mark and the keyword. See below for more
          details on the supported keywords.

&lt;pattern&gt; is the pattern to look for. It may be a string or a regular
          expression. If the pattern contains spaces, they must be escaped
          with the usual backslash ('\').</pre>
</div>
<pre class="text">By default, &quot;<a href="#option%20httpchk">option httpchk</a>&quot; considers that response statuses 2xx and 3xx
are valid, and that others are invalid. When &quot;<a href="#http-check%20expect">http-check expect</a>&quot; is used,
it defines what is considered valid or invalid. Only one &quot;<a href="#http-check">http-check</a>&quot;
statement is supported in a backend. If a server fails to respond or times
out, the check obviously fails. The available matches are :

  status &lt;string&gt; : test the exact string match for the HTTP status code.
                    A health check response will be considered valid if the
                    response's status code is exactly this string. If the
                    &quot;<a href="#status">status</a>&quot; keyword is prefixed with &quot;!&quot;, then the response
                    will be considered invalid if the status code matches.

  rstatus &lt;regex&gt; : test a regular expression for the HTTP status code.
                    A health check response will be considered valid if the
                    response's status code matches the expression. If the
                    &quot;rstatus&quot; keyword is prefixed with &quot;!&quot;, then the response
                    will be considered invalid if the status code matches.
                    This is mostly used to check for multiple codes.

  string &lt;string&gt; : test the exact string match in the HTTP response body.
                    A health check response will be considered valid if the
                    response's body contains this exact string. If the
                    &quot;string&quot; keyword is prefixed with &quot;!&quot;, then the response
                    will be considered invalid if the body contains this
                    string. This can be used to look for a mandatory word at
                    the end of a dynamic page, or to detect a failure when a
                    specific error appears on the check page (eg: a stack
                    trace).

  rstring &lt;regex&gt; : test a regular expression on the HTTP response body.
                    A health check response will be considered valid if the
                    response's body matches this expression. If the &quot;rstring&quot;
                    keyword is prefixed with &quot;!&quot;, then the response will be
                    considered invalid if the body matches the expression.
                    This can be used to look for a mandatory word at the end
                    of a dynamic page, or to detect a failure when a specific
                    error appears on the check page (eg: a stack trace).

It is important to note that the responses will be limited to a certain size
defined by the global &quot;<a href="#tune.chksize">tune.chksize</a>&quot; option, which defaults to 16384 bytes.
Thus, too large responses may not contain the mandatory pattern when using
&quot;string&quot; or &quot;rstring&quot;. If a large response is absolutely required, it is
possible to change the default max size by setting the global variable.
However, it is worth keeping in mind that parsing very large responses can
waste some CPU cycles, especially when regular expressions are used, and that
it is always better to focus the checks on smaller resources.

Last, if &quot;<a href="#http-check%20expect">http-check expect</a>&quot; is combined with &quot;<a href="#http-check%20disable-on-404">http-check disable-on-404</a>&quot;,
then this last one has precedence when the server responds with 404.
</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code><span class="comment"># only accept status 200 as valid</span>
http-check expect status 200

<span class="comment"># consider SQL errors as errors</span>
http-check expect ! string SQL\ Error

<span class="comment"># consider status 5xx only as errors</span>
http-check expect ! rstatus ^5

<span class="comment"># check that we have a correct hexadecimal tag before /html</span>
http-check expect rstring &lt;!--tag:[0-9a-f]*&lt;/html&gt;
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httpchk">option httpchk</a>&quot;, &quot;<a href="#http-check%20disable-on-404">http-check disable-on-404</a>&quot;</div>
<a class="anchor" name="http-check"></a><a class="anchor" name="4-http-check"></a><a class="anchor" name="4.2-http-check"></a><a class="anchor" name="http-check (Proxies)"></a><a class="anchor" name="http-check (Alphabetically sorted keywords reference)"></a><a class="anchor" name="http-check send-state"></a><a class="anchor" name="4-http-check send-state"></a><a class="anchor" name="4.2-http-check send-state"></a><a class="anchor" name="http-check send-state (Proxies)"></a><a class="anchor" name="http-check send-state (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="http-check send-state"></a><a href="#4.2-http-check%20send-state">http-check send-state</a></b></div><pre class="text">Enable emission of a state header with HTTP health checks
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When this option is set, haproxy will systematically send a special header
&quot;X-Haproxy-Server-State&quot; with a list of parameters indicating to each server
how they are seen by haproxy. This can be used for instance when a server is
manipulated without access to haproxy and the operator needs to know whether
haproxy still sees it up or not, or if the server is the last one in a farm.

The header is composed of fields delimited by semi-colons, the first of which
is a word (&quot;UP&quot;, &quot;DOWN&quot;, &quot;NOLB&quot;), possibly followed by a number of valid
checks on the total number before transition, just as appears in the stats
interface. Next headers are in the form &quot;&lt;variable&gt;=&lt;value&gt;&quot;, indicating in
no specific order some values available in the stats interface :
  - a variable &quot;<a href="#name">name</a>&quot;, containing the name of the backend followed by a slash
    (&quot;/&quot;) then the name of the server. This can be used when a server is
    checked in multiple backends.

  - a variable &quot;<a href="#node">node</a>&quot; containing the name of the haproxy node, as set in the
    global &quot;<a href="#node">node</a>&quot; variable, otherwise the system's hostname if unspecified.

  - a variable &quot;<a href="#weight">weight</a>&quot; indicating the weight of the server, a slash (&quot;/&quot;)
    and the total weight of the farm (just counting usable servers). This
    helps to know if other servers are available to handle the load when this
    one fails.

  - a variable &quot;scur&quot; indicating the current number of concurrent connections
    on the server, followed by a slash (&quot;/&quot;) then the total number of
    connections on all servers of the same backend.

  - a variable &quot;qcur&quot; indicating the current number of requests in the
    server's queue.

Example of a header received by the application server :
  &gt;&gt;&gt;  X-Haproxy-Server-State: UP 2/3; name=bck/srv2; node=lb1; weight=1/2; \
         scur=13/22; qcur=0
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httpchk">option httpchk</a>&quot;, &quot;<a href="#http-check%20disable-on-404">http-check disable-on-404</a>&quot;</div>
<a class="anchor" name="http-request"></a><a class="anchor" name="4-http-request"></a><a class="anchor" name="4.2-http-request"></a><a class="anchor" name="http-request (Proxies)"></a><a class="anchor" name="http-request (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="http-request"></a><a href="#4.2-http-request">http-request</a></b> <span style="color: #800">{ allow | deny | tarpit | auth <span style="color: #008">[realm <span style="color: #080">&lt;realm&gt;</span>]</span> | redirect <span style="color: #080">&lt;rule&gt;</span> |
              add-header <span style="color: #080">&lt;name&gt;</span> <span style="color: #080">&lt;fmt&gt;</span> | set-header <span style="color: #080">&lt;name&gt;</span> <span style="color: #080">&lt;fmt&gt;</span> |
              del-header <span style="color: #080">&lt;name&gt;</span> | set-nice <span style="color: #080">&lt;nice&gt;</span> | set-log-level <span style="color: #080">&lt;level&gt;</span> |
              replace-header <span style="color: #080">&lt;name&gt;</span> <span style="color: #080">&lt;match-regex&gt;</span> <span style="color: #080">&lt;replace-fmt&gt;</span> |
              replace-value <span style="color: #080">&lt;name&gt;</span> <span style="color: #080">&lt;match-regex&gt;</span> <span style="color: #080">&lt;replace-fmt&gt;</span> |
              set-tos <span style="color: #080">&lt;tos&gt;</span> | set-mark <span style="color: #080">&lt;mark&gt;</span> |
              add-acl(<span style="color: #080">&lt;file name&gt;</span>) <span style="color: #080">&lt;key fmt&gt;</span> |
              del-acl(<span style="color: #080">&lt;file name&gt;</span>) <span style="color: #080">&lt;key fmt&gt;</span> |
              del-map(<span style="color: #080">&lt;file name&gt;</span>) <span style="color: #080">&lt;key fmt&gt;</span> |
              set-map(<span style="color: #080">&lt;file name&gt;</span>) <span style="color: #080">&lt;key fmt&gt;</span> <span style="color: #080">&lt;value fmt&gt;</span>
             }</span>
             <span style="color: #008">[ <span style="color: #800">{ if | unless }</span> <span style="color: #080">&lt;condition&gt;</span> ]</span></div><pre class="text">Access control for Layer 7 requests
</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">The http-request statement defines a set of rules which apply to layer 7
processing. The rules are evaluated in their declaration order when they are
met in a frontend, listen or backend section. Any rule may optionally be
followed by an ACL-based condition, in which case it will only be evaluated
if the condition is true.

The first keyword is the rule's action. Currently supported actions include :
  - &quot;allow&quot; : this stops the evaluation of the rules and lets the request
    pass the check. No further &quot;<a href="#http-request">http-request</a>&quot; rules are evaluated.

  - &quot;deny&quot; : this stops the evaluation of the rules and immediately rejects
    the request and emits an HTTP 403 error. No further &quot;<a href="#http-request">http-request</a>&quot; rules
    are evaluated.

  - &quot;tarpit&quot; : this stops the evaluation of the rules and immediately blocks
    the request without responding for a delay specified by &quot;<a href="#timeout%20tarpit">timeout tarpit</a>&quot;
    or &quot;<a href="#timeout%20connect">timeout connect</a>&quot; if the former is not set. After that delay, if the
    client is still connected, an HTTP error 500 is returned so that the
    client does not suspect it has been tarpitted. Logs will report the flags
    &quot;PT&quot;. The goal of the tarpit rule is to slow down robots during an attack
    when they're limited on the number of concurrent requests. It can be very
    efficient against very dumb robots, and will significantly reduce the
    load on firewalls compared to a &quot;deny&quot; rule. But when facing &quot;correctly&quot;
    developed robots, it can make things worse by forcing haproxy and the
    front firewall to support insane number of concurrent connections.

  - &quot;auth&quot; : this stops the evaluation of the rules and immediately responds
    with an HTTP 401 or 407 error code to invite the user to present a valid
    user name and password. No further &quot;<a href="#http-request">http-request</a>&quot; rules are evaluated. An
    optional &quot;realm&quot; parameter is supported, it sets the authentication realm
    that is returned with the response (typically the application's name).

  - &quot;<a href="#redirect">redirect</a>&quot; : this performs an HTTP redirection based on a redirect rule.
    This is exactly the same as the &quot;<a href="#redirect">redirect</a>&quot; statement except that it
    inserts a redirect rule which can be processed in the middle of other
    &quot;<a href="#http-request">http-request</a>&quot; rules and that these rules use the &quot;<a href="#log-format">log-format</a>&quot; strings.
    See the &quot;<a href="#redirect">redirect</a>&quot; keyword for the rule's syntax.

  - &quot;add-header&quot; appends an HTTP header field whose name is specified in
    &lt;name&gt; and whose value is defined by &lt;fmt&gt; which follows the log-format
    rules (see Custom Log Format in <a href="#8.2.4">section 8.2.4</a>). This is particularly
    useful to pass connection-specific information to the server (eg: the
    client's SSL certificate), or to combine several headers into one. This
    rule is not final, so it is possible to add other similar rules. Note
    that header addition is performed immediately, so one rule might reuse
    the resulting header from a previous rule.

  - &quot;set-header&quot; does the same as &quot;add-header&quot; except that the header name
    is first removed if it existed. This is useful when passing security
    information to the server, where the header must not be manipulated by
    external users.

  - &quot;del-header&quot; removes all HTTP header fields whose name is specified in
    &lt;name&gt;.

  - &quot;replace-header&quot; matches the regular expression in all occurrences of
    header field &lt;name&gt; according to &lt;match-regex&gt;, and replaces them with
    the &lt;replace-fmt&gt; argument. Format characters are allowed in replace-fmt
    and work like in &lt;fmt&gt; arguments in &quot;add-header&quot;. The match is only
    case-sensitive. It is important to understand that this action only
    considers whole header lines, regardless of the number of values they
    may contain. This usage is suited to headers naturally containing commas
    in their value, such as If-Modified-Since and so on.
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>http-request replace-header Cookie foo=([^;]*);(.*) foo=\1;ip=%bi;\2
</code></pre>
</div><pre class="text">  applied to:

    Cookie: foo=foobar; expires=Tue, 14-Jun-2016 01:40:45 GMT;

  outputs:

    Cookie: foo=foobar;ip=192.168.1.20; expires=Tue, 14-Jun-2016 01:40:45 GMT;

  assuming the backend IP is 192.168.1.20

- &quot;replace-value&quot; works like &quot;replace-header&quot; except that it matches the
  regex against every comma-delimited value of the header field &lt;name&gt;
  instead of the entire header. This is suited for all headers which are
  allowed to carry more than one value. An example could be the Accept
  header.
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>http-request replace-value X-Forwarded-For ^192\.168\.(.*)$ 172.16.\1
</code></pre>
</div><pre class="text">    applied to:

      X-Forwarded-For: 192.168.10.1, 192.168.13.24, 10.0.0.37

    outputs:

      X-Forwarded-For: 172.16.10.1, 172.16.13.24, 10.0.0.37

  - &quot;set-nice&quot; sets the &quot;<a href="#nice">nice</a>&quot; factor of the current request being processed.
    It only has effect against the other requests being processed at the same
    time. The default value is 0, unless altered by the &quot;<a href="#nice">nice</a>&quot; setting on the
    &quot;<a href="#bind">bind</a>&quot; line. The accepted range is -1024..1024. The higher the value, the
    nicest the request will be. Lower values will make the request more
    important than other ones. This can be useful to improve the speed of
    some requests, or lower the priority of non-important requests. Using
    this setting without prior experimentation can cause some major slowdown.

  - &quot;set-log-level&quot; is used to change the log level of the current request
    when a certain condition is met. Valid levels are the 8 syslog levels
    (see the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">log<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#log%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#log%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li></ul></span>&quot; keyword) plus the special level &quot;silent&quot; which disables
    logging for this request. This rule is not final so the last matching
    rule wins. This rule can be useful to disable health checks coming from
    another equipment.

  - &quot;set-tos&quot; is used to set the TOS or DSCP field value of packets sent to
    the client to the value passed in &lt;tos&gt; on platforms which support this.
    This value represents the whole 8 bits of the IP TOS field, and can be
    expressed both in decimal or hexadecimal format (prefixed by &quot;0x&quot;). Note
    that only the 6 higher bits are used in DSCP or TOS, and the two lower
    bits are always 0. This can be used to adjust some routing behaviour on
    border routers based on some information from the request. See RFC 2474,
    2597, 3260 and 4594 for more information.

  - &quot;set-mark&quot; is used to set the Netfilter MARK on all packets sent to the
    client to the value passed in &lt;mark&gt; on platforms which support it. This
    value is an unsigned 32 bit value which can be matched by netfilter and
    by the routing table. It can be expressed both in decimal or hexadecimal
    format (prefixed by &quot;0x&quot;). This can be useful to force certain packets to
    take a different route (for example a cheaper network path for bulk
    downloads). This works on Linux kernels 2.6.32 and above and requires
    admin privileges.

  - &quot;add-acl&quot; is used to add a new entry into an ACL. The ACL must be loaded
    from a file (even a dummy empty file). The file name of the ACL to be
    updated is passed between parentheses. It takes one argument: &lt;key fmt&gt;,
    which follows log-format rules, to collect content of the new entry. It
    performs a lookup in the ACL before insertion, to avoid duplicated (or
    more) values. This lookup is done by a linear search and can be expensive
    with large lists! It is the equivalent of the &quot;<a href="#add%20acl">add acl</a>&quot; command from the
    stats socket, but can be triggered by an HTTP request.

  - &quot;del-acl&quot; is used to delete an entry from an ACL. The ACL must be loaded
    from a file (even a dummy empty file). The file name of the ACL to be
    updated is passed between parentheses. It takes one argument: &lt;key fmt&gt;,
    which follows log-format rules, to collect content of the entry to delete.
    It is the equivalent of the &quot;<a href="#del%20acl">del acl</a>&quot; command from the stats socket, but
    can be triggered by an HTTP request.

  - &quot;del-map&quot; is used to delete an entry from a MAP. The MAP must be loaded
    from a file (even a dummy empty file). The file name of the MAP to be
    updated is passed between parentheses. It takes one argument: &lt;key fmt&gt;,
    which follows log-format rules, to collect content of the entry to delete.
    It takes one argument: &quot;file name&quot; It is the equivalent of the &quot;<a href="#del%20map">del map</a>&quot;
    command from the stats socket, but can be triggered by an HTTP request.

  - &quot;set-map&quot; is used to add a new entry into a MAP. The MAP must be loaded
    from a file (even a dummy empty file). The file name of the MAP to be
    updated is passed between parentheses. It takes 2 arguments: &lt;key fmt&gt;,
    which follows log-format rules, used to collect MAP key, and &lt;value fmt&gt;,
    which follows log-format rules, used to collect content for the new entry.
    It performs a lookup in the MAP before insertion, to avoid duplicated (or
    more) values. This lookup is done by a linear search and can be expensive
    with large lists! It is the equivalent of the &quot;<a href="#set%20map">set map</a>&quot; command from the
    stats socket, but can be triggered by an HTTP request.

There is no limit to the number of http-request statements per instance.

It is important to know that http-request rules are processed very early in
the HTTP processing, just after &quot;<a href="#block">block</a>&quot; rules and before &quot;<a href="#reqdel">reqdel</a>&quot; or &quot;<a href="#reqrep">reqrep</a>&quot;
rules. That way, headers added by &quot;add-header&quot;/&quot;set-header&quot; are visible by
almost all further ACL rules.
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>acl nagios src 192.168.129.3
acl local_net src 192.168.0.0/16
acl auth_ok http_auth(L1)

http-request allow if nagios
http-request allow if local_net auth_ok
http-request auth realm Gimme if local_net auth_ok
http-request deny
</code></pre>
</div><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>acl auth_ok http_auth_group(L1) G1
http-request auth unless auth_ok
</code></pre>
</div><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>http-request set-header X-Haproxy-Current-Date %T
http-request set-header X-SSL                  %[ssl_fc]
http-request set-header X-SSL-Session_ID       %[ssl_fc_session_id]
http-request set-header X-SSL-Client-Verify    %[ssl_c_verify]
http-request set-header X-SSL-Client-DN        %{+Q}[ssl_c_s_dn]
http-request set-header X-SSL-Client-CN        %{+Q}[ssl_c_s_dn(cn)]
http-request set-header X-SSL-Issuer           %{+Q}[ssl_c_i_dn]
http-request set-header X-SSL-Client-NotBefore %{+Q}[ssl_c_notbefore]
http-request set-header X-SSL-Client-NotAfter  %{+Q}[ssl_c_notafter]
</code></pre>
</div><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>acl key req.hdr(X-Add-Acl-Key) -m found
acl add path /addacl
acl del path /delacl

acl myhost hdr(Host) -f myhost.lst

http-request add-acl(myhost.lst) %[req.hdr(X-Add-Acl-Key)] if key add
http-request del-acl(myhost.lst) %[req.hdr(X-Add-Acl-Key)] if key del
</code></pre>
</div><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>acl value  req.hdr(X-Value) -m found
acl setmap path /setmap
acl delmap path /delmap

use_backend bk_appli if { hdr(Host),map_str(map.lst) -m found }

http-request set-map(map.lst) %[src] %[req.hdr(X-Value)] if setmap value
http-request del-map(map.lst) %[src]                     if delmap
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stats%20http-request">stats http-request</a>&quot;, <a href="#3.4">section 3.4</a> about userlists and <a href="#7">section 7</a> about ACL usage.</div>
<a class="anchor" name="http-response"></a><a class="anchor" name="4-http-response"></a><a class="anchor" name="4.2-http-response"></a><a class="anchor" name="http-response (Proxies)"></a><a class="anchor" name="http-response (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="http-response"></a><a href="#4.2-http-response">http-response</a></b> <span style="color: #800">{ allow | deny | add-header <span style="color: #080">&lt;name&gt;</span> <span style="color: #080">&lt;fmt&gt;</span> | set-nice <span style="color: #080">&lt;nice&gt;</span> |
                set-header <span style="color: #080">&lt;name&gt;</span> <span style="color: #080">&lt;fmt&gt;</span> | del-header <span style="color: #080">&lt;name&gt;</span> |
                replace-header <span style="color: #080">&lt;name&gt;</span> <span style="color: #080">&lt;regex-match&gt;</span> <span style="color: #080">&lt;replace-fmt&gt;</span> |
                replace-value <span style="color: #080">&lt;name&gt;</span> <span style="color: #080">&lt;regex-match&gt;</span> <span style="color: #080">&lt;replace-fmt&gt;</span> |
                set-log-level <span style="color: #080">&lt;level&gt;</span> | set-mark <span style="color: #080">&lt;mark&gt;</span> | set-tos <span style="color: #080">&lt;tos&gt;</span> |
                add-acl(<span style="color: #080">&lt;file name&gt;</span>) <span style="color: #080">&lt;key fmt&gt;</span> |
                del-acl(<span style="color: #080">&lt;file name&gt;</span>) <span style="color: #080">&lt;key fmt&gt;</span> |
                del-map(<span style="color: #080">&lt;file name&gt;</span>) <span style="color: #080">&lt;key fmt&gt;</span> |
                set-map(<span style="color: #080">&lt;file name&gt;</span>) <span style="color: #080">&lt;key fmt&gt;</span> <span style="color: #080">&lt;value fmt&gt;</span>
              }</span>
              <span style="color: #008">[ <span style="color: #800">{ if | unless }</span> <span style="color: #080">&lt;condition&gt;</span> ]</span></div><pre class="text">Access control for Layer 7 responses
</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">The http-response statement defines a set of rules which apply to layer 7
processing. The rules are evaluated in their declaration order when they are
met in a frontend, listen or backend section. Any rule may optionally be
followed by an ACL-based condition, in which case it will only be evaluated
if the condition is true. Since these rules apply on responses, the backend
rules are applied first, followed by the frontend's rules.

The first keyword is the rule's action. Currently supported actions include :
  - &quot;allow&quot; : this stops the evaluation of the rules and lets the response
    pass the check. No further &quot;<a href="#http-response">http-response</a>&quot; rules are evaluated for the
    current section.

  - &quot;deny&quot; : this stops the evaluation of the rules and immediately rejects
    the response and emits an HTTP 502 error. No further &quot;<a href="#http-response">http-response</a>&quot;
    rules are evaluated.

  - &quot;add-header&quot; appends an HTTP header field whose name is specified in
    &lt;name&gt; and whose value is defined by &lt;fmt&gt; which follows the log-format
    rules (see Custom Log Format in <a href="#8.2.4">section 8.2.4</a>). This may be used to send
    a cookie to a client for example, or to pass some internal information.
    This rule is not final, so it is possible to add other similar rules.
    Note that header addition is performed immediately, so one rule might
    reuse the resulting header from a previous rule.

  - &quot;set-header&quot; does the same as &quot;add-header&quot; except that the header name
    is first removed if it existed. This is useful when passing security
    information to the server, where the header must not be manipulated by
    external users.

  - &quot;del-header&quot; removes all HTTP header fields whose name is specified in
    &lt;name&gt;.

  - &quot;replace-header&quot; matches the regular expression in all occurrences of
    header field &lt;name&gt; according to &lt;match-regex&gt;, and replaces them with
    the &lt;replace-fmt&gt; argument. Format characters are allowed in replace-fmt
    and work like in &lt;fmt&gt; arguments in &quot;add-header&quot;. The match is only
    case-sensitive. It is important to understand that this action only
    considers whole header lines, regardless of the number of values they
    may contain. This usage is suited to headers naturally containing commas
    in their value, such as Set-Cookie, Expires and so on.
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>http-response replace-header Set-Cookie (C=[^;]*);(.*) \1;ip=%bi;\2
</code></pre>
</div><pre class="text">  applied to:

    Set-Cookie: C=1; expires=Tue, 14-Jun-2016 01:40:45 GMT

  outputs:

    Set-Cookie: C=1;ip=192.168.1.20; expires=Tue, 14-Jun-2016 01:40:45 GMT

  assuming the backend IP is 192.168.1.20.

- &quot;replace-value&quot; works like &quot;replace-header&quot; except that it matches the
  regex against every comma-delimited value of the header field &lt;name&gt;
  instead of the entire header. This is suited for all headers which are
  allowed to carry more than one value. An example could be the Accept
  header.
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>http-response replace-value Cache-control ^public$ private
</code></pre>
</div><pre class="text">    applied to:

      Cache-Control: max-age=3600, public

    outputs:

      Cache-Control: max-age=3600, private

  - &quot;set-nice&quot; sets the &quot;<a href="#nice">nice</a>&quot; factor of the current request being processed.
    It only has effect against the other requests being processed at the same
    time. The default value is 0, unless altered by the &quot;<a href="#nice">nice</a>&quot; setting on the
    &quot;<a href="#bind">bind</a>&quot; line. The accepted range is -1024..1024. The higher the value, the
    nicest the request will be. Lower values will make the request more
    important than other ones. This can be useful to improve the speed of
    some requests, or lower the priority of non-important requests. Using
    this setting without prior experimentation can cause some major slowdown.

  - &quot;set-log-level&quot; is used to change the log level of the current request
    when a certain condition is met. Valid levels are the 8 syslog levels
    (see the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">log<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#log%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#log%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li></ul></span>&quot; keyword) plus the special level &quot;silent&quot; which disables
    logging for this request. This rule is not final so the last matching
    rule wins. This rule can be useful to disable health checks coming from
    another equipment.

  - &quot;set-tos&quot; is used to set the TOS or DSCP field value of packets sent to
    the client to the value passed in &lt;tos&gt; on platforms which support this.
    This value represents the whole 8 bits of the IP TOS field, and can be
    expressed both in decimal or hexadecimal format (prefixed by &quot;0x&quot;). Note
    that only the 6 higher bits are used in DSCP or TOS, and the two lower
    bits are always 0. This can be used to adjust some routing behaviour on
    border routers based on some information from the request. See RFC 2474,
    2597, 3260 and 4594 for more information.

  - &quot;set-mark&quot; is used to set the Netfilter MARK on all packets sent to the
    client to the value passed in &lt;mark&gt; on platforms which support it. This
    value is an unsigned 32 bit value which can be matched by netfilter and
    by the routing table. It can be expressed both in decimal or hexadecimal
    format (prefixed by &quot;0x&quot;). This can be useful to force certain packets to
    take a different route (for example a cheaper network path for bulk
    downloads). This works on Linux kernels 2.6.32 and above and requires
    admin privileges.

  - &quot;add-acl&quot; is used to add a new entry into an ACL. The ACL must be loaded
    from a file (even a dummy empty file). The file name of the ACL to be
    updated is passed between parentheses. It takes one argument: &lt;key fmt&gt;,
    which follows log-format rules, to collect content of the new entry. It
    performs a lookup in the ACL before insertion, to avoid duplicated (or
    more) values. This lookup is done by a linear search and can be expensive
    with large lists! It is the equivalent of the &quot;<a href="#add%20acl">add acl</a>&quot; command from the
    stats socket, but can be triggered by an HTTP response.

  - &quot;del-acl&quot; is used to delete an entry from an ACL. The ACL must be loaded
    from a file (even a dummy empty file). The file name of the ACL to be
    updated is passed between parentheses. It takes one argument: &lt;key fmt&gt;,
    which follows log-format rules, to collect content of the entry to delete.
    It is the equivalent of the &quot;<a href="#del%20acl">del acl</a>&quot; command from the stats socket, but
    can be triggered by an HTTP response.

  - &quot;del-map&quot; is used to delete an entry from a MAP. The MAP must be loaded
    from a file (even a dummy empty file). The file name of the MAP to be
    updated is passed between parentheses. It takes one argument: &lt;key fmt&gt;,
    which follows log-format rules, to collect content of the entry to delete.
    It takes one argument: &quot;file name&quot; It is the equivalent of the &quot;<a href="#del%20map">del map</a>&quot;
    command from the stats socket, but can be triggered by an HTTP response.

  - &quot;set-map&quot; is used to add a new entry into a MAP. The MAP must be loaded
    from a file (even a dummy empty file). The file name of the MAP to be
    updated is passed between parentheses. It takes 2 arguments: &lt;key fmt&gt;,
    which follows log-format rules, used to collect MAP key, and &lt;value fmt&gt;,
    which follows log-format rules, used to collect content for the new entry.
    It performs a lookup in the MAP before insertion, to avoid duplicated (or
    more) values. This lookup is done by a linear search and can be expensive
    with large lists! It is the equivalent of the &quot;<a href="#set%20map">set map</a>&quot; command from the
    stats socket, but can be triggered by an HTTP response.

There is no limit to the number of http-response statements per instance.

It is important to know that http-response rules are processed very early in
the HTTP processing, before &quot;<a href="#reqdel">reqdel</a>&quot; or &quot;<a href="#reqrep">reqrep</a>&quot; rules. That way, headers
added by &quot;add-header&quot;/&quot;set-header&quot; are visible by almost all further ACL
rules.
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>acl key_acl res.hdr(X-Acl-Key) -m found

acl myhost hdr(Host) -f myhost.lst

http-response add-acl(myhost.lst) %[res.hdr(X-Acl-Key)] if key_acl
http-response del-acl(myhost.lst) %[res.hdr(X-Acl-Key)] if key_acl
</code></pre>
</div><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>acl value  res.hdr(X-Value) -m found

use_backend bk_appli if { hdr(Host),map_str(map.lst) -m found }

http-response set-map(map.lst) %[src] %[res.hdr(X-Value)] if value
http-response del-map(map.lst) %[src]                     if ! value
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#http-request">http-request</a>&quot;, <a href="#3.4">section 3.4</a> about userlists and <a href="#7">section 7</a> about ACL usage.</div>
<a class="anchor" name="http-send-name-header"></a><a class="anchor" name="4-http-send-name-header"></a><a class="anchor" name="4.2-http-send-name-header"></a><a class="anchor" name="http-send-name-header (Proxies)"></a><a class="anchor" name="http-send-name-header (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="http-send-name-header"></a><a href="#4.2-http-send-name-header">http-send-name-header</a></b> <span style="color: #008">[<span style="color: #080">&lt;header&gt;</span>]</span></div><pre class="text">Add the server name to a request. Use the header string given by &lt;header&gt;
</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;header&gt;  The header string to use to send the server name</pre>
</div>
<pre class="text">The &quot;<a href="#http-send-name-header">http-send-name-header</a>&quot; statement causes the name of the target
server to be added to the headers of an HTTP request.  The name
is added with the header string proved.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#server">server</a>&quot;</div>
<a class="anchor" name="id"></a><a class="anchor" name="4-id"></a><a class="anchor" name="4.2-id"></a><a class="anchor" name="id (Proxies)"></a><a class="anchor" name="id (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="id"></a><a href="#4.2-id">id</a></b> <span style="color: #080">&lt;value&gt;</span></div><pre class="text">Set a persistent ID to a proxy.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">Set a persistent ID for the proxy. This ID must be unique and positive.
An unused ID will automatically be assigned if unset. The first assigned
value will be 1. This ID is currently only returned in statistics.
</pre><a class="anchor" name="ignore-persist"></a><a class="anchor" name="4-ignore-persist"></a><a class="anchor" name="4.2-ignore-persist"></a><a class="anchor" name="ignore-persist (Proxies)"></a><a class="anchor" name="ignore-persist (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="ignore-persist"></a><a href="#4.2-ignore-persist">ignore-persist</a></b> <span style="color: #800">{ if | unless }</span> <span style="color: #080">&lt;condition&gt;</span></div><pre class="text">Declare a condition to ignore persistence
</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">By default, when cookie persistence is enabled, every requests containing
the cookie are unconditionally persistent (assuming the target server is up
and running).

The &quot;<a href="#ignore-persist">ignore-persist</a>&quot; statement allows one to declare various ACL-based
conditions which, when met, will cause a request to ignore persistence.
This is sometimes useful to load balance requests for static files, which
often don't require persistence. This can also be used to fully disable
persistence for a specific User-Agent (for example, some web crawler bots).

Combined with &quot;<a href="#appsession">appsession</a>&quot;, it can also help reduce HAProxy memory usage, as
the appsession table won't grow if persistence is ignored.

The persistence is ignored when an &quot;if&quot; condition is met, or unless an
&quot;unless&quot; condition is met.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#force-persist">force-persist</a>&quot;, &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">cookie<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#cookie%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#cookie%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li><li><a href="#cookie%20%28Fetching%20HTTP%20samples%20%28Layer%207%29%29">Fetching HTTP samples (Layer 7)</a></li></ul></span>&quot;, and <a href="#7">section 7</a> about ACL usage.</div>
<a class="anchor" name="log"></a><a class="anchor" name="4-log"></a><a class="anchor" name="4.2-log"></a><a class="anchor" name="log (Proxies)"></a><a class="anchor" name="log (Alphabetically sorted keywords reference)"></a><a class="anchor" name="log global"></a><a class="anchor" name="4-log global"></a><a class="anchor" name="4.2-log global"></a><a class="anchor" name="log global (Proxies)"></a><a class="anchor" name="log global (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="log global"></a><a href="#4.2-log%20global">log global</a></b></div><a class="anchor" name="log"></a><a class="anchor" name="4-log"></a><a class="anchor" name="4.2-log"></a><a class="anchor" name="log (Proxies)"></a><a class="anchor" name="log (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="log"></a><a href="#4.2-log">log</a></b> <span style="color: #080">&lt;address&gt;</span> <span style="color: #080">&lt;facility&gt;</span> <span style="color: #008">[<span style="color: #080">&lt;level&gt;</span> <span style="color: #008">[<span style="color: #080">&lt;minlevel&gt;</span>]</span>]</span></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no log"></a><a class="anchor" name="4-no log"></a><a class="anchor" name="4.2-no log"></a><a class="anchor" name="no log (Proxies)"></a><a class="anchor" name="no log (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no log"></a><a href="#4.2-no%20log">no log</a></b></div><pre class="text">Enable per-instance logging of events and traffic.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">Prefix :
  no         should be used when the logger list must be flushed. For example,
             if you don't want to inherit from the default logger list. This
             prefix does not allow arguments.
</pre><div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">global     should be used when the instance's logging parameters are the
           same as the global ones. This is the most common usage. &quot;global&quot;
           replaces &lt;address&gt;, &lt;facility&gt; and &lt;level&gt; with those of the log
           entries found in the &quot;global&quot; section. Only one &quot;<a href="#log%20global">log global</a>&quot;
           statement may be used per instance, and this form takes no other
           parameter.

&lt;address&gt;  indicates where to send the logs. It takes the same format as
           for the &quot;global&quot; section's logs, and can be one of :

           - An IPv4 address optionally followed by a colon (':') and a UDP
             port. If no port is specified, 514 is used by default (the
             standard syslog port).

           - An IPv6 address followed by a colon (':') and optionally a UDP
             port. If no port is specified, 514 is used by default (the
             standard syslog port).

           - A filesystem path to a UNIX domain socket, keeping in mind
             considerations for chroot (be sure the path is accessible
             inside the chroot) and uid/gid (be sure the path is
             appropriately writeable).

           Any part of the address string may reference any number of
           environment variables by preceding their name with a dollar
           sign ('$') and optionally enclosing them with braces ('{}'),
           similarly to what is done in Bourne shell.

&lt;facility&gt; must be one of the 24 standard syslog facilities :

             kern   user   mail   daemon auth   syslog lpr    news
             uucp   cron   auth2  ftp    ntp    audit  alert  cron2
             local0 local1 local2 local3 local4 local5 local6 local7

&lt;level&gt;    is optional and can be specified to filter outgoing messages. By
           default, all messages are sent. If a level is specified, only
           messages with a severity at least as important as this level
           will be sent. An optional minimum level can be specified. If it
           is set, logs emitted with a more severe level than this one will
           be capped to this level. This is used to avoid sending &quot;emerg&quot;
           messages on all terminals on some default syslog configurations.
           Eight levels are known :

             emerg  alert  crit   err    warning notice info  debug</pre>
</div>
<pre class="text">It is important to keep in mind that it is the frontend which decides what to
log from a connection, and that in case of content switching, the log entries
from the backend will be ignored. Connections are logged at level &quot;info&quot;.

However, backend log declaration define how and where servers status changes
will be logged. Level &quot;notice&quot; will be used to indicate a server going up,
&quot;warning&quot; will be used for termination signals and definitive service
termination, and &quot;alert&quot; will be used for when a server goes down.

Note : According to RFC3164, messages are truncated to 1024 bytes before
       being emitted.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>log global
log 127.0.0.1:514 local0 notice         <span class="comment"># only send important events</span>
log 127.0.0.1:514 local0 notice notice  <span class="comment"># same but limit output level</span>
log ${LOCAL_SYSLOG}:514 local0 notice   <span class="comment"># send to local server</span>
</code></pre>
</div><a class="anchor" name="log-format"></a><a class="anchor" name="4-log-format"></a><a class="anchor" name="4.2-log-format"></a><a class="anchor" name="log-format (Proxies)"></a><a class="anchor" name="log-format (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="log-format"></a><a href="#4.2-log-format">log-format</a></b> <span style="color: #080">&lt;string&gt;</span>
   Allows you to custom a log line.</div><div class="page-header"><b>See also :</b> Custom Log Format (8.2.4)</div>
<a class="anchor" name="max-keep-alive-queue"></a><a class="anchor" name="4-max-keep-alive-queue"></a><a class="anchor" name="4.2-max-keep-alive-queue"></a><a class="anchor" name="max-keep-alive-queue (Proxies)"></a><a class="anchor" name="max-keep-alive-queue (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="max-keep-alive-queue"></a><a href="#4.2-max-keep-alive-queue">max-keep-alive-queue</a></b> <span style="color: #080">&lt;value&gt;</span></div><pre class="text">Set the maximum server queue size for maintaining keep-alive connections
</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">HTTP keep-alive tries to reuse the same server connection whenever possible,
but sometimes it can be counter-productive, for example if a server has a lot
of connections while other ones are idle. This is especially true for static
servers.

The purpose of this setting is to set a threshold on the number of queued
connections at which haproxy stops trying to reuse the same server and prefers
to find another one. The default value, -1, means there is no limit. A value
of zero means that keep-alive requests will never be queued. For very close
servers which can be reached with a low latency and which are not sensible to
breaking keep-alive, a low value is recommended (eg: local static server can
use a value of 10 or less). For remote servers suffering from a high latency,
higher values might be needed to cover for the latency and/or the cost of
picking a different server.

Note that this has no impact on responses which are maintained to the same
server consecutively to a 401 response. They will still go to the same server
even if they have to be queued.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot;, &quot;<a href="#option%20prefer-last-server">option prefer-last-server</a>&quot;, server &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Performance%20tuning%29">Performance tuning</a></li><li><a href="#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#maxconn%20%28Bind%20options%29">Bind options</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; and cookie persistence.</div>
<a class="anchor" name="maxconn"></a><a class="anchor" name="4-maxconn"></a><a class="anchor" name="4.2-maxconn"></a><a class="anchor" name="maxconn (Proxies)"></a><a class="anchor" name="maxconn (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="maxconn"></a><a href="#4.2-maxconn">maxconn</a></b> <span style="color: #080">&lt;conns&gt;</span></div><pre class="text">Fix the maximum number of concurrent connections on a frontend
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;conns&gt;   is the maximum number of concurrent connections the frontend will
          accept to serve. Excess connections will be queued by the system
          in the socket's listen queue and will be served once a connection
          closes.</pre>
</div>
<pre class="text">If the system supports it, it can be useful on big sites to raise this limit
very high so that haproxy manages connection queues, instead of leaving the
clients with unanswered connection attempts. This value should not exceed the
global maxconn. Also, keep in mind that a connection contains two buffers
of 8kB each, as well as some other data resulting in about 17 kB of RAM being
consumed per established connection. That means that a medium system equipped
with 1GB of RAM can withstand around 40000-50000 concurrent connections if
properly tuned.

Also, when &lt;conns&gt; is set to large values, it is possible that the servers
are not sized to accept such loads, and for this reason it is generally wise
to assign them some reasonable connection limits.

By default, this value is set to 2000.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#server">server</a>&quot;, global section's &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Performance%20tuning%29">Performance tuning</a></li><li><a href="#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#maxconn%20%28Bind%20options%29">Bind options</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;, &quot;<a href="#fullconn">fullconn</a>&quot;</div>
<a class="anchor" name="mode"></a><a class="anchor" name="4-mode"></a><a class="anchor" name="4.2-mode"></a><a class="anchor" name="mode (Proxies)"></a><a class="anchor" name="mode (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="mode"></a><a href="#4.2-mode">mode</a></b> <span style="color: #800">{ tcp|http|health }</span></div><pre class="text">Set the running mode or protocol of the instance
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">tcp       The instance will work in pure TCP mode. A full-duplex connection
          will be established between clients and servers, and no layer 7
          examination will be performed. This is the default mode. It
          should be used for SSL, SSH, SMTP, ...

http      The instance will work in HTTP mode. The client request will be
          analyzed in depth before connecting to any server. Any request
          which is not RFC-compliant will be rejected. Layer 7 filtering,
          processing and switching will be possible. This is the mode which
          brings HAProxy most of its value.

health    The instance will work in &quot;health&quot; mode. It will just reply &quot;OK&quot;
          to incoming connections and close the connection. Alternatively,
          If the &quot;<a href="#option%20httpchk">httpchk</a>&quot; option is set, &quot;HTTP/1.0 200 OK&quot; will be sent
          instead. Nothing will be logged in either case. This mode is used
          to reply to external components health checks. This mode is
          deprecated and should not be used anymore as it is possible to do
          the same and even better by combining TCP or HTTP modes with the
          &quot;<a href="#monitor">monitor</a>&quot; keyword.</pre>
</div>
<pre class="text">When doing content switching, it is mandatory that the frontend and the
backend are in the same mode (generally HTTP), otherwise the configuration
will be refused.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>defaults http_instances
    mode http
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#monitor">monitor</a>&quot;, &quot;<a href="#monitor-net">monitor-net</a>&quot;</div>
<a class="anchor" name="monitor"></a><a class="anchor" name="4-monitor"></a><a class="anchor" name="4.2-monitor"></a><a class="anchor" name="monitor (Proxies)"></a><a class="anchor" name="monitor (Alphabetically sorted keywords reference)"></a><a class="anchor" name="monitor fail"></a><a class="anchor" name="4-monitor fail"></a><a class="anchor" name="4.2-monitor fail"></a><a class="anchor" name="monitor fail (Proxies)"></a><a class="anchor" name="monitor fail (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="monitor fail"></a><a href="#4.2-monitor%20fail">monitor fail</a></b> <span style="color: #800">{ if | unless }</span> <span style="color: #080">&lt;condition&gt;</span></div><pre class="text">Add a condition to report a failure to a monitor HTTP request.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">if &lt;cond&gt;     the monitor request will fail if the condition is satisfied,
              and will succeed otherwise. The condition should describe a
              combined test which must induce a failure if all conditions
              are met, for instance a low number of servers both in a
              backend and its backup.

unless &lt;cond&gt; the monitor request will succeed only if the condition is
              satisfied, and will fail otherwise. Such a condition may be
              based on a test on the presence of a minimum number of active
              servers in a list of backends.</pre>
</div>
<pre class="text">This statement adds a condition which can force the response to a monitor
request to report a failure. By default, when an external component queries
the URI dedicated to monitoring, a 200 response is returned. When one of the
conditions above is met, haproxy will return 503 instead of 200. This is
very useful to report a site failure to an external component which may base
routing advertisements between multiple sites on the availability reported by
haproxy. In this case, one would rely on an ACL involving the &quot;<a href="#nbsrv">nbsrv</a>&quot;
criterion. Note that &quot;<a href="#monitor%20fail">monitor fail</a>&quot; only works in HTTP mode. Both status
messages may be tweaked using &quot;<a href="#errorfile">errorfile</a>&quot; or &quot;<a href="#errorloc">errorloc</a>&quot; if needed.
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>frontend www
   mode http
   acl site_dead nbsrv(dynamic) lt 2
   acl site_dead nbsrv(static)  lt 2
   monitor-uri   /site_alive
   monitor fail  if site_dead
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#monitor-net">monitor-net</a>&quot;, &quot;<a href="#monitor-uri">monitor-uri</a>&quot;, &quot;<a href="#errorfile">errorfile</a>&quot;, &quot;<a href="#errorloc">errorloc</a>&quot;</div>
<a class="anchor" name="monitor-net"></a><a class="anchor" name="4-monitor-net"></a><a class="anchor" name="4.2-monitor-net"></a><a class="anchor" name="monitor-net (Proxies)"></a><a class="anchor" name="monitor-net (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="monitor-net"></a><a href="#4.2-monitor-net">monitor-net</a></b> <span style="color: #080">&lt;source&gt;</span></div><pre class="text">Declare a source network which is limited to monitor requests
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;source&gt;  is the source IPv4 address or network which will only be able to
          get monitor responses to any request. It can be either an IPv4
          address, a host name, or an address followed by a slash ('/')
          followed by a mask.</pre>
</div>
<pre class="text">In TCP mode, any connection coming from a source matching &lt;source&gt; will cause
the connection to be immediately closed without any log. This allows another
equipment to probe the port and verify that it is still listening, without
forwarding the connection to a remote server.

In HTTP mode, a connection coming from a source matching &lt;source&gt; will be
accepted, the following response will be sent without waiting for a request,
then the connection will be closed : &quot;HTTP/1.0 200 OK&quot;. This is normally
enough for any front-end HTTP probe to detect that the service is UP and
running without forwarding the request to a backend server. Note that this
response is sent in raw format, without any transformation. This is important
as it means that it will not be SSL-encrypted on SSL listeners.

Monitor requests are processed very early, just after tcp-request connection
ACLs which are the only ones able to block them. These connections are short
lived and never wait for any data from the client. They cannot be logged, and
it is the intended purpose. They are only used to report HAProxy's health to
an upper component, nothing more. Please note that &quot;<a href="#monitor%20fail">monitor fail</a>&quot; rules do
not apply to connections intercepted by &quot;<a href="#monitor-net">monitor-net</a>&quot;.

Last, please note that only one &quot;<a href="#monitor-net">monitor-net</a>&quot; statement can be specified in
a frontend. If more than one is found, only the last one will be considered.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># addresses .252 and .253 are just probing us.</span>
frontend www
    monitor-net 192.168.0.252/31
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#monitor%20fail">monitor fail</a>&quot;, &quot;<a href="#monitor-uri">monitor-uri</a>&quot;</div>
<a class="anchor" name="monitor-uri"></a><a class="anchor" name="4-monitor-uri"></a><a class="anchor" name="4.2-monitor-uri"></a><a class="anchor" name="monitor-uri (Proxies)"></a><a class="anchor" name="monitor-uri (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="monitor-uri"></a><a href="#4.2-monitor-uri">monitor-uri</a></b> <span style="color: #080">&lt;uri&gt;</span></div><pre class="text">Intercept a URI used by external components' monitor requests
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;uri&gt;     is the exact URI which we want to intercept to return HAProxy's
          health status instead of forwarding the request.</pre>
</div>
<pre class="text">When an HTTP request referencing &lt;uri&gt; will be received on a frontend,
HAProxy will not forward it nor log it, but instead will return either
&quot;HTTP/1.0 200 OK&quot; or &quot;HTTP/1.0 503 Service unavailable&quot;, depending on failure
conditions defined with &quot;<a href="#monitor%20fail">monitor fail</a>&quot;. This is normally enough for any
front-end HTTP probe to detect that the service is UP and running without
forwarding the request to a backend server. Note that the HTTP method, the
version and all headers are ignored, but the request must at least be valid
at the HTTP level. This keyword may only be used with an HTTP-mode frontend.

Monitor requests are processed very early. It is not possible to block nor
divert them using ACLs. They cannot be logged either, and it is the intended
purpose. They are only used to report HAProxy's health to an upper component,
nothing more. However, it is possible to add any number of conditions using
&quot;<a href="#monitor%20fail">monitor fail</a>&quot; and ACLs so that the result can be adjusted to whatever check
can be imagined (most often the number of available servers in a backend).
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># Use /haproxy_test to report haproxy's status</span>
frontend www
    mode http
    monitor-uri /haproxy_test
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#monitor%20fail">monitor fail</a>&quot;, &quot;<a href="#monitor-net">monitor-net</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option abortonclose"></a><a class="anchor" name="4-option abortonclose"></a><a class="anchor" name="4.2-option abortonclose"></a><a class="anchor" name="option abortonclose (Proxies)"></a><a class="anchor" name="option abortonclose (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option abortonclose"></a><a href="#4.2-option%20abortonclose">option abortonclose</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option abortonclose"></a><a class="anchor" name="4-no option abortonclose"></a><a class="anchor" name="4.2-no option abortonclose"></a><a class="anchor" name="no option abortonclose (Proxies)"></a><a class="anchor" name="no option abortonclose (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option abortonclose"></a><a href="#4.2-no%20option%20abortonclose">no option abortonclose</a></b></div><pre class="text">Enable or disable early dropping of aborted requests pending in queues.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">In presence of very high loads, the servers will take some time to respond.
The per-instance connection queue will inflate, and the response time will
increase respective to the size of the queue times the average per-session
response time. When clients will wait for more than a few seconds, they will
often hit the &quot;STOP&quot; button on their browser, leaving a useless request in
the queue, and slowing down other users, and the servers as well, because the
request will eventually be served, then aborted at the first error
encountered while delivering the response.

As there is no way to distinguish between a full STOP and a simple output
close on the client side, HTTP agents should be conservative and consider
that the client might only have closed its output channel while waiting for
the response. However, this introduces risks of congestion when lots of users
do the same, and is completely useless nowadays because probably no client at
all will close the session while waiting for the response. Some HTTP agents
support this behaviour (Squid, Apache, HAProxy), and others do not (TUX, most
hardware-based load balancers). So the probability for a closed input channel
to represent a user hitting the &quot;STOP&quot; button is close to 100%, and the risk
of being the single component to break rare but valid traffic is extremely
low, which adds to the temptation to be able to abort a session early while
still not served and not pollute the servers.

In HAProxy, the user can choose the desired behaviour using the option
&quot;<a href="#option%20abortonclose">abortonclose</a>&quot;. By default (without the option) the behaviour is HTTP
compliant and aborted requests will be served. But when the option is
specified, a session with an incoming channel closed will be aborted while
it is still possible, either pending in the queue for a connection slot, or
during the connection establishment if the server has not yet acknowledged
the connection request. This considerably reduces the queue size and the load
on saturated servers when users are tempted to click on STOP, which in turn
reduces the response time for other users.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#timeout%20queue">timeout queue</a>&quot; and server's &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Performance%20tuning%29">Performance tuning</a></li><li><a href="#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#maxconn%20%28Bind%20options%29">Bind options</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; and &quot;<a href="#maxqueue">maxqueue</a>&quot; parameters</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option accept-invalid-http-request"></a><a class="anchor" name="4-option accept-invalid-http-request"></a><a class="anchor" name="4.2-option accept-invalid-http-request"></a><a class="anchor" name="option accept-invalid-http-request (Proxies)"></a><a class="anchor" name="option accept-invalid-http-request (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option accept-invalid-http-request"></a><a href="#4.2-option%20accept-invalid-http-request">option accept-invalid-http-request</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option accept-invalid-http-request"></a><a class="anchor" name="4-no option accept-invalid-http-request"></a><a class="anchor" name="4.2-no option accept-invalid-http-request"></a><a class="anchor" name="no option accept-invalid-http-request (Proxies)"></a><a class="anchor" name="no option accept-invalid-http-request (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option accept-invalid-http-request"></a><a href="#4.2-no%20option%20accept-invalid-http-request">no option accept-invalid-http-request</a></b></div><pre class="text">Enable or disable relaxing of HTTP request parsing
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default, HAProxy complies with RFC2616 in terms of message parsing. This
means that invalid characters in header names are not permitted and cause an
error to be returned to the client. This is the desired behaviour as such
forbidden characters are essentially used to build attacks exploiting server
weaknesses, and bypass security filtering. Sometimes, a buggy browser or
server will emit invalid header names for whatever reason (configuration,
implementation) and the issue will not be immediately fixed. In such a case,
it is possible to relax HAProxy's header name parser to accept any character
even if that does not make sense, by specifying this option. Similarly, the
list of characters allowed to appear in a URI is well defined by RFC3986, and
chars 0-31, 32 (space), 34 ('&quot;'), 60 ('&lt;'), 62 ('&gt;'), 92 ('\'), 94 ('^'), 96
('`'), 123 ('{'), 124 ('|'), 125 ('}'), 127 (delete) and anything above are
not allowed at all. Haproxy always blocks a number of them (0..32, 127). The
remaining ones are blocked by default unless this option is enabled.

This option should never be enabled by default as it hides application bugs
and open security breaches. It should only be deployed after a problem has
been confirmed.

When this option is enabled, erroneous header names will still be accepted in
requests, but the complete request will be captured in order to permit later
analysis using the &quot;<a href="#show%20errors">show errors</a>&quot; request on the UNIX stats socket. Similarly,
requests containing invalid chars in the URI part will be logged. Doing this
also helps confirming that the issue has been solved.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20accept-invalid-http-response">option accept-invalid-http-response</a>&quot; and &quot;<a href="#show%20errors">show errors</a>&quot; on the stats socket.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option accept-invalid-http-response"></a><a class="anchor" name="4-option accept-invalid-http-response"></a><a class="anchor" name="4.2-option accept-invalid-http-response"></a><a class="anchor" name="option accept-invalid-http-response (Proxies)"></a><a class="anchor" name="option accept-invalid-http-response (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option accept-invalid-http-response"></a><a href="#4.2-option%20accept-invalid-http-response">option accept-invalid-http-response</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option accept-invalid-http-response"></a><a class="anchor" name="4-no option accept-invalid-http-response"></a><a class="anchor" name="4.2-no option accept-invalid-http-response"></a><a class="anchor" name="no option accept-invalid-http-response (Proxies)"></a><a class="anchor" name="no option accept-invalid-http-response (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option accept-invalid-http-response"></a><a href="#4.2-no%20option%20accept-invalid-http-response">no option accept-invalid-http-response</a></b></div><pre class="text">Enable or disable relaxing of HTTP response parsing
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default, HAProxy complies with RFC2616 in terms of message parsing. This
means that invalid characters in header names are not permitted and cause an
error to be returned to the client. This is the desired behaviour as such
forbidden characters are essentially used to build attacks exploiting server
weaknesses, and bypass security filtering. Sometimes, a buggy browser or
server will emit invalid header names for whatever reason (configuration,
implementation) and the issue will not be immediately fixed. In such a case,
it is possible to relax HAProxy's header name parser to accept any character
even if that does not make sense, by specifying this option.

This option should never be enabled by default as it hides application bugs
and open security breaches. It should only be deployed after a problem has
been confirmed.

When this option is enabled, erroneous header names will still be accepted in
responses, but the complete response will be captured in order to permit
later analysis using the &quot;<a href="#show%20errors">show errors</a>&quot; request on the UNIX stats socket.
Doing this also helps confirming that the issue has been solved.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20accept-invalid-http-request">option accept-invalid-http-request</a>&quot; and &quot;<a href="#show%20errors">show errors</a>&quot; on the stats socket.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option allbackups"></a><a class="anchor" name="4-option allbackups"></a><a class="anchor" name="4.2-option allbackups"></a><a class="anchor" name="option allbackups (Proxies)"></a><a class="anchor" name="option allbackups (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option allbackups"></a><a href="#4.2-option%20allbackups">option allbackups</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option allbackups"></a><a class="anchor" name="4-no option allbackups"></a><a class="anchor" name="4.2-no option allbackups"></a><a class="anchor" name="no option allbackups (Proxies)"></a><a class="anchor" name="no option allbackups (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option allbackups"></a><a href="#4.2-no%20option%20allbackups">no option allbackups</a></b></div><pre class="text">Use either all backup servers at a time or only the first one
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default, the first operational backup server gets all traffic when normal
servers are all down. Sometimes, it may be preferred to use multiple backups
at once, because one will not be enough. When &quot;<a href="#option%20allbackups">option allbackups</a>&quot; is enabled,
the load balancing will be performed among all backup servers when all normal
ones are unavailable. The same load balancing algorithm will be used and the
servers' weights will be respected. Thus, there will not be any priority
order between the backup servers anymore.

This option is mostly used with static server farms dedicated to return a
&quot;sorry&quot; page when an application is completely offline.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.
</pre><a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option checkcache"></a><a class="anchor" name="4-option checkcache"></a><a class="anchor" name="4.2-option checkcache"></a><a class="anchor" name="option checkcache (Proxies)"></a><a class="anchor" name="option checkcache (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option checkcache"></a><a href="#4.2-option%20checkcache">option checkcache</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option checkcache"></a><a class="anchor" name="4-no option checkcache"></a><a class="anchor" name="4.2-no option checkcache"></a><a class="anchor" name="no option checkcache (Proxies)"></a><a class="anchor" name="no option checkcache (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option checkcache"></a><a href="#4.2-no%20option%20checkcache">no option checkcache</a></b></div><pre class="text">Analyze all server responses and block responses with cacheable cookies
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">Some high-level frameworks set application cookies everywhere and do not
always let enough control to the developer to manage how the responses should
be cached. When a session cookie is returned on a cacheable object, there is a
high risk of session crossing or stealing between users traversing the same
caches. In some situations, it is better to block the response than to let
some sensitive session information go in the wild.

The option &quot;<a href="#option%20checkcache">checkcache</a>&quot; enables deep inspection of all server responses for
strict compliance with HTTP specification in terms of cacheability. It
carefully checks &quot;Cache-control&quot;, &quot;Pragma&quot; and &quot;Set-cookie&quot; headers in server
response to check if there's a risk of caching a cookie on a client-side
proxy. When this option is enabled, the only responses which can be delivered
to the client are :
  - all those without &quot;Set-Cookie&quot; header ;
  - all those with a return code other than 200, 203, 206, 300, 301, 410,
    provided that the server has not set a &quot;Cache-control: public&quot; header ;
  - all those that come from a POST request, provided that the server has not
    set a 'Cache-Control: public' header ;
  - those with a 'Pragma: no-cache' header
  - those with a 'Cache-control: private' header
  - those with a 'Cache-control: no-store' header
  - those with a 'Cache-control: max-age=0' header
  - those with a 'Cache-control: s-maxage=0' header
  - those with a 'Cache-control: no-cache' header
  - those with a 'Cache-control: no-cache=&quot;<a href="#set-cookie">set-cookie</a>&quot;' header
  - those with a 'Cache-control: no-cache=&quot;set-cookie,' header
    (allowing other fields after set-cookie)

If a response doesn't respect these requirements, then it will be blocked
just as if it was from an &quot;<a href="#rspdeny">rspdeny</a>&quot; filter, with an &quot;HTTP 502 bad gateway&quot;.
The session state shows &quot;PH--&quot; meaning that the proxy blocked the response
during headers processing. Additionally, an alert will be sent in the logs so
that admins are informed that there's something to be fixed.

Due to the high impact on the application, the application should be tested
in depth with the option enabled before going to production. It is also a
good practice to always activate it during tests, even if it is not used in
production, as it will report potentially dangerous application behaviours.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.
</pre><a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option clitcpka"></a><a class="anchor" name="4-option clitcpka"></a><a class="anchor" name="4.2-option clitcpka"></a><a class="anchor" name="option clitcpka (Proxies)"></a><a class="anchor" name="option clitcpka (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option clitcpka"></a><a href="#4.2-option%20clitcpka">option clitcpka</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option clitcpka"></a><a class="anchor" name="4-no option clitcpka"></a><a class="anchor" name="4.2-no option clitcpka"></a><a class="anchor" name="no option clitcpka (Proxies)"></a><a class="anchor" name="no option clitcpka (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option clitcpka"></a><a href="#4.2-no%20option%20clitcpka">no option clitcpka</a></b></div><pre class="text">Enable or disable the sending of TCP keepalive packets on the client side
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When there is a firewall or any session-aware component between a client and
a server, and when the protocol involves very long sessions with long idle
periods (eg: remote desktops), there is a risk that one of the intermediate
components decides to expire a session which has remained idle for too long.

Enabling socket-level TCP keep-alives makes the system regularly send packets
to the other end of the connection, leaving it active. The delay between
keep-alive probes is controlled by the system only and depends both on the
operating system and its tuning parameters.

It is important to understand that keep-alive packets are neither emitted nor
received at the application level. It is only the network stacks which sees
them. For this reason, even if one side of the proxy already uses keep-alives
to maintain its connection alive, those keep-alive packets will not be
forwarded to the other side of the proxy.

Please note that this has nothing to do with HTTP keep-alive.

Using option &quot;<a href="#option%20clitcpka">clitcpka</a>&quot; enables the emission of TCP keep-alive probes on the
client side of a connection, which should help when session expirations are
noticed between HAProxy and a client.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20srvtcpka">option srvtcpka</a>&quot;, &quot;<a href="#option%20tcpka">option tcpka</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option contstats"></a><a class="anchor" name="4-option contstats"></a><a class="anchor" name="4.2-option contstats"></a><a class="anchor" name="option contstats (Proxies)"></a><a class="anchor" name="option contstats (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option contstats"></a><a href="#4.2-option%20contstats">option contstats</a></b></div><pre class="text">Enable continuous traffic statistics updates
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default, counters used for statistics calculation are incremented
only when a session finishes. It works quite well when serving small
objects, but with big ones (for example large images or archives) or
with A/V streaming, a graph generated from haproxy counters looks like
a hedgehog. With this option enabled counters get incremented continuously,
during a whole session. Recounting touches a hotpath directly so
it is not enabled by default, as it has small performance impact (~0.5%).
</pre><a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option dontlog-normal"></a><a class="anchor" name="4-option dontlog-normal"></a><a class="anchor" name="4.2-option dontlog-normal"></a><a class="anchor" name="option dontlog-normal (Proxies)"></a><a class="anchor" name="option dontlog-normal (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option dontlog-normal"></a><a href="#4.2-option%20dontlog-normal">option dontlog-normal</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option dontlog-normal"></a><a class="anchor" name="4-no option dontlog-normal"></a><a class="anchor" name="4.2-no option dontlog-normal"></a><a class="anchor" name="no option dontlog-normal (Proxies)"></a><a class="anchor" name="no option dontlog-normal (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option dontlog-normal"></a><a href="#4.2-no%20option%20dontlog-normal">no option dontlog-normal</a></b></div><pre class="text">Enable or disable logging of normal, successful connections
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">There are large sites dealing with several thousand connections per second
and for which logging is a major pain. Some of them are even forced to turn
logs off and cannot debug production issues. Setting this option ensures that
normal connections, those which experience no error, no timeout, no retry nor
redispatch, will not be logged. This leaves disk space for anomalies. In HTTP
mode, the response status code is checked and return codes 5xx will still be
logged.

It is strongly discouraged to use this option as most of the time, the key to
complex issues is in the normal logs which will not be logged here. If you
need to separate logs, see the &quot;<a href="#option%20log-separate-errors">log-separate-errors</a>&quot; option instead.
</pre><div class="page-header"><b>See also :</b> &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">log<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#log%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#log%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li></ul></span>&quot;, &quot;<a href="#option%20dontlognull">dontlognull</a>&quot;, &quot;<a href="#option%20log-separate-errors">log-separate-errors</a>&quot; and <a href="#8">section 8</a> about logging.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option dontlognull"></a><a class="anchor" name="4-option dontlognull"></a><a class="anchor" name="4.2-option dontlognull"></a><a class="anchor" name="option dontlognull (Proxies)"></a><a class="anchor" name="option dontlognull (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option dontlognull"></a><a href="#4.2-option%20dontlognull">option dontlognull</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option dontlognull"></a><a class="anchor" name="4-no option dontlognull"></a><a class="anchor" name="4.2-no option dontlognull"></a><a class="anchor" name="no option dontlognull (Proxies)"></a><a class="anchor" name="no option dontlognull (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option dontlognull"></a><a href="#4.2-no%20option%20dontlognull">no option dontlognull</a></b></div><pre class="text">Enable or disable logging of null connections
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">In certain environments, there are components which will regularly connect to
various systems to ensure that they are still alive. It can be the case from
another load balancer as well as from monitoring systems. By default, even a
simple port probe or scan will produce a log. If those connections pollute
the logs too much, it is possible to enable option &quot;<a href="#option%20dontlognull">dontlognull</a>&quot; to indicate
that a connection on which no data has been transferred will not be logged,
which typically corresponds to those probes.

It is generally recommended not to use this option in uncontrolled
environments (eg: internet), otherwise scans and other malicious activities
would not be logged.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.
</pre><div class="page-header"><b>See also :</b> &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">log<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#log%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#log%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li></ul></span>&quot;, &quot;<a href="#monitor-net">monitor-net</a>&quot;, &quot;<a href="#monitor-uri">monitor-uri</a>&quot; and <a href="#8">section 8</a> about logging.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option forceclose"></a><a class="anchor" name="4-option forceclose"></a><a class="anchor" name="4.2-option forceclose"></a><a class="anchor" name="option forceclose (Proxies)"></a><a class="anchor" name="option forceclose (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option forceclose"></a><a href="#4.2-option%20forceclose">option forceclose</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option forceclose"></a><a class="anchor" name="4-no option forceclose"></a><a class="anchor" name="4.2-no option forceclose"></a><a class="anchor" name="no option forceclose (Proxies)"></a><a class="anchor" name="no option forceclose (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option forceclose"></a><a href="#4.2-no%20option%20forceclose">no option forceclose</a></b></div><pre class="text">Enable or disable active connection closing after response is transferred.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">Some HTTP servers do not necessarily close the connections when they receive
the &quot;Connection: close&quot; set by &quot;<a href="#option%20httpclose">option httpclose</a>&quot;, and if the client does not
close either, then the connection remains open till the timeout expires. This
causes high number of simultaneous connections on the servers and shows high
global session times in the logs.

When this happens, it is possible to use &quot;<a href="#option%20forceclose">option forceclose</a>&quot;. It will
actively close the outgoing server channel as soon as the server has finished
to respond and release some resources earlier than with &quot;<a href="#option%20httpclose">option httpclose</a>&quot;.

This option may also be combined with &quot;<a href="#option%20http-pretend-keepalive">option http-pretend-keepalive</a>&quot;, which
will disable sending of the &quot;Connection: close&quot; header, but will still cause
the connection to be closed once the whole response is received.

This option disables and replaces any previous &quot;<a href="#option%20httpclose">option httpclose</a>&quot;, &quot;option
http-server-close&quot;, &quot;<a href="#option%20http-keep-alive">option http-keep-alive</a>&quot;, or &quot;<a href="#option%20http-tunnel">option http-tunnel</a>&quot;.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httpclose">option httpclose</a>&quot; and &quot;<a href="#option%20http-pretend-keepalive">option http-pretend-keepalive</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option forwardfor"></a><a class="anchor" name="4-option forwardfor"></a><a class="anchor" name="4.2-option forwardfor"></a><a class="anchor" name="option forwardfor (Proxies)"></a><a class="anchor" name="option forwardfor (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option forwardfor"></a><a href="#4.2-option%20forwardfor">option forwardfor</a></b> <span style="color: #008">[ except <span style="color: #080">&lt;network&gt;</span> ]</span> <span style="color: #008">[ header <span style="color: #080">&lt;name&gt;</span> ]</span> <span style="color: #008">[ if-none ]</span></div><pre class="text">Enable insertion of the X-Forwarded-For header to requests sent to servers
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;network&gt; is an optional argument used to disable this option for sources
          matching &lt;network&gt;
&lt;name&gt;    an optional argument to specify a different &quot;X-Forwarded-For&quot;
          header name.</pre>
</div>
<pre class="text">Since HAProxy works in reverse-proxy mode, the servers see its IP address as
their client address. This is sometimes annoying when the client's IP address
is expected in server logs. To solve this problem, the well-known HTTP header
&quot;X-Forwarded-For&quot; may be added by HAProxy to all requests sent to the server.
This header contains a value representing the client's IP address. Since this
header is always appended at the end of the existing header list, the server
must be configured to always use the last occurrence of this header only. See
the server's manual to find how to enable use of this standard header. Note
that only the last occurrence of the header must be used, since it is really
possible that the client has already brought one.

The keyword &quot;header&quot; may be used to supply a different header name to replace
the default &quot;X-Forwarded-For&quot;. This can be useful where you might already
have a &quot;X-Forwarded-For&quot; header from a different application (eg: stunnel),
and you need preserve it. Also if your backend server doesn't use the
&quot;X-Forwarded-For&quot; header and requires different one (eg: Zeus Web Servers
require &quot;X-Cluster-Client-IP&quot;).

Sometimes, a same HAProxy instance may be shared between a direct client
access and a reverse-proxy access (for instance when an SSL reverse-proxy is
used to decrypt HTTPS traffic). It is possible to disable the addition of the
header for a known source address or network by adding the &quot;except&quot; keyword
followed by the network address. In this case, any source IP matching the
network will not cause an addition of this header. Most common uses are with
private networks or 127.0.0.1.

Alternatively, the keyword &quot;if-none&quot; states that the header will only be
added if it is not present. This should only be used in perfectly trusted
environment, as this might cause a security issue if headers reaching haproxy
are under the control of the end-user.

This option may be specified either in the frontend or in the backend. If at
least one of them uses it, the header will be added. Note that the backend's
setting of the header subargument takes precedence over the frontend's if
both are defined. In the case of the &quot;if-none&quot; argument, if at least one of
the frontend or the backend does not specify it, it wants the addition to be
mandatory, so it wins.
</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code><span class="comment"># Public HTTP address also used by stunnel on the same machine</span>
frontend www
    mode http
    option forwardfor except 127.0.0.1  <span class="comment"># stunnel already adds the header</span>

<span class="comment"># Those servers want the IP Address in X-Client</span>
backend www
    mode http
    option forwardfor header X-Client
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httpclose">option httpclose</a>&quot;, &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot;, &quot;<a href="#option%20forceclose">option forceclose</a>&quot;, &quot;<a href="#option%20http-keep-alive">option http-keep-alive</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option http-keep-alive"></a><a class="anchor" name="4-option http-keep-alive"></a><a class="anchor" name="4.2-option http-keep-alive"></a><a class="anchor" name="option http-keep-alive (Proxies)"></a><a class="anchor" name="option http-keep-alive (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option http-keep-alive"></a><a href="#4.2-option%20http-keep-alive">option http-keep-alive</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option http-keep-alive"></a><a class="anchor" name="4-no option http-keep-alive"></a><a class="anchor" name="4.2-no option http-keep-alive"></a><a class="anchor" name="no option http-keep-alive (Proxies)"></a><a class="anchor" name="no option http-keep-alive (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option http-keep-alive"></a><a href="#4.2-no%20option%20http-keep-alive">no option http-keep-alive</a></b></div><pre class="text">Enable or disable HTTP keep-alive from client to server
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default HAProxy operates in keep-alive mode with regards to persistent
connections: for each connection it processes each request and response, and
leaves the connection idle on both sides between the end of a response and the
start of a new request. This mode may be changed by several options such as
&quot;<a href="#option%20http-server-close">option http-server-close</a>&quot;, &quot;<a href="#option%20forceclose">option forceclose</a>&quot;, &quot;<a href="#option%20httpclose">option httpclose</a>&quot; or
&quot;<a href="#option%20http-tunnel">option http-tunnel</a>&quot;. This option allows to set back the keep-alive mode,
which can be useful when another mode was used in a defaults section.

Setting &quot;<a href="#option%20http-keep-alive">option http-keep-alive</a>&quot; enables HTTP keep-alive mode on the client-
and server- sides. This provides the lowest latency on the client side (slow
network) and the fastest session reuse on the server side at the expense
of maintaining idle connections to the servers. In general, it is possible
with this option to achieve approximately twice the request rate that the
&quot;<a href="#option%20http-server-close">http-server-close</a>&quot; option achieves on small objects. There are mainly two
situations where this option may be useful :

  - when the server is non-HTTP compliant and authenticates the connection
    instead of requests (eg: NTLM authentication)

  - when the cost of establishing the connection to the server is significant
    compared to the cost of retrieving the associated object from the server.

This last case can happen when the server is a fast static server of cache.
In this case, the server will need to be properly tuned to support high enough
connection counts because connections will last until the client sends another
request.

If the client request has to go to another backend or another server due to
content switching or the load balancing algorithm, the idle connection will
immediately be closed and a new one re-opened. Option &quot;<a href="#option%20prefer-last-server">prefer-last-server</a>&quot; is
available to try optimize server selection so that if the server currently
attached to an idle connection is usable, it will be used.

In general it is preferred to use &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot; with application
servers, and some static servers might benefit from &quot;<a href="#option%20http-keep-alive">option http-keep-alive</a>&quot;.

At the moment, logs will not indicate whether requests came from the same
session or not. The accept date reported in the logs corresponds to the end
of the previous request, and the request time corresponds to the time spent
waiting for a new request. The keep-alive request time is still bound to the
timeout defined by &quot;<a href="#timeout%20http-keep-alive">timeout http-keep-alive</a>&quot; or &quot;<a href="#timeout%20http-request">timeout http-request</a>&quot; if
not set.

This option disables and replaces any previous &quot;<a href="#option%20httpclose">option httpclose</a>&quot;, &quot;option
http-server-close&quot;, &quot;<a href="#option%20forceclose">option forceclose</a>&quot; or &quot;<a href="#option%20http-tunnel">option http-tunnel</a>&quot;. When backend
and frontend options differ, all of these 4 options have precedence over
&quot;<a href="#option%20http-keep-alive">option http-keep-alive</a>&quot;.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20forceclose">option forceclose</a>&quot;, &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot;, &quot;<a href="#option%20prefer-last-server">option prefer-last-server</a>&quot;, &quot;<a href="#option%20http-pretend-keepalive">option http-pretend-keepalive</a>&quot;, &quot;<a href="#option%20httpclose">option httpclose</a>&quot;, and &quot;1.1. The HTTP transaction model&quot;.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option http-no-delay"></a><a class="anchor" name="4-option http-no-delay"></a><a class="anchor" name="4.2-option http-no-delay"></a><a class="anchor" name="option http-no-delay (Proxies)"></a><a class="anchor" name="option http-no-delay (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option http-no-delay"></a><a href="#4.2-option%20http-no-delay">option http-no-delay</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option http-no-delay"></a><a class="anchor" name="4-no option http-no-delay"></a><a class="anchor" name="4.2-no option http-no-delay"></a><a class="anchor" name="no option http-no-delay (Proxies)"></a><a class="anchor" name="no option http-no-delay (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option http-no-delay"></a><a href="#4.2-no%20option%20http-no-delay">no option http-no-delay</a></b></div><pre class="text">Instruct the system to favor low interactive delays over performance in HTTP
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">In HTTP, each payload is unidirectional and has no notion of interactivity.
Any agent is expected to queue data somewhat for a reasonably low delay.
There are some very rare server-to-server applications that abuse the HTTP
protocol and expect the payload phase to be highly interactive, with many
interleaved data chunks in both directions within a single request. This is
absolutely not supported by the HTTP specification and will not work across
most proxies or servers. When such applications attempt to do this through
haproxy, it works but they will experience high delays due to the network
optimizations which favor performance by instructing the system to wait for
enough data to be available in order to only send full packets. Typical
delays are around 200 ms per round trip. Note that this only happens with
abnormal uses. Normal uses such as CONNECT requests nor WebSockets are not
affected.

When &quot;<a href="#option%20http-no-delay">option http-no-delay</a>&quot; is present in either the frontend or the backend
used by a connection, all such optimizations will be disabled in order to
make the exchanges as fast as possible. Of course this offers no guarantee on
the functionality, as it may break at any other place. But if it works via
HAProxy, it will work as fast as possible. This option should never be used
by default, and should never be used at all unless such a buggy application
is discovered. The impact of using this option is an increase of bandwidth
usage and CPU usage, which may significantly lower performance in high
latency environments.
</pre><a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option http-pretend-keepalive"></a><a class="anchor" name="4-option http-pretend-keepalive"></a><a class="anchor" name="4.2-option http-pretend-keepalive"></a><a class="anchor" name="option http-pretend-keepalive (Proxies)"></a><a class="anchor" name="option http-pretend-keepalive (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option http-pretend-keepalive"></a><a href="#4.2-option%20http-pretend-keepalive">option http-pretend-keepalive</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option http-pretend-keepalive"></a><a class="anchor" name="4-no option http-pretend-keepalive"></a><a class="anchor" name="4.2-no option http-pretend-keepalive"></a><a class="anchor" name="no option http-pretend-keepalive (Proxies)"></a><a class="anchor" name="no option http-pretend-keepalive (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option http-pretend-keepalive"></a><a href="#4.2-no%20option%20http-pretend-keepalive">no option http-pretend-keepalive</a></b></div><pre class="text">Define whether haproxy will announce keepalive to the server or not
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When running with &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot; or &quot;<a href="#option%20forceclose">option forceclose</a>&quot;, haproxy
adds a &quot;Connection: close&quot; header to the request forwarded to the server.
Unfortunately, when some servers see this header, they automatically refrain
from using the chunked encoding for responses of unknown length, while this
is totally unrelated. The immediate effect is that this prevents haproxy from
maintaining the client connection alive. A second effect is that a client or
a cache could receive an incomplete response without being aware of it, and
consider the response complete.

By setting &quot;<a href="#option%20http-pretend-keepalive">option http-pretend-keepalive</a>&quot;, haproxy will make the server
believe it will keep the connection alive. The server will then not fall back
to the abnormal undesired above. When haproxy gets the whole response, it
will close the connection with the server just as it would do with the
&quot;<a href="#option%20forceclose">forceclose</a>&quot; option. That way the client gets a normal response and the
connection is correctly closed on the server side.

It is recommended not to enable this option by default, because most servers
will more efficiently close the connection themselves after the last packet,
and release its buffers slightly earlier. Also, the added packet on the
network could slightly reduce the overall peak performance. However it is
worth noting that when this option is enabled, haproxy will have slightly
less work to do. So if haproxy is the bottleneck on the whole architecture,
enabling this option might save a few CPU cycles.

This option may be set both in a frontend and in a backend. It is enabled if
at least one of the frontend or backend holding a connection has it enabled.
This option may be combined with &quot;<a href="#option%20httpclose">option httpclose</a>&quot;, which will cause
keepalive to be announced to the server and close to be announced to the
client. This practice is discouraged though.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20forceclose">option forceclose</a>&quot;, &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot;, and &quot;<a href="#option%20http-keep-alive">option http-keep-alive</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option http-server-close"></a><a class="anchor" name="4-option http-server-close"></a><a class="anchor" name="4.2-option http-server-close"></a><a class="anchor" name="option http-server-close (Proxies)"></a><a class="anchor" name="option http-server-close (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option http-server-close"></a><a href="#4.2-option%20http-server-close">option http-server-close</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option http-server-close"></a><a class="anchor" name="4-no option http-server-close"></a><a class="anchor" name="4.2-no option http-server-close"></a><a class="anchor" name="no option http-server-close (Proxies)"></a><a class="anchor" name="no option http-server-close (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option http-server-close"></a><a href="#4.2-no%20option%20http-server-close">no option http-server-close</a></b></div><pre class="text">Enable or disable HTTP connection closing on the server side
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default HAProxy operates in keep-alive mode with regards to persistent
connections: for each connection it processes each request and response, and
leaves the connection idle on both sides between the end of a response and
the start of a new request. This mode may be changed by several options such
as &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot;, &quot;<a href="#option%20forceclose">option forceclose</a>&quot;, &quot;<a href="#option%20httpclose">option httpclose</a>&quot; or
&quot;<a href="#option%20http-tunnel">option http-tunnel</a>&quot;. Setting &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot; enables HTTP
connection-close mode on the server side while keeping the ability to support
HTTP keep-alive and pipelining on the client side.  This provides the lowest
latency on the client side (slow network) and the fastest session reuse on
the server side to save server resources, similarly to &quot;<a href="#option%20forceclose">option forceclose</a>&quot;.
It also permits non-keepalive capable servers to be served in keep-alive mode
to the clients if they conform to the requirements of RFC2616. Please note
that some servers do not always conform to those requirements when they see
&quot;Connection: close&quot; in the request. The effect will be that keep-alive will
never be used. A workaround consists in enabling &quot;option
http-pretend-keepalive&quot;.

At the moment, logs will not indicate whether requests came from the same
session or not. The accept date reported in the logs corresponds to the end
of the previous request, and the request time corresponds to the time spent
waiting for a new request. The keep-alive request time is still bound to the
timeout defined by &quot;<a href="#timeout%20http-keep-alive">timeout http-keep-alive</a>&quot; or &quot;<a href="#timeout%20http-request">timeout http-request</a>&quot; if
not set.

This option may be set both in a frontend and in a backend. It is enabled if
at least one of the frontend or backend holding a connection has it enabled.
It disables and replaces any previous &quot;<a href="#option%20httpclose">option httpclose</a>&quot;, &quot;<a href="#option%20forceclose">option forceclose</a>&quot;,
&quot;<a href="#option%20http-tunnel">option http-tunnel</a>&quot; or &quot;<a href="#option%20http-keep-alive">option http-keep-alive</a>&quot;. Please check <a href="#4">section 4</a>
(&quot;Proxies&quot;) to see how this option combines with others when frontend and
backend options differ.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20forceclose">option forceclose</a>&quot;, &quot;<a href="#option%20http-pretend-keepalive">option http-pretend-keepalive</a>&quot;, &quot;<a href="#option%20httpclose">option httpclose</a>&quot;, &quot;<a href="#option%20http-keep-alive">option http-keep-alive</a>&quot;, and &quot;1.1. The HTTP transaction model&quot;.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option http-tunnel"></a><a class="anchor" name="4-option http-tunnel"></a><a class="anchor" name="4.2-option http-tunnel"></a><a class="anchor" name="option http-tunnel (Proxies)"></a><a class="anchor" name="option http-tunnel (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option http-tunnel"></a><a href="#4.2-option%20http-tunnel">option http-tunnel</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option http-tunnel"></a><a class="anchor" name="4-no option http-tunnel"></a><a class="anchor" name="4.2-no option http-tunnel"></a><a class="anchor" name="no option http-tunnel (Proxies)"></a><a class="anchor" name="no option http-tunnel (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option http-tunnel"></a><a href="#4.2-no%20option%20http-tunnel">no option http-tunnel</a></b></div><pre class="text">Disable or enable HTTP connection processing after first transaction
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default HAProxy operates in keep-alive mode with regards to persistent
connections: for each connection it processes each request and response, and
leaves the connection idle on both sides between the end of a response and
the start of a new request. This mode may be changed by several options such
as &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot;, &quot;<a href="#option%20forceclose">option forceclose</a>&quot;, &quot;<a href="#option%20httpclose">option httpclose</a>&quot; or
&quot;<a href="#option%20http-tunnel">option http-tunnel</a>&quot;.

Option &quot;<a href="#option%20http-tunnel">http-tunnel</a>&quot; disables any HTTP processing past the first request and
the first response. This is the mode which was used by default in versions
1.0 to 1.5-dev21. It is the mode with the lowest processing overhead, which
is normally not needed anymore unless in very specific cases such as when
using an in-house protocol that looks like HTTP but is not compatible, or
just to log one request per client in order to reduce log size. Note that
everything which works at the HTTP level, including header parsing/addition,
cookie processing or content switching will only work for the first request
and will be ignored after the first response.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20forceclose">option forceclose</a>&quot;, &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot;, &quot;<a href="#option%20httpclose">option httpclose</a>&quot;, &quot;<a href="#option%20http-keep-alive">option http-keep-alive</a>&quot;, and &quot;1.1. The HTTP transaction model&quot;.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option http-use-proxy-header"></a><a class="anchor" name="4-option http-use-proxy-header"></a><a class="anchor" name="4.2-option http-use-proxy-header"></a><a class="anchor" name="option http-use-proxy-header (Proxies)"></a><a class="anchor" name="option http-use-proxy-header (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option http-use-proxy-header"></a><a href="#4.2-option%20http-use-proxy-header">option http-use-proxy-header</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option http-use-proxy-header"></a><a class="anchor" name="4-no option http-use-proxy-header"></a><a class="anchor" name="4.2-no option http-use-proxy-header"></a><a class="anchor" name="no option http-use-proxy-header (Proxies)"></a><a class="anchor" name="no option http-use-proxy-header (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option http-use-proxy-header"></a><a href="#4.2-no%20option%20http-use-proxy-header">no option http-use-proxy-header</a></b></div><pre class="text">Make use of non-standard Proxy-Connection header instead of Connection
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">While RFC2616 explicitly states that HTTP/1.1 agents must use the
Connection header to indicate their wish of persistent or non-persistent
connections, both browsers and proxies ignore this header for proxied
connections and make use of the undocumented, non-standard Proxy-Connection
header instead. The issue begins when trying to put a load balancer between
browsers and such proxies, because there will be a difference between what
haproxy understands and what the client and the proxy agree on.

By setting this option in a frontend, haproxy can automatically switch to use
that non-standard header if it sees proxied requests. A proxied request is
defined here as one where the URI begins with neither a '/' nor a '*'. The
choice of header only affects requests passing through proxies making use of
one of the &quot;<a href="#option%20httpclose">httpclose</a>&quot;, &quot;<a href="#option%20forceclose">forceclose</a>&quot; and &quot;<a href="#option%20http-server-close">http-server-close</a>&quot; options. Note
that this option can only be specified in a frontend and will affect the
request along its whole life.

Also, when this option is set, a request which requires authentication will
automatically switch to use proxy authentication headers if it is itself a
proxied request. That makes it possible to check or enforce authentication in
front of an existing proxy.

This option should normally never be used, except in front of a proxy.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httpclose">option httpclose</a>&quot;, &quot;<a href="#option%20forceclose">option forceclose</a>&quot; and &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot;.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option httpchk"></a><a class="anchor" name="4-option httpchk"></a><a class="anchor" name="4.2-option httpchk"></a><a class="anchor" name="option httpchk (Proxies)"></a><a class="anchor" name="option httpchk (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option httpchk"></a><a href="#4.2-option%20httpchk">option httpchk</a></b></div><a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option httpchk"></a><a class="anchor" name="4-option httpchk"></a><a class="anchor" name="4.2-option httpchk"></a><a class="anchor" name="option httpchk (Proxies)"></a><a class="anchor" name="option httpchk (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option httpchk"></a><a href="#4.2-option%20httpchk">option httpchk</a></b> <span style="color: #080">&lt;uri&gt;</span></div><a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option httpchk"></a><a class="anchor" name="4-option httpchk"></a><a class="anchor" name="4.2-option httpchk"></a><a class="anchor" name="option httpchk (Proxies)"></a><a class="anchor" name="option httpchk (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option httpchk"></a><a href="#4.2-option%20httpchk">option httpchk</a></b> <span style="color: #080">&lt;method&gt;</span> <span style="color: #080">&lt;uri&gt;</span></div><a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option httpchk"></a><a class="anchor" name="4-option httpchk"></a><a class="anchor" name="4.2-option httpchk"></a><a class="anchor" name="option httpchk (Proxies)"></a><a class="anchor" name="option httpchk (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option httpchk"></a><a href="#4.2-option%20httpchk">option httpchk</a></b> <span style="color: #080">&lt;method&gt;</span> <span style="color: #080">&lt;uri&gt;</span> <span style="color: #080">&lt;version&gt;</span></div><pre class="text">Enable HTTP protocol to check on the servers health
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;method&gt;  is the optional HTTP method used with the requests. When not set,
          the &quot;OPTIONS&quot; method is used, as it generally requires low server
          processing and is easy to filter out from the logs. Any method
          may be used, though it is not recommended to invent non-standard
          ones.

&lt;uri&gt;     is the URI referenced in the HTTP requests. It defaults to &quot; / &quot;
          which is accessible by default on almost any server, but may be
          changed to any other URI. Query strings are permitted.

&lt;version&gt; is the optional HTTP version string. It defaults to &quot;HTTP/1.0&quot;
          but some servers might behave incorrectly in HTTP 1.0, so turning
          it to HTTP/1.1 may sometimes help. Note that the Host field is
          mandatory in HTTP/1.1, and as a trick, it is possible to pass it
          after &quot;\r\n&quot; following the version string.</pre>
</div>
<pre class="text">By default, server health checks only consist in trying to establish a TCP
connection. When &quot;<a href="#option%20httpchk">option httpchk</a>&quot; is specified, a complete HTTP request is
sent once the TCP connection is established, and responses 2xx and 3xx are
considered valid, while all other ones indicate a server failure, including
the lack of any response.

The port and interval are specified in the server configuration.

This option does not necessarily require an HTTP backend, it also works with
plain TCP backends. This is particularly useful to check simple scripts bound
to some dedicated ports using the inetd daemon.
</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code><span class="comment"># Relay HTTPS traffic to Apache instance and check service availability</span>
<span class="comment"># using HTTP request &quot;OPTIONS * HTTP/1.1&quot; on port 80.</span>
backend https_relay
    mode tcp
    option httpchk OPTIONS * HTTP/1.1\r\nHost:\ www
    server apache1 192.168.1.1:443 check port 80
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#option%20ssl-hello-chk">option ssl-hello-chk</a>&quot;, &quot;<a href="#option%20smtpchk">option smtpchk</a>&quot;, &quot;<a href="#option%20mysql-check">option mysql-check</a>&quot;, &quot;<a href="#option%20pgsql-check">option pgsql-check</a>&quot;, &quot;<a href="#http-check">http-check</a>&quot; and the &quot;<a href="#check">check</a>&quot;, &quot;<a href="#port">port</a>&quot; and &quot;<a href="#inter">inter</a>&quot; server options.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option httpclose"></a><a class="anchor" name="4-option httpclose"></a><a class="anchor" name="4.2-option httpclose"></a><a class="anchor" name="option httpclose (Proxies)"></a><a class="anchor" name="option httpclose (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option httpclose"></a><a href="#4.2-option%20httpclose">option httpclose</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option httpclose"></a><a class="anchor" name="4-no option httpclose"></a><a class="anchor" name="4.2-no option httpclose"></a><a class="anchor" name="no option httpclose (Proxies)"></a><a class="anchor" name="no option httpclose (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option httpclose"></a><a href="#4.2-no%20option%20httpclose">no option httpclose</a></b></div><pre class="text">Enable or disable passive HTTP connection closing
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default HAProxy operates in keep-alive mode with regards to persistent
connections: for each connection it processes each request and response, and
leaves the connection idle on both sides between the end of a response and
the start of a new request. This mode may be changed by several options such
as &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot;, &quot;<a href="#option%20forceclose">option forceclose</a>&quot;, &quot;<a href="#option%20httpclose">option httpclose</a>&quot; or
&quot;<a href="#option%20http-tunnel">option http-tunnel</a>&quot;.

If &quot;<a href="#option%20httpclose">option httpclose</a>&quot; is set, HAProxy will work in HTTP tunnel mode and check
if a &quot;Connection: close&quot; header is already set in each direction, and will
add one if missing. Each end should react to this by actively closing the TCP
connection after each transfer, thus resulting in a switch to the HTTP close
mode. Any &quot;Connection&quot; header different from &quot;close&quot; will also be removed.
Note that this option is deprecated since what it does is very cheap but not
reliable. Using &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot; or &quot;<a href="#option%20forceclose">option forceclose</a>&quot; is strongly
recommended instead.

It seldom happens that some servers incorrectly ignore this header and do not
close the connection even though they reply &quot;Connection: close&quot;. For this
reason, they are not compatible with older HTTP 1.0 browsers. If this happens
it is possible to use the &quot;<a href="#option%20forceclose">option forceclose</a>&quot; which actively closes the
request connection once the server responds. Option &quot;<a href="#option%20forceclose">forceclose</a>&quot; also
releases the server connection earlier because it does not have to wait for
the client to acknowledge it.

This option may be set both in a frontend and in a backend. It is enabled if
at least one of the frontend or backend holding a connection has it enabled.
It disables and replaces any previous &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot;,
&quot;<a href="#option%20forceclose">option forceclose</a>&quot;, &quot;<a href="#option%20http-keep-alive">option http-keep-alive</a>&quot; or &quot;<a href="#option%20http-tunnel">option http-tunnel</a>&quot;. Please
check <a href="#4">section 4</a> (&quot;Proxies&quot;) to see how this option combines with others when
frontend and backend options differ.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20forceclose">option forceclose</a>&quot;, &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot; and &quot;1.1. The HTTP transaction model&quot;.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option httplog"></a><a class="anchor" name="4-option httplog"></a><a class="anchor" name="4.2-option httplog"></a><a class="anchor" name="option httplog (Proxies)"></a><a class="anchor" name="option httplog (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option httplog"></a><a href="#4.2-option%20httplog">option httplog</a></b> <span style="color: #008">[ clf ]</span></div><pre class="text">Enable logging of HTTP request, session state and timers
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">clf       if the &quot;clf&quot; argument is added, then the output format will be
          the CLF format instead of HAProxy's default HTTP format. You can
          use this when you need to feed HAProxy's logs through a specific
          log analyser which only support the CLF format and which is not
          extensible.</pre>
</div>
<pre class="text">By default, the log output format is very poor, as it only contains the
source and destination addresses, and the instance name. By specifying
&quot;<a href="#option%20httplog">option httplog</a>&quot;, each log line turns into a much richer format including,
but not limited to, the HTTP request, the connection timers, the session
status, the connections numbers, the captured headers and cookies, the
frontend, backend and server name, and of course the source address and
ports.

This option may be set either in the frontend or the backend.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it. Specifying
only &quot;<a href="#option%20httplog">option httplog</a>&quot; will automatically clear the 'clf' mode if it was set
by default.
</pre><div class="page-header"><b>See also :</b> <a href="#8">section 8</a> about logging.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option http_proxy"></a><a class="anchor" name="4-option http_proxy"></a><a class="anchor" name="4.2-option http_proxy"></a><a class="anchor" name="option http_proxy (Proxies)"></a><a class="anchor" name="option http_proxy (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option http_proxy"></a><a href="#4.2-option%20http_proxy">option http_proxy</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option http_proxy"></a><a class="anchor" name="4-no option http_proxy"></a><a class="anchor" name="4.2-no option http_proxy"></a><a class="anchor" name="no option http_proxy (Proxies)"></a><a class="anchor" name="no option http_proxy (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option http_proxy"></a><a href="#4.2-no%20option%20http_proxy">no option http_proxy</a></b></div><pre class="text">Enable or disable plain HTTP proxy mode
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">It sometimes happens that people need a pure HTTP proxy which understands
basic proxy requests without caching nor any fancy feature. In this case,
it may be worth setting up an HAProxy instance with the &quot;<a href="#option%20http_proxy">option http_proxy</a>&quot;
set. In this mode, no server is declared, and the connection is forwarded to
the IP address and port found in the URL after the &quot;http://&quot; scheme.

No host address resolution is performed, so this only works when pure IP
addresses are passed. Since this option's usage perimeter is rather limited,
it will probably be used only by experts who know they need exactly it. Last,
if the clients are susceptible of sending keep-alive requests, it will be
needed to add &quot;<a href="#option%20httpclose">option httpclose</a>&quot; to ensure that all requests will correctly
be analyzed.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># this backend understands HTTP proxy requests and forwards them directly.</span>
backend direct_forward
    option httpclose
    option http_proxy
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httpclose">option httpclose</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option independent-streams"></a><a class="anchor" name="4-option independent-streams"></a><a class="anchor" name="4.2-option independent-streams"></a><a class="anchor" name="option independent-streams (Proxies)"></a><a class="anchor" name="option independent-streams (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option independent-streams"></a><a href="#4.2-option%20independent-streams">option independent-streams</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option independent-streams"></a><a class="anchor" name="4-no option independent-streams"></a><a class="anchor" name="4.2-no option independent-streams"></a><a class="anchor" name="no option independent-streams (Proxies)"></a><a class="anchor" name="no option independent-streams (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option independent-streams"></a><a href="#4.2-no%20option%20independent-streams">no option independent-streams</a></b></div><pre class="text">Enable or disable independent timeout processing for both directions
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default, when data is sent over a socket, both the write timeout and the
read timeout for that socket are refreshed, because we consider that there is
activity on that socket, and we have no other means of guessing if we should
receive data or not.

While this default behaviour is desirable for almost all applications, there
exists a situation where it is desirable to disable it, and only refresh the
read timeout if there are incoming data. This happens on sessions with large
timeouts and low amounts of exchanged data such as telnet session. If the
server suddenly disappears, the output data accumulates in the system's
socket buffers, both timeouts are correctly refreshed, and there is no way
to know the server does not receive them, so we don't timeout. However, when
the underlying protocol always echoes sent data, it would be enough by itself
to detect the issue using the read timeout. Note that this problem does not
happen with more verbose protocols because data won't accumulate long in the
socket buffers.

When this option is set on the frontend, it will disable read timeout updates
on data sent to the client. There probably is little use of this case. When
the option is set on the backend, it will disable read timeout updates on
data sent to the server. Doing so will typically break large HTTP posts from
slow lines, so use it with caution.

Note: older versions used to call this setting &quot;<a href="#option%20independent-streams">option independent-streams</a>&quot;
      with a spelling mistake. This spelling is still supported but
      deprecated.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#timeout%20client">timeout client</a>&quot;, &quot;<a href="#timeout%20server">timeout server</a>&quot; and &quot;<a href="#timeout%20tunnel">timeout tunnel</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option ldap-check"></a><a class="anchor" name="4-option ldap-check"></a><a class="anchor" name="4.2-option ldap-check"></a><a class="anchor" name="option ldap-check (Proxies)"></a><a class="anchor" name="option ldap-check (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option ldap-check"></a><a href="#4.2-option%20ldap-check">option ldap-check</a></b></div><pre class="text">Use LDAPv3 health checks for server testing
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">It is possible to test that the server correctly talks LDAPv3 instead of just
testing that it accepts the TCP connection. When this option is set, an
LDAPv3 anonymous simple bind message is sent to the server, and the response
is analyzed to find an LDAPv3 bind response message.

The server is considered valid only when the LDAP response contains success
resultCode (http://tools.ietf.org/html/rfc4511#section-4.1.9).

Logging of bind requests is server dependent see your documentation how to
configure it.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>option ldap-check
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httpchk">option httpchk</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option log-health-checks"></a><a class="anchor" name="4-option log-health-checks"></a><a class="anchor" name="4.2-option log-health-checks"></a><a class="anchor" name="option log-health-checks (Proxies)"></a><a class="anchor" name="option log-health-checks (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option log-health-checks"></a><a href="#4.2-option%20log-health-checks">option log-health-checks</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option log-health-checks"></a><a class="anchor" name="4-no option log-health-checks"></a><a class="anchor" name="4.2-no option log-health-checks"></a><a class="anchor" name="no option log-health-checks (Proxies)"></a><a class="anchor" name="no option log-health-checks (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option log-health-checks"></a><a href="#4.2-no%20option%20log-health-checks">no option log-health-checks</a></b></div><pre class="text">Enable or disable logging of health checks status updates
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default, failed health check are logged if server is UP and successful
health checks are logged if server is DOWN, so the amount of additional
information is limited.

When this option is enabled, any change of the health check status or to
the server's health will be logged, so that it becomes possible to know
that a server was failing occasional checks before crashing, or exactly when
it failed to respond a valid HTTP status, then when the port started to
reject connections, then when the server stopped responding at all.

Note that status changes not caused by health checks (eg: enable/disable on
the CLI) are intentionally not logged by this option.
</pre><div class="page-header"><b>See also:</b> &quot;<a href="#option%20httpchk">option httpchk</a>&quot;, &quot;<a href="#option%20ldap-check">option ldap-check</a>&quot;, &quot;<a href="#option%20mysql-check">option mysql-check</a>&quot;, &quot;<a href="#option%20pgsql-check">option pgsql-check</a>&quot;, &quot;<a href="#option%20redis-check">option redis-check</a>&quot;, &quot;<a href="#option%20smtpchk">option smtpchk</a>&quot;, &quot;<a href="#option%20tcp-check">option tcp-check</a>&quot;, &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">log<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#log%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#log%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li></ul></span>&quot; and <a href="#8">section 8</a> about logging.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option log-separate-errors"></a><a class="anchor" name="4-option log-separate-errors"></a><a class="anchor" name="4.2-option log-separate-errors"></a><a class="anchor" name="option log-separate-errors (Proxies)"></a><a class="anchor" name="option log-separate-errors (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option log-separate-errors"></a><a href="#4.2-option%20log-separate-errors">option log-separate-errors</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option log-separate-errors"></a><a class="anchor" name="4-no option log-separate-errors"></a><a class="anchor" name="4.2-no option log-separate-errors"></a><a class="anchor" name="no option log-separate-errors (Proxies)"></a><a class="anchor" name="no option log-separate-errors (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option log-separate-errors"></a><a href="#4.2-no%20option%20log-separate-errors">no option log-separate-errors</a></b></div><pre class="text">Change log level for non-completely successful connections
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">Sometimes looking for errors in logs is not easy. This option makes haproxy
raise the level of logs containing potentially interesting information such
as errors, timeouts, retries, redispatches, or HTTP status codes 5xx. The
level changes from &quot;info&quot; to &quot;err&quot;. This makes it possible to log them
separately to a different file with most syslog daemons. Be careful not to
remove them from the original file, otherwise you would lose ordering which
provides very important information.

Using this option, large sites dealing with several thousand connections per
second may log normal traffic to a rotating buffer and only archive smaller
error logs.
</pre><div class="page-header"><b>See also :</b> &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">log<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#log%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#log%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li></ul></span>&quot;, &quot;<a href="#option%20dontlognull">dontlognull</a>&quot;, &quot;<a href="#option%20dontlog-normal">dontlog-normal</a>&quot; and <a href="#8">section 8</a> about logging.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option logasap"></a><a class="anchor" name="4-option logasap"></a><a class="anchor" name="4.2-option logasap"></a><a class="anchor" name="option logasap (Proxies)"></a><a class="anchor" name="option logasap (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option logasap"></a><a href="#4.2-option%20logasap">option logasap</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option logasap"></a><a class="anchor" name="4-no option logasap"></a><a class="anchor" name="4.2-no option logasap"></a><a class="anchor" name="no option logasap (Proxies)"></a><a class="anchor" name="no option logasap (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option logasap"></a><a href="#4.2-no%20option%20logasap">no option logasap</a></b></div><pre class="text">Enable or disable early logging of HTTP requests
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default, HTTP requests are logged upon termination so that the total
transfer time and the number of bytes appear in the logs. When large objects
are being transferred, it may take a while before the request appears in the
logs. Using &quot;<a href="#option%20logasap">option logasap</a>&quot;, the request gets logged as soon as the server
sends the complete headers. The only missing information in the logs will be
the total number of bytes which will indicate everything except the amount
of data transferred, and the total time which will not take the transfer
time into account. In such a situation, it's a good practice to capture the
&quot;Content-Length&quot; response header so that the logs at least indicate how many
bytes are expected to be transferred.
</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code>  listen http_proxy 0.0.0.0:80
      mode http
      option httplog
      option logasap
      log 192.168.2.200 local3

&gt;&gt;&gt; Feb  6 12:14:14 localhost \
      haproxy[14389]: 10.0.1.2:33317 [06/Feb/2009:12:14:14.655] http-in \
      static/srv1 9/10/7/14/+30 200 +243 - - ---- 3/1/1/1/0 1/0 \
      &quot;GET /image.iso HTTP/1.0&quot;
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httplog">option httplog</a>&quot;, &quot;<a href="#capture%20response%20header">capture response header</a>&quot;, and <a href="#8">section 8</a> about logging.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option mysql-check"></a><a class="anchor" name="4-option mysql-check"></a><a class="anchor" name="4.2-option mysql-check"></a><a class="anchor" name="option mysql-check (Proxies)"></a><a class="anchor" name="option mysql-check (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option mysql-check"></a><a href="#4.2-option%20mysql-check">option mysql-check</a></b> <span style="color: #008">[ user <span style="color: #080">&lt;username&gt;</span> <span style="color: #008">[ post-41 ]</span> ]</span></div><pre class="text">Use MySQL health checks for server testing
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;username&gt; This is the username which will be used when connecting to MySQL
           server.
post-41    Send post v4.1 client compatible checks</pre>
</div>
<pre class="text">If you specify a username, the check consists of sending two MySQL packet,
one Client Authentication packet, and one QUIT packet, to correctly close
MySQL session. We then parse the MySQL Handshake Initialisation packet and/or
Error packet. It is a basic but useful test which does not produce error nor
aborted connect on the server. However, it requires adding an authorization
in the MySQL table, like this :

    USE mysql;
    INSERT INTO user (Host,User) values ('&lt;ip_of_haproxy&gt;','&lt;username&gt;');
    FLUSH PRIVILEGES;

If you don't specify a username (it is deprecated and not recommended), the
check only consists in parsing the Mysql Handshake Initialisation packet or
Error packet, we don't send anything in this mode. It was reported that it
can generate lockout if check is too frequent and/or if there is not enough
traffic. In fact, you need in this case to check MySQL &quot;max_connect_errors&quot;
value as if a connection is established successfully within fewer than MySQL
&quot;max_connect_errors&quot; attempts after a previous connection was interrupted,
the error count for the host is cleared to zero. If HAProxy's server get
blocked, the &quot;FLUSH HOSTS&quot; statement is the only way to unblock it.

Remember that this does not check database presence nor database consistency.
To do this, you can use an external check with xinetd for example.

The check requires MySQL &gt;=3.22, for older version, please use TCP check.

Most often, an incoming MySQL server needs to see the client's IP address for
various purposes, including IP privilege matching and connection logging.
When possible, it is often wise to masquerade the client's IP address when
connecting to the server using the &quot;usesrc&quot; argument of the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#source%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; keyword,
which requires the cttproxy feature to be compiled in, and the MySQL server
to route the client via the machine hosting haproxy.
</pre><div class="page-header"><b>See also:</b> &quot;<a href="#option%20httpchk">option httpchk</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option nolinger"></a><a class="anchor" name="4-option nolinger"></a><a class="anchor" name="4.2-option nolinger"></a><a class="anchor" name="option nolinger (Proxies)"></a><a class="anchor" name="option nolinger (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option nolinger"></a><a href="#4.2-option%20nolinger">option nolinger</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option nolinger"></a><a class="anchor" name="4-no option nolinger"></a><a class="anchor" name="4.2-no option nolinger"></a><a class="anchor" name="no option nolinger (Proxies)"></a><a class="anchor" name="no option nolinger (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option nolinger"></a><a href="#4.2-no%20option%20nolinger">no option nolinger</a></b></div><pre class="text">Enable or disable immediate session resource cleaning after close
</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When clients or servers abort connections in a dirty way (eg: they are
physically disconnected), the session timeouts triggers and the session is
closed. But it will remain in FIN_WAIT1 state for some time in the system,
using some resources and possibly limiting the ability to establish newer
connections.

When this happens, it is possible to activate &quot;<a href="#option%20nolinger">option nolinger</a>&quot; which forces
the system to immediately remove any socket's pending data on close. Thus,
the session is instantly purged from the system's tables. This usually has
side effects such as increased number of TCP resets due to old retransmits
getting immediately rejected. Some firewalls may sometimes complain about
this too.

For this reason, it is not recommended to use this option when not absolutely
needed. You know that you need it when you have thousands of FIN_WAIT1
sessions on your system (TIME_WAIT ones do not count).

This option may be used both on frontends and backends, depending on the side
where it is required. Use it on the frontend for clients, and on the backend
for servers.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.
</pre><a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option originalto"></a><a class="anchor" name="4-option originalto"></a><a class="anchor" name="4.2-option originalto"></a><a class="anchor" name="option originalto (Proxies)"></a><a class="anchor" name="option originalto (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option originalto"></a><a href="#4.2-option%20originalto">option originalto</a></b> <span style="color: #008">[ except <span style="color: #080">&lt;network&gt;</span> ]</span> <span style="color: #008">[ header <span style="color: #080">&lt;name&gt;</span> ]</span></div><pre class="text">Enable insertion of the X-Original-To header to requests sent to servers
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;network&gt; is an optional argument used to disable this option for sources
          matching &lt;network&gt;
&lt;name&gt;    an optional argument to specify a different &quot;X-Original-To&quot;
          header name.</pre>
</div>
<pre class="text">Since HAProxy can work in transparent mode, every request from a client can
be redirected to the proxy and HAProxy itself can proxy every request to a
complex SQUID environment and the destination host from SO_ORIGINAL_DST will
be lost. This is annoying when you want access rules based on destination ip
addresses. To solve this problem, a new HTTP header &quot;X-Original-To&quot; may be
added by HAProxy to all requests sent to the server. This header contains a
value representing the original destination IP address. Since this must be
configured to always use the last occurrence of this header only. Note that
only the last occurrence of the header must be used, since it is really
possible that the client has already brought one.

The keyword &quot;header&quot; may be used to supply a different header name to replace
the default &quot;X-Original-To&quot;. This can be useful where you might already
have a &quot;X-Original-To&quot; header from a different application, and you need
preserve it. Also if your backend server doesn't use the &quot;X-Original-To&quot;
header and requires different one.

Sometimes, a same HAProxy instance may be shared between a direct client
access and a reverse-proxy access (for instance when an SSL reverse-proxy is
used to decrypt HTTPS traffic). It is possible to disable the addition of the
header for a known source address or network by adding the &quot;except&quot; keyword
followed by the network address. In this case, any source IP matching the
network will not cause an addition of this header. Most common uses are with
private networks or 127.0.0.1.

This option may be specified either in the frontend or in the backend. If at
least one of them uses it, the header will be added. Note that the backend's
setting of the header subargument takes precedence over the frontend's if
both are defined.
</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code><span class="comment"># Original Destination address</span>
frontend www
    mode http
    option originalto except 127.0.0.1

<span class="comment"># Those servers want the IP Address in X-Client-Dst</span>
backend www
    mode http
    option originalto header X-Client-Dst
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httpclose">option httpclose</a>&quot;, &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot;, &quot;<a href="#option%20forceclose">option forceclose</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option persist"></a><a class="anchor" name="4-option persist"></a><a class="anchor" name="4.2-option persist"></a><a class="anchor" name="option persist (Proxies)"></a><a class="anchor" name="option persist (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option persist"></a><a href="#4.2-option%20persist">option persist</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option persist"></a><a class="anchor" name="4-no option persist"></a><a class="anchor" name="4.2-no option persist"></a><a class="anchor" name="no option persist (Proxies)"></a><a class="anchor" name="no option persist (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option persist"></a><a href="#4.2-no%20option%20persist">no option persist</a></b></div><pre class="text">Enable or disable forced persistence on down servers
</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When an HTTP request reaches a backend with a cookie which references a dead
server, by default it is redispatched to another server. It is possible to
force the request to be sent to the dead server first using &quot;<a href="#option%20persist">option persist</a>&quot;
if absolutely needed. A common use case is when servers are under extreme
load and spend their time flapping. In this case, the users would still be
directed to the server they opened the session on, in the hope they would be
correctly served. It is recommended to use &quot;<a href="#option%20redispatch">option redispatch</a>&quot; in conjunction
with this option so that in the event it would not be possible to connect to
the server at all (server definitely dead), the client would finally be
redirected to another valid server.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20redispatch">option redispatch</a>&quot;, &quot;<a href="#retries">retries</a>&quot;, &quot;<a href="#force-persist">force-persist</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option pgsql-check"></a><a class="anchor" name="4-option pgsql-check"></a><a class="anchor" name="4.2-option pgsql-check"></a><a class="anchor" name="option pgsql-check (Proxies)"></a><a class="anchor" name="option pgsql-check (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option pgsql-check"></a><a href="#4.2-option%20pgsql-check">option pgsql-check</a></b> <span style="color: #008">[ user <span style="color: #080">&lt;username&gt;</span> ]</span></div><pre class="text">Use PostgreSQL health checks for server testing
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;username&gt; This is the username which will be used when connecting to
           PostgreSQL server.</pre>
</div>
<pre class="text">The check sends a PostgreSQL StartupMessage and waits for either
Authentication request or ErrorResponse message. It is a basic but useful
test which does not produce error nor aborted connect on the server.
This check is identical with the &quot;<a href="#option%20mysql-check">mysql-check</a>&quot;.
</pre><div class="page-header"><b>See also:</b> &quot;<a href="#option%20httpchk">option httpchk</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option prefer-last-server"></a><a class="anchor" name="4-option prefer-last-server"></a><a class="anchor" name="4.2-option prefer-last-server"></a><a class="anchor" name="option prefer-last-server (Proxies)"></a><a class="anchor" name="option prefer-last-server (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option prefer-last-server"></a><a href="#4.2-option%20prefer-last-server">option prefer-last-server</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option prefer-last-server"></a><a class="anchor" name="4-no option prefer-last-server"></a><a class="anchor" name="4.2-no option prefer-last-server"></a><a class="anchor" name="no option prefer-last-server (Proxies)"></a><a class="anchor" name="no option prefer-last-server (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option prefer-last-server"></a><a href="#4.2-no%20option%20prefer-last-server">no option prefer-last-server</a></b></div><pre class="text">Allow multiple load balanced requests to remain on the same server
</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When the load balancing algorithm in use is not deterministic, and a previous
request was sent to a server to which haproxy still holds a connection, it is
sometimes desirable that subsequent requests on a same session go to the same
server as much as possible. Note that this is different from persistence, as
we only indicate a preference which haproxy tries to apply without any form
of warranty. The real use is for keep-alive connections sent to servers. When
this option is used, haproxy will try to reuse the same connection that is
attached to the server instead of rebalancing to another server, causing a
close of the connection. This can make sense for static file servers. It does
not make much sense to use this in combination with hashing algorithms. Note,
haproxy already automatically tries to stick to a server which sends a 401 or
to a proxy which sends a 407 (authentication required). This is mandatory for
use with the broken NTLM authentication challenge, and significantly helps in
troubleshooting some faulty applications. Option prefer-last-server might be
desirable in these environments as well, to avoid redistributing the traffic
after every other response.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.
</pre><div class="page-header"><b>See also:</b> &quot;<a href="#option%20http-keep-alive">option http-keep-alive</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option redispatch"></a><a class="anchor" name="4-option redispatch"></a><a class="anchor" name="4.2-option redispatch"></a><a class="anchor" name="option redispatch (Proxies)"></a><a class="anchor" name="option redispatch (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option redispatch"></a><a href="#4.2-option%20redispatch">option redispatch</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option redispatch"></a><a class="anchor" name="4-no option redispatch"></a><a class="anchor" name="4.2-no option redispatch"></a><a class="anchor" name="no option redispatch (Proxies)"></a><a class="anchor" name="no option redispatch (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option redispatch"></a><a href="#4.2-no%20option%20redispatch">no option redispatch</a></b></div><pre class="text">Enable or disable session redistribution in case of connection failure
</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">In HTTP mode, if a server designated by a cookie is down, clients may
definitely stick to it because they cannot flush the cookie, so they will not
be able to access the service anymore.

Specifying &quot;<a href="#option%20redispatch">option redispatch</a>&quot; will allow the proxy to break their
persistence and redistribute them to a working server.

It also allows to retry last connection to another server in case of multiple
connection failures. Of course, it requires having &quot;<a href="#retries">retries</a>&quot; set to a nonzero
value.

This form is the preferred form, which replaces both the &quot;<a href="#option%20redispatch">redispatch</a>&quot; and
&quot;<a href="#redisp">redisp</a>&quot; keywords.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20redispatch">redispatch</a>&quot;, &quot;<a href="#retries">retries</a>&quot;, &quot;<a href="#force-persist">force-persist</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option redis-check"></a><a class="anchor" name="4-option redis-check"></a><a class="anchor" name="4.2-option redis-check"></a><a class="anchor" name="option redis-check (Proxies)"></a><a class="anchor" name="option redis-check (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option redis-check"></a><a href="#4.2-option%20redis-check">option redis-check</a></b></div><pre class="text">Use redis health checks for server testing
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">It is possible to test that the server correctly talks REDIS protocol instead
of just testing that it accepts the TCP connection. When this option is set,
a PING redis command is sent to the server, and the response is analyzed to
find the &quot;+PONG&quot; response message.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>option redis-check
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httpchk">option httpchk</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option smtpchk"></a><a class="anchor" name="4-option smtpchk"></a><a class="anchor" name="4.2-option smtpchk"></a><a class="anchor" name="option smtpchk (Proxies)"></a><a class="anchor" name="option smtpchk (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option smtpchk"></a><a href="#4.2-option%20smtpchk">option smtpchk</a></b></div><a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option smtpchk"></a><a class="anchor" name="4-option smtpchk"></a><a class="anchor" name="4.2-option smtpchk"></a><a class="anchor" name="option smtpchk (Proxies)"></a><a class="anchor" name="option smtpchk (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option smtpchk"></a><a href="#4.2-option%20smtpchk">option smtpchk</a></b> <span style="color: #080">&lt;hello&gt;</span> <span style="color: #080">&lt;domain&gt;</span></div><pre class="text">Use SMTP health checks for server testing
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;hello&gt;   is an optional argument. It is the &quot;hello&quot; command to use. It can
          be either &quot;HELO&quot; (for SMTP) or &quot;EHLO&quot; (for ESTMP). All other
          values will be turned into the default command (&quot;HELO&quot;).

&lt;domain&gt;  is the domain name to present to the server. It may only be
          specified (and is mandatory) if the hello command has been
          specified. By default, &quot;localhost&quot; is used.</pre>
</div>
<pre class="text">When &quot;<a href="#option%20smtpchk">option smtpchk</a>&quot; is set, the health checks will consist in TCP
connections followed by an SMTP command. By default, this command is
&quot;HELO localhost&quot;. The server's return code is analyzed and only return codes
starting with a &quot;2&quot; will be considered as valid. All other responses,
including a lack of response will constitute an error and will indicate a
dead server.

This test is meant to be used with SMTP servers or relays. Depending on the
request, it is possible that some servers do not log each connection attempt,
so you may want to experiment to improve the behaviour. Using telnet on port
25 is often easier than adjusting the configuration.

Most often, an incoming SMTP server needs to see the client's IP address for
various purposes, including spam filtering, anti-spoofing and logging. When
possible, it is often wise to masquerade the client's IP address when
connecting to the server using the &quot;usesrc&quot; argument of the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#source%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; keyword,
which requires the cttproxy feature to be compiled in.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>option smtpchk HELO mydomain.org
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httpchk">option httpchk</a>&quot;, &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#source%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option socket-stats"></a><a class="anchor" name="4-option socket-stats"></a><a class="anchor" name="4.2-option socket-stats"></a><a class="anchor" name="option socket-stats (Proxies)"></a><a class="anchor" name="option socket-stats (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option socket-stats"></a><a href="#4.2-option%20socket-stats">option socket-stats</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option socket-stats"></a><a class="anchor" name="4-no option socket-stats"></a><a class="anchor" name="4.2-no option socket-stats"></a><a class="anchor" name="no option socket-stats (Proxies)"></a><a class="anchor" name="no option socket-stats (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option socket-stats"></a><a href="#4.2-no%20option%20socket-stats">no option socket-stats</a></b></div><pre class="text">Enable or disable collecting &amp; providing separate statistics for each socket.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option splice-auto"></a><a class="anchor" name="4-option splice-auto"></a><a class="anchor" name="4.2-option splice-auto"></a><a class="anchor" name="option splice-auto (Proxies)"></a><a class="anchor" name="option splice-auto (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option splice-auto"></a><a href="#4.2-option%20splice-auto">option splice-auto</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option splice-auto"></a><a class="anchor" name="4-no option splice-auto"></a><a class="anchor" name="4.2-no option splice-auto"></a><a class="anchor" name="no option splice-auto (Proxies)"></a><a class="anchor" name="no option splice-auto (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option splice-auto"></a><a href="#4.2-no%20option%20splice-auto">no option splice-auto</a></b></div><pre class="text">Enable or disable automatic kernel acceleration on sockets in both directions
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When this option is enabled either on a frontend or on a backend, haproxy
will automatically evaluate the opportunity to use kernel tcp splicing to
forward data between the client and the server, in either direction. Haproxy
uses heuristics to estimate if kernel splicing might improve performance or
not. Both directions are handled independently. Note that the heuristics used
are not much aggressive in order to limit excessive use of splicing. This
option requires splicing to be enabled at compile time, and may be globally
disabled with the global option &quot;<a href="#nosplice">nosplice</a>&quot;. Since splice uses pipes, using it
requires that there are enough spare pipes.

Important note: kernel-based TCP splicing is a Linux-specific feature which
first appeared in kernel 2.6.25. It offers kernel-based acceleration to
transfer data between sockets without copying these data to user-space, thus
providing noticeable performance gains and CPU cycles savings. Since many
early implementations are buggy, corrupt data and/or are inefficient, this
feature is not enabled by default, and it should be used with extreme care.
While it is not possible to detect the correctness of an implementation,
2.6.29 is the first version offering a properly working implementation. In
case of doubt, splicing may be globally disabled using the global &quot;<a href="#nosplice">nosplice</a>&quot;
keyword.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>option splice-auto
</code></pre>
</div><pre class="text">If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20splice-request">option splice-request</a>&quot;, &quot;<a href="#option%20splice-response">option splice-response</a>&quot;, and global options &quot;<a href="#nosplice">nosplice</a>&quot; and &quot;<a href="#maxpipes">maxpipes</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option splice-request"></a><a class="anchor" name="4-option splice-request"></a><a class="anchor" name="4.2-option splice-request"></a><a class="anchor" name="option splice-request (Proxies)"></a><a class="anchor" name="option splice-request (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option splice-request"></a><a href="#4.2-option%20splice-request">option splice-request</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option splice-request"></a><a class="anchor" name="4-no option splice-request"></a><a class="anchor" name="4.2-no option splice-request"></a><a class="anchor" name="no option splice-request (Proxies)"></a><a class="anchor" name="no option splice-request (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option splice-request"></a><a href="#4.2-no%20option%20splice-request">no option splice-request</a></b></div><pre class="text">Enable or disable automatic kernel acceleration on sockets for requests
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When this option is enabled either on a frontend or on a backend, haproxy
will use kernel tcp splicing whenever possible to forward data going from
the client to the server. It might still use the recv/send scheme if there
are no spare pipes left. This option requires splicing to be enabled at
compile time, and may be globally disabled with the global option &quot;<a href="#nosplice">nosplice</a>&quot;.
Since splice uses pipes, using it requires that there are enough spare pipes.

Important note: see &quot;<a href="#option%20splice-auto">option splice-auto</a>&quot; for usage limitations.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>option splice-request
</code></pre>
</div><pre class="text">If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20splice-auto">option splice-auto</a>&quot;, &quot;<a href="#option%20splice-response">option splice-response</a>&quot;, and global options &quot;<a href="#nosplice">nosplice</a>&quot; and &quot;<a href="#maxpipes">maxpipes</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option splice-response"></a><a class="anchor" name="4-option splice-response"></a><a class="anchor" name="4.2-option splice-response"></a><a class="anchor" name="option splice-response (Proxies)"></a><a class="anchor" name="option splice-response (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option splice-response"></a><a href="#4.2-option%20splice-response">option splice-response</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option splice-response"></a><a class="anchor" name="4-no option splice-response"></a><a class="anchor" name="4.2-no option splice-response"></a><a class="anchor" name="no option splice-response (Proxies)"></a><a class="anchor" name="no option splice-response (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option splice-response"></a><a href="#4.2-no%20option%20splice-response">no option splice-response</a></b></div><pre class="text">Enable or disable automatic kernel acceleration on sockets for responses
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When this option is enabled either on a frontend or on a backend, haproxy
will use kernel tcp splicing whenever possible to forward data going from
the server to the client. It might still use the recv/send scheme if there
are no spare pipes left. This option requires splicing to be enabled at
compile time, and may be globally disabled with the global option &quot;<a href="#nosplice">nosplice</a>&quot;.
Since splice uses pipes, using it requires that there are enough spare pipes.

Important note: see &quot;<a href="#option%20splice-auto">option splice-auto</a>&quot; for usage limitations.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>option splice-response
</code></pre>
</div><pre class="text">If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20splice-auto">option splice-auto</a>&quot;, &quot;<a href="#option%20splice-request">option splice-request</a>&quot;, and global options &quot;<a href="#nosplice">nosplice</a>&quot; and &quot;<a href="#maxpipes">maxpipes</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option srvtcpka"></a><a class="anchor" name="4-option srvtcpka"></a><a class="anchor" name="4.2-option srvtcpka"></a><a class="anchor" name="option srvtcpka (Proxies)"></a><a class="anchor" name="option srvtcpka (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option srvtcpka"></a><a href="#4.2-option%20srvtcpka">option srvtcpka</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option srvtcpka"></a><a class="anchor" name="4-no option srvtcpka"></a><a class="anchor" name="4.2-no option srvtcpka"></a><a class="anchor" name="no option srvtcpka (Proxies)"></a><a class="anchor" name="no option srvtcpka (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option srvtcpka"></a><a href="#4.2-no%20option%20srvtcpka">no option srvtcpka</a></b></div><pre class="text">Enable or disable the sending of TCP keepalive packets on the server side
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When there is a firewall or any session-aware component between a client and
a server, and when the protocol involves very long sessions with long idle
periods (eg: remote desktops), there is a risk that one of the intermediate
components decides to expire a session which has remained idle for too long.

Enabling socket-level TCP keep-alives makes the system regularly send packets
to the other end of the connection, leaving it active. The delay between
keep-alive probes is controlled by the system only and depends both on the
operating system and its tuning parameters.

It is important to understand that keep-alive packets are neither emitted nor
received at the application level. It is only the network stacks which sees
them. For this reason, even if one side of the proxy already uses keep-alives
to maintain its connection alive, those keep-alive packets will not be
forwarded to the other side of the proxy.

Please note that this has nothing to do with HTTP keep-alive.

Using option &quot;<a href="#option%20srvtcpka">srvtcpka</a>&quot; enables the emission of TCP keep-alive probes on the
server side of a connection, which should help when session expirations are
noticed between HAProxy and a server.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20clitcpka">option clitcpka</a>&quot;, &quot;<a href="#option%20tcpka">option tcpka</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option ssl-hello-chk"></a><a class="anchor" name="4-option ssl-hello-chk"></a><a class="anchor" name="4.2-option ssl-hello-chk"></a><a class="anchor" name="option ssl-hello-chk (Proxies)"></a><a class="anchor" name="option ssl-hello-chk (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option ssl-hello-chk"></a><a href="#4.2-option%20ssl-hello-chk">option ssl-hello-chk</a></b></div><pre class="text">Use SSLv3 client hello health checks for server testing
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When some SSL-based protocols are relayed in TCP mode through HAProxy, it is
possible to test that the server correctly talks SSL instead of just testing
that it accepts the TCP connection. When &quot;<a href="#option%20ssl-hello-chk">option ssl-hello-chk</a>&quot; is set, pure
SSLv3 client hello messages are sent once the connection is established to
the server, and the response is analyzed to find an SSL server hello message.
The server is considered valid only when the response contains this server
hello message.

All servers tested till there correctly reply to SSLv3 client hello messages,
and most servers tested do not even log the requests containing only hello
messages, which is appreciable.

Note that this check works even when SSL support was not built into haproxy
because it forges the SSL message. When SSL support is available, it is best
to use native SSL health checks instead of this one.
</pre><div class="page-header"><b>See also:</b> &quot;<a href="#option%20httpchk">option httpchk</a>&quot;, &quot;<a href="#check-ssl">check-ssl</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option tcp-check"></a><a class="anchor" name="4-option tcp-check"></a><a class="anchor" name="4.2-option tcp-check"></a><a class="anchor" name="option tcp-check (Proxies)"></a><a class="anchor" name="option tcp-check (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option tcp-check"></a><a href="#4.2-option%20tcp-check">option tcp-check</a></b></div><pre class="text">Perform health checks using tcp-check send/expect sequences
</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">This health check method is intended to be combined with &quot;<a href="#option%20tcp-check">tcp-check</a>&quot; command
lists in order to support send/expect types of health check sequences.

TCP checks currently support 4 modes of operations :
  - no &quot;<a href="#option%20tcp-check">tcp-check</a>&quot; directive : the health check only consists in a connection
    attempt, which remains the default mode.

  - &quot;<a href="#tcp-check%20send">tcp-check send</a>&quot; or &quot;<a href="#tcp-check%20send-binary">tcp-check send-binary</a>&quot; only is mentioned : this is
    used to send a string along with a connection opening. With some
    protocols, it helps sending a &quot;QUIT&quot; message for example that prevents
    the server from logging a connection error for each health check. The
    check result will still be based on the ability to open the connection
    only.

  - &quot;<a href="#tcp-check%20expect">tcp-check expect</a>&quot; only is mentioned : this is used to test a banner.
    The connection is opened and haproxy waits for the server to present some
    contents which must validate some rules. The check result will be based
    on the matching between the contents and the rules. This is suited for
    POP, IMAP, SMTP, FTP, SSH, TELNET.

  - both &quot;<a href="#tcp-check%20send">tcp-check send</a>&quot; and &quot;<a href="#tcp-check%20expect">tcp-check expect</a>&quot; are mentioned : this is
    used to test a hello-type protocol. Haproxy sends a message, the server
    responds and its response is analysed. the check result will be based on
    the matching between the response contents and the rules. This is often
    suited for protocols which require a binding or a request/response model.
    LDAP, MySQL, Redis and SSL are example of such protocols, though they
    already all have their dedicated checks with a deeper understanding of
    the respective protocols.
    In this mode, many questions may be sent and many answers may be
    analysed.
</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code><span class="comment"># perform a POP check (analyse only server's banner)</span>
option tcp-check
tcp-check expect string +OK\ POP3\ ready

<span class="comment"># perform an IMAP check (analyse only server's banner)</span>
option tcp-check
tcp-check expect string *\ OK\ IMAP4\ ready

<span class="comment"># look for the redis master server after ensuring it speaks well</span>
<span class="comment"># redis protocol, then it exits properly.</span>
<span class="comment"># (send a command then analyse the response 3 times)</span>
option tcp-check
tcp-check send PING\r\n
tcp-check expect +PONG
tcp-check send info\ replication\r\n
tcp-check expect string role:master
tcp-check send QUIT\r\n
tcp-check expect string +OK

forge a HTTP request, then analyse the response
(send many headers before analyzing)
option tcp-check
tcp-check send HEAD\ /\ HTTP/1.1\r\n
tcp-check send Host:\ www.mydomain.com\r\n
tcp-check send User-Agent:\ HAProxy\ tcpcheck\r\n
tcp-check send \r\n
tcp-check expect rstring HTTP/1\..\ (2..|3..)
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#tcp-check%20expect">tcp-check expect</a>&quot;, &quot;<a href="#tcp-check%20send">tcp-check send</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option tcp-smart-accept"></a><a class="anchor" name="4-option tcp-smart-accept"></a><a class="anchor" name="4.2-option tcp-smart-accept"></a><a class="anchor" name="option tcp-smart-accept (Proxies)"></a><a class="anchor" name="option tcp-smart-accept (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option tcp-smart-accept"></a><a href="#4.2-option%20tcp-smart-accept">option tcp-smart-accept</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option tcp-smart-accept"></a><a class="anchor" name="4-no option tcp-smart-accept"></a><a class="anchor" name="4.2-no option tcp-smart-accept"></a><a class="anchor" name="no option tcp-smart-accept (Proxies)"></a><a class="anchor" name="no option tcp-smart-accept (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option tcp-smart-accept"></a><a href="#4.2-no%20option%20tcp-smart-accept">no option tcp-smart-accept</a></b></div><pre class="text">Enable or disable the saving of one ACK packet during the accept sequence
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When an HTTP connection request comes in, the system acknowledges it on
behalf of HAProxy, then the client immediately sends its request, and the
system acknowledges it too while it is notifying HAProxy about the new
connection. HAProxy then reads the request and responds. This means that we
have one TCP ACK sent by the system for nothing, because the request could
very well be acknowledged by HAProxy when it sends its response.

For this reason, in HTTP mode, HAProxy automatically asks the system to avoid
sending this useless ACK on platforms which support it (currently at least
Linux). It must not cause any problem, because the system will send it anyway
after 40 ms if the response takes more time than expected to come.

During complex network debugging sessions, it may be desirable to disable
this optimization because delayed ACKs can make troubleshooting more complex
when trying to identify where packets are delayed. It is then possible to
fall back to normal behaviour by specifying &quot;<a href="#no%20option%20tcp-smart-accept">no option tcp-smart-accept</a>&quot;.

It is also possible to force it for non-HTTP proxies by simply specifying
&quot;<a href="#option%20tcp-smart-accept">option tcp-smart-accept</a>&quot;. For instance, it can make sense with some services
such as SMTP where the server speaks first.

It is recommended to avoid forcing this option in a defaults section. In case
of doubt, consider setting it back to automatic values by prepending the
&quot;default&quot; keyword before it, or disabling it using the &quot;no&quot; keyword.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20tcp-smart-connect">option tcp-smart-connect</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option tcp-smart-connect"></a><a class="anchor" name="4-option tcp-smart-connect"></a><a class="anchor" name="4.2-option tcp-smart-connect"></a><a class="anchor" name="option tcp-smart-connect (Proxies)"></a><a class="anchor" name="option tcp-smart-connect (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option tcp-smart-connect"></a><a href="#4.2-option%20tcp-smart-connect">option tcp-smart-connect</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option tcp-smart-connect"></a><a class="anchor" name="4-no option tcp-smart-connect"></a><a class="anchor" name="4.2-no option tcp-smart-connect"></a><a class="anchor" name="no option tcp-smart-connect (Proxies)"></a><a class="anchor" name="no option tcp-smart-connect (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option tcp-smart-connect"></a><a href="#4.2-no%20option%20tcp-smart-connect">no option tcp-smart-connect</a></b></div><pre class="text">Enable or disable the saving of one ACK packet during the connect sequence
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">On certain systems (at least Linux), HAProxy can ask the kernel not to
immediately send an empty ACK upon a connection request, but to directly
send the buffer request instead. This saves one packet on the network and
thus boosts performance. It can also be useful for some servers, because they
immediately get the request along with the incoming connection.

This feature is enabled when &quot;<a href="#option%20tcp-smart-connect">option tcp-smart-connect</a>&quot; is set in a backend.
It is not enabled by default because it makes network troubleshooting more
complex.

It only makes sense to enable it with protocols where the client speaks first
such as HTTP. In other situations, if there is no data to send in place of
the ACK, a normal ACK is sent.

If this option has been enabled in a &quot;defaults&quot; section, it can be disabled
in a specific instance by prepending the &quot;no&quot; keyword before it.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20tcp-smart-accept">option tcp-smart-accept</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option tcpka"></a><a class="anchor" name="4-option tcpka"></a><a class="anchor" name="4.2-option tcpka"></a><a class="anchor" name="option tcpka (Proxies)"></a><a class="anchor" name="option tcpka (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option tcpka"></a><a href="#4.2-option%20tcpka">option tcpka</a></b></div><pre class="text">Enable or disable the sending of TCP keepalive packets on both sides
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">When there is a firewall or any session-aware component between a client and
a server, and when the protocol involves very long sessions with long idle
periods (eg: remote desktops), there is a risk that one of the intermediate
components decides to expire a session which has remained idle for too long.

Enabling socket-level TCP keep-alives makes the system regularly send packets
to the other end of the connection, leaving it active. The delay between
keep-alive probes is controlled by the system only and depends both on the
operating system and its tuning parameters.

It is important to understand that keep-alive packets are neither emitted nor
received at the application level. It is only the network stacks which sees
them. For this reason, even if one side of the proxy already uses keep-alives
to maintain its connection alive, those keep-alive packets will not be
forwarded to the other side of the proxy.

Please note that this has nothing to do with HTTP keep-alive.

Using option &quot;<a href="#option%20tcpka">tcpka</a>&quot; enables the emission of TCP keep-alive probes on both
the client and server sides of a connection. Note that this is meaningful
only in &quot;defaults&quot; or &quot;listen&quot; sections. If this option is used in a
frontend, only the client side will get keep-alives, and if this option is
used in a backend, only the server side will get keep-alives. For this
reason, it is strongly recommended to explicitly use &quot;<a href="#option%20clitcpka">option clitcpka</a>&quot; and
&quot;<a href="#option%20srvtcpka">option srvtcpka</a>&quot; when the configuration is split between frontends and
backends.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20clitcpka">option clitcpka</a>&quot;, &quot;<a href="#option%20srvtcpka">option srvtcpka</a>&quot;</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option tcplog"></a><a class="anchor" name="4-option tcplog"></a><a class="anchor" name="4.2-option tcplog"></a><a class="anchor" name="option tcplog (Proxies)"></a><a class="anchor" name="option tcplog (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option tcplog"></a><a href="#4.2-option%20tcplog">option tcplog</a></b></div><pre class="text">Enable advanced logging of TCP connections with session state and timers
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default, the log output format is very poor, as it only contains the
source and destination addresses, and the instance name. By specifying
&quot;<a href="#option%20tcplog">option tcplog</a>&quot;, each log line turns into a much richer format including, but
not limited to, the connection timers, the session status, the connections
numbers, the frontend, backend and server name, and of course the source
address and ports. This option is useful for pure TCP proxies in order to
find which of the client or server disconnects or times out. For normal HTTP
proxies, it's better to use &quot;<a href="#option%20httplog">option httplog</a>&quot; which is even more complete.

This option may be set either in the frontend or the backend.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20httplog">option httplog</a>&quot;, and <a href="#8">section 8</a> about logging.</div>
<a class="anchor" name="option"></a><a class="anchor" name="4-option"></a><a class="anchor" name="4.2-option"></a><a class="anchor" name="option (Proxies)"></a><a class="anchor" name="option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="option transparent"></a><a class="anchor" name="4-option transparent"></a><a class="anchor" name="4.2-option transparent"></a><a class="anchor" name="option transparent (Proxies)"></a><a class="anchor" name="option transparent (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="option transparent"></a><a href="#4.2-option%20transparent">option transparent</a></b></div><a class="anchor" name="no"></a><a class="anchor" name="4-no"></a><a class="anchor" name="4.2-no"></a><a class="anchor" name="no (Proxies)"></a><a class="anchor" name="no (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option"></a><a class="anchor" name="4-no option"></a><a class="anchor" name="4.2-no option"></a><a class="anchor" name="no option (Proxies)"></a><a class="anchor" name="no option (Alphabetically sorted keywords reference)"></a><a class="anchor" name="no option transparent"></a><a class="anchor" name="4-no option transparent"></a><a class="anchor" name="4.2-no option transparent"></a><a class="anchor" name="no option transparent (Proxies)"></a><a class="anchor" name="no option transparent (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="no option transparent"></a><a href="#4.2-no%20option%20transparent">no option transparent</a></b></div><pre class="text">Enable client-side transparent proxying
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">This option was introduced in order to provide layer 7 persistence to layer 3
load balancers. The idea is to use the OS's ability to redirect an incoming
connection for a remote address to a local process (here HAProxy), and let
this process know what address was initially requested. When this option is
used, sessions without cookies will be forwarded to the original destination
IP address of the incoming request (which should match that of another
equipment), while requests with cookies will still be forwarded to the
appropriate server.

Note that contrary to a common belief, this option does NOT make HAProxy
present the client's IP to the server when establishing the connection.
</pre><div class="page-header"><b>See also:</b> the &quot;usesrc&quot; argument of the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#source%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; keyword, and the &quot;<a href="#option%20transparent">transparent</a>&quot; option of the &quot;<a href="#bind">bind</a>&quot; keyword.</div>
<a class="anchor" name="persist"></a><a class="anchor" name="4-persist"></a><a class="anchor" name="4.2-persist"></a><a class="anchor" name="persist (Proxies)"></a><a class="anchor" name="persist (Alphabetically sorted keywords reference)"></a><a class="anchor" name="persist rdp-cookie"></a><a class="anchor" name="4-persist rdp-cookie"></a><a class="anchor" name="4.2-persist rdp-cookie"></a><a class="anchor" name="persist rdp-cookie (Proxies)"></a><a class="anchor" name="persist rdp-cookie (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="persist rdp-cookie"></a><a href="#4.2-persist%20rdp-cookie">persist rdp-cookie</a></b></div><a class="anchor" name="persist"></a><a class="anchor" name="4-persist"></a><a class="anchor" name="4.2-persist"></a><a class="anchor" name="persist (Proxies)"></a><a class="anchor" name="persist (Alphabetically sorted keywords reference)"></a><a class="anchor" name="persist rdp-cookie"></a><a class="anchor" name="4-persist rdp-cookie"></a><a class="anchor" name="4.2-persist rdp-cookie"></a><a class="anchor" name="persist rdp-cookie (Proxies)"></a><a class="anchor" name="persist rdp-cookie (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="persist rdp-cookie"></a><a href="#4.2-persist%20rdp-cookie">persist rdp-cookie</a></b>(<span style="color: #080">&lt;name&gt;</span>)</div><pre class="text">Enable RDP cookie-based persistence
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;name&gt;    is the optional name of the RDP cookie to check. If omitted, the
          default cookie name &quot;msts&quot; will be used. There currently is no
          valid reason to change this name.</pre>
</div>
<pre class="text">This statement enables persistence based on an RDP cookie. The RDP cookie
contains all information required to find the server in the list of known
servers. So when this option is set in the backend, the request is analysed
and if an RDP cookie is found, it is decoded. If it matches a known server
which is still UP (or if &quot;<a href="#option%20persist">option persist</a>&quot; is set), then the connection is
forwarded to this server.

Note that this only makes sense in a TCP backend, but for this to work, the
frontend must have waited long enough to ensure that an RDP cookie is present
in the request buffer. This is the same requirement as with the &quot;rdp-cookie&quot;
load-balancing method. Thus it is highly recommended to put all statements in
a single &quot;listen&quot; section.

Also, it is important to understand that the terminal server will emit this
RDP cookie only if it is configured for &quot;token redirection mode&quot;, which means
that the &quot;IP address redirection&quot; option is disabled.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>listen tse-farm
    bind :3389
    <span class="comment"># wait up to 5s for an RDP cookie in the request</span>
    tcp-request inspect-delay 5s
    tcp-request content accept if RDP_COOKIE
    <span class="comment"># apply RDP cookie persistence</span>
    persist rdp-cookie
    <span class="comment"># if server is unknown, let's balance on the same cookie.</span>
    <span class="comment"># alternatively, &quot;balance leastconn&quot; may be useful too.</span>
    balance rdp-cookie
    server srv1 1.1.1.1:3389
    server srv2 1.1.1.2:3389
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;balance rdp-cookie&quot;, &quot;<a href="#tcp-request">tcp-request</a>&quot;, the &quot;req_rdp_cookie&quot; ACL and the rdp_cookie pattern fetch function.</div>
<a class="anchor" name="rate-limit"></a><a class="anchor" name="4-rate-limit"></a><a class="anchor" name="4.2-rate-limit"></a><a class="anchor" name="rate-limit (Proxies)"></a><a class="anchor" name="rate-limit (Alphabetically sorted keywords reference)"></a><a class="anchor" name="rate-limit sessions"></a><a class="anchor" name="4-rate-limit sessions"></a><a class="anchor" name="4.2-rate-limit sessions"></a><a class="anchor" name="rate-limit sessions (Proxies)"></a><a class="anchor" name="rate-limit sessions (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="rate-limit sessions"></a><a href="#4.2-rate-limit%20sessions">rate-limit sessions</a></b> <span style="color: #080">&lt;rate&gt;</span></div><pre class="text">Set a limit on the number of new sessions accepted per second on a frontend
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;rate&gt;    The &lt;rate&gt; parameter is an integer designating the maximum number
          of new sessions per second to accept on the frontend.</pre>
</div>
<pre class="text">When the frontend reaches the specified number of new sessions per second, it
stops accepting new connections until the rate drops below the limit again.
During this time, the pending sessions will be kept in the socket's backlog
(in system buffers) and haproxy will not even be aware that sessions are
pending. When applying very low limit on a highly loaded service, it may make
sense to increase the socket's backlog using the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">backlog<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#backlog%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#backlog%20%28Bind%20options%29">Bind options</a></li></ul></span>&quot; keyword.

This feature is particularly efficient at blocking connection-based attacks
or service abuse on fragile servers. Since the session rate is measured every
millisecond, it is extremely accurate. Also, the limit applies immediately,
no delay is needed at all to detect the threshold.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<div class="example-desc">Limit the connection rate on SMTP to 10 per second max</div><code>listen smtp
    mode tcp
    bind :25
    rate-limit sessions 10
    server 127.0.0.1:1025
</code></pre>
</div><pre class="text">Note : when the maximum rate is reached, the frontend's status is not changed
       but its sockets appear as &quot;WAITING&quot; in the statistics if the
       &quot;<a href="#option%20socket-stats">socket-stats</a>&quot; option is enabled.
</pre><div class="page-header"><b>See also :</b> the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">backlog<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#backlog%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#backlog%20%28Bind%20options%29">Bind options</a></li></ul></span>&quot; keyword and the &quot;<a href="#fe_sess_rate">fe_sess_rate</a>&quot; ACL criterion.</div>
<a class="anchor" name="redirect"></a><a class="anchor" name="4-redirect"></a><a class="anchor" name="4.2-redirect"></a><a class="anchor" name="redirect (Proxies)"></a><a class="anchor" name="redirect (Alphabetically sorted keywords reference)"></a><a class="anchor" name="redirect location"></a><a class="anchor" name="4-redirect location"></a><a class="anchor" name="4.2-redirect location"></a><a class="anchor" name="redirect location (Proxies)"></a><a class="anchor" name="redirect location (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="redirect location"></a><a href="#4.2-redirect%20location">redirect location</a></b> <span style="color: #080">&lt;loc&gt;</span> <span style="color: #008">[code <span style="color: #080">&lt;code&gt;</span>]</span> <span style="color: #080">&lt;option&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;condition&gt;</span>]</span></div><a class="anchor" name="redirect"></a><a class="anchor" name="4-redirect"></a><a class="anchor" name="4.2-redirect"></a><a class="anchor" name="redirect (Proxies)"></a><a class="anchor" name="redirect (Alphabetically sorted keywords reference)"></a><a class="anchor" name="redirect prefix"></a><a class="anchor" name="4-redirect prefix"></a><a class="anchor" name="4.2-redirect prefix"></a><a class="anchor" name="redirect prefix (Proxies)"></a><a class="anchor" name="redirect prefix (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="redirect prefix"></a><a href="#4.2-redirect%20prefix">redirect prefix</a></b>   <span style="color: #080">&lt;pfx&gt;</span> <span style="color: #008">[code <span style="color: #080">&lt;code&gt;</span>]</span> <span style="color: #080">&lt;option&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;condition&gt;</span>]</span></div><a class="anchor" name="redirect"></a><a class="anchor" name="4-redirect"></a><a class="anchor" name="4.2-redirect"></a><a class="anchor" name="redirect (Proxies)"></a><a class="anchor" name="redirect (Alphabetically sorted keywords reference)"></a><a class="anchor" name="redirect scheme"></a><a class="anchor" name="4-redirect scheme"></a><a class="anchor" name="4.2-redirect scheme"></a><a class="anchor" name="redirect scheme (Proxies)"></a><a class="anchor" name="redirect scheme (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="redirect scheme"></a><a href="#4.2-redirect%20scheme">redirect scheme</a></b>   <span style="color: #080">&lt;sch&gt;</span> <span style="color: #008">[code <span style="color: #080">&lt;code&gt;</span>]</span> <span style="color: #080">&lt;option&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;condition&gt;</span>]</span></div><pre class="text">Return an HTTP redirection if/unless a condition is matched
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">If/unless the condition is matched, the HTTP request will lead to a redirect
response. If no condition is specified, the redirect applies unconditionally.
</pre><div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;loc&gt;     With &quot;<a href="#redirect%20location">redirect location</a>&quot;, the exact value in &lt;loc&gt; is placed into
          the HTTP &quot;Location&quot; header. When used in an &quot;<a href="#http-request">http-request</a>&quot; rule,
          &lt;loc&gt; value follows the log-format rules and can include some
          dynamic values (see Custom Log Format in <a href="#8.2.4">section 8.2.4</a>).

&lt;pfx&gt;     With &quot;<a href="#redirect%20prefix">redirect prefix</a>&quot;, the &quot;Location&quot; header is built from the
          concatenation of &lt;pfx&gt; and the complete URI path, including the
          query string, unless the &quot;drop-query&quot; option is specified (see
          below). As a special case, if &lt;pfx&gt; equals exactly &quot;/&quot;, then
          nothing is inserted before the original URI. It allows one to
          redirect to the same URL (for instance, to insert a cookie). When
          used in an &quot;<a href="#http-request">http-request</a>&quot; rule, &lt;pfx&gt; value follows the log-format
          rules and can include some dynamic values (see Custom Log Format
          in <a href="#8.2.4">section 8.2.4</a>).

&lt;sch&gt;     With &quot;<a href="#redirect%20scheme">redirect scheme</a>&quot;, then the &quot;Location&quot; header is built by
          concatenating &lt;sch&gt; with &quot;://&quot; then the first occurrence of the
          &quot;Host&quot; header, and then the URI path, including the query string
          unless the &quot;drop-query&quot; option is specified (see below). If no
          path is found or if the path is &quot;*&quot;, then &quot;/&quot; is used instead. If
          no &quot;Host&quot; header is found, then an empty host component will be
          returned, which most recent browsers interpret as redirecting to
          the same host. This directive is mostly used to redirect HTTP to
          HTTPS. When used in an &quot;<a href="#http-request">http-request</a>&quot; rule, &lt;sch&gt; value follows
          the log-format rules and can include some dynamic values (see
          Custom Log Format in <a href="#8.2.4">section 8.2.4</a>).

&lt;code&gt;    The code is optional. It indicates which type of HTTP redirection
          is desired. Only codes 301, 302, 303, 307 and 308 are supported,
          with 302 used by default if no code is specified. 301 means
          &quot;Moved permanently&quot;, and a browser may cache the Location. 302
          means &quot;Moved permanently&quot; and means that the browser should not
          cache the redirection. 303 is equivalent to 302 except that the
          browser will fetch the location with a GET method. 307 is just
          like 302 but makes it clear that the same method must be reused.
          Likewise, 308 replaces 301 if the same method must be used.

&lt;option&gt;  There are several options which can be specified to adjust the
          expected behaviour of a redirection :

  - &quot;drop-query&quot;
    When this keyword is used in a prefix-based redirection, then the
    location will be set without any possible query-string, which is useful
    for directing users to a non-secure page for instance. It has no effect
    with a location-type redirect.

  - &quot;append-slash&quot;
    This keyword may be used in conjunction with &quot;drop-query&quot; to redirect
    users who use a URL not ending with a '/' to the same one with the '/'.
    It can be useful to ensure that search engines will only see one URL.
    For this, a return code 301 is preferred.

  - &quot;set-cookie NAME[=value]&quot;
    A &quot;Set-Cookie&quot; header will be added with NAME (and optionally &quot;=value&quot;)
    to the response. This is sometimes used to indicate that a user has
    been seen, for instance to protect against some types of DoS. No other
    cookie option is added, so the cookie will be a session cookie. Note
    that for a browser, a sole cookie name without an equal sign is
    different from a cookie with an equal sign.

  - &quot;clear-cookie NAME[=]&quot;
    A &quot;Set-Cookie&quot; header will be added with NAME (and optionally &quot;=&quot;), but
    with the &quot;Max-Age&quot; attribute set to zero. This will tell the browser to
    delete this cookie. It is useful for instance on logout pages. It is
    important to note that clearing the cookie &quot;NAME&quot; will not remove a
    cookie set with &quot;NAME=value&quot;. You have to clear the cookie &quot;NAME=&quot; for
    that, because the browser makes the difference.</pre>
</div>
<div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<div class="example-desc">Move the login URL only to HTTPS.</div><code>acl clear      dst_port  80
acl secure     dst_port  8080
acl login_page url_beg   /login
acl logout     url_beg   /logout
acl uid_given  url_reg   /login?userid=[^&amp;]+
acl cookie_set hdr_sub(cookie) SEEN=1

redirect prefix   https://mysite.com set-cookie SEEN=1 if !cookie_set
redirect prefix   https://mysite.com           if login_page !secure
redirect prefix   http://mysite.com drop-query if login_page !uid_given
redirect location http://mysite.com/           if !login_page secure
redirect location / clear-cookie USERID=       if logout
</code></pre>
</div><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<div class="example-desc">Send redirects for request for articles without a '/'.</div><code>acl missing_slash path_reg ^/article/[^/]*$
redirect code 301 prefix / drop-query append-slash if missing_slash
</code></pre>
</div><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<div class="example-desc">Redirect all HTTP traffic to HTTPS when SSL is handled by haproxy.</div><code>redirect scheme https if !{ ssl_fc }
</code></pre>
</div><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<div class="example-desc">Append 'www.' prefix in front of all hosts not having it</div><code>http-request redirect code 301 location www.%[hdr(host)]%[req.uri] \
  unless { hdr_beg(host) -i www }
</code></pre>
</div><pre class="text">See <a href="#7">section 7</a> about ACL usage.
</pre><a class="anchor" name="redisp"></a><a class="anchor" name="4-redisp"></a><a class="anchor" name="4.2-redisp"></a><a class="anchor" name="redisp (Proxies)"></a><a class="anchor" name="redisp (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="redisp"></a><a href="#4.2-redisp">redisp</a></b> <span class="label label-warning">(deprecated)</span></div><a class="anchor" name="redispatch"></a><a class="anchor" name="4-redispatch"></a><a class="anchor" name="4.2-redispatch"></a><a class="anchor" name="redispatch (Proxies)"></a><a class="anchor" name="redispatch (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="redispatch"></a><a href="#4.2-redispatch">redispatch</a></b> <span class="label label-warning">(deprecated)</span></div><pre class="text">Enable or disable session redistribution in case of connection failure
</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">In HTTP mode, if a server designated by a cookie is down, clients may
definitely stick to it because they cannot flush the cookie, so they will not
be able to access the service anymore.

Specifying &quot;<a href="#option%20redispatch">redispatch</a>&quot; will allow the proxy to break their persistence and
redistribute them to a working server.

It also allows to retry last connection to another server in case of multiple
connection failures. Of course, it requires having &quot;<a href="#retries">retries</a>&quot; set to a nonzero
value.

This form is deprecated, do not use it in any new configuration, use the new
&quot;<a href="#option%20redispatch">option redispatch</a>&quot; instead.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20redispatch">option redispatch</a>&quot;</div>
<a class="anchor" name="reqadd"></a><a class="anchor" name="4-reqadd"></a><a class="anchor" name="4.2-reqadd"></a><a class="anchor" name="reqadd (Proxies)"></a><a class="anchor" name="reqadd (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqadd"></a><a href="#4.2-reqadd">reqadd</a></b>  <span style="color: #080">&lt;string&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><pre class="text">Add a header at the end of the HTTP request
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;string&gt;  is the complete line to be added. Any space or known delimiter
          must be escaped using a backslash ('\'). Please refer to section
          6 about HTTP header manipulation for more information.

&lt;cond&gt;    is an optional matching condition built from ACLs. It makes it
          possible to ignore this rule when other conditions are not met.</pre>
</div>
<pre class="text">A new line consisting in &lt;string&gt; followed by a line feed will be added after
the last header of an HTTP request.

Header transformations only apply to traffic which passes through HAProxy,
and not to traffic generated by HAProxy, such as health-checks or error
responses.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<div class="example-desc">Add &quot;X-Proto: SSL&quot; to requests coming via port 81</div><code>acl is-ssl  dst_port       81
reqadd      X-Proto:\ SSL  if is-ssl
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#rspadd">rspadd</a>&quot;, <a href="#6">section 6</a> about HTTP header manipulation, and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="reqallow"></a><a class="anchor" name="4-reqallow"></a><a class="anchor" name="4.2-reqallow"></a><a class="anchor" name="reqallow (Proxies)"></a><a class="anchor" name="reqallow (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqallow"></a><a href="#4.2-reqallow">reqallow</a></b>  <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><a class="anchor" name="reqiallow"></a><a class="anchor" name="4-reqiallow"></a><a class="anchor" name="4.2-reqiallow"></a><a class="anchor" name="reqiallow (Proxies)"></a><a class="anchor" name="reqiallow (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqiallow"></a><a href="#4.2-reqiallow">reqiallow</a></b> <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span> (ignore case)</div><pre class="text">Definitely allow an HTTP request if a line matches a regular expression
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;search&gt;  is the regular expression applied to HTTP headers and to the
          request line. This is an extended regular expression. Parenthesis
          grouping is supported and no preliminary backslash is required.
          Any space or known delimiter must be escaped using a backslash
          ('\'). The pattern applies to a full line at a time. The
          &quot;<a href="#reqallow">reqallow</a>&quot; keyword strictly matches case while &quot;<a href="#reqiallow">reqiallow</a>&quot;
          ignores case.

&lt;cond&gt;    is an optional matching condition built from ACLs. It makes it
          possible to ignore this rule when other conditions are not met.</pre>
</div>
<pre class="text">A request containing any line which matches extended regular expression
&lt;search&gt; will mark the request as allowed, even if any later test would
result in a deny. The test applies both to the request line and to request
headers. Keep in mind that URLs in request line are case-sensitive while
header names are not.

It is easier, faster and more powerful to use ACLs to write access policies.
Reqdeny, reqallow and reqpass should be avoided in new designs.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># allow www.* but refuse *.local</span>
reqiallow ^Host:\ www\.
reqideny  ^Host:\ .*\.local
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#reqdeny">reqdeny</a>&quot;, &quot;<a href="#block">block</a>&quot;, <a href="#6">section 6</a> about HTTP header manipulation, and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="reqdel"></a><a class="anchor" name="4-reqdel"></a><a class="anchor" name="4.2-reqdel"></a><a class="anchor" name="reqdel (Proxies)"></a><a class="anchor" name="reqdel (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqdel"></a><a href="#4.2-reqdel">reqdel</a></b>  <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><a class="anchor" name="reqidel"></a><a class="anchor" name="4-reqidel"></a><a class="anchor" name="4.2-reqidel"></a><a class="anchor" name="reqidel (Proxies)"></a><a class="anchor" name="reqidel (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqidel"></a><a href="#4.2-reqidel">reqidel</a></b> <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span>  (ignore case)</div><pre class="text">Delete all headers matching a regular expression in an HTTP request
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;search&gt;  is the regular expression applied to HTTP headers and to the
          request line. This is an extended regular expression. Parenthesis
          grouping is supported and no preliminary backslash is required.
          Any space or known delimiter must be escaped using a backslash
          ('\'). The pattern applies to a full line at a time. The &quot;<a href="#reqdel">reqdel</a>&quot;
          keyword strictly matches case while &quot;<a href="#reqidel">reqidel</a>&quot; ignores case.

&lt;cond&gt;    is an optional matching condition built from ACLs. It makes it
          possible to ignore this rule when other conditions are not met.</pre>
</div>
<pre class="text">Any header line matching extended regular expression &lt;search&gt; in the request
will be completely deleted. Most common use of this is to remove unwanted
and/or dangerous headers or cookies from a request before passing it to the
next servers.

Header transformations only apply to traffic which passes through HAProxy,
and not to traffic generated by HAProxy, such as health-checks or error
responses. Keep in mind that header names are not case-sensitive.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># remove X-Forwarded-For header and SERVER cookie</span>
reqidel ^X-Forwarded-For:.*
reqidel ^Cookie:.*SERVER=
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#reqadd">reqadd</a>&quot;, &quot;<a href="#reqrep">reqrep</a>&quot;, &quot;<a href="#rspdel">rspdel</a>&quot;, <a href="#6">section 6</a> about HTTP header manipulation, and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="reqdeny"></a><a class="anchor" name="4-reqdeny"></a><a class="anchor" name="4.2-reqdeny"></a><a class="anchor" name="reqdeny (Proxies)"></a><a class="anchor" name="reqdeny (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqdeny"></a><a href="#4.2-reqdeny">reqdeny</a></b>  <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><a class="anchor" name="reqideny"></a><a class="anchor" name="4-reqideny"></a><a class="anchor" name="4.2-reqideny"></a><a class="anchor" name="reqideny (Proxies)"></a><a class="anchor" name="reqideny (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqideny"></a><a href="#4.2-reqideny">reqideny</a></b> <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span>  (ignore case)</div><pre class="text">Deny an HTTP request if a line matches a regular expression
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;search&gt;  is the regular expression applied to HTTP headers and to the
          request line. This is an extended regular expression. Parenthesis
          grouping is supported and no preliminary backslash is required.
          Any space or known delimiter must be escaped using a backslash
          ('\'). The pattern applies to a full line at a time. The
          &quot;<a href="#reqdeny">reqdeny</a>&quot; keyword strictly matches case while &quot;<a href="#reqideny">reqideny</a>&quot; ignores
          case.

&lt;cond&gt;    is an optional matching condition built from ACLs. It makes it
          possible to ignore this rule when other conditions are not met.</pre>
</div>
<pre class="text">A request containing any line which matches extended regular expression
&lt;search&gt; will mark the request as denied, even if any later test would
result in an allow. The test applies both to the request line and to request
headers. Keep in mind that URLs in request line are case-sensitive while
header names are not.

A denied request will generate an &quot;HTTP 403 forbidden&quot; response once the
complete request has been parsed. This is consistent with what is practiced
using ACLs.

It is easier, faster and more powerful to use ACLs to write access policies.
Reqdeny, reqallow and reqpass should be avoided in new designs.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># refuse *.local, then allow www.*</span>
reqideny  ^Host:\ .*\.local
reqiallow ^Host:\ www\.
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#reqallow">reqallow</a>&quot;, &quot;<a href="#rspdeny">rspdeny</a>&quot;, &quot;<a href="#block">block</a>&quot;, <a href="#6">section 6</a> about HTTP header manipulation, and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="reqpass"></a><a class="anchor" name="4-reqpass"></a><a class="anchor" name="4.2-reqpass"></a><a class="anchor" name="reqpass (Proxies)"></a><a class="anchor" name="reqpass (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqpass"></a><a href="#4.2-reqpass">reqpass</a></b>  <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><a class="anchor" name="reqipass"></a><a class="anchor" name="4-reqipass"></a><a class="anchor" name="4.2-reqipass"></a><a class="anchor" name="reqipass (Proxies)"></a><a class="anchor" name="reqipass (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqipass"></a><a href="#4.2-reqipass">reqipass</a></b> <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span>  (ignore case)</div><pre class="text">Ignore any HTTP request line matching a regular expression in next rules
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;search&gt;  is the regular expression applied to HTTP headers and to the
          request line. This is an extended regular expression. Parenthesis
          grouping is supported and no preliminary backslash is required.
          Any space or known delimiter must be escaped using a backslash
          ('\'). The pattern applies to a full line at a time. The
          &quot;<a href="#reqpass">reqpass</a>&quot; keyword strictly matches case while &quot;<a href="#reqipass">reqipass</a>&quot; ignores
          case.

&lt;cond&gt;    is an optional matching condition built from ACLs. It makes it
          possible to ignore this rule when other conditions are not met.</pre>
</div>
<pre class="text">A request containing any line which matches extended regular expression
&lt;search&gt; will skip next rules, without assigning any deny or allow verdict.
The test applies both to the request line and to request headers. Keep in
mind that URLs in request line are case-sensitive while header names are not.

It is easier, faster and more powerful to use ACLs to write access policies.
Reqdeny, reqallow and reqpass should be avoided in new designs.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># refuse *.local, then allow www.*, but ignore &quot;www.private.local&quot;</span>
reqipass  ^Host:\ www.private\.local
reqideny  ^Host:\ .*\.local
reqiallow ^Host:\ www\.
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#reqallow">reqallow</a>&quot;, &quot;<a href="#reqdeny">reqdeny</a>&quot;, &quot;<a href="#block">block</a>&quot;, <a href="#6">section 6</a> about HTTP header manipulation, and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="reqrep"></a><a class="anchor" name="4-reqrep"></a><a class="anchor" name="4.2-reqrep"></a><a class="anchor" name="reqrep (Proxies)"></a><a class="anchor" name="reqrep (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqrep"></a><a href="#4.2-reqrep">reqrep</a></b>  <span style="color: #080">&lt;search&gt;</span> <span style="color: #080">&lt;string&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><a class="anchor" name="reqirep"></a><a class="anchor" name="4-reqirep"></a><a class="anchor" name="4.2-reqirep"></a><a class="anchor" name="reqirep (Proxies)"></a><a class="anchor" name="reqirep (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqirep"></a><a href="#4.2-reqirep">reqirep</a></b> <span style="color: #080">&lt;search&gt;</span> <span style="color: #080">&lt;string&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span>   (ignore case)</div><pre class="text">Replace a regular expression with a string in an HTTP request line
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;search&gt;  is the regular expression applied to HTTP headers and to the
          request line. This is an extended regular expression. Parenthesis
          grouping is supported and no preliminary backslash is required.
          Any space or known delimiter must be escaped using a backslash
          ('\'). The pattern applies to a full line at a time. The &quot;<a href="#reqrep">reqrep</a>&quot;
          keyword strictly matches case while &quot;<a href="#reqirep">reqirep</a>&quot; ignores case.

&lt;string&gt;  is the complete line to be added. Any space or known delimiter
          must be escaped using a backslash ('\'). References to matched
          pattern groups are possible using the common \N form, with N
          being a single digit between 0 and 9. Please refer to section
          6 about HTTP header manipulation for more information.

&lt;cond&gt;    is an optional matching condition built from ACLs. It makes it
          possible to ignore this rule when other conditions are not met.</pre>
</div>
<pre class="text">Any line matching extended regular expression &lt;search&gt; in the request (both
the request line and header lines) will be completely replaced with &lt;string&gt;.
Most common use of this is to rewrite URLs or domain names in &quot;Host&quot; headers.

Header transformations only apply to traffic which passes through HAProxy,
and not to traffic generated by HAProxy, such as health-checks or error
responses. Note that for increased readability, it is suggested to add enough
spaces between the request and the response. Keep in mind that URLs in
request line are case-sensitive while header names are not.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># replace &quot;/static/&quot; with &quot;/&quot; at the beginning of any request path.</span>
reqrep ^([^\ :]*)\ /static/(.*)     \1\ /\2
<span class="comment"># replace &quot;www.mydomain.com&quot; with &quot;www&quot; in the host name.</span>
reqirep ^Host:\ www.mydomain.com   Host:\ www
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#reqadd">reqadd</a>&quot;, &quot;<a href="#reqdel">reqdel</a>&quot;, &quot;<a href="#rsprep">rsprep</a>&quot;, &quot;<a href="#tune.bufsize">tune.bufsize</a>&quot;, <a href="#6">section 6</a> about HTTP header manipulation, and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="reqtarpit"></a><a class="anchor" name="4-reqtarpit"></a><a class="anchor" name="4.2-reqtarpit"></a><a class="anchor" name="reqtarpit (Proxies)"></a><a class="anchor" name="reqtarpit (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqtarpit"></a><a href="#4.2-reqtarpit">reqtarpit</a></b>  <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><a class="anchor" name="reqitarpit"></a><a class="anchor" name="4-reqitarpit"></a><a class="anchor" name="4.2-reqitarpit"></a><a class="anchor" name="reqitarpit (Proxies)"></a><a class="anchor" name="reqitarpit (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="reqitarpit"></a><a href="#4.2-reqitarpit">reqitarpit</a></b> <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span>  (ignore case)</div><pre class="text">Tarpit an HTTP request containing a line matching a regular expression
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;search&gt;  is the regular expression applied to HTTP headers and to the
          request line. This is an extended regular expression. Parenthesis
          grouping is supported and no preliminary backslash is required.
          Any space or known delimiter must be escaped using a backslash
          ('\'). The pattern applies to a full line at a time. The
          &quot;<a href="#reqtarpit">reqtarpit</a>&quot; keyword strictly matches case while &quot;<a href="#reqitarpit">reqitarpit</a>&quot;
          ignores case.

&lt;cond&gt;    is an optional matching condition built from ACLs. It makes it
          possible to ignore this rule when other conditions are not met.</pre>
</div>
<pre class="text">A request containing any line which matches extended regular expression
&lt;search&gt; will be tarpitted, which means that it will connect to nowhere, will
be kept open for a pre-defined time, then will return an HTTP error 500 so
that the attacker does not suspect it has been tarpitted. The status 500 will
be reported in the logs, but the completion flags will indicate &quot;PT&quot;. The
delay is defined by &quot;<a href="#timeout%20tarpit">timeout tarpit</a>&quot;, or &quot;<a href="#timeout%20connect">timeout connect</a>&quot; if the former is
not set.

The goal of the tarpit is to slow down robots attacking servers with
identifiable requests. Many robots limit their outgoing number of connections
and stay connected waiting for a reply which can take several minutes to
come. Depending on the environment and attack, it may be particularly
efficient at reducing the load on the network and firewalls.
</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code><span class="comment"># ignore user-agents reporting any flavour of &quot;Mozilla&quot; or &quot;MSIE&quot;, but</span>
<span class="comment"># block all others.</span>
reqipass   ^User-Agent:\.*(Mozilla|MSIE)
reqitarpit ^User-Agent:

<span class="comment"># block bad guys</span>
acl badguys src 10.1.0.3 172.16.13.20/28
reqitarpit . if badguys
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#reqallow">reqallow</a>&quot;, &quot;<a href="#reqdeny">reqdeny</a>&quot;, &quot;<a href="#reqpass">reqpass</a>&quot;, <a href="#6">section 6</a> about HTTP header manipulation, and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="retries"></a><a class="anchor" name="4-retries"></a><a class="anchor" name="4.2-retries"></a><a class="anchor" name="retries (Proxies)"></a><a class="anchor" name="retries (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="retries"></a><a href="#4.2-retries">retries</a></b> <span style="color: #080">&lt;value&gt;</span></div><pre class="text">Set the number of retries to perform on a server after a connection failure
</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;value&gt;   is the number of times a connection attempt should be retried on
          a server when a connection either is refused or times out. The
          default value is 3.</pre>
</div>
<pre class="text">It is important to understand that this value applies to the number of
connection attempts, not full requests. When a connection has effectively
been established to a server, there will be no more retry.

In order to avoid immediate reconnections to a server which is restarting,
a turn-around timer of 1 second is applied before a retry occurs.

When &quot;<a href="#option%20redispatch">option redispatch</a>&quot; is set, the last retry may be performed on another
server even if a cookie references a different server.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#option%20redispatch">option redispatch</a>&quot;</div>
<a class="anchor" name="rspadd"></a><a class="anchor" name="4-rspadd"></a><a class="anchor" name="4.2-rspadd"></a><a class="anchor" name="rspadd (Proxies)"></a><a class="anchor" name="rspadd (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="rspadd"></a><a href="#4.2-rspadd">rspadd</a></b> <span style="color: #080">&lt;string&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><pre class="text">Add a header at the end of the HTTP response
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;string&gt;  is the complete line to be added. Any space or known delimiter
          must be escaped using a backslash ('\'). Please refer to section
          6 about HTTP header manipulation for more information.

&lt;cond&gt;    is an optional matching condition built from ACLs. It makes it
          possible to ignore this rule when other conditions are not met.</pre>
</div>
<pre class="text">A new line consisting in &lt;string&gt; followed by a line feed will be added after
the last header of an HTTP response.

Header transformations only apply to traffic which passes through HAProxy,
and not to traffic generated by HAProxy, such as health-checks or error
responses.
</pre><div class="page-header"><b>See also:</b> &quot;<a href="#reqadd">reqadd</a>&quot;, <a href="#6">section 6</a> about HTTP header manipulation, and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="rspdel"></a><a class="anchor" name="4-rspdel"></a><a class="anchor" name="4.2-rspdel"></a><a class="anchor" name="rspdel (Proxies)"></a><a class="anchor" name="rspdel (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="rspdel"></a><a href="#4.2-rspdel">rspdel</a></b>  <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><a class="anchor" name="rspidel"></a><a class="anchor" name="4-rspidel"></a><a class="anchor" name="4.2-rspidel"></a><a class="anchor" name="rspidel (Proxies)"></a><a class="anchor" name="rspidel (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="rspidel"></a><a href="#4.2-rspidel">rspidel</a></b> <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span>  (ignore case)</div><pre class="text">Delete all headers matching a regular expression in an HTTP response
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;search&gt;  is the regular expression applied to HTTP headers and to the
          response line. This is an extended regular expression, so
          parenthesis grouping is supported and no preliminary backslash
          is required. Any space or known delimiter must be escaped using
          a backslash ('\'). The pattern applies to a full line at a time.
          The &quot;<a href="#rspdel">rspdel</a>&quot; keyword strictly matches case while &quot;<a href="#rspidel">rspidel</a>&quot;
          ignores case.

&lt;cond&gt;    is an optional matching condition built from ACLs. It makes it
          possible to ignore this rule when other conditions are not met.</pre>
</div>
<pre class="text">Any header line matching extended regular expression &lt;search&gt; in the response
will be completely deleted. Most common use of this is to remove unwanted
and/or sensitive headers or cookies from a response before passing it to the
client.

Header transformations only apply to traffic which passes through HAProxy,
and not to traffic generated by HAProxy, such as health-checks or error
responses. Keep in mind that header names are not case-sensitive.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># remove the Server header from responses</span>
rspidel ^Server:.*
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#rspadd">rspadd</a>&quot;, &quot;<a href="#rsprep">rsprep</a>&quot;, &quot;<a href="#reqdel">reqdel</a>&quot;, <a href="#6">section 6</a> about HTTP header manipulation, and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="rspdeny"></a><a class="anchor" name="4-rspdeny"></a><a class="anchor" name="4.2-rspdeny"></a><a class="anchor" name="rspdeny (Proxies)"></a><a class="anchor" name="rspdeny (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="rspdeny"></a><a href="#4.2-rspdeny">rspdeny</a></b>  <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><a class="anchor" name="rspideny"></a><a class="anchor" name="4-rspideny"></a><a class="anchor" name="4.2-rspideny"></a><a class="anchor" name="rspideny (Proxies)"></a><a class="anchor" name="rspideny (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="rspideny"></a><a href="#4.2-rspideny">rspideny</a></b> <span style="color: #080">&lt;search&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span>  (ignore case)</div><pre class="text">Block an HTTP response if a line matches a regular expression
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;search&gt;  is the regular expression applied to HTTP headers and to the
          response line. This is an extended regular expression, so
          parenthesis grouping is supported and no preliminary backslash
          is required. Any space or known delimiter must be escaped using
          a backslash ('\'). The pattern applies to a full line at a time.
          The &quot;<a href="#rspdeny">rspdeny</a>&quot; keyword strictly matches case while &quot;<a href="#rspideny">rspideny</a>&quot;
          ignores case.

&lt;cond&gt;    is an optional matching condition built from ACLs. It makes it
          possible to ignore this rule when other conditions are not met.</pre>
</div>
<pre class="text">A response containing any line which matches extended regular expression
&lt;search&gt; will mark the request as denied. The test applies both to the
response line and to response headers. Keep in mind that header names are not
case-sensitive.

Main use of this keyword is to prevent sensitive information leak and to
block the response before it reaches the client. If a response is denied, it
will be replaced with an HTTP 502 error so that the client never retrieves
any sensitive data.

It is easier, faster and more powerful to use ACLs to write access policies.
Rspdeny should be avoided in new designs.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># Ensure that no content type matching ms-word will leak</span>
rspideny  ^Content-type:\.*/ms-word
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#reqdeny">reqdeny</a>&quot;, &quot;<a href="#acl">acl</a>&quot;, &quot;<a href="#block">block</a>&quot;, <a href="#6">section 6</a> about HTTP header manipulation and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="rsprep"></a><a class="anchor" name="4-rsprep"></a><a class="anchor" name="4.2-rsprep"></a><a class="anchor" name="rsprep (Proxies)"></a><a class="anchor" name="rsprep (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="rsprep"></a><a href="#4.2-rsprep">rsprep</a></b>  <span style="color: #080">&lt;search&gt;</span> <span style="color: #080">&lt;string&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><a class="anchor" name="rspirep"></a><a class="anchor" name="4-rspirep"></a><a class="anchor" name="4.2-rspirep"></a><a class="anchor" name="rspirep (Proxies)"></a><a class="anchor" name="rspirep (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="rspirep"></a><a href="#4.2-rspirep">rspirep</a></b> <span style="color: #080">&lt;search&gt;</span> <span style="color: #080">&lt;string&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span>  (ignore case)</div><pre class="text">Replace a regular expression with a string in an HTTP response line
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;search&gt;  is the regular expression applied to HTTP headers and to the
          response line. This is an extended regular expression, so
          parenthesis grouping is supported and no preliminary backslash
          is required. Any space or known delimiter must be escaped using
          a backslash ('\'). The pattern applies to a full line at a time.
          The &quot;<a href="#rsprep">rsprep</a>&quot; keyword strictly matches case while &quot;<a href="#rspirep">rspirep</a>&quot;
          ignores case.

&lt;string&gt;  is the complete line to be added. Any space or known delimiter
          must be escaped using a backslash ('\'). References to matched
          pattern groups are possible using the common \N form, with N
          being a single digit between 0 and 9. Please refer to section
          6 about HTTP header manipulation for more information.

&lt;cond&gt;    is an optional matching condition built from ACLs. It makes it
          possible to ignore this rule when other conditions are not met.</pre>
</div>
<pre class="text">Any line matching extended regular expression &lt;search&gt; in the response (both
the response line and header lines) will be completely replaced with
&lt;string&gt;. Most common use of this is to rewrite Location headers.

Header transformations only apply to traffic which passes through HAProxy,
and not to traffic generated by HAProxy, such as health-checks or error
responses. Note that for increased readability, it is suggested to add enough
spaces between the request and the response. Keep in mind that header names
are not case-sensitive.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># replace &quot;Location: 127.0.0.1:8080&quot; with &quot;Location: www.mydomain.com&quot;</span>
rspirep ^Location:\ 127.0.0.1:8080    Location:\ www.mydomain.com
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#rspadd">rspadd</a>&quot;, &quot;<a href="#rspdel">rspdel</a>&quot;, &quot;<a href="#reqrep">reqrep</a>&quot;, <a href="#6">section 6</a> about HTTP header manipulation, and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="server"></a><a class="anchor" name="4-server"></a><a class="anchor" name="4.2-server"></a><a class="anchor" name="server (Proxies)"></a><a class="anchor" name="server (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="server"></a><a href="#4.2-server">server</a></b> <span style="color: #080">&lt;name&gt;</span> <span style="color: #080">&lt;address&gt;</span><span style="color: #008">[:<span style="color: #008">[port]</span>]</span> <span style="color: #008">[param*]</span></div><pre class="text">Declare a server in a backend
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;name&gt;    is the internal name assigned to this server. This name will
          appear in logs and alerts.  If &quot;<a href="#http-send-name-header">http-send-name-header</a>&quot; is
          set, it will be added to the request header sent to the server.

&lt;address&gt; is the IPv4 or IPv6 address of the server. Alternatively, a
          resolvable hostname is supported, but this name will be resolved
          during start-up. Address &quot;0.0.0.0&quot; or &quot;*&quot; has a special meaning.
          It indicates that the connection will be forwarded to the same IP
          address as the one from the client connection. This is useful in
          transparent proxy architectures where the client's connection is
          intercepted and haproxy must forward to the original destination
          address. This is more or less what the &quot;<a href="#option%20transparent">transparent</a>&quot; keyword does
          except that with a server it's possible to limit concurrency and
          to report statistics. Optionally, an address family prefix may be
          used before the address to force the family regardless of the
          address format, which can be useful to specify a path to a unix
          socket with no slash ('/'). Currently supported prefixes are :
                - 'ipv4@'  -&gt; address is always IPv4
                - 'ipv6@'  -&gt; address is always IPv6
                - 'unix@'  -&gt; address is a path to a local unix socket
                - 'abns@'  -&gt; address is in abstract namespace (Linux only)
          Any part of the address string may reference any number of
          environment variables by preceding their name with a dollar
          sign ('$') and optionally enclosing them with braces ('{}'),
          similarly to what is done in Bourne shell.

&lt;port&gt;    is an optional port specification. If set, all connections will
          be sent to this port. If unset, the same port the client
          connected to will be used. The port may also be prefixed by a &quot;+&quot;
          or a &quot;-&quot;. In this case, the server's port will be determined by
          adding this value to the client's port.

&lt;param*&gt;  is a list of parameters for this server. The &quot;<a href="#server">server</a>&quot; keywords
          accepts an important number of options and has a complete section
          dedicated to it. Please refer to <a href="#5">section 5</a> for more details.</pre>
</div>
<div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code>server first  10.1.1.1:1080 cookie first  check inter 1000
server second 10.1.1.2:1080 cookie second check inter 1000
server transp ipv4@
server backup ${SRV_BACKUP}:1080 backup
server www1_dc1 ${LAN_DC1}.101:80
server www1_dc2 ${LAN_DC2}.101:80
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#default-server">default-server</a>&quot;, &quot;<a href="#http-send-name-header">http-send-name-header</a>&quot; and <a href="#5">section 5</a> about server options</div>
<a class="anchor" name="source"></a><a class="anchor" name="4-source"></a><a class="anchor" name="4.2-source"></a><a class="anchor" name="source (Proxies)"></a><a class="anchor" name="source (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="source"></a><a href="#4.2-source">source</a></b> <span style="color: #080">&lt;addr&gt;</span><span style="color: #008">[:<span style="color: #080">&lt;port&gt;</span>]</span> <span style="color: #008">[usesrc <span style="color: #800">{ <span style="color: #080">&lt;addr2&gt;</span><span style="color: #008">[:<span style="color: #080">&lt;port2&gt;</span>]</span> | client | clientip }</span> ]</span></div><a class="anchor" name="source"></a><a class="anchor" name="4-source"></a><a class="anchor" name="4.2-source"></a><a class="anchor" name="source (Proxies)"></a><a class="anchor" name="source (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="source"></a><a href="#4.2-source">source</a></b> <span style="color: #080">&lt;addr&gt;</span><span style="color: #008">[:<span style="color: #080">&lt;port&gt;</span>]</span> <span style="color: #008">[usesrc <span style="color: #800">{ <span style="color: #080">&lt;addr2&gt;</span><span style="color: #008">[:<span style="color: #080">&lt;port2&gt;</span>]</span> | hdr_ip(<span style="color: #080">&lt;hdr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;occ&gt;</span>]</span>) }</span> ]</span></div><a class="anchor" name="source"></a><a class="anchor" name="4-source"></a><a class="anchor" name="4.2-source"></a><a class="anchor" name="source (Proxies)"></a><a class="anchor" name="source (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="source"></a><a href="#4.2-source">source</a></b> <span style="color: #080">&lt;addr&gt;</span><span style="color: #008">[:<span style="color: #080">&lt;port&gt;</span>]</span> <span style="color: #008">[interface <span style="color: #080">&lt;name&gt;</span>]</span></div><pre class="text">Set the source address for outgoing connections
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;addr&gt;    is the IPv4 address HAProxy will bind to before connecting to a
          server. This address is also used as a source for health checks.

          The default value of 0.0.0.0 means that the system will select
          the most appropriate address to reach its destination. Optionally
          an address family prefix may be used before the address to force
          the family regardless of the address format, which can be useful
          to specify a path to a unix socket with no slash ('/'). Currently
          supported prefixes are :
            - 'ipv4@' -&gt; address is always IPv4
            - 'ipv6@' -&gt; address is always IPv6
            - 'unix@' -&gt; address is a path to a local unix socket
            - 'abns@' -&gt; address is in abstract namespace (Linux only)
          Any part of the address string may reference any number of
          environment variables by preceding their name with a dollar
          sign ('$') and optionally enclosing them with braces ('{}'),
          similarly to what is done in Bourne shell.

&lt;port&gt;    is an optional port. It is normally not needed but may be useful
          in some very specific contexts. The default value of zero means
          the system will select a free port. Note that port ranges are not
          supported in the backend. If you want to force port ranges, you
          have to specify them on each &quot;<a href="#server">server</a>&quot; line.

&lt;addr2&gt;   is the IP address to present to the server when connections are
          forwarded in full transparent proxy mode. This is currently only
          supported on some patched Linux kernels. When this address is
          specified, clients connecting to the server will be presented
          with this address, while health checks will still use the address
          &lt;addr&gt;.

&lt;port2&gt;   is the optional port to present to the server when connections
          are forwarded in full transparent proxy mode (see &lt;addr2&gt; above).
          The default value of zero means the system will select a free
          port.

&lt;hdr&gt;     is the name of a HTTP header in which to fetch the IP to bind to.
          This is the name of a comma-separated header list which can
          contain multiple IP addresses. By default, the last occurrence is
          used. This is designed to work with the X-Forwarded-For header
          and to automatically bind to the client's IP address as seen
          by previous proxy, typically Stunnel. In order to use another
          occurrence from the last one, please see the &lt;occ&gt; parameter
          below. When the header (or occurrence) is not found, no binding
          is performed so that the proxy's default IP address is used. Also
          keep in mind that the header name is case insensitive, as for any
          HTTP header.

&lt;occ&gt;     is the occurrence number of a value to be used in a multi-value
          header. This is to be used in conjunction with &quot;hdr_ip(&lt;hdr&gt;)&quot;,
          in order to specify which occurrence to use for the source IP
          address. Positive values indicate a position from the first
          occurrence, 1 being the first one. Negative values indicate
          positions relative to the last one, -1 being the last one. This
          is helpful for situations where an X-Forwarded-For header is set
          at the entry point of an infrastructure and must be used several
          proxy layers away. When this value is not specified, -1 is
          assumed. Passing a zero here disables the feature.

&lt;name&gt;    is an optional interface name to which to bind to for outgoing
          traffic. On systems supporting this features (currently, only
          Linux), this allows one to bind all traffic to the server to
          this interface even if it is not the one the system would select
          based on routing tables. This should be used with extreme care.
          Note that using this option requires root privileges.</pre>
</div>
<pre class="text">The &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#source%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; keyword is useful in complex environments where a specific
address only is allowed to connect to the servers. It may be needed when a
private address must be used through a public gateway for instance, and it is
known that the system cannot determine the adequate source address by itself.

An extension which is available on certain patched Linux kernels may be used
through the &quot;usesrc&quot; optional keyword. It makes it possible to connect to the
servers with an IP address which does not belong to the system itself. This
is called &quot;full transparent proxy mode&quot;. For this to work, the destination
servers have to route their traffic back to this address through the machine
running HAProxy, and IP forwarding must generally be enabled on this machine.

In this &quot;full transparent proxy&quot; mode, it is possible to force a specific IP
address to be presented to the servers. This is not much used in fact. A more
common use is to tell HAProxy to present the client's IP address. For this,
there are two methods :

  - present the client's IP and port addresses. This is the most transparent
    mode, but it can cause problems when IP connection tracking is enabled on
    the machine, because a same connection may be seen twice with different
    states. However, this solution presents the huge advantage of not
    limiting the system to the 64k outgoing address+port couples, because all
    of the client ranges may be used.

  - present only the client's IP address and select a spare port. This
    solution is still quite elegant but slightly less transparent (downstream
    firewalls logs will not match upstream's). It also presents the downside
    of limiting the number of concurrent connections to the usual 64k ports.
    However, since the upstream and downstream ports are different, local IP
    connection tracking on the machine will not be upset by the reuse of the
    same session.

Note that depending on the transparent proxy technology used, it may be
required to force the source address. In fact, cttproxy version 2 requires an
IP address in &lt;addr&gt; above, and does not support setting of &quot;0.0.0.0&quot; as the
IP address because it creates NAT entries which much match the exact outgoing
address. Tproxy version 4 and some other kernel patches which work in pure
forwarding mode generally will not have this limitation.

This option sets the default source for all servers in the backend. It may
also be specified in a &quot;defaults&quot; section. Finer source address specification
is possible at the server level using the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#source%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; server option. Refer to
<a href="#5">section 5</a> for more information.
</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code>backend private
    <span class="comment"># Connect to the servers using our 192.168.1.200 source address</span>
    source 192.168.1.200

backend transparent_ssl1
    <span class="comment"># Connect to the SSL farm from the client's source address</span>
    source 192.168.1.200 usesrc clientip

backend transparent_ssl2
    <span class="comment"># Connect to the SSL farm from the client's source address and port</span>
    <span class="comment"># not recommended if IP conntrack is present on the local machine.</span>
    source 192.168.1.200 usesrc client

backend transparent_ssl3
    <span class="comment"># Connect to the SSL farm from the client's source address. It</span>
    <span class="comment"># is more conntrack-friendly.</span>
    source 192.168.1.200 usesrc clientip

backend transparent_smtp
    <span class="comment"># Connect to the SMTP farm from the client's source address/port</span>
    <span class="comment"># with Tproxy version 4.</span>
    source 0.0.0.0 usesrc clientip

backend transparent_http
    <span class="comment"># Connect to the servers using the client's IP as seen by previous</span>
    <span class="comment"># proxy.</span>
    source 0.0.0.0 usesrc hdr_ip(x-forwarded-for,-1)
</code></pre>
</div><div class="page-header"><b>See also :</b> the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#source%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; server option in <a href="#5">section 5</a>, the Tproxy patches for the Linux kernel on www.balabit.com, the &quot;<a href="#bind">bind</a>&quot; keyword.</div>
<a class="anchor" name="srvtimeout"></a><a class="anchor" name="4-srvtimeout"></a><a class="anchor" name="4.2-srvtimeout"></a><a class="anchor" name="srvtimeout (Proxies)"></a><a class="anchor" name="srvtimeout (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="srvtimeout"></a><a href="#4.2-srvtimeout">srvtimeout</a></b> <span style="color: #080">&lt;timeout&gt;</span> <span class="label label-warning">(deprecated)</span></div><pre class="text">Set the maximum inactivity time on the server side.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">The inactivity timeout applies when the server is expected to acknowledge or
send data. In HTTP mode, this timeout is particularly important to consider
during the first phase of the server's response, when it has to send the
headers, as it directly represents the server's processing time for the
request. To find out what value to put there, it's often good to start with
what would be considered as unacceptable response times, then check the logs
to observe the response time distribution, and adjust the value accordingly.

The value is specified in milliseconds by default, but can be in any other
unit if the number is suffixed by the unit, as specified at the top of this
document. In TCP mode (and to a lesser extent, in HTTP mode), it is highly
recommended that the client timeout remains equal to the server timeout in
order to avoid complex situations to debug. Whatever the expected server
response times, it is a good practice to cover at least one or several TCP
packet losses by specifying timeouts that are slightly above multiples of 3
seconds (eg: 4 or 5 seconds minimum).

This parameter is specific to backends, but can be specified once for all in
&quot;defaults&quot; sections. This is in fact one of the easiest solutions not to
forget about it. An unspecified timeout results in an infinite timeout, which
is not recommended. Such a usage is accepted and works but reports a warning
during startup because it may results in accumulation of expired sessions in
the system if the system's timeouts are not configured either.

This parameter is provided for compatibility but is currently deprecated.
Please use &quot;<a href="#timeout%20server">timeout server</a>&quot; instead.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#timeout%20server">timeout server</a>&quot;, &quot;<a href="#timeout%20tunnel">timeout tunnel</a>&quot;, &quot;<a href="#timeout%20client">timeout client</a>&quot; and &quot;<a href="#clitimeout">clitimeout</a>&quot;.</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats admin"></a><a class="anchor" name="4-stats admin"></a><a class="anchor" name="4.2-stats admin"></a><a class="anchor" name="stats admin (Proxies)"></a><a class="anchor" name="stats admin (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats admin"></a><a href="#4.2-stats%20admin">stats admin</a></b> <span style="color: #800">{ if | unless }</span> <span style="color: #080">&lt;cond&gt;</span></div><pre class="text">Enable statistics admin level if/unless a condition is matched
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">This statement enables the statistics admin level if/unless a condition is
matched.

The admin level allows to enable/disable servers from the web interface. By
default, statistics page is read-only for security reasons.

Note : Consider not using this feature in multi-process mode (nbproc &gt; 1)
       unless you know what you do : memory is not shared between the
       processes, which can result in random behaviours.

Currently, the POST request is limited to the buffer size minus the reserved
buffer space, which means that if the list of servers is too long, the
request won't be processed. It is recommended to alter few servers at a
time.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># statistics admin level only for localhost</span>
backend stats_localhost
    stats enable
    stats admin if LOCALHOST
</code></pre>
</div><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># statistics admin level always enabled because of the authentication</span>
backend stats_auth
    stats enable
    stats auth  admin:AdMiN123
    stats admin if TRUE
</code></pre>
</div><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># statistics admin level depends on the authenticated user</span>
userlist stats-auth
    group admin    users admin
    user  admin    insecure-password AdMiN123
    group readonly users haproxy
    user  haproxy  insecure-password haproxy

backend stats_auth
    stats enable
    acl AUTH       http_auth(stats-auth)
    acl AUTH_ADMIN http_auth_group(stats-auth) admin
    stats http-request auth unless AUTH
    stats admin if AUTH_ADMIN
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stats%20enable">stats enable</a>&quot;, &quot;<a href="#stats%20auth">stats auth</a>&quot;, &quot;<a href="#stats%20http-request">stats http-request</a>&quot;, &quot;<a href="#nbproc">nbproc</a>&quot;, &quot;<a href="#bind-process">bind-process</a>&quot;, <a href="#3.4">section 3.4</a> about userlists and <a href="#7">section 7</a> about ACL usage.</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats auth"></a><a class="anchor" name="4-stats auth"></a><a class="anchor" name="4.2-stats auth"></a><a class="anchor" name="stats auth (Proxies)"></a><a class="anchor" name="stats auth (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats auth"></a><a href="#4.2-stats%20auth">stats auth</a></b> <span style="color: #080">&lt;user&gt;</span>:<span style="color: #080">&lt;passwd&gt;</span></div><pre class="text">Enable statistics with authentication and grant access to an account
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;user&gt;    is a user name to grant access to

&lt;passwd&gt;  is the cleartext password associated to this user</pre>
</div>
<pre class="text">This statement enables statistics with default settings, and restricts access
to declared users only. It may be repeated as many times as necessary to
allow as many users as desired. When a user tries to access the statistics
without a valid account, a &quot;401 Forbidden&quot; response will be returned so that
the browser asks the user to provide a valid user and password. The real
which will be returned to the browser is configurable using &quot;<a href="#stats%20realm">stats realm</a>&quot;.

Since the authentication method is HTTP Basic Authentication, the passwords
circulate in cleartext on the network. Thus, it was decided that the
configuration file would also use cleartext passwords to remind the users
that those ones should not be sensitive and not shared with any other account.

It is also possible to reduce the scope of the proxies which appear in the
report using &quot;<a href="#stats%20scope">stats scope</a>&quot;.

Though this statement alone is enough to enable statistics reporting, it is
recommended to set all other settings in order to avoid relying on default
unobvious parameters.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># public access (limited to this backend only)</span>
backend public_www
    server srv1 192.168.0.1:80
    stats enable
    stats hide-version
    stats scope   .
    stats uri     /admin?stats
    stats realm   Haproxy\ Statistics
    stats auth    admin1:AdMiN123
    stats auth    admin2:AdMiN321

<span class="comment"># internal monitoring access (unlimited)</span>
backend private_monitoring
    stats enable
    stats uri     /admin?stats
    stats refresh 5s
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stats%20enable">stats enable</a>&quot;, &quot;<a href="#stats%20realm">stats realm</a>&quot;, &quot;<a href="#stats%20scope">stats scope</a>&quot;, &quot;<a href="#stats%20uri">stats uri</a>&quot;</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats enable"></a><a class="anchor" name="4-stats enable"></a><a class="anchor" name="4.2-stats enable"></a><a class="anchor" name="stats enable (Proxies)"></a><a class="anchor" name="stats enable (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats enable"></a><a href="#4.2-stats%20enable">stats enable</a></b></div><pre class="text">Enable statistics reporting with default settings
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">This statement enables statistics reporting with default settings defined
at build time. Unless stated otherwise, these settings are used :
  - stats uri   : /haproxy?stats
  - stats realm : &quot;HAProxy Statistics&quot;
  - stats auth  : no authentication
  - stats scope : no restriction

Though this statement alone is enough to enable statistics reporting, it is
recommended to set all other settings in order to avoid relying on default
unobvious parameters.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># public access (limited to this backend only)</span>
backend public_www
    server srv1 192.168.0.1:80
    stats enable
    stats hide-version
    stats scope   .
    stats uri     /admin?stats
    stats realm   Haproxy\ Statistics
    stats auth    admin1:AdMiN123
    stats auth    admin2:AdMiN321

<span class="comment"># internal monitoring access (unlimited)</span>
backend private_monitoring
    stats enable
    stats uri     /admin?stats
    stats refresh 5s
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stats%20auth">stats auth</a>&quot;, &quot;<a href="#stats%20realm">stats realm</a>&quot;, &quot;<a href="#stats%20uri">stats uri</a>&quot;</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats hide-version"></a><a class="anchor" name="4-stats hide-version"></a><a class="anchor" name="4.2-stats hide-version"></a><a class="anchor" name="stats hide-version (Proxies)"></a><a class="anchor" name="stats hide-version (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats hide-version"></a><a href="#4.2-stats%20hide-version">stats hide-version</a></b></div><pre class="text">Enable statistics and hide HAProxy version reporting
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">By default, the stats page reports some useful status information along with
the statistics. Among them is HAProxy's version. However, it is generally
considered dangerous to report precise version to anyone, as it can help them
target known weaknesses with specific attacks. The &quot;<a href="#stats%20hide-version">stats hide-version</a>&quot;
statement removes the version from the statistics report. This is recommended
for public sites or any site with a weak login/password.

Though this statement alone is enough to enable statistics reporting, it is
recommended to set all other settings in order to avoid relying on default
unobvious parameters.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># public access (limited to this backend only)</span>
backend public_www
    server srv1 192.168.0.1:80
    stats enable
    stats hide-version
    stats scope   .
    stats uri     /admin?stats
    stats realm   Haproxy\ Statistics
    stats auth    admin1:AdMiN123
    stats auth    admin2:AdMiN321

<span class="comment"># internal monitoring access (unlimited)</span>
backend private_monitoring
    stats enable
    stats uri     /admin?stats
    stats refresh 5s
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stats%20auth">stats auth</a>&quot;, &quot;<a href="#stats%20enable">stats enable</a>&quot;, &quot;<a href="#stats%20realm">stats realm</a>&quot;, &quot;<a href="#stats%20uri">stats uri</a>&quot;</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats http-request"></a><a class="anchor" name="4-stats http-request"></a><a class="anchor" name="4.2-stats http-request"></a><a class="anchor" name="stats http-request (Proxies)"></a><a class="anchor" name="stats http-request (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats http-request"></a><a href="#4.2-stats%20http-request">stats http-request</a></b> <span style="color: #800">{ allow | deny | auth <span style="color: #008">[realm <span style="color: #080">&lt;realm&gt;</span>]</span> }</span>
             <span style="color: #008">[ <span style="color: #800">{ if | unless }</span> <span style="color: #080">&lt;condition&gt;</span> ]</span></div><pre class="text">Access control for statistics
</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">As &quot;<a href="#http-request">http-request</a>&quot;, these set of options allow to fine control access to
statistics. Each option may be followed by if/unless and acl.
First option with matched condition (or option without condition) is final.
For &quot;deny&quot; a 403 error will be returned, for &quot;allow&quot; normal processing is
performed, for &quot;auth&quot; a 401/407 error code is returned so the client
should be asked to enter a username and password.

There is no fixed limit to the number of http-request statements per
instance.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#http-request">http-request</a>&quot;, <a href="#3.4">section 3.4</a> about userlists and <a href="#7">section 7</a> about ACL usage.</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats realm"></a><a class="anchor" name="4-stats realm"></a><a class="anchor" name="4.2-stats realm"></a><a class="anchor" name="stats realm (Proxies)"></a><a class="anchor" name="stats realm (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats realm"></a><a href="#4.2-stats%20realm">stats realm</a></b> <span style="color: #080">&lt;realm&gt;</span></div><pre class="text">Enable statistics and set authentication realm
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;realm&gt;   is the name of the HTTP Basic Authentication realm reported to
          the browser. The browser uses it to display it in the pop-up
          inviting the user to enter a valid username and password.</pre>
</div>
<pre class="text">The realm is read as a single word, so any spaces in it should be escaped
using a backslash ('\').

This statement is useful only in conjunction with &quot;<a href="#stats%20auth">stats auth</a>&quot; since it is
only related to authentication.

Though this statement alone is enough to enable statistics reporting, it is
recommended to set all other settings in order to avoid relying on default
unobvious parameters.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># public access (limited to this backend only)</span>
backend public_www
    server srv1 192.168.0.1:80
    stats enable
    stats hide-version
    stats scope   .
    stats uri     /admin?stats
    stats realm   Haproxy\ Statistics
    stats auth    admin1:AdMiN123
    stats auth    admin2:AdMiN321

<span class="comment"># internal monitoring access (unlimited)</span>
backend private_monitoring
    stats enable
    stats uri     /admin?stats
    stats refresh 5s
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stats%20auth">stats auth</a>&quot;, &quot;<a href="#stats%20enable">stats enable</a>&quot;, &quot;<a href="#stats%20uri">stats uri</a>&quot;</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats refresh"></a><a class="anchor" name="4-stats refresh"></a><a class="anchor" name="4.2-stats refresh"></a><a class="anchor" name="stats refresh (Proxies)"></a><a class="anchor" name="stats refresh (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats refresh"></a><a href="#4.2-stats%20refresh">stats refresh</a></b> <span style="color: #080">&lt;delay&gt;</span></div><pre class="text">Enable statistics with automatic refresh
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;delay&gt;   is the suggested refresh delay, specified in seconds, which will
          be returned to the browser consulting the report page. While the
          browser is free to apply any delay, it will generally respect it
          and refresh the page this every seconds. The refresh interval may
          be specified in any other non-default time unit, by suffixing the
          unit after the value, as explained at the top of this document.</pre>
</div>
<pre class="text">This statement is useful on monitoring displays with a permanent page
reporting the load balancer's activity. When set, the HTML report page will
include a link &quot;refresh&quot;/&quot;stop refresh&quot; so that the user can select whether
he wants automatic refresh of the page or not.

Though this statement alone is enough to enable statistics reporting, it is
recommended to set all other settings in order to avoid relying on default
unobvious parameters.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># public access (limited to this backend only)</span>
backend public_www
    server srv1 192.168.0.1:80
    stats enable
    stats hide-version
    stats scope   .
    stats uri     /admin?stats
    stats realm   Haproxy\ Statistics
    stats auth    admin1:AdMiN123
    stats auth    admin2:AdMiN321

<span class="comment"># internal monitoring access (unlimited)</span>
backend private_monitoring
    stats enable
    stats uri     /admin?stats
    stats refresh 5s
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stats%20auth">stats auth</a>&quot;, &quot;<a href="#stats%20enable">stats enable</a>&quot;, &quot;<a href="#stats%20realm">stats realm</a>&quot;, &quot;<a href="#stats%20uri">stats uri</a>&quot;</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats scope"></a><a class="anchor" name="4-stats scope"></a><a class="anchor" name="4.2-stats scope"></a><a class="anchor" name="stats scope (Proxies)"></a><a class="anchor" name="stats scope (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats scope"></a><a href="#4.2-stats%20scope">stats scope</a></b> <span style="color: #800">{ <span style="color: #080">&lt;name&gt;</span> | &quot;.&quot; }</span></div><pre class="text">Enable statistics and limit access scope
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;name&gt;    is the name of a listen, frontend or backend section to be
          reported. The special name &quot;.&quot; (a single dot) designates the
          section in which the statement appears.</pre>
</div>
<pre class="text">When this statement is specified, only the sections enumerated with this
statement will appear in the report. All other ones will be hidden. This
statement may appear as many times as needed if multiple sections need to be
reported. Please note that the name checking is performed as simple string
comparisons, and that it is never checked that a give section name really
exists.

Though this statement alone is enough to enable statistics reporting, it is
recommended to set all other settings in order to avoid relying on default
unobvious parameters.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># public access (limited to this backend only)</span>
backend public_www
    server srv1 192.168.0.1:80
    stats enable
    stats hide-version
    stats scope   .
    stats uri     /admin?stats
    stats realm   Haproxy\ Statistics
    stats auth    admin1:AdMiN123
    stats auth    admin2:AdMiN321

<span class="comment"># internal monitoring access (unlimited)</span>
backend private_monitoring
    stats enable
    stats uri     /admin?stats
    stats refresh 5s
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stats%20auth">stats auth</a>&quot;, &quot;<a href="#stats%20enable">stats enable</a>&quot;, &quot;<a href="#stats%20realm">stats realm</a>&quot;, &quot;<a href="#stats%20uri">stats uri</a>&quot;</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats show-desc"></a><a class="anchor" name="4-stats show-desc"></a><a class="anchor" name="4.2-stats show-desc"></a><a class="anchor" name="stats show-desc (Proxies)"></a><a class="anchor" name="stats show-desc (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats show-desc"></a><a href="#4.2-stats%20show-desc">stats show-desc</a></b> <span style="color: #008">[ <span style="color: #080">&lt;desc&gt;</span> ]</span></div><pre class="text">Enable reporting of a description on the statistics page.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">  &lt;desc&gt;    is an optional description to be reported. If unspecified, the
            description from global section is automatically used instead.

This statement is useful for users that offer shared services to their
customers, where node or description should be different for each customer.

Though this statement alone is enough to enable statistics reporting, it is
recommended to set all other settings in order to avoid relying on default
unobvious parameters.  By default description is not shown.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># internal monitoring access (unlimited)</span>
backend private_monitoring
    stats enable
    stats show-desc Master node for Europe, Asia, Africa
    stats uri       /admin?stats
    stats refresh   5s
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;show-node&quot;, &quot;<a href="#stats%20enable">stats enable</a>&quot;, &quot;<a href="#stats%20uri">stats uri</a>&quot; and &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">description<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#description%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#description%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li></ul></span>&quot; in global section.</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats show-legends"></a><a class="anchor" name="4-stats show-legends"></a><a class="anchor" name="4.2-stats show-legends"></a><a class="anchor" name="stats show-legends (Proxies)"></a><a class="anchor" name="stats show-legends (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats show-legends"></a><a href="#4.2-stats%20show-legends">stats show-legends</a></b></div><pre class="text">Enable reporting additional information on the statistics page
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">Enable reporting additional information on the statistics page :
  - cap: capabilities (proxy)
  - mode: one of tcp, http or health (proxy)
  - id: SNMP ID (proxy, socket, server)
  - IP (socket, server)
  - cookie (backend, server)

Though this statement alone is enough to enable statistics reporting, it is
recommended to set all other settings in order to avoid relying on default
unobvious parameters.  Default behaviour is not to show this information.
</pre><div class="page-header"><b>See also:</b> &quot;<a href="#stats%20enable">stats enable</a>&quot;, &quot;<a href="#stats%20uri">stats uri</a>&quot;.</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats show-node"></a><a class="anchor" name="4-stats show-node"></a><a class="anchor" name="4.2-stats show-node"></a><a class="anchor" name="stats show-node (Proxies)"></a><a class="anchor" name="stats show-node (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats show-node"></a><a href="#4.2-stats%20show-node">stats show-node</a></b> <span style="color: #008">[ <span style="color: #080">&lt;name&gt;</span> ]</span></div><pre class="text">Enable reporting of a host name on the statistics page.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments:</span><pre class="prettyprint arguments">&lt;name&gt;    is an optional name to be reported. If unspecified, the
          node name from global section is automatically used instead.</pre>
</div>
<pre class="text">This statement is useful for users that offer shared services to their
customers, where node or description might be different on a stats page
provided for each customer.  Default behaviour is not to show host name.

Though this statement alone is enough to enable statistics reporting, it is
recommended to set all other settings in order to avoid relying on default
unobvious parameters.
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code><span class="comment"># internal monitoring access (unlimited)</span>
backend private_monitoring
    stats enable
    stats show-node Europe-1
    stats uri       /admin?stats
    stats refresh   5s
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;show-desc&quot;, &quot;<a href="#stats%20enable">stats enable</a>&quot;, &quot;<a href="#stats%20uri">stats uri</a>&quot;, and &quot;<a href="#node">node</a>&quot; in global section.</div>
<a class="anchor" name="stats"></a><a class="anchor" name="4-stats"></a><a class="anchor" name="4.2-stats"></a><a class="anchor" name="stats (Proxies)"></a><a class="anchor" name="stats (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stats uri"></a><a class="anchor" name="4-stats uri"></a><a class="anchor" name="4.2-stats uri"></a><a class="anchor" name="stats uri (Proxies)"></a><a class="anchor" name="stats uri (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stats uri"></a><a href="#4.2-stats%20uri">stats uri</a></b> <span style="color: #080">&lt;prefix&gt;</span></div><pre class="text">Enable statistics and define the URI prefix to access them
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;prefix&gt;  is the prefix of any URI which will be redirected to stats. This
          prefix may contain a question mark ('?') to indicate part of a
          query string.</pre>
</div>
<pre class="text">The statistics URI is intercepted on the relayed traffic, so it appears as a
page within the normal application. It is strongly advised to ensure that the
selected URI will never appear in the application, otherwise it will never be
possible to reach it in the application.

The default URI compiled in haproxy is &quot;/haproxy?stats&quot;, but this may be
changed at build time, so it's better to always explicitly specify it here.
It is generally a good idea to include a question mark in the URI so that
intermediate proxies refrain from caching the results. Also, since any string
beginning with the prefix will be accepted as a stats request, the question
mark helps ensuring that no valid URI will begin with the same words.

It is sometimes very convenient to use &quot;/&quot; as the URI prefix, and put that
statement in a &quot;listen&quot; instance of its own. That makes it easy to dedicate
an address or a port to statistics only.

Though this statement alone is enough to enable statistics reporting, it is
recommended to set all other settings in order to avoid relying on default
unobvious parameters.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># public access (limited to this backend only)</span>
backend public_www
    server srv1 192.168.0.1:80
    stats enable
    stats hide-version
    stats scope   .
    stats uri     /admin?stats
    stats realm   Haproxy\ Statistics
    stats auth    admin1:AdMiN123
    stats auth    admin2:AdMiN321

<span class="comment"># internal monitoring access (unlimited)</span>
backend private_monitoring
    stats enable
    stats uri     /admin?stats
    stats refresh 5s
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stats%20auth">stats auth</a>&quot;, &quot;<a href="#stats%20enable">stats enable</a>&quot;, &quot;<a href="#stats%20realm">stats realm</a>&quot;</div>
<a class="anchor" name="stick"></a><a class="anchor" name="4-stick"></a><a class="anchor" name="4.2-stick"></a><a class="anchor" name="stick (Proxies)"></a><a class="anchor" name="stick (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stick match"></a><a class="anchor" name="4-stick match"></a><a class="anchor" name="4.2-stick match"></a><a class="anchor" name="stick match (Proxies)"></a><a class="anchor" name="stick match (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stick match"></a><a href="#4.2-stick%20match">stick match</a></b> <span style="color: #080">&lt;pattern&gt;</span> <span style="color: #008">[table <span style="color: #080">&lt;table&gt;</span>]</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;cond&gt;</span>]</span></div><pre class="text">Define a request pattern matching condition to stick a user to a server
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;pattern&gt;  is a sample expression rule as described in <a href="#7.3">section 7.3</a>. It
           describes what elements of the incoming request or connection
           will be analysed in the hope to find a matching entry in a
           stickiness table. This rule is mandatory.

&lt;table&gt;    is an optional stickiness table name. If unspecified, the same
           backend's table is used. A stickiness table is declared using
           the &quot;<a href="#stick-table">stick-table</a>&quot; statement.

&lt;cond&gt;     is an optional matching condition. It makes it possible to match
           on a certain criterion only when other conditions are met (or
           not met). For instance, it could be used to match on a source IP
           address except when a request passes through a known proxy, in
           which case we'd match on a header containing that IP address.</pre>
</div>
<pre class="text">Some protocols or applications require complex stickiness rules and cannot
always simply rely on cookies nor hashing. The &quot;<a href="#stick%20match">stick match</a>&quot; statement
describes a rule to extract the stickiness criterion from an incoming request
or connection. See <a href="#7">section 7</a> for a complete list of possible patterns and
transformation rules.

The table has to be declared using the &quot;<a href="#stick-table">stick-table</a>&quot; statement. It must be of
a type compatible with the pattern. By default it is the one which is present
in the same backend. It is possible to share a table with other backends by
referencing it using the &quot;table&quot; keyword. If another table is referenced,
the server's ID inside the backends are used. By default, all server IDs
start at 1 in each backend, so the server ordering is enough. But in case of
doubt, it is highly recommended to force server IDs using their &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">id<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#id%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#id%20%28Bind%20options%29">Bind options</a></li><li><a href="#id%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; setting.

It is possible to restrict the conditions where a &quot;<a href="#stick%20match">stick match</a>&quot; statement
will apply, using &quot;if&quot; or &quot;unless&quot; followed by a condition. See <a href="#7">section 7</a> for
ACL based conditions.

There is no limit on the number of &quot;<a href="#stick%20match">stick match</a>&quot; statements. The first that
applies and matches will cause the request to be directed to the same server
as was used for the request which created the entry. That way, multiple
matches can be used as fallbacks.

The stick rules are checked after the persistence cookies, so they will not
affect stickiness if a cookie has already been used to select a server. That
way, it becomes very easy to insert cookies and match on IP addresses in
order to maintain stickiness between HTTP and HTTPS.

Note : Consider not using this feature in multi-process mode (nbproc &gt; 1)
       unless you know what you do : memory is not shared between the
       processes, which can result in random behaviours.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># forward SMTP users to the same server they just used for POP in the</span>
<span class="comment"># last 30 minutes</span>
backend pop
    mode tcp
    balance roundrobin
    stick store-request src
    stick-table type ip size 200k expire 30m
    server s1 192.168.1.1:110
    server s2 192.168.1.1:110

backend smtp
    mode tcp
    balance roundrobin
    stick match src table pop
    server s1 192.168.1.1:25
    server s2 192.168.1.1:25
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stick-table">stick-table</a>&quot;, &quot;<a href="#stick%20on">stick on</a>&quot;, &quot;<a href="#nbproc">nbproc</a>&quot;, &quot;<a href="#bind-process">bind-process</a>&quot; and <a href="#7">section 7</a> about ACLs and samples fetching.</div>
<a class="anchor" name="stick"></a><a class="anchor" name="4-stick"></a><a class="anchor" name="4.2-stick"></a><a class="anchor" name="stick (Proxies)"></a><a class="anchor" name="stick (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stick on"></a><a class="anchor" name="4-stick on"></a><a class="anchor" name="4.2-stick on"></a><a class="anchor" name="stick on (Proxies)"></a><a class="anchor" name="stick on (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stick on"></a><a href="#4.2-stick%20on">stick on</a></b> <span style="color: #080">&lt;pattern&gt;</span> <span style="color: #008">[table <span style="color: #080">&lt;table&gt;</span>]</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;condition&gt;</span>]</span></div><pre class="text">Define a request pattern to associate a user to a server
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">Note : This form is exactly equivalent to &quot;<a href="#stick%20match">stick match</a>&quot; followed by
       &quot;<a href="#stick%20store-request">stick store-request</a>&quot;, all with the same arguments. Please refer
       to both keywords for details. It is only provided as a convenience
       for writing more maintainable configurations.

Note : Consider not using this feature in multi-process mode (nbproc &gt; 1)
       unless you know what you do : memory is not shared between the
       processes, which can result in random behaviours.
</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code><span class="comment"># The following form ...</span>
stick on src table pop if !localhost

<span class="comment"># ...is strictly equivalent to this one :</span>
stick match src table pop if !localhost
stick store-request src table pop if !localhost


<span class="comment"># Use cookie persistence for HTTP, and stick on source address for HTTPS as</span>
<span class="comment"># well as HTTP without cookie. Share the same table between both accesses.</span>
backend http
    mode http
    balance roundrobin
    stick on src table https
    cookie SRV insert indirect nocache
    server s1 192.168.1.1:80 cookie s1
    server s2 192.168.1.1:80 cookie s2

backend https
    mode tcp
    balance roundrobin
    stick-table type ip size 200k expire 30m
    stick on src
    server s1 192.168.1.1:443
    server s2 192.168.1.1:443
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stick%20match">stick match</a>&quot;, &quot;<a href="#stick%20store-request">stick store-request</a>&quot;, &quot;<a href="#nbproc">nbproc</a>&quot; and &quot;<a href="#bind-process">bind-process</a>&quot;.</div>
<a class="anchor" name="stick"></a><a class="anchor" name="4-stick"></a><a class="anchor" name="4.2-stick"></a><a class="anchor" name="stick (Proxies)"></a><a class="anchor" name="stick (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stick store-request"></a><a class="anchor" name="4-stick store-request"></a><a class="anchor" name="4.2-stick store-request"></a><a class="anchor" name="stick store-request (Proxies)"></a><a class="anchor" name="stick store-request (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stick store-request"></a><a href="#4.2-stick%20store-request">stick store-request</a></b> <span style="color: #080">&lt;pattern&gt;</span> <span style="color: #008">[table <span style="color: #080">&lt;table&gt;</span>]</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;condition&gt;</span>]</span></div><pre class="text">Define a request pattern used to create an entry in a stickiness table
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;pattern&gt;  is a sample expression rule as described in <a href="#7.3">section 7.3</a>. It
           describes what elements of the incoming request or connection
           will be analysed, extracted and stored in the table once a
           server is selected.

&lt;table&gt;    is an optional stickiness table name. If unspecified, the same
           backend's table is used. A stickiness table is declared using
           the &quot;<a href="#stick-table">stick-table</a>&quot; statement.

&lt;cond&gt;     is an optional storage condition. It makes it possible to store
           certain criteria only when some conditions are met (or not met).
           For instance, it could be used to store the source IP address
           except when the request passes through a known proxy, in which
           case we'd store a converted form of a header containing that IP
           address.</pre>
</div>
<pre class="text">Some protocols or applications require complex stickiness rules and cannot
always simply rely on cookies nor hashing. The &quot;<a href="#stick%20store-request">stick store-request</a>&quot; statement
describes a rule to decide what to extract from the request and when to do
it, in order to store it into a stickiness table for further requests to
match it using the &quot;<a href="#stick%20match">stick match</a>&quot; statement. Obviously the extracted part must
make sense and have a chance to be matched in a further request. Storing a
client's IP address for instance often makes sense. Storing an ID found in a
URL parameter also makes sense. Storing a source port will almost never make
any sense because it will be randomly matched. See <a href="#7">section 7</a> for a complete
list of possible patterns and transformation rules.

The table has to be declared using the &quot;<a href="#stick-table">stick-table</a>&quot; statement. It must be of
a type compatible with the pattern. By default it is the one which is present
in the same backend. It is possible to share a table with other backends by
referencing it using the &quot;table&quot; keyword. If another table is referenced,
the server's ID inside the backends are used. By default, all server IDs
start at 1 in each backend, so the server ordering is enough. But in case of
doubt, it is highly recommended to force server IDs using their &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">id<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#id%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#id%20%28Bind%20options%29">Bind options</a></li><li><a href="#id%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; setting.

It is possible to restrict the conditions where a &quot;<a href="#stick%20store-request">stick store-request</a>&quot;
statement will apply, using &quot;if&quot; or &quot;unless&quot; followed by a condition. This
condition will be evaluated while parsing the request, so any criteria can be
used. See <a href="#7">section 7</a> for ACL based conditions.

There is no limit on the number of &quot;<a href="#stick%20store-request">stick store-request</a>&quot; statements, but
there is a limit of 8 simultaneous stores per request or response. This
makes it possible to store up to 8 criteria, all extracted from either the
request or the response, regardless of the number of rules. Only the 8 first
ones which match will be kept. Using this, it is possible to feed multiple
tables at once in the hope to increase the chance to recognize a user on
another protocol or access method. Using multiple store-request rules with
the same table is possible and may be used to find the best criterion to rely
on, by arranging the rules by decreasing preference order. Only the first
extracted criterion for a given table will be stored. All subsequent store-
request rules referencing the same table will be skipped and their ACLs will
not be evaluated.

The &quot;store-request&quot; rules are evaluated once the server connection has been
established, so that the table will contain the real server that processed
the request.

Note : Consider not using this feature in multi-process mode (nbproc &gt; 1)
       unless you know what you do : memory is not shared between the
       processes, which can result in random behaviours.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># forward SMTP users to the same server they just used for POP in the</span>
<span class="comment"># last 30 minutes</span>
backend pop
    mode tcp
    balance roundrobin
    stick store-request src
    stick-table type ip size 200k expire 30m
    server s1 192.168.1.1:110
    server s2 192.168.1.1:110

backend smtp
    mode tcp
    balance roundrobin
    stick match src table pop
    server s1 192.168.1.1:25
    server s2 192.168.1.1:25
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stick-table">stick-table</a>&quot;, &quot;<a href="#stick%20on">stick on</a>&quot;, &quot;<a href="#nbproc">nbproc</a>&quot;, &quot;<a href="#bind-process">bind-process</a>&quot; and <a href="#7">section 7</a> about ACLs and sample fetching.</div>
<a class="anchor" name="stick-table"></a><a class="anchor" name="4-stick-table"></a><a class="anchor" name="4.2-stick-table"></a><a class="anchor" name="stick-table (Proxies)"></a><a class="anchor" name="stick-table (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stick-table type"></a><a class="anchor" name="4-stick-table type"></a><a class="anchor" name="4.2-stick-table type"></a><a class="anchor" name="stick-table type (Proxies)"></a><a class="anchor" name="stick-table type (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stick-table type"></a><a href="#4.2-stick-table%20type">stick-table type</a></b> <span style="color: #800">{ip | integer | string <span style="color: #008">[len <span style="color: #080">&lt;length&gt;</span>]</span> | binary <span style="color: #008">[len <span style="color: #080">&lt;length&gt;</span>]</span>}</span>
            size <span style="color: #080">&lt;size&gt;</span> <span style="color: #008">[expire <span style="color: #080">&lt;expire&gt;</span>]</span> <span style="color: #008">[nopurge]</span> <span style="color: #008">[peers <span style="color: #080">&lt;peersect&gt;</span>]</span>
            <span style="color: #008">[store <span style="color: #080">&lt;data_type&gt;</span>]</span>*</div><pre class="text">Configure the stickiness table for the current section
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments"> ip         a table declared with &quot;type ip&quot; will only store IPv4 addresses.
            This form is very compact (about 50 bytes per entry) and allows
            very fast entry lookup and stores with almost no overhead. This
            is mainly used to store client source IP addresses.

 ipv6       a table declared with &quot;type ipv6&quot; will only store IPv6 addresses.
            This form is very compact (about 60 bytes per entry) and allows
            very fast entry lookup and stores with almost no overhead. This
            is mainly used to store client source IP addresses.

 integer    a table declared with &quot;type integer&quot; will store 32bit integers
            which can represent a client identifier found in a request for
            instance.

 string     a table declared with &quot;type string&quot; will store substrings of up
            to &lt;len&gt; characters. If the string provided by the pattern
            extractor is larger than &lt;len&gt;, it will be truncated before
            being stored. During matching, at most &lt;len&gt; characters will be
            compared between the string in the table and the extracted
            pattern. When not specified, the string is automatically limited
            to 32 characters.

 binary     a table declared with &quot;type binary&quot; will store binary blocks
            of &lt;len&gt; bytes. If the block provided by the pattern
            extractor is larger than &lt;len&gt;, it will be truncated before
            being stored. If the block provided by the sample expression
            is shorter than &lt;len&gt;, it will be padded by 0. When not
            specified, the block is automatically limited to 32 bytes.

 &lt;length&gt;   is the maximum number of characters that will be stored in a
            &quot;string&quot; type table (See type &quot;string&quot; above). Or the number
            of bytes of the block in &quot;binary&quot; type table. Be careful when
            changing this parameter as memory usage will proportionally
            increase.

 &lt;size&gt;     is the maximum number of entries that can fit in the table. This
            value directly impacts memory usage. Count approximately
            50 bytes per entry, plus the size of a string if any. The size
            supports suffixes &quot;k&quot;, &quot;m&quot;, &quot;g&quot; for 2^10, 2^20 and 2^30 factors.

 [nopurge]  indicates that we refuse to purge older entries when the table
            is full. When not specified and the table is full when haproxy
            wants to store an entry in it, it will flush a few of the oldest
            entries in order to release some space for the new ones. This is
            most often the desired behaviour. In some specific cases, it
            be desirable to refuse new entries instead of purging the older
            ones. That may be the case when the amount of data to store is
            far above the hardware limits and we prefer not to offer access
            to new clients than to reject the ones already connected. When
            using this parameter, be sure to properly set the &quot;expire&quot;
            parameter (see below).

 &lt;peersect&gt; is the name of the peers section to use for replication. Entries
            which associate keys to server IDs are kept synchronized with
            the remote peers declared in this section. All entries are also
            automatically learned from the local peer (old process) during a
            soft restart.

            NOTE : peers can't be used in multi-process mode.

 &lt;expire&gt;   defines the maximum duration of an entry in the table since it
            was last created, refreshed or matched. The expiration delay is
            defined using the standard time format, similarly as the various
            timeouts. The maximum duration is slightly above 24 days. See
            <a href="#2.2">section 2.2</a> for more information. If this delay is not specified,
            the session won't automatically expire, but older entries will
            be removed once full. Be sure not to use the &quot;nopurge&quot; parameter
            if not expiration delay is specified.

&lt;data_type&gt; is used to store additional information in the stick-table. This
            may be used by ACLs in order to control various criteria related
            to the activity of the client matching the stick-table. For each
            item specified here, the size of each entry will be inflated so
            that the additional data can fit. Several data types may be
            stored with an entry. Multiple data types may be specified after
            the &quot;store&quot; keyword, as a comma-separated list. Alternatively,
            it is possible to repeat the &quot;store&quot; keyword followed by one or
            several data types. Except for the &quot;server_id&quot; type which is
            automatically detected and enabled, all data types must be
            explicitly declared to be stored. If an ACL references a data
            type which is not stored, the ACL will simply not match. Some
            data types require an argument which must be passed just after
            the type between parenthesis. See below for the supported data
            types and their arguments.</pre>
</div>
<pre class="text">The data types that can be stored with an entry are the following :
  - server_id : this is an integer which holds the numeric ID of the server a
    request was assigned to. It is used by the &quot;<a href="#stick%20match">stick match</a>&quot;, &quot;stick store&quot;,
    and &quot;<a href="#stick%20on">stick on</a>&quot; rules. It is automatically enabled when referenced.

  - gpc0 : first General Purpose Counter. It is a positive 32-bit integer
    integer which may be used for anything. Most of the time it will be used
    to put a special tag on some entries, for instance to note that a
    specific behaviour was detected and must be known for future matches.

  - gpc0_rate(&lt;period&gt;) : increment rate of the first General Purpose Counter
    over a period. It is a positive 32-bit integer integer which may be used
    for anything. Just like &lt;gpc0&gt;, it counts events, but instead of keeping
    a cumulative count, it maintains the rate at which the counter is
    incremented. Most of the time it will be used to measure the frequency of
    occurrence of certain events (eg: requests to a specific URL).

  - conn_cnt : Connection Count. It is a positive 32-bit integer which counts
    the absolute number of connections received from clients which matched
    this entry. It does not mean the connections were accepted, just that
    they were received.

  - conn_cur : Current Connections. It is a positive 32-bit integer which
    stores the concurrent connection counts for the entry. It is incremented
    once an incoming connection matches the entry, and decremented once the
    connection leaves. That way it is possible to know at any time the exact
    number of concurrent connections for an entry.

  - conn_rate(&lt;period&gt;) : frequency counter (takes 12 bytes). It takes an
    integer parameter &lt;period&gt; which indicates in milliseconds the length
    of the period over which the average is measured. It reports the average
    incoming connection rate over that period, in connections per period. The
    result is an integer which can be matched using ACLs.

  - sess_cnt : Session Count. It is a positive 32-bit integer which counts
    the absolute number of sessions received from clients which matched this
    entry. A session is a connection that was accepted by the layer 4 rules.

  - sess_rate(&lt;period&gt;) : frequency counter (takes 12 bytes). It takes an
    integer parameter &lt;period&gt; which indicates in milliseconds the length
    of the period over which the average is measured. It reports the average
    incoming session rate over that period, in sessions per period. The
    result is an integer which can be matched using ACLs.

  - http_req_cnt : HTTP request Count. It is a positive 32-bit integer which
    counts the absolute number of HTTP requests received from clients which
    matched this entry. It does not matter whether they are valid requests or
    not. Note that this is different from sessions when keep-alive is used on
    the client side.

  - http_req_rate(&lt;period&gt;) : frequency counter (takes 12 bytes). It takes an
    integer parameter &lt;period&gt; which indicates in milliseconds the length
    of the period over which the average is measured. It reports the average
    HTTP request rate over that period, in requests per period. The result is
    an integer which can be matched using ACLs. It does not matter whether
    they are valid requests or not. Note that this is different from sessions
    when keep-alive is used on the client side.

  - http_err_cnt : HTTP Error Count. It is a positive 32-bit integer which
    counts the absolute number of HTTP requests errors induced by clients
    which matched this entry. Errors are counted on invalid and truncated
    requests, as well as on denied or tarpitted requests, and on failed
    authentications. If the server responds with 4xx, then the request is
    also counted as an error since it's an error triggered by the client
    (eg: vulnerability scan).

  - http_err_rate(&lt;period&gt;) : frequency counter (takes 12 bytes). It takes an
    integer parameter &lt;period&gt; which indicates in milliseconds the length
    of the period over which the average is measured. It reports the average
    HTTP request error rate over that period, in requests per period (see
    http_err_cnt above for what is accounted as an error). The result is an
    integer which can be matched using ACLs.

  - bytes_in_cnt : client to server byte count. It is a positive 64-bit
    integer which counts the cumulated amount of bytes received from clients
    which matched this entry. Headers are included in the count. This may be
    used to limit abuse of upload features on photo or video servers.

  - bytes_in_rate(&lt;period&gt;) : frequency counter (takes 12 bytes). It takes an
    integer parameter &lt;period&gt; which indicates in milliseconds the length
    of the period over which the average is measured. It reports the average
    incoming bytes rate over that period, in bytes per period. It may be used
    to detect users which upload too much and too fast. Warning: with large
    uploads, it is possible that the amount of uploaded data will be counted
    once upon termination, thus causing spikes in the average transfer speed
    instead of having a smooth one. This may partially be smoothed with
    &quot;<a href="#option%20contstats">option contstats</a>&quot; though this is not perfect yet. Use of byte_in_cnt is
    recommended for better fairness.

  - bytes_out_cnt : server to client byte count. It is a positive 64-bit
    integer which counts the cumulated amount of bytes sent to clients which
    matched this entry. Headers are included in the count. This may be used
    to limit abuse of bots sucking the whole site.

  - bytes_out_rate(&lt;period&gt;) : frequency counter (takes 12 bytes). It takes
    an integer parameter &lt;period&gt; which indicates in milliseconds the length
    of the period over which the average is measured. It reports the average
    outgoing bytes rate over that period, in bytes per period. It may be used
    to detect users which download too much and too fast. Warning: with large
    transfers, it is possible that the amount of transferred data will be
    counted once upon termination, thus causing spikes in the average
    transfer speed instead of having a smooth one. This may partially be
    smoothed with &quot;<a href="#option%20contstats">option contstats</a>&quot; though this is not perfect yet. Use of
    byte_out_cnt is recommended for better fairness.

There is only one stick-table per proxy. At the moment of writing this doc,
it does not seem useful to have multiple tables per proxy. If this happens
to be required, simply create a dummy backend with a stick-table in it and
reference it.

It is important to understand that stickiness based on learning information
has some limitations, including the fact that all learned associations are
lost upon restart. In general it can be good as a complement but not always
as an exclusive stickiness.

Last, memory requirements may be important when storing many data types.
Indeed, storing all indicators above at once in each entry requires 116 bytes
per entry, or 116 MB for a 1-million entries table. This is definitely not
something that can be ignored.
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code><span class="comment"># Keep track of counters of up to 1 million IP addresses over 5 minutes</span>
<span class="comment"># and store a general purpose counter and the average connection rate</span>
<span class="comment"># computed over a sliding window of 30 seconds.</span>
stick-table type ip size 1m expire 5m store gpc0,conn_rate(30s)
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stick%20match">stick match</a>&quot;, &quot;<a href="#stick%20on">stick on</a>&quot;, &quot;<a href="#stick%20store-request">stick store-request</a>&quot;, <a href="#2.2">section 2.2</a> about time format and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="stick"></a><a class="anchor" name="4-stick"></a><a class="anchor" name="4.2-stick"></a><a class="anchor" name="stick (Proxies)"></a><a class="anchor" name="stick (Alphabetically sorted keywords reference)"></a><a class="anchor" name="stick store-response"></a><a class="anchor" name="4-stick store-response"></a><a class="anchor" name="4.2-stick store-response"></a><a class="anchor" name="stick store-response (Proxies)"></a><a class="anchor" name="stick store-response (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="stick store-response"></a><a href="#4.2-stick%20store-response">stick store-response</a></b> <span style="color: #080">&lt;pattern&gt;</span> <span style="color: #008">[table <span style="color: #080">&lt;table&gt;</span>]</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;condition&gt;</span>]</span></div><pre class="text">Define a request pattern used to create an entry in a stickiness table
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;pattern&gt;  is a sample expression rule as described in <a href="#7.3">section 7.3</a>. It
           describes what elements of the response or connection will
           be analysed, extracted and stored in the table once a
           server is selected.

&lt;table&gt;    is an optional stickiness table name. If unspecified, the same
           backend's table is used. A stickiness table is declared using
           the &quot;<a href="#stick-table">stick-table</a>&quot; statement.

&lt;cond&gt;     is an optional storage condition. It makes it possible to store
           certain criteria only when some conditions are met (or not met).
           For instance, it could be used to store the SSL session ID only
           when the response is a SSL server hello.</pre>
</div>
<pre class="text">Some protocols or applications require complex stickiness rules and cannot
always simply rely on cookies nor hashing. The &quot;<a href="#stick%20store-response">stick store-response</a>&quot;
statement  describes a rule to decide what to extract from the response and
when to do it, in order to store it into a stickiness table for further
requests to match it using the &quot;<a href="#stick%20match">stick match</a>&quot; statement. Obviously the
extracted part must make sense and have a chance to be matched in a further
request. Storing an ID found in a header of a response makes sense.
See <a href="#7">section 7</a> for a complete list of possible patterns and transformation
rules.

The table has to be declared using the &quot;<a href="#stick-table">stick-table</a>&quot; statement. It must be of
a type compatible with the pattern. By default it is the one which is present
in the same backend. It is possible to share a table with other backends by
referencing it using the &quot;table&quot; keyword. If another table is referenced,
the server's ID inside the backends are used. By default, all server IDs
start at 1 in each backend, so the server ordering is enough. But in case of
doubt, it is highly recommended to force server IDs using their &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">id<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#id%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#id%20%28Bind%20options%29">Bind options</a></li><li><a href="#id%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; setting.

It is possible to restrict the conditions where a &quot;<a href="#stick%20store-response">stick store-response</a>&quot;
statement will apply, using &quot;if&quot; or &quot;unless&quot; followed by a condition. This
condition will be evaluated while parsing the response, so any criteria can
be used. See <a href="#7">section 7</a> for ACL based conditions.

There is no limit on the number of &quot;<a href="#stick%20store-response">stick store-response</a>&quot; statements, but
there is a limit of 8 simultaneous stores per request or response. This
makes it possible to store up to 8 criteria, all extracted from either the
request or the response, regardless of the number of rules. Only the 8 first
ones which match will be kept. Using this, it is possible to feed multiple
tables at once in the hope to increase the chance to recognize a user on
another protocol or access method. Using multiple store-response rules with
the same table is possible and may be used to find the best criterion to rely
on, by arranging the rules by decreasing preference order. Only the first
extracted criterion for a given table will be stored. All subsequent store-
response rules referencing the same table will be skipped and their ACLs will
not be evaluated. However, even if a store-request rule references a table, a
store-response rule may also use the same table. This means that each table
may learn exactly one element from the request and one element from the
response at once.

The table will contain the real server that processed the request.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># Learn SSL session ID from both request and response and create affinity.</span>
backend https
    mode tcp
    balance roundrobin
    <span class="comment"># maximum SSL session ID length is 32 bytes.</span>
    stick-table type binary len 32 size 30k expire 30m

    acl clienthello req_ssl_hello_type 1
    acl serverhello rep_ssl_hello_type 2

    <span class="comment"># use tcp content accepts to detects ssl client and server hello.</span>
    tcp-request inspect-delay 5s
    tcp-request content accept if clienthello

    <span class="comment"># no timeout on response inspect delay by default.</span>
    tcp-response content accept if serverhello

    <span class="comment"># SSL session ID (SSLID) may be present on a client or server hello.</span>
    <span class="comment"># Its length is coded on 1 byte at offset 43 and its value starts</span>
    <span class="comment"># at offset 44.</span>

    <span class="comment"># Match and learn on request if client hello.</span>
    stick on payload_lv(43,1) if clienthello

    <span class="comment"># Learn on response if server hello.</span>
    stick store-response payload_lv(43,1) if serverhello

    server s1 192.168.1.1:443
    server s2 192.168.1.1:443
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#stick-table">stick-table</a>&quot;, &quot;<a href="#stick%20on">stick on</a>&quot;, and <a href="#7">section 7</a> about ACLs and pattern extraction.</div>
<a class="anchor" name="tcp-check"></a><a class="anchor" name="4-tcp-check"></a><a class="anchor" name="4.2-tcp-check"></a><a class="anchor" name="tcp-check (Proxies)"></a><a class="anchor" name="tcp-check (Alphabetically sorted keywords reference)"></a><a class="anchor" name="tcp-check connect"></a><a class="anchor" name="4-tcp-check connect"></a><a class="anchor" name="4.2-tcp-check connect"></a><a class="anchor" name="tcp-check connect (Proxies)"></a><a class="anchor" name="tcp-check connect (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="tcp-check connect"></a><a href="#4.2-tcp-check%20connect">tcp-check connect</a></b> <span style="color: #008">[params*]</span></div><pre class="text">Opens a new connection
</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">When an application lies on more than a single TCP port or when HAProxy
load-balance many services in a single backend, it makes sense to probe all
the services individually before considering a server as operational.

When there are no TCP port configured on the server line neither server port
directive, then the 'tcp-check connect port &lt;port&gt;' must be the first step
of the sequence.

In a tcp-check ruleset a 'connect' is required, it is also mandatory to start
the ruleset with a 'connect' rule. Purpose is to ensure admin know what they
do.

Parameters :
  They are optional and can be used to describe how HAProxy should open and
  use the TCP connection.

  port      if not set, check port or server port is used.
            It tells HAProxy where to open the connection to.
            &lt;port&gt; must be a valid TCP port source integer, from 1 to 65535.

  send-proxy   send a PROXY protocol string

  ssl          opens a ciphered connection
</pre><div class="separator">
<span class="label label-success">Examples:</span>
<pre class="prettyprint">
<code><span class="comment"># check HTTP and HTTPs services on a server.</span>
<span class="comment"># first open port 80 thanks to server line port directive, then</span>
<span class="comment"># tcp-check opens port 443, ciphered and run a request on it:</span>
option tcp-check
tcp-check connect
tcp-check send GET\ /\ HTTP/1.0\r\n
tcp-check send Host:\ haproxy.1wt.eu\r\n
tcp-check send \r\n
tcp-check expect rstring (2..|3..)
tcp-check connect port 443 ssl
tcp-check send GET\ /\ HTTP/1.0\r\n
tcp-check send Host:\ haproxy.1wt.eu\r\n
tcp-check send \r\n
tcp-check expect rstring (2..|3..)
server www 10.0.0.1 check port 80

<span class="comment"># check both POP and IMAP from a single server:</span>
option tcp-check
tcp-check connect port 110
tcp-check expect string +OK\ POP3\ ready
tcp-check connect port 143
tcp-check expect string *\ OK\ IMAP4\ ready
server mail 10.0.0.1 check
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#option%20tcp-check">option tcp-check</a>&quot;, &quot;<a href="#tcp-check%20send">tcp-check send</a>&quot;, &quot;<a href="#tcp-check%20expect">tcp-check expect</a>&quot;</div>
<a class="anchor" name="tcp-check"></a><a class="anchor" name="4-tcp-check"></a><a class="anchor" name="4.2-tcp-check"></a><a class="anchor" name="tcp-check (Proxies)"></a><a class="anchor" name="tcp-check (Alphabetically sorted keywords reference)"></a><a class="anchor" name="tcp-check expect"></a><a class="anchor" name="4-tcp-check expect"></a><a class="anchor" name="4.2-tcp-check expect"></a><a class="anchor" name="tcp-check expect (Proxies)"></a><a class="anchor" name="tcp-check expect (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="tcp-check expect"></a><a href="#4.2-tcp-check%20expect">tcp-check expect</a></b> <span style="color: #008">[!]</span> <span style="color: #080">&lt;match&gt;</span> <span style="color: #080">&lt;pattern&gt;</span></div><pre class="text">Specify data to be collected and analysed during a generic health check
</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;match&gt;   is a keyword indicating how to look for a specific pattern in the
          response. The keyword may be one of &quot;string&quot;, &quot;rstring&quot; or
          binary.
          The keyword may be preceded by an exclamation mark (&quot;!&quot;) to negate
          the match. Spaces are allowed between the exclamation mark and the
          keyword. See below for more details on the supported keywords.

&lt;pattern&gt; is the pattern to look for. It may be a string or a regular
          expression. If the pattern contains spaces, they must be escaped
          with the usual backslash ('\').
          If the match is set to binary, then the pattern must be passed as
          a serie of hexadecimal digits in an even number. Each sequence of
          two digits will represent a byte. The hexadecimal digits may be
          used upper or lower case.</pre>
</div>
<pre class="text">The available matches are intentionally similar to their http-check cousins :

  string &lt;string&gt; : test the exact string matches in the response buffer.
                    A health check response will be considered valid if the
                    response's buffer contains this exact string. If the
                    &quot;string&quot; keyword is prefixed with &quot;!&quot;, then the response
                    will be considered invalid if the body contains this
                    string. This can be used to look for a mandatory pattern
                    in a protocol response, or to detect a failure when a
                    specific error appears in a protocol banner.

  rstring &lt;regex&gt; : test a regular expression on the response buffer.
                    A health check response will be considered valid if the
                    response's buffer matches this expression. If the
                    &quot;rstring&quot; keyword is prefixed with &quot;!&quot;, then the response
                    will be considered invalid if the body matches the
                    expression.

  binary &lt;hexstring&gt; : test the exact string in its hexadecimal form matches
                       in the response buffer. A health check response will
                       be considered valid if the response's buffer contains
                       this exact hexadecimal string.
                       Purpose is to match data on binary protocols.

It is important to note that the responses will be limited to a certain size
defined by the global &quot;<a href="#tune.chksize">tune.chksize</a>&quot; option, which defaults to 16384 bytes.
Thus, too large responses may not contain the mandatory pattern when using
&quot;string&quot;, &quot;rstring&quot; or binary. If a large response is absolutely required, it
is possible to change the default max size by setting the global variable.
However, it is worth keeping in mind that parsing very large responses can
waste some CPU cycles, especially when regular expressions are used, and that
it is always better to focus the checks on smaller resources. Also, in its
current state, the check will not find any string nor regex past a null
character in the response. Similarly it is not possible to request matching
the null character.
</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code><span class="comment"># perform a POP check</span>
option tcp-check
tcp-check expect string +OK\ POP3\ ready

<span class="comment"># perform an IMAP check</span>
option tcp-check
tcp-check expect string *\ OK\ IMAP4\ ready

<span class="comment"># look for the redis master server</span>
option tcp-check
tcp-check send PING\r\n
tcp-check expect +PONG
tcp-check send info\ replication\r\n
tcp-check expect string role:master
tcp-check send QUIT\r\n
tcp-check expect string +OK
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#option%20tcp-check">option tcp-check</a>&quot;, &quot;<a href="#tcp-check%20connect">tcp-check connect</a>&quot;, &quot;<a href="#tcp-check%20send">tcp-check send</a>&quot;, &quot;<a href="#tcp-check%20send-binary">tcp-check send-binary</a>&quot;, &quot;<a href="#http-check%20expect">http-check expect</a>&quot;, tune.chksize</div>
<a class="anchor" name="tcp-check"></a><a class="anchor" name="4-tcp-check"></a><a class="anchor" name="4.2-tcp-check"></a><a class="anchor" name="tcp-check (Proxies)"></a><a class="anchor" name="tcp-check (Alphabetically sorted keywords reference)"></a><a class="anchor" name="tcp-check send"></a><a class="anchor" name="4-tcp-check send"></a><a class="anchor" name="4.2-tcp-check send"></a><a class="anchor" name="tcp-check send (Proxies)"></a><a class="anchor" name="tcp-check send (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="tcp-check send"></a><a href="#4.2-tcp-check%20send">tcp-check send</a></b> <span style="color: #080">&lt;data&gt;</span></div><pre class="text">Specify a string to be sent as a question during a generic health check
</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">&lt;data&gt; : the data to be sent as a question during a generic health check
         session. For now, &lt;data&gt; must be a string.
</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code><span class="comment"># look for the redis master server</span>
option tcp-check
tcp-check send info\ replication\r\n
tcp-check expect string role:master
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#option%20tcp-check">option tcp-check</a>&quot;, &quot;<a href="#tcp-check%20connect">tcp-check connect</a>&quot;, &quot;<a href="#tcp-check%20expect">tcp-check expect</a>&quot;, &quot;<a href="#tcp-check%20send-binary">tcp-check send-binary</a>&quot;, tune.chksize</div>
<a class="anchor" name="tcp-check"></a><a class="anchor" name="4-tcp-check"></a><a class="anchor" name="4.2-tcp-check"></a><a class="anchor" name="tcp-check (Proxies)"></a><a class="anchor" name="tcp-check (Alphabetically sorted keywords reference)"></a><a class="anchor" name="tcp-check send-binary"></a><a class="anchor" name="4-tcp-check send-binary"></a><a class="anchor" name="4.2-tcp-check send-binary"></a><a class="anchor" name="tcp-check send-binary (Proxies)"></a><a class="anchor" name="tcp-check send-binary (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="tcp-check send-binary"></a><a href="#4.2-tcp-check%20send-binary">tcp-check send-binary</a></b> <span style="color: #080">&lt;hexastring&gt;</span></div><pre class="text">Specify an hexa digits string to be sent as a binary question during a raw
tcp health check
</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<pre class="text">&lt;data&gt; : the data to be sent as a question during a generic health check
         session. For now, &lt;data&gt; must be a string.
&lt;hexastring&gt; : test the exact string in its hexadecimal form matches in the
               response buffer. A health check response will be considered
               valid if the response's buffer contains this exact
               hexadecimal string.
               Purpose is to send binary data to ask on binary protocols.
</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code><span class="comment"># redis check in binary</span>
option tcp-check
tcp-check send-binary 50494e470d0a <span class="comment"># PING\r\n</span>
tcp-check expect binary 2b504F4e47 <span class="comment"># +PONG</span>
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#option%20tcp-check">option tcp-check</a>&quot;, &quot;<a href="#tcp-check%20connect">tcp-check connect</a>&quot;, &quot;<a href="#tcp-check%20expect">tcp-check expect</a>&quot;, &quot;<a href="#tcp-check%20send">tcp-check send</a>&quot;, tune.chksize</div>
<a class="anchor" name="tcp-request"></a><a class="anchor" name="4-tcp-request"></a><a class="anchor" name="4.2-tcp-request"></a><a class="anchor" name="tcp-request (Proxies)"></a><a class="anchor" name="tcp-request (Alphabetically sorted keywords reference)"></a><a class="anchor" name="tcp-request connection"></a><a class="anchor" name="4-tcp-request connection"></a><a class="anchor" name="4.2-tcp-request connection"></a><a class="anchor" name="tcp-request connection (Proxies)"></a><a class="anchor" name="tcp-request connection (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="tcp-request connection"></a><a href="#4.2-tcp-request%20connection">tcp-request connection</a></b> <span style="color: #080">&lt;action&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;condition&gt;</span>]</span></div><pre class="text">Perform an action on an incoming connection depending on a layer 4 condition
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;action&gt;    defines the action to perform if the condition applies. Valid
            actions include : &quot;accept&quot;, &quot;reject&quot;, &quot;track-sc0&quot;, &quot;track-sc1&quot;,
            &quot;track-sc2&quot;, and &quot;expect-proxy&quot;. See below for more details.

&lt;condition&gt; is a standard layer4-only ACL-based condition (see <a href="#7">section 7</a>).</pre>
</div>
<pre class="text">Immediately after acceptance of a new incoming connection, it is possible to
evaluate some conditions to decide whether this connection must be accepted
or dropped or have its counters tracked. Those conditions cannot make use of
any data contents because the connection has not been read from yet, and the
buffers are not yet allocated. This is used to selectively and very quickly
accept or drop connections from various sources with a very low overhead. If
some contents need to be inspected in order to take the decision, the
&quot;<a href="#tcp-request%20content">tcp-request content</a>&quot; statements must be used instead.

The &quot;<a href="#tcp-request%20connection">tcp-request connection</a>&quot; rules are evaluated in their exact declaration
order. If no rule matches or if there is no rule, the default action is to
accept the incoming connection. There is no specific limit to the number of
rules which may be inserted.

Five types of actions are supported :
  - accept :
      accepts the connection if the condition is true (when used with &quot;if&quot;)
      or false (when used with &quot;unless&quot;). The first such rule executed ends
      the rules evaluation.

  - reject :
      rejects the connection if the condition is true (when used with &quot;if&quot;)
      or false (when used with &quot;unless&quot;). The first such rule executed ends
      the rules evaluation. Rejected connections do not even become a
      session, which is why they are accounted separately for in the stats,
      as &quot;denied connections&quot;. They are not considered for the session
      rate-limit and are not logged either. The reason is that these rules
      should only be used to filter extremely high connection rates such as
      the ones encountered during a massive DDoS attack. Under these extreme
      conditions, the simple action of logging each event would make the
      system collapse and would considerably lower the filtering capacity. If
      logging is absolutely desired, then &quot;<a href="#tcp-request%20content">tcp-request content</a>&quot; rules should
      be used instead.

  - expect-proxy layer4 :
      configures the client-facing connection to receive a PROXY protocol
      header before any byte is read from the socket. This is equivalent to
      having the &quot;<a href="#accept-proxy">accept-proxy</a>&quot; keyword on the &quot;<a href="#bind">bind</a>&quot; line, except that using
      the TCP rule allows the PROXY protocol to be accepted only for certain
      IP address ranges using an ACL. This is convenient when multiple layers
      of load balancers are passed through by traffic coming from public
      hosts.

  - capture &lt;sample&gt; len &lt;length&gt; :
      This only applies to &quot;<a href="#tcp-request%20content">tcp-request content</a>&quot; rules. It captures sample
      expression &lt;sample&gt; from the request buffer, and converts it to a
      string of at most &lt;len&gt; characters. The resulting string is stored into
      the next request &quot;<a href="#capture">capture</a>&quot; slot, so it will possibly appear next to
      some captured HTTP headers. It will then automatically appear in the
      logs, and it will be possible to extract it using sample fetch rules to
      feed it into headers or anything. The length should be limited given
      that this size will be allocated for each capture during the whole
      session life. Since it applies to Please check <a href="#7.3">section 7.3</a> (Fetching
      samples) and &quot;<a href="#capture%20request%20header">capture request header</a>&quot; for more information.

  - { track-sc0 | track-sc1 | track-sc2 } &lt;key&gt; [table &lt;table&gt;] :
      enables tracking of sticky counters from current connection. These
      rules do not stop evaluation and do not change default action. Two sets
      of counters may be simultaneously tracked by the same connection. The
      first &quot;track-sc0&quot; rule executed enables tracking of the counters of the
      specified table as the first set. The first &quot;track-sc1&quot; rule executed
      enables tracking of the counters of the specified table as the second
      set. The first &quot;track-sc2&quot; rule executed enables tracking of the
      counters of the specified table as the third set. It is a recommended
      practice to use the first set of counters for the per-frontend counters
      and the second set for the per-backend ones. But this is just a
      guideline, all may be used everywhere.

      These actions take one or two arguments :
        &lt;key&gt;   is mandatory, and is a sample expression rule as described
                in <a href="#7.3">section 7.3</a>. It describes what elements of the incoming
                request or connection will be analysed, extracted, combined,
                and used to select which table entry to update the counters.
                Note that &quot;<a href="#tcp-request%20connection">tcp-request connection</a>&quot; cannot use content-based
                fetches.

       &lt;table&gt;  is an optional table to be used instead of the default one,
                which is the stick-table declared in the current proxy. All
                the counters for the matches and updates for the key will
                then be performed in that table until the session ends.

      Once a &quot;track-sc*&quot; rule is executed, the key is looked up in the table
      and if it is not found, an entry is allocated for it. Then a pointer to
      that entry is kept during all the session's life, and this entry's
      counters are updated as often as possible, every time the session's
      counters are updated, and also systematically when the session ends.
      Counters are only updated for events that happen after the tracking has
      been started. For example, connection counters will not be updated when
      tracking layer 7 information, since the connection event happens before
      layer7 information is extracted.

      If the entry tracks concurrent connection counters, one connection is
      counted for as long as the entry is tracked, and the entry will not
      expire during that time. Tracking counters also provides a performance
      advantage over just checking the keys, because only one table lookup is
      performed for all ACL checks that make use of it.

Note that the &quot;if/unless&quot; condition is optional. If no condition is set on
the action, it is simply performed unconditionally. That can be useful for
&quot;track-sc*&quot; actions as well as for changing the default action to a reject.
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<div class="example-desc">Accept all connections from white-listed hosts, reject too fast connection without counting them, and track accepted connections. This results in connection rate being capped from abusive sources.</div><code>tcp-request connection accept if { src -f /etc/haproxy/whitelist.lst }
tcp-request connection reject if { src_conn_rate gt 10 }
tcp-request connection track-sc0 src
</code></pre>
</div><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<div class="example-desc">Accept all connections from white-listed hosts, count all other connections and reject too fast ones. This results in abusive ones being blocked as long as they don't slow down.</div><code>tcp-request connection accept if { src -f /etc/haproxy/whitelist.lst }
tcp-request connection track-sc0 src
tcp-request connection reject if { sc0_conn_rate gt 10 }
</code></pre>
</div><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<div class="example-desc">Enable the PROXY protocol for traffic coming from all known proxies.</div><code>tcp-request connection expect-proxy layer4 if { src -f proxies.lst }
</code></pre>
</div><pre class="text">See <a href="#7">section 7</a> about ACL usage.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#tcp-request%20content">tcp-request content</a>&quot;, &quot;<a href="#stick-table">stick-table</a>&quot;</div>
<a class="anchor" name="tcp-request"></a><a class="anchor" name="4-tcp-request"></a><a class="anchor" name="4.2-tcp-request"></a><a class="anchor" name="tcp-request (Proxies)"></a><a class="anchor" name="tcp-request (Alphabetically sorted keywords reference)"></a><a class="anchor" name="tcp-request content"></a><a class="anchor" name="4-tcp-request content"></a><a class="anchor" name="4.2-tcp-request content"></a><a class="anchor" name="tcp-request content (Proxies)"></a><a class="anchor" name="tcp-request content (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="tcp-request content"></a><a href="#4.2-tcp-request%20content">tcp-request content</a></b> <span style="color: #080">&lt;action&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;condition&gt;</span>]</span></div><pre class="text">Perform an action on a new session depending on a layer 4-7 condition
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;action&gt;    defines the action to perform if the condition applies. Valid
            actions include : &quot;accept&quot;, &quot;reject&quot;, &quot;track-sc0&quot;, &quot;track-sc1&quot;,
            &quot;track-sc2&quot; and &quot;<a href="#capture">capture</a>&quot;. See &quot;<a href="#tcp-request%20connection">tcp-request connection</a>&quot; above
            for their signification.

&lt;condition&gt; is a standard layer 4-7 ACL-based condition (see <a href="#7">section 7</a>).</pre>
</div>
<pre class="text">A request's contents can be analysed at an early stage of request processing
called &quot;TCP content inspection&quot;. During this stage, ACL-based rules are
evaluated every time the request contents are updated, until either an
&quot;accept&quot; or a &quot;reject&quot; rule matches, or the TCP request inspection delay
expires with no matching rule.

The first difference between these rules and &quot;<a href="#tcp-request%20connection">tcp-request connection</a>&quot; rules
is that &quot;<a href="#tcp-request%20content">tcp-request content</a>&quot; rules can make use of contents to take a
decision. Most often, these decisions will consider a protocol recognition or
validity. The second difference is that content-based rules can be used in
both frontends and backends. In case of HTTP keep-alive with the client, all
tcp-request content rules are evaluated again, so haproxy keeps a record of
what sticky counters were assigned by a &quot;<a href="#tcp-request%20connection">tcp-request connection</a>&quot; versus a
&quot;<a href="#tcp-request%20content">tcp-request content</a>&quot; rule, and flushes all the content-related ones after
processing an HTTP request, so that they may be evaluated again by the rules
being evaluated again for the next request. This is of particular importance
when the rule tracks some L7 information or when it is conditioned by an
L7-based ACL, since tracking may change between requests.

Content-based rules are evaluated in their exact declaration order. If no
rule matches or if there is no rule, the default action is to accept the
contents. There is no specific limit to the number of rules which may be
inserted.

Four types of actions are supported :
  - accept : the request is accepted
  - reject : the request is rejected and the connection is closed
  - capture : the specified sample expression is captured
  - { track-sc0 | track-sc1 | track-sc2 } &lt;key&gt; [table &lt;table&gt;]

They have the same meaning as their counter-parts in &quot;<a href="#tcp-request%20connection">tcp-request connection</a>&quot;
so please refer to that section for a complete description.

While there is nothing mandatory about it, it is recommended to use the
track-sc0 in &quot;<a href="#tcp-request%20connection">tcp-request connection</a>&quot; rules, track-sc1 for &quot;tcp-request
content&quot; rules in the frontend, and track-sc2 for &quot;<a href="#tcp-request%20content">tcp-request content</a>&quot;
rules in the backend, because that makes the configuration more readable
and easier to troubleshoot, but this is just a guideline and all counters
may be used everywhere.

Note that the &quot;if/unless&quot; condition is optional. If no condition is set on
the action, it is simply performed unconditionally. That can be useful for
&quot;track-sc*&quot; actions as well as for changing the default action to a reject.

It is perfectly possible to match layer 7 contents with &quot;<a href="#tcp-request%20content">tcp-request content</a>&quot;
rules, since HTTP-specific ACL matches are able to preliminarily parse the
contents of a buffer before extracting the required data. If the buffered
contents do not parse as a valid HTTP message, then the ACL does not match.
The parser which is involved there is exactly the same as for all other HTTP
processing, so there is no risk of parsing something differently. In an HTTP
backend connected to from an HTTP frontend, it is guaranteed that HTTP
contents will always be immediately present when the rule is evaluated first.

Tracking layer7 information is also possible provided that the information
are present when the rule is processed. The current solution for making the
rule engine wait for such information is to set an inspect delay and to
condition its execution with an ACL relying on such information.
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code><span class="comment"># Accept HTTP requests containing a Host header saying &quot;example.com&quot;</span>
<span class="comment"># and reject everything else.</span>
acl is_host_com hdr(Host) -i example.com
tcp-request inspect-delay 30s
tcp-request content accept if is_host_com
tcp-request content reject
</code></pre>
</div><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code><span class="comment"># reject SMTP connection if client speaks first</span>
tcp-request inspect-delay 30s
acl content_present req_len gt 0
tcp-request content reject if content_present

<span class="comment"># Forward HTTPS connection only if client speaks</span>
tcp-request inspect-delay 30s
acl content_present req_len gt 0
tcp-request content accept if content_present
tcp-request content reject
</code></pre>
</div><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code><span class="comment"># Track the last IP from X-Forwarded-For</span>
tcp-request inspect-delay 10s
tcp-request content track-sc0 hdr(x-forwarded-for,-1) if HTTP
</code></pre>
</div><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code><span class="comment"># track request counts per &quot;<a href="#base">base</a>&quot; (concatenation of Host+URL)</span>
tcp-request inspect-delay 10s
tcp-request content track-sc0 base table req-rate if HTTP
</code></pre>
</div><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<div class="example-desc">Track per-frontend and per-backend counters, block abusers at the frontend when the backend detects abuse.</div><code>frontend http
    <span class="comment"># Use General Purpose Couter 0 in SC0 as a global abuse counter</span>
    <span class="comment"># protecting all our sites</span>
    stick-table type ip size 1m expire 5m store gpc0
    tcp-request connection track-sc0 src
    tcp-request connection reject if { sc0_get_gpc0 gt 0 }
    ...
    use_backend http_dynamic if { path_end .php }

backend http_dynamic
    <span class="comment"># if a source makes too fast requests to this dynamic site (tracked</span>
    <span class="comment"># by SC1), block it globally in the frontend.</span>
    stick-table type ip size 1m expire 5m store http_req_rate(10s)
    acl click_too_fast sc1_http_req_rate gt 10
    acl mark_as_abuser sc0_inc_gpc0 gt 0
    tcp-request content track-sc1 src
    tcp-request content reject if click_too_fast mark_as_abuser
</code></pre>
</div><pre class="text">See <a href="#7">section 7</a> about ACL usage.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#tcp-request%20connection">tcp-request connection</a>&quot;, &quot;<a href="#tcp-request%20inspect-delay">tcp-request inspect-delay</a>&quot;</div>
<a class="anchor" name="tcp-request"></a><a class="anchor" name="4-tcp-request"></a><a class="anchor" name="4.2-tcp-request"></a><a class="anchor" name="tcp-request (Proxies)"></a><a class="anchor" name="tcp-request (Alphabetically sorted keywords reference)"></a><a class="anchor" name="tcp-request inspect-delay"></a><a class="anchor" name="4-tcp-request inspect-delay"></a><a class="anchor" name="4.2-tcp-request inspect-delay"></a><a class="anchor" name="tcp-request inspect-delay (Proxies)"></a><a class="anchor" name="tcp-request inspect-delay (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="tcp-request inspect-delay"></a><a href="#4.2-tcp-request%20inspect-delay">tcp-request inspect-delay</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><pre class="text">Set the maximum allowed time to wait for data during content inspection
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">People using haproxy primarily as a TCP relay are often worried about the
risk of passing any type of protocol to a server without any analysis. In
order to be able to analyze the request contents, we must first withhold
the data then analyze them. This statement simply enables withholding of
data for at most the specified amount of time.

TCP content inspection applies very early when a connection reaches a
frontend, then very early when the connection is forwarded to a backend. This
means that a connection may experience a first delay in the frontend and a
second delay in the backend if both have tcp-request rules.

Note that when performing content inspection, haproxy will evaluate the whole
rules for every new chunk which gets in, taking into account the fact that
those data are partial. If no rule matches before the aforementioned delay,
a last check is performed upon expiration, this time considering that the
contents are definitive. If no delay is set, haproxy will not wait at all
and will immediately apply a verdict based on the available information.
Obviously this is unlikely to be very useful and might even be racy, so such
setups are not recommended.

As soon as a rule matches, the request is released and continues as usual. If
the timeout is reached and no rule matches, the default policy will be to let
it pass through unaffected.

For most protocols, it is enough to set it to a few seconds, as most clients
send the full request immediately upon connection. Add 3 or more seconds to
cover TCP retransmits but that's all. For some protocols, it may make sense
to use large values, for instance to ensure that the client never talks
before the server (eg: SMTP), or to wait for a client to talk before passing
data to the server (eg: SSL). Note that the client timeout must cover at
least the inspection delay, otherwise it will expire first. If the client
closes the connection or if the buffer is full, the delay immediately expires
since the contents will not be able to change anymore.
</pre><div class="page-header"><b>See also :</b> &quot;tcp-request content accept&quot;, &quot;tcp-request content reject&quot;, &quot;<a href="#timeout%20client">timeout client</a>&quot;.</div>
<a class="anchor" name="tcp-response"></a><a class="anchor" name="4-tcp-response"></a><a class="anchor" name="4.2-tcp-response"></a><a class="anchor" name="tcp-response (Proxies)"></a><a class="anchor" name="tcp-response (Alphabetically sorted keywords reference)"></a><a class="anchor" name="tcp-response content"></a><a class="anchor" name="4-tcp-response content"></a><a class="anchor" name="4.2-tcp-response content"></a><a class="anchor" name="tcp-response content (Proxies)"></a><a class="anchor" name="tcp-response content (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="tcp-response content"></a><a href="#4.2-tcp-response%20content">tcp-response content</a></b> <span style="color: #080">&lt;action&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;condition&gt;</span>]</span></div><pre class="text">Perform an action on a session response depending on a layer 4-7 condition
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;action&gt;    defines the action to perform if the condition applies. Valid
            actions include : &quot;accept&quot;, &quot;close&quot;, &quot;reject&quot;.

&lt;condition&gt; is a standard layer 4-7 ACL-based condition (see <a href="#7">section 7</a>).</pre>
</div>
<pre class="text">Response contents can be analysed at an early stage of response processing
called &quot;TCP content inspection&quot;. During this stage, ACL-based rules are
evaluated every time the response contents are updated, until either an
&quot;accept&quot;, &quot;close&quot; or a &quot;reject&quot; rule matches, or a TCP response inspection
delay is set and expires with no matching rule.

Most often, these decisions will consider a protocol recognition or validity.

Content-based rules are evaluated in their exact declaration order. If no
rule matches or if there is no rule, the default action is to accept the
contents. There is no specific limit to the number of rules which may be
inserted.

Two types of actions are supported :
  - accept :
      accepts the response if the condition is true (when used with &quot;if&quot;)
      or false (when used with &quot;unless&quot;). The first such rule executed ends
      the rules evaluation.

  - close :
      immediately closes the connection with the server if the condition is
      true (when used with &quot;if&quot;), or false (when used with &quot;unless&quot;). The
      first such rule executed ends the rules evaluation. The main purpose of
      this action is to force a connection to be finished between a client
      and a server after an exchange when the application protocol expects
      some long time outs to elapse first. The goal is to eliminate idle
      connections which take significant resources on servers with certain
      protocols.

  - reject :
      rejects the response if the condition is true (when used with &quot;if&quot;)
      or false (when used with &quot;unless&quot;). The first such rule executed ends
      the rules evaluation. Rejected session are immediately closed.

Note that the &quot;if/unless&quot; condition is optional. If no condition is set on
the action, it is simply performed unconditionally. That can be useful for
for changing the default action to a reject.

It is perfectly possible to match layer 7 contents with &quot;tcp-response
content&quot; rules, but then it is important to ensure that a full response has
been buffered, otherwise no contents will match. In order to achieve this,
the best solution involves detecting the HTTP protocol during the inspection
period.

See <a href="#7">section 7</a> about ACL usage.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#tcp-request%20content">tcp-request content</a>&quot;, &quot;<a href="#tcp-response%20inspect-delay">tcp-response inspect-delay</a>&quot;</div>
<a class="anchor" name="tcp-response"></a><a class="anchor" name="4-tcp-response"></a><a class="anchor" name="4.2-tcp-response"></a><a class="anchor" name="tcp-response (Proxies)"></a><a class="anchor" name="tcp-response (Alphabetically sorted keywords reference)"></a><a class="anchor" name="tcp-response inspect-delay"></a><a class="anchor" name="4-tcp-response inspect-delay"></a><a class="anchor" name="4.2-tcp-response inspect-delay"></a><a class="anchor" name="tcp-response inspect-delay (Proxies)"></a><a class="anchor" name="tcp-response inspect-delay (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="tcp-response inspect-delay"></a><a href="#4.2-tcp-response%20inspect-delay">tcp-response inspect-delay</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><pre class="text">Set the maximum allowed time to wait for a response during content inspection
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<div class="page-header"><b>See also :</b> &quot;<a href="#tcp-response%20content">tcp-response content</a>&quot;, &quot;<a href="#tcp-request%20inspect-delay">tcp-request inspect-delay</a>&quot;.</div>
<a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout check"></a><a class="anchor" name="4-timeout check"></a><a class="anchor" name="4.2-timeout check"></a><a class="anchor" name="timeout check (Proxies)"></a><a class="anchor" name="timeout check (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout check"></a><a href="#4.2-timeout%20check">timeout check</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><pre class="text">Set additional check timeout, but only after a connection has been already
established.
</pre><div><p>  May be used in sections :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments:</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">If set, haproxy uses min(&quot;<a href="#timeout%20connect">timeout connect</a>&quot;, &quot;<a href="#inter">inter</a>&quot;) as a connect timeout
for check and &quot;<a href="#timeout%20check">timeout check</a>&quot; as an additional read timeout. The &quot;min&quot; is
used so that people running with *very* long &quot;<a href="#timeout%20connect">timeout connect</a>&quot; (eg. those
who needed this due to the queue or tarpit) do not slow down their checks.
(Please also note that there is no valid reason to have such long connect
timeouts, because &quot;<a href="#timeout%20queue">timeout queue</a>&quot; and &quot;<a href="#timeout%20tarpit">timeout tarpit</a>&quot; can always be used to
avoid that).

If &quot;<a href="#timeout%20check">timeout check</a>&quot; is not set haproxy uses &quot;<a href="#inter">inter</a>&quot; for complete check
timeout (connect + read) exactly like all &lt;1.3.15 version.

In most cases check request is much simpler and faster to handle than normal
requests and people may want to kick out laggy servers so this timeout should
be smaller than &quot;<a href="#timeout%20server">timeout server</a>&quot;.

This parameter is specific to backends, but can be specified once for all in
&quot;defaults&quot; sections. This is in fact one of the easiest solutions not to
forget about it.
</pre><div class="page-header"><b>See also:</b> &quot;<a href="#timeout%20connect">timeout connect</a>&quot;, &quot;<a href="#timeout%20queue">timeout queue</a>&quot;, &quot;<a href="#timeout%20server">timeout server</a>&quot;, &quot;<a href="#timeout%20tarpit">timeout tarpit</a>&quot;.</div>
<a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout client"></a><a class="anchor" name="4-timeout client"></a><a class="anchor" name="4.2-timeout client"></a><a class="anchor" name="timeout client (Proxies)"></a><a class="anchor" name="timeout client (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout client"></a><a href="#4.2-timeout%20client">timeout client</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout clitimeout"></a><a class="anchor" name="4-timeout clitimeout"></a><a class="anchor" name="4.2-timeout clitimeout"></a><a class="anchor" name="timeout clitimeout (Proxies)"></a><a class="anchor" name="timeout clitimeout (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout clitimeout"></a><a href="#4.2-timeout%20clitimeout">timeout clitimeout</a></b> <span style="color: #080">&lt;timeout&gt;</span> <span class="label label-warning">(deprecated)</span></div><pre class="text">Set the maximum inactivity time on the client side.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">The inactivity timeout applies when the client is expected to acknowledge or
send data. In HTTP mode, this timeout is particularly important to consider
during the first phase, when the client sends the request, and during the
response while it is reading data sent by the server. The value is specified
in milliseconds by default, but can be in any other unit if the number is
suffixed by the unit, as specified at the top of this document. In TCP mode
(and to a lesser extent, in HTTP mode), it is highly recommended that the
client timeout remains equal to the server timeout in order to avoid complex
situations to debug. It is a good practice to cover one or several TCP packet
losses by specifying timeouts that are slightly above multiples of 3 seconds
(eg: 4 or 5 seconds). If some long-lived sessions are mixed with short-lived
sessions (eg: WebSocket and HTTP), it's worth considering &quot;<a href="#timeout%20tunnel">timeout tunnel</a>&quot;,
which overrides &quot;<a href="#timeout%20client">timeout client</a>&quot; and &quot;<a href="#timeout%20server">timeout server</a>&quot; for tunnels, as well as
&quot;<a href="#timeout%20client-fin">timeout client-fin</a>&quot; for half-closed connections.

This parameter is specific to frontends, but can be specified once for all in
&quot;defaults&quot; sections. This is in fact one of the easiest solutions not to
forget about it. An unspecified timeout results in an infinite timeout, which
is not recommended. Such a usage is accepted and works but reports a warning
during startup because it may results in accumulation of expired sessions in
the system if the system's timeouts are not configured either.

This parameter replaces the old, deprecated &quot;<a href="#clitimeout">clitimeout</a>&quot;. It is recommended
to use it to write new configurations. The form &quot;<a href="#timeout%20clitimeout">timeout clitimeout</a>&quot; is
provided only by backwards compatibility but its use is strongly discouraged.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#clitimeout">clitimeout</a>&quot;, &quot;<a href="#timeout%20server">timeout server</a>&quot;, &quot;<a href="#timeout%20tunnel">timeout tunnel</a>&quot;.</div>
<a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout client-fin"></a><a class="anchor" name="4-timeout client-fin"></a><a class="anchor" name="4.2-timeout client-fin"></a><a class="anchor" name="timeout client-fin (Proxies)"></a><a class="anchor" name="timeout client-fin (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout client-fin"></a><a href="#4.2-timeout%20client-fin">timeout client-fin</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><pre class="text">Set the inactivity timeout on the client side for half-closed connections.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">The inactivity timeout applies when the client is expected to acknowledge or
send data while one direction is already shut down. This timeout is different
from &quot;<a href="#timeout%20client">timeout client</a>&quot; in that it only applies to connections which are closed
in one direction. This is particularly useful to avoid keeping connections in
FIN_WAIT state for too long when clients do not disconnect cleanly. This
problem is particularly common long connections such as RDP or WebSocket.
Note that this timeout can override &quot;<a href="#timeout%20tunnel">timeout tunnel</a>&quot; when a connection shuts
down in one direction.

This parameter is specific to frontends, but can be specified once for all in
&quot;defaults&quot; sections. By default it is not set, so half-closed connections
will use the other timeouts (timeout.client or timeout.tunnel).
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#timeout%20client">timeout client</a>&quot;, &quot;<a href="#timeout%20server-fin">timeout server-fin</a>&quot;, and &quot;<a href="#timeout%20tunnel">timeout tunnel</a>&quot;.</div>
<a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout connect"></a><a class="anchor" name="4-timeout connect"></a><a class="anchor" name="4.2-timeout connect"></a><a class="anchor" name="timeout connect (Proxies)"></a><a class="anchor" name="timeout connect (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout connect"></a><a href="#4.2-timeout%20connect">timeout connect</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout contimeout"></a><a class="anchor" name="4-timeout contimeout"></a><a class="anchor" name="4.2-timeout contimeout"></a><a class="anchor" name="timeout contimeout (Proxies)"></a><a class="anchor" name="timeout contimeout (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout contimeout"></a><a href="#4.2-timeout%20contimeout">timeout contimeout</a></b> <span style="color: #080">&lt;timeout&gt;</span> <span class="label label-warning">(deprecated)</span></div><pre class="text">Set the maximum time to wait for a connection attempt to a server to succeed.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">If the server is located on the same LAN as haproxy, the connection should be
immediate (less than a few milliseconds). Anyway, it is a good practice to
cover one or several TCP packet losses by specifying timeouts that are
slightly above multiples of 3 seconds (eg: 4 or 5 seconds). By default, the
connect timeout also presets both queue and tarpit timeouts to the same value
if these have not been specified.

This parameter is specific to backends, but can be specified once for all in
&quot;defaults&quot; sections. This is in fact one of the easiest solutions not to
forget about it. An unspecified timeout results in an infinite timeout, which
is not recommended. Such a usage is accepted and works but reports a warning
during startup because it may results in accumulation of failed sessions in
the system if the system's timeouts are not configured either.

This parameter replaces the old, deprecated &quot;<a href="#contimeout">contimeout</a>&quot;. It is recommended
to use it to write new configurations. The form &quot;<a href="#timeout%20contimeout">timeout contimeout</a>&quot; is
provided only by backwards compatibility but its use is strongly discouraged.
</pre><div class="page-header"><b>See also:</b> &quot;<a href="#timeout%20check">timeout check</a>&quot;, &quot;<a href="#timeout%20queue">timeout queue</a>&quot;, &quot;<a href="#timeout%20server">timeout server</a>&quot;, &quot;<a href="#contimeout">contimeout</a>&quot;, &quot;<a href="#timeout%20tarpit">timeout tarpit</a>&quot;.</div>
<a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout http-keep-alive"></a><a class="anchor" name="4-timeout http-keep-alive"></a><a class="anchor" name="4.2-timeout http-keep-alive"></a><a class="anchor" name="timeout http-keep-alive (Proxies)"></a><a class="anchor" name="timeout http-keep-alive (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout http-keep-alive"></a><a href="#4.2-timeout%20http-keep-alive">timeout http-keep-alive</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><pre class="text">Set the maximum allowed time to wait for a new HTTP request to appear
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">By default, the time to wait for a new request in case of keep-alive is set
by &quot;<a href="#timeout%20http-request">timeout http-request</a>&quot;. However this is not always convenient because some
people want very short keep-alive timeouts in order to release connections
faster, and others prefer to have larger ones but still have short timeouts
once the request has started to present itself.

The &quot;<a href="#option%20http-keep-alive">http-keep-alive</a>&quot; timeout covers these needs. It will define how long to
wait for a new HTTP request to start coming after a response was sent. Once
the first byte of request has been seen, the &quot;<a href="#http-request">http-request</a>&quot; timeout is used
to wait for the complete request to come. Note that empty lines prior to a
new request do not refresh the timeout and are not counted as a new request.

There is also another difference between the two timeouts : when a connection
expires during timeout http-keep-alive, no error is returned, the connection
just closes. If the connection expires in &quot;<a href="#http-request">http-request</a>&quot; while waiting for a
connection to complete, a HTTP 408 error is returned.

In general it is optimal to set this value to a few tens to hundreds of
milliseconds, to allow users to fetch all objects of a page at once but
without waiting for further clicks. Also, if set to a very small value (eg:
1 millisecond) it will probably only accept pipelined requests but not the
non-pipelined ones. It may be a nice trade-off for very large sites running
with tens to hundreds of thousands of clients.

If this parameter is not set, the &quot;<a href="#http-request">http-request</a>&quot; timeout applies, and if both
are not set, &quot;<a href="#timeout%20client">timeout client</a>&quot; still applies at the lower level. It should be
set in the frontend to take effect, unless the frontend is in TCP mode, in
which case the HTTP backend's timeout will be used.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#timeout%20http-request">timeout http-request</a>&quot;, &quot;<a href="#timeout%20client">timeout client</a>&quot;.</div>
<a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout http-request"></a><a class="anchor" name="4-timeout http-request"></a><a class="anchor" name="4.2-timeout http-request"></a><a class="anchor" name="timeout http-request (Proxies)"></a><a class="anchor" name="timeout http-request (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout http-request"></a><a href="#4.2-timeout%20http-request">timeout http-request</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><pre class="text">Set the maximum allowed time to wait for a complete HTTP request
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">In order to offer DoS protection, it may be required to lower the maximum
accepted time to receive a complete HTTP request without affecting the client
timeout. This helps protecting against established connections on which
nothing is sent. The client timeout cannot offer a good protection against
this abuse because it is an inactivity timeout, which means that if the
attacker sends one character every now and then, the timeout will not
trigger. With the HTTP request timeout, no matter what speed the client
types, the request will be aborted if it does not complete in time. When the
timeout expires, an HTTP 408 response is sent to the client to inform it
about the problem, and the connection is closed. The logs will report
termination codes &quot;cR&quot;. Some recent browsers are having problems with this
standard, well-documented behaviour, so it might be needed to hide the 408
code using &quot;errorfile 408 /dev/null&quot;. See more details in the explanations of
the &quot;cR&quot; termination code in <a href="#8.5">section 8.5</a>.

Note that this timeout only applies to the header part of the request, and
not to any data. As soon as the empty line is received, this timeout is not
used anymore. It is used again on keep-alive connections to wait for a second
request if &quot;<a href="#timeout%20http-keep-alive">timeout http-keep-alive</a>&quot; is not set.

Generally it is enough to set it to a few seconds, as most clients send the
full request immediately upon connection. Add 3 or more seconds to cover TCP
retransmits but that's all. Setting it to very low values (eg: 50 ms) will
generally work on local networks as long as there are no packet losses. This
will prevent people from sending bare HTTP requests using telnet.

If this parameter is not set, the client timeout still applies between each
chunk of the incoming request. It should be set in the frontend to take
effect, unless the frontend is in TCP mode, in which case the HTTP backend's
timeout will be used.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#errorfile">errorfile</a>&quot;, &quot;<a href="#timeout%20http-keep-alive">timeout http-keep-alive</a>&quot;, &quot;<a href="#timeout%20client">timeout client</a>&quot;.</div>
<a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout queue"></a><a class="anchor" name="4-timeout queue"></a><a class="anchor" name="4.2-timeout queue"></a><a class="anchor" name="timeout queue (Proxies)"></a><a class="anchor" name="timeout queue (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout queue"></a><a href="#4.2-timeout%20queue">timeout queue</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><pre class="text">Set the maximum time to wait in the queue for a connection slot to be free
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">When a server's maxconn is reached, connections are left pending in a queue
which may be server-specific or global to the backend. In order not to wait
indefinitely, a timeout is applied to requests pending in the queue. If the
timeout is reached, it is considered that the request will almost never be
served, so it is dropped and a 503 error is returned to the client.

The &quot;<a href="#timeout%20queue">timeout queue</a>&quot; statement allows to fix the maximum time for a request to
be left pending in a queue. If unspecified, the same value as the backend's
connection timeout (&quot;<a href="#timeout%20connect">timeout connect</a>&quot;) is used, for backwards compatibility
with older versions with no &quot;<a href="#timeout%20queue">timeout queue</a>&quot; parameter.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#timeout%20connect">timeout connect</a>&quot;, &quot;<a href="#contimeout">contimeout</a>&quot;.</div>
<a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout server"></a><a class="anchor" name="4-timeout server"></a><a class="anchor" name="4.2-timeout server"></a><a class="anchor" name="timeout server (Proxies)"></a><a class="anchor" name="timeout server (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout server"></a><a href="#4.2-timeout%20server">timeout server</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout srvtimeout"></a><a class="anchor" name="4-timeout srvtimeout"></a><a class="anchor" name="4.2-timeout srvtimeout"></a><a class="anchor" name="timeout srvtimeout (Proxies)"></a><a class="anchor" name="timeout srvtimeout (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout srvtimeout"></a><a href="#4.2-timeout%20srvtimeout">timeout srvtimeout</a></b> <span style="color: #080">&lt;timeout&gt;</span> <span class="label label-warning">(deprecated)</span></div><pre class="text">Set the maximum inactivity time on the server side.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">The inactivity timeout applies when the server is expected to acknowledge or
send data. In HTTP mode, this timeout is particularly important to consider
during the first phase of the server's response, when it has to send the
headers, as it directly represents the server's processing time for the
request. To find out what value to put there, it's often good to start with
what would be considered as unacceptable response times, then check the logs
to observe the response time distribution, and adjust the value accordingly.

The value is specified in milliseconds by default, but can be in any other
unit if the number is suffixed by the unit, as specified at the top of this
document. In TCP mode (and to a lesser extent, in HTTP mode), it is highly
recommended that the client timeout remains equal to the server timeout in
order to avoid complex situations to debug. Whatever the expected server
response times, it is a good practice to cover at least one or several TCP
packet losses by specifying timeouts that are slightly above multiples of 3
seconds (eg: 4 or 5 seconds minimum). If some long-lived sessions are mixed
with short-lived sessions (eg: WebSocket and HTTP), it's worth considering
&quot;<a href="#timeout%20tunnel">timeout tunnel</a>&quot;, which overrides &quot;<a href="#timeout%20client">timeout client</a>&quot; and &quot;<a href="#timeout%20server">timeout server</a>&quot; for
tunnels.

This parameter is specific to backends, but can be specified once for all in
&quot;defaults&quot; sections. This is in fact one of the easiest solutions not to
forget about it. An unspecified timeout results in an infinite timeout, which
is not recommended. Such a usage is accepted and works but reports a warning
during startup because it may results in accumulation of expired sessions in
the system if the system's timeouts are not configured either.

This parameter replaces the old, deprecated &quot;<a href="#srvtimeout">srvtimeout</a>&quot;. It is recommended
to use it to write new configurations. The form &quot;<a href="#timeout%20srvtimeout">timeout srvtimeout</a>&quot; is
provided only by backwards compatibility but its use is strongly discouraged.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#srvtimeout">srvtimeout</a>&quot;, &quot;<a href="#timeout%20client">timeout client</a>&quot; and &quot;<a href="#timeout%20tunnel">timeout tunnel</a>&quot;.</div>
<a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout server-fin"></a><a class="anchor" name="4-timeout server-fin"></a><a class="anchor" name="4.2-timeout server-fin"></a><a class="anchor" name="timeout server-fin (Proxies)"></a><a class="anchor" name="timeout server-fin (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout server-fin"></a><a href="#4.2-timeout%20server-fin">timeout server-fin</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><pre class="text">Set the inactivity timeout on the server side for half-closed connections.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">The inactivity timeout applies when the server is expected to acknowledge or
send data while one direction is already shut down. This timeout is different
from &quot;<a href="#timeout%20server">timeout server</a>&quot; in that it only applies to connections which are closed
in one direction. This is particularly useful to avoid keeping connections in
FIN_WAIT state for too long when a remote server does not disconnect cleanly.
This problem is particularly common long connections such as RDP or WebSocket.
Note that this timeout can override &quot;<a href="#timeout%20tunnel">timeout tunnel</a>&quot; when a connection shuts
down in one direction. This setting was provided for completeness, but in most
situations, it should not be needed.

This parameter is specific to backends, but can be specified once for all in
&quot;defaults&quot; sections. By default it is not set, so half-closed connections
will use the other timeouts (timeout.server or timeout.tunnel).
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#timeout%20client-fin">timeout client-fin</a>&quot;, &quot;<a href="#timeout%20server">timeout server</a>&quot;, and &quot;<a href="#timeout%20tunnel">timeout tunnel</a>&quot;.</div>
<a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout tarpit"></a><a class="anchor" name="4-timeout tarpit"></a><a class="anchor" name="4.2-timeout tarpit"></a><a class="anchor" name="timeout tarpit (Proxies)"></a><a class="anchor" name="timeout tarpit (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout tarpit"></a><a href="#4.2-timeout%20tarpit">timeout tarpit</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><pre class="text">Set the duration for which tarpitted connections will be maintained
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the tarpit duration specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">When a connection is tarpitted using &quot;<a href="#reqtarpit">reqtarpit</a>&quot;, it is maintained open with
no activity for a certain amount of time, then closed. &quot;<a href="#timeout%20tarpit">timeout tarpit</a>&quot;
defines how long it will be maintained open.

The value is specified in milliseconds by default, but can be in any other
unit if the number is suffixed by the unit, as specified at the top of this
document. If unspecified, the same value as the backend's connection timeout
(&quot;<a href="#timeout%20connect">timeout connect</a>&quot;) is used, for backwards compatibility with older versions
with no &quot;<a href="#timeout%20tarpit">timeout tarpit</a>&quot; parameter.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#timeout%20connect">timeout connect</a>&quot;, &quot;<a href="#contimeout">contimeout</a>&quot;.</div>
<a class="anchor" name="timeout"></a><a class="anchor" name="4-timeout"></a><a class="anchor" name="4.2-timeout"></a><a class="anchor" name="timeout (Proxies)"></a><a class="anchor" name="timeout (Alphabetically sorted keywords reference)"></a><a class="anchor" name="timeout tunnel"></a><a class="anchor" name="4-timeout tunnel"></a><a class="anchor" name="4.2-timeout tunnel"></a><a class="anchor" name="timeout tunnel (Proxies)"></a><a class="anchor" name="timeout tunnel (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="timeout tunnel"></a><a href="#4.2-timeout%20tunnel">timeout tunnel</a></b> <span style="color: #080">&lt;timeout&gt;</span></div><pre class="text">Set the maximum inactivity time on the client and server side for tunnels.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;timeout&gt; is the timeout value specified in milliseconds by default, but
          can be in any other unit if the number is suffixed by the unit,
          as explained at the top of this document.</pre>
</div>
<pre class="text">The tunnel timeout applies when a bidirectional connection is established
between a client and a server, and the connection remains inactive in both
directions. This timeout supersedes both the client and server timeouts once
the connection becomes a tunnel. In TCP, this timeout is used as soon as no
analyser remains attached to either connection (eg: tcp content rules are
accepted). In HTTP, this timeout is used when a connection is upgraded (eg:
when switching to the WebSocket protocol, or forwarding a CONNECT request
to a proxy), or after the first response when no keepalive/close option is
specified.

Since this timeout is usually used in conjunction with long-lived connections,
it usually is a good idea to also set &quot;<a href="#timeout%20client-fin">timeout client-fin</a>&quot; to handle the
situation where a client suddenly disappears from the net and does not
acknowledge a close, or sends a shutdown and does not acknowledge pending
data anymore. This can happen in lossy networks where firewalls are present,
and is detected by the presence of large amounts of sessions in a FIN_WAIT
state.

The value is specified in milliseconds by default, but can be in any other
unit if the number is suffixed by the unit, as specified at the top of this
document. Whatever the expected normal idle time, it is a good practice to
cover at least one or several TCP packet losses by specifying timeouts that
are slightly above multiples of 3 seconds (eg: 4 or 5 seconds minimum).

This parameter is specific to backends, but can be specified once for all in
&quot;defaults&quot; sections. This is in fact one of the easiest solutions not to
forget about it.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>defaults http
    option http-server-close
    timeout connect 5s
    timeout client 30s
    timeout client-fin 30s
    timeout server 30s
    timeout tunnel  1h    <span class="comment"># timeout to use with WebSocket and CONNECT</span>
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;<a href="#timeout%20client">timeout client</a>&quot;, &quot;<a href="#timeout%20client-fin">timeout client-fin</a>&quot;, &quot;<a href="#timeout%20server">timeout server</a>&quot;.</div>
<a class="anchor" name="transparent"></a><a class="anchor" name="4-transparent"></a><a class="anchor" name="4.2-transparent"></a><a class="anchor" name="transparent (Proxies)"></a><a class="anchor" name="transparent (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="transparent"></a><a href="#4.2-transparent">transparent</a></b> <span class="label label-warning">(deprecated)</span></div><pre class="text">Enable client-side transparent proxying
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span> none
</div>
<pre class="text">This keyword was introduced in order to provide layer 7 persistence to layer
3 load balancers. The idea is to use the OS's ability to redirect an incoming
connection for a remote address to a local process (here HAProxy), and let
this process know what address was initially requested. When this option is
used, sessions without cookies will be forwarded to the original destination
IP address of the incoming request (which should match that of another
equipment), while requests with cookies will still be forwarded to the
appropriate server.

The &quot;<a href="#option%20transparent">transparent</a>&quot; keyword is deprecated, use &quot;<a href="#option%20transparent">option transparent</a>&quot; instead.

Note that contrary to a common belief, this option does NOT make HAProxy
present the client's IP to the server when establishing the connection.
</pre><div class="page-header"><b>See also:</b> &quot;<a href="#option%20transparent">option transparent</a>&quot;</div>
<a class="anchor" name="unique-id-format"></a><a class="anchor" name="4-unique-id-format"></a><a class="anchor" name="4.2-unique-id-format"></a><a class="anchor" name="unique-id-format (Proxies)"></a><a class="anchor" name="unique-id-format (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="unique-id-format"></a><a href="#4.2-unique-id-format">unique-id-format</a></b> <span style="color: #080">&lt;string&gt;</span></div><pre class="text">Generate a unique ID for each request.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;string&gt;   is a log-format string.</pre>
</div>
<pre class="text">This keyword creates a ID for each request using the custom log format. A
unique ID is useful to trace a request passing through many components of
a complex infrastructure. The newly created ID may also be logged using the
%ID tag the log-format string.

The format should be composed from elements that are guaranteed to be
unique when combined together. For instance, if multiple haproxy instances
are involved, it might be important to include the node name. It is often
needed to log the incoming connection's source and destination addresses
and ports. Note that since multiple requests may be performed over the same
connection, including a request counter may help differentiate them.
Similarly, a timestamp may protect against a rollover of the counter.
Logging the process ID will avoid collisions after a service restart.

It is recommended to use hexadecimal notation for many fields since it
makes them more compact and saves space in logs.
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>unique-id-format %{+X}o\ %ci:%cp_%fi:%fp_%Ts_%rt:%pid

will generate:

       7F000001:8296_7F00001E:1F90_4F7B0A69_0003:790A
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#unique-id-header">unique-id-header</a>&quot;</div>
<a class="anchor" name="unique-id-header"></a><a class="anchor" name="4-unique-id-header"></a><a class="anchor" name="4.2-unique-id-header"></a><a class="anchor" name="unique-id-header (Proxies)"></a><a class="anchor" name="unique-id-header (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="unique-id-header"></a><a href="#4.2-unique-id-header">unique-id-header</a></b> <span style="color: #080">&lt;name&gt;</span></div><pre class="text">Add a unique ID header in the HTTP request.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;name&gt;   is the name of the header.</pre>
</div>
<pre class="text">Add a unique-id header in the HTTP request sent to the server, using the
unique-id-format. It can't work if the unique-id-format doesn't exist.
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>    unique-id-format %{+X}o\ %ci:%cp_%fi:%fp_%Ts_%rt:%pid
    unique-id-header X-Unique-ID

    will generate:

       X-Unique-ID: 7F000001:8296_7F00001E:1F90_4F7B0A69_0003:790A

See also: &quot;<a href="#unique-id-format">unique-id-format</a>&quot;
</code></pre>
</div><a class="anchor" name="use_backend"></a><a class="anchor" name="4-use_backend"></a><a class="anchor" name="4.2-use_backend"></a><a class="anchor" name="use_backend (Proxies)"></a><a class="anchor" name="use_backend (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="use_backend"></a><a href="#4.2-use_backend">use_backend</a></b> <span style="color: #080">&lt;backend&gt;</span> <span style="color: #008">[<span style="color: #800">{if | unless}</span> <span style="color: #080">&lt;condition&gt;</span>]</span></div><pre class="text">Switch to a specific backend if/unless an ACL-based condition is matched.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;backend&gt;   is the name of a valid backend or &quot;listen&quot; section, or a
            &quot;<a href="#log-format">log-format</a>&quot; string resolving to a backend name.

&lt;condition&gt; is a condition composed of ACLs, as described in <a href="#7">section 7</a>. If
            it is omitted, the rule is unconditionally applied.</pre>
</div>
<pre class="text">When doing content-switching, connections arrive on a frontend and are then
dispatched to various backends depending on a number of conditions. The
relation between the conditions and the backends is described with the
&quot;<a href="#use_backend">use_backend</a>&quot; keyword. While it is normally used with HTTP processing, it can
also be used in pure TCP, either without content using stateless ACLs (eg:
source address validation) or combined with a &quot;<a href="#tcp-request">tcp-request</a>&quot; rule to wait for
some payload.

There may be as many &quot;<a href="#use_backend">use_backend</a>&quot; rules as desired. All of these rules are
evaluated in their declaration order, and the first one which matches will
assign the backend.

In the first form, the backend will be used if the condition is met. In the
second form, the backend will be used if the condition is not met. If no
condition is valid, the backend defined with &quot;<a href="#default_backend">default_backend</a>&quot; will be used.
If no default backend is defined, either the servers in the same section are
used (in case of a &quot;listen&quot; section) or, in case of a frontend, no server is
used and a 503 service unavailable response is returned.

Note that it is possible to switch from a TCP frontend to an HTTP backend. In
this case, either the frontend has already checked that the protocol is HTTP,
and backend processing will immediately follow, or the backend will wait for
a complete HTTP request to get in. This feature is useful when a frontend
must decode several protocols on a unique port, one of them being HTTP.

When &lt;backend&gt; is a simple name, it is resolved at configuration time, and an
error is reported if the specified backend does not exist. If &lt;backend&gt; is
a log-format string instead, no check may be done at configuration time, so
the backend name is resolved dynamically at run time. If the resulting
backend name does not correspond to any valid backend, no other rule is
evaluated, and the default_backend directive is applied instead. Note that
when using dynamic backend names, it is highly recommended to use a prefix
that no other backend uses in order to ensure that an unauthorized backend
cannot be forced from the request.

It is worth mentioning that &quot;<a href="#use_backend">use_backend</a>&quot; rules with an explicit name are
used to detect the association between frontends and backends to compute the
backend's &quot;<a href="#fullconn">fullconn</a>&quot; setting. This cannot be done for dynamic names.
</pre><div class="page-header"><b>See also:</b> &quot;<a href="#default_backend">default_backend</a>&quot;, &quot;<a href="#tcp-request">tcp-request</a>&quot;, &quot;<a href="#fullconn">fullconn</a>&quot;, &quot;<a href="#log-format">log-format</a>&quot;, and <a href="#7">section 7</a> about ACLs.</div>
<a class="anchor" name="use-server"></a><a class="anchor" name="4-use-server"></a><a class="anchor" name="4.2-use-server"></a><a class="anchor" name="use-server (Proxies)"></a><a class="anchor" name="use-server (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="use-server"></a><a href="#4.2-use-server">use-server</a></b> <span style="color: #080">&lt;server&gt;</span> if <span style="color: #080">&lt;condition&gt;</span></div><a class="anchor" name="use-server"></a><a class="anchor" name="4-use-server"></a><a class="anchor" name="4.2-use-server"></a><a class="anchor" name="use-server (Proxies)"></a><a class="anchor" name="use-server (Alphabetically sorted keywords reference)"></a><div class="keyword"><b><a class="anchor" name="use-server"></a><a href="#4.2-use-server">use-server</a></b> <span style="color: #080">&lt;server&gt;</span> unless <span style="color: #080">&lt;condition&gt;</span></div><pre class="text">Only use a specific server if/unless an ACL-based condition is matched.
</pre><div><p>  May be used in sections  :</p><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>defaults</th><th>frontend</th><th>listen</th><th>backend</th></tr></thead>
<tr><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-error pagination-centered">no<br /><img src="css/cross.png" alt="no" title="no" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td><td class="alert-success pagination-centered">yes<br /><img src="css/check.png" alt="yes" title="yes" /></td></tr>
</table></div>
<div class="separator">
<span class="label label-info">Arguments :</span><pre class="prettyprint arguments">&lt;server&gt;    is the name of a valid server in the same backend section.

&lt;condition&gt; is a condition composed of ACLs, as described in <a href="#7">section 7</a>.</pre>
</div>
<pre class="text">By default, connections which arrive to a backend are load-balanced across
the available servers according to the configured algorithm, unless a
persistence mechanism such as a cookie is used and found in the request.

Sometimes it is desirable to forward a particular request to a specific
server without having to declare a dedicated backend for this server. This
can be achieved using the &quot;<a href="#use-server">use-server</a>&quot; rules. These rules are evaluated after
the &quot;<a href="#redirect">redirect</a>&quot; rules and before evaluating cookies, and they have precedence
on them. There may be as many &quot;<a href="#use-server">use-server</a>&quot; rules as desired. All of these
rules are evaluated in their declaration order, and the first one which
matches will assign the server.

If a rule designates a server which is down, and &quot;<a href="#option%20persist">option persist</a>&quot; is not used
and no force-persist rule was validated, it is ignored and evaluation goes on
with the next rules until one matches.

In the first form, the server will be used if the condition is met. In the
second form, the server will be used if the condition is not met. If no
condition is valid, the processing continues and the server will be assigned
according to other persistence mechanisms.

Note that even if a rule is matched, cookie processing is still performed but
does not assign the server. This allows prefixed cookies to have their prefix
stripped.

The &quot;<a href="#use-server">use-server</a>&quot; statement works both in HTTP and TCP mode. This makes it
suitable for use with content-based inspection. For instance, a server could
be selected in a farm according to the TLS SNI field. And if these servers
have their weight set to zero, they will not be used for other traffic.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># intercept incoming TLS requests based on the SNI field</span>
use-server www if { req_ssl_sni -i www.example.com }
server     www 192.168.0.1:443 weight 0
use-server mail if { req_ssl_sni -i mail.example.com }
server     mail 192.168.0.1:587 weight 0
use-server imap if { req_ssl_sni -i imap.example.com }
server     mail 192.168.0.1:993 weight 0
<span class="comment"># all the rest is forwarded to this server</span>
server  default 192.168.0.2:443 check
</code></pre>
</div><div class="page-header"><b>See also:</b> &quot;<a href="#use_backend">use_backend</a>&quot;, <a href="#5">section 5</a> about server and <a href="#7">section 7</a> about ACLs.</div>
</div>
<a class="anchor" id="5" name="5"></a>
<div class="page-header"><h1 id="chapter-5" data-target="5"><small><a class="small" href="#5">5.</a></small> Bind and Server options</h1>
</div><div><pre class="text">The &quot;<a href="#bind">bind</a>&quot;, &quot;<a href="#server">server</a>&quot; and &quot;<a href="#default-server">default-server</a>&quot; keywords support a number of settings
depending on some build options and on the system HAProxy was built on. These
settings generally each consist in one word sometimes followed by a value,
written on the same line as the &quot;<a href="#bind">bind</a>&quot; or &quot;<a href="#server">server</a>&quot; line. All these options are
described in this section.
</pre></div>
<a class="anchor" id="5.1" name="5.1"></a>
<h2 id="chapter-5.1" data-target="5.1"><small><a class="small" href="#5.1">5.1.</a></small> Bind options</h2>
<div><pre class="text">The &quot;<a href="#bind">bind</a>&quot; keyword supports a certain number of settings which are all passed
as arguments on the same line. The order in which those arguments appear makes
no importance, provided that they appear after the bind address. All of these
parameters are optional. Some of them consist in a single words (booleans),
while other ones expect a value after them. In this case, the value must be
provided immediately after the setting name.

The currently supported settings are the following ones.
</pre><a class="anchor" name="accept-proxy"></a><a class="anchor" name="5-accept-proxy"></a><a class="anchor" name="5.1-accept-proxy"></a><a class="anchor" name="accept-proxy (Bind and Server options)"></a><a class="anchor" name="accept-proxy (Bind options)"></a><div class="keyword"><b><a class="anchor" name="accept-proxy"></a><a href="#5.1-accept-proxy">accept-proxy</a></b></div><pre class="text">Enforces the use of the PROXY protocol over any connection accepted by any of
the sockets declared on the same line. Versions 1 and 2 of the PROXY protocol
are supported and correctly detected. The PROXY protocol dictates the layer
3/4 addresses of the incoming connection to be used everywhere an address is
used, with the only exception of &quot;<a href="#tcp-request%20connection">tcp-request connection</a>&quot; rules which will
only see the real connection address. Logs will reflect the addresses
indicated in the protocol, unless it is violated, in which case the real
address will still be used.  This keyword combined with support from external
components can be used as an efficient and reliable alternative to the
X-Forwarded-For mechanism which is not always reliable and not even always
usable. See also &quot;tcp-request connection expect-proxy&quot; for a finer-grained
setting of which client is allowed to use the protocol.
</pre><a class="anchor" name="alpn"></a><a class="anchor" name="5-alpn"></a><a class="anchor" name="5.1-alpn"></a><a class="anchor" name="alpn (Bind and Server options)"></a><a class="anchor" name="alpn (Bind options)"></a><div class="keyword"><b><a class="anchor" name="alpn"></a><a href="#5.1-alpn">alpn</a></b> <span style="color: #080">&lt;protocols&gt;</span></div><pre class="text">This enables the TLS ALPN extension and advertises the specified protocol
list as supported on top of ALPN. The protocol list consists in a comma-
delimited list of protocol names, for instance: &quot;http/1.1,http/1.0&quot; (without
quotes). This requires that the SSL library is build with support for TLS
extensions enabled (check with haproxy -vv). The ALPN extension replaces the
initial NPN extension.
</pre><a class="anchor" name="backlog"></a><a class="anchor" name="5-backlog"></a><a class="anchor" name="5.1-backlog"></a><a class="anchor" name="backlog (Bind and Server options)"></a><a class="anchor" name="backlog (Bind options)"></a><div class="keyword"><b><a class="anchor" name="backlog"></a><a href="#5.1-backlog">backlog</a></b> <span style="color: #080">&lt;backlog&gt;</span></div><pre class="text">Sets the socket's backlog to this value. If unspecified, the frontend's
backlog is used instead, which generally defaults to the maxconn value.
</pre><a class="anchor" name="ecdhe"></a><a class="anchor" name="5-ecdhe"></a><a class="anchor" name="5.1-ecdhe"></a><a class="anchor" name="ecdhe (Bind and Server options)"></a><a class="anchor" name="ecdhe (Bind options)"></a><div class="keyword"><b><a class="anchor" name="ecdhe"></a><a href="#5.1-ecdhe">ecdhe</a></b> <span style="color: #080">&lt;named curve&gt;</span></div><pre class="text">This setting is only available when support for OpenSSL was built in. It sets
the named curve (RFC 4492) used to generate ECDH ephemeral keys. By default,
used named curve is prime256v1.
</pre><a class="anchor" name="ca-file"></a><a class="anchor" name="5-ca-file"></a><a class="anchor" name="5.1-ca-file"></a><a class="anchor" name="ca-file (Bind and Server options)"></a><a class="anchor" name="ca-file (Bind options)"></a><div class="keyword"><b><a class="anchor" name="ca-file"></a><a href="#5.1-ca-file">ca-file</a></b> <span style="color: #080">&lt;cafile&gt;</span></div><pre class="text">This setting is only available when support for OpenSSL was built in. It
designates a PEM file from which to load CA certificates used to verify
client's certificate.
</pre><a class="anchor" name="ca-ignore-err"></a><a class="anchor" name="5-ca-ignore-err"></a><a class="anchor" name="5.1-ca-ignore-err"></a><a class="anchor" name="ca-ignore-err (Bind and Server options)"></a><a class="anchor" name="ca-ignore-err (Bind options)"></a><div class="keyword"><b><a class="anchor" name="ca-ignore-err"></a><a href="#5.1-ca-ignore-err">ca-ignore-err</a></b> <span style="color: #008">[all|<span style="color: #080">&lt;errorID&gt;</span>,...]</span></div><pre class="text">This setting is only available when support for OpenSSL was built in.
Sets a comma separated list of errorIDs to ignore during verify at depth &gt; 0.
If set to 'all', all errors are ignored. SSL handshake is not aborted if an
error is ignored.
</pre><a class="anchor" name="ciphers"></a><a class="anchor" name="5-ciphers"></a><a class="anchor" name="5.1-ciphers"></a><a class="anchor" name="ciphers (Bind and Server options)"></a><a class="anchor" name="ciphers (Bind options)"></a><div class="keyword"><b><a class="anchor" name="ciphers"></a><a href="#5.1-ciphers">ciphers</a></b> <span style="color: #080">&lt;ciphers&gt;</span></div><pre class="text">This setting is only available when support for OpenSSL was built in. It sets
the string describing the list of cipher algorithms (&quot;cipher suite&quot;) that are
negotiated during the SSL/TLS handshake. The format of the string is defined
in &quot;man 1 ciphers&quot; from OpenSSL man pages, and can be for instance a string
such as &quot;AES:ALL:!aNULL:!eNULL:+RC4:@STRENGTH&quot; (without quotes).
</pre><a class="anchor" name="crl-file"></a><a class="anchor" name="5-crl-file"></a><a class="anchor" name="5.1-crl-file"></a><a class="anchor" name="crl-file (Bind and Server options)"></a><a class="anchor" name="crl-file (Bind options)"></a><div class="keyword"><b><a class="anchor" name="crl-file"></a><a href="#5.1-crl-file">crl-file</a></b> <span style="color: #080">&lt;crlfile&gt;</span></div><pre class="text">This setting is only available when support for OpenSSL was built in. It
designates a PEM file from which to load certificate revocation list used
to verify client's certificate.
</pre><a class="anchor" name="crt"></a><a class="anchor" name="5-crt"></a><a class="anchor" name="5.1-crt"></a><a class="anchor" name="crt (Bind and Server options)"></a><a class="anchor" name="crt (Bind options)"></a><div class="keyword"><b><a class="anchor" name="crt"></a><a href="#5.1-crt">crt</a></b> <span style="color: #080">&lt;cert&gt;</span></div><pre class="text">This setting is only available when support for OpenSSL was built in. It
designates a PEM file containing both the required certificates and any
associated private keys. This file can be built by concatenating multiple
PEM files into one (e.g. cat cert.pem key.pem &gt; combined.pem). If your CA
requires an intermediate certificate, this can also be concatenated into this
file.

If the OpenSSL used supports Diffie-Hellman, parameters present in this file
are loaded.

If a directory name is used instead of a PEM file, then all files found in
that directory will be loaded unless their name ends with '.issuer' or
'.ocsp' (reserved extensions). This directive may be specified multiple times
in order to load certificates from multiple files or directories. The
certificates will be presented to clients who provide a valid TLS Server Name
Indication field matching one of their CN or alt subjects. Wildcards are
supported, where a wildcard character '*' is used instead of the first
hostname component (eg: *.example.org matches www.example.org but not
www.sub.example.org).

If no SNI is provided by the client or if the SSL library does not support
TLS extensions, or if the client provides an SNI hostname which does not
match any certificate, then the first loaded certificate will be presented.
This means that when loading certificates from a directory, it is highly
recommended to load the default one first as a file.

Note that the same cert may be loaded multiple times without side effects.

Some CAs (such as Godaddy) offer a drop down list of server types that do not
include HAProxy when obtaining a certificate. If this happens be sure to
choose a webserver that the CA believes requires an intermediate CA (for
Godaddy, selection Apache Tomcat will get the correct bundle, but many
others, e.g. nginx, result in a wrong bundle that will not work for some
clients).

For each PEM file, haproxy checks for the presence of file at the same path
suffixed by &quot;.ocsp&quot;. If such file is found, support for the TLS Certificate
Status Request extension (also known as &quot;OCSP stapling&quot;) is automatically
enabled. The content of this file is optional. If not empty, it must contain
a valid OCSP Response in DER format. In order to be valid an OCSP Response
must comply with the following rules: it has to indicate a good status,
it has to be a single response for the certificate of the PEM file, and it
has to be valid at the moment of addition. If these rules are not respected
the OCSP Response is ignored and a warning is emitted. In order to  identify
which certificate an OCSP Response applies to, the issuer's certificate is
necessary. If the issuer's certificate is not found in the PEM file, it will
be loaded from a file at the same path as the PEM file suffixed by &quot;.issuer&quot;
if it exists otherwise it will fail with an error.
</pre><a class="anchor" name="crt-ignore-err"></a><a class="anchor" name="5-crt-ignore-err"></a><a class="anchor" name="5.1-crt-ignore-err"></a><a class="anchor" name="crt-ignore-err (Bind and Server options)"></a><a class="anchor" name="crt-ignore-err (Bind options)"></a><div class="keyword"><b><a class="anchor" name="crt-ignore-err"></a><a href="#5.1-crt-ignore-err">crt-ignore-err</a></b> <span style="color: #080">&lt;errors&gt;</span></div><pre class="text">This setting is only available when support for OpenSSL was built in. Sets a
comma separated list of errorIDs to ignore during verify at depth == 0.  If
set to 'all', all errors are ignored. SSL handshake is not aborted if an error
is ignored.
</pre><a class="anchor" name="crt-list"></a><a class="anchor" name="5-crt-list"></a><a class="anchor" name="5.1-crt-list"></a><a class="anchor" name="crt-list (Bind and Server options)"></a><a class="anchor" name="crt-list (Bind options)"></a><div class="keyword"><b><a class="anchor" name="crt-list"></a><a href="#5.1-crt-list">crt-list</a></b> <span style="color: #080">&lt;file&gt;</span></div><pre class="text">This setting is only available when support for OpenSSL was built in. It
designates a list of PEM file with an optional list of SNI filter per
certificate, with the following format for each line :

      &lt;crtfile&gt; [[!]&lt;snifilter&gt; ...]

Wildcards are supported in the SNI filter. Negative filter are also supported,
only useful in combination with a wildcard filter to exclude a particular SNI.
The certificates will be presented to clients who provide a valid TLS Server
Name Indication field matching one of the SNI filters. If no SNI filter is
specified, the CN and alt subjects are used. This directive may be specified
multiple times. See the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">crt<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#crt%20%28Bind%20options%29">Bind options</a></li><li><a href="#crt%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; option for more information. The default
certificate is still needed to meet OpenSSL expectations. If it is not used,
the 'strict-sni' option may be used.
</pre><a class="anchor" name="defer-accept"></a><a class="anchor" name="5-defer-accept"></a><a class="anchor" name="5.1-defer-accept"></a><a class="anchor" name="defer-accept (Bind and Server options)"></a><a class="anchor" name="defer-accept (Bind options)"></a><div class="keyword"><b><a class="anchor" name="defer-accept"></a><a href="#5.1-defer-accept">defer-accept</a></b></div><pre class="text">Is an optional keyword which is supported only on certain Linux kernels. It
states that a connection will only be accepted once some data arrive on it,
or at worst after the first retransmit. This should be used only on protocols
for which the client talks first (eg: HTTP). It can slightly improve
performance by ensuring that most of the request is already available when
the connection is accepted. On the other hand, it will not be able to detect
connections which don't talk. It is important to note that this option is
broken in all kernels up to 2.6.31, as the connection is never accepted until
the client talks. This can cause issues with front firewalls which would see
an established connection while the proxy will only see it in SYN_RECV. This
option is only supported on TCPv4/TCPv6 sockets and ignored by other ones.
</pre><a class="anchor" name="force-sslv3"></a><a class="anchor" name="5-force-sslv3"></a><a class="anchor" name="5.1-force-sslv3"></a><a class="anchor" name="force-sslv3 (Bind and Server options)"></a><a class="anchor" name="force-sslv3 (Bind options)"></a><div class="keyword"><b><a class="anchor" name="force-sslv3"></a><a href="#5.1-force-sslv3">force-sslv3</a></b></div><pre class="text">This option enforces use of SSLv3 only on SSL connections instantiated from
this listener. SSLv3 is generally less expensive than the TLS counterparts
for high connection rates. See also &quot;force-tls*&quot;, &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">no-sslv3<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#no-sslv3%20%28Bind%20options%29">Bind options</a></li><li><a href="#no-sslv3%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;, and &quot;no-tls*&quot;.
</pre><a class="anchor" name="force-tlsv10"></a><a class="anchor" name="5-force-tlsv10"></a><a class="anchor" name="5.1-force-tlsv10"></a><a class="anchor" name="force-tlsv10 (Bind and Server options)"></a><a class="anchor" name="force-tlsv10 (Bind options)"></a><div class="keyword"><b><a class="anchor" name="force-tlsv10"></a><a href="#5.1-force-tlsv10">force-tlsv10</a></b></div><pre class="text">This option enforces use of TLSv1.0 only on SSL connections instantiated from
this listener. See also &quot;force-tls*&quot;, &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">no-sslv3<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#no-sslv3%20%28Bind%20options%29">Bind options</a></li><li><a href="#no-sslv3%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;, and &quot;no-tls*&quot;.
</pre><a class="anchor" name="force-tlsv11"></a><a class="anchor" name="5-force-tlsv11"></a><a class="anchor" name="5.1-force-tlsv11"></a><a class="anchor" name="force-tlsv11 (Bind and Server options)"></a><a class="anchor" name="force-tlsv11 (Bind options)"></a><div class="keyword"><b><a class="anchor" name="force-tlsv11"></a><a href="#5.1-force-tlsv11">force-tlsv11</a></b></div><pre class="text">This option enforces use of TLSv1.1 only on SSL connections instantiated from
this listener. See also &quot;force-tls*&quot;, &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">no-sslv3<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#no-sslv3%20%28Bind%20options%29">Bind options</a></li><li><a href="#no-sslv3%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;, and &quot;no-tls*&quot;.
</pre><a class="anchor" name="force-tlsv12"></a><a class="anchor" name="5-force-tlsv12"></a><a class="anchor" name="5.1-force-tlsv12"></a><a class="anchor" name="force-tlsv12 (Bind and Server options)"></a><a class="anchor" name="force-tlsv12 (Bind options)"></a><div class="keyword"><b><a class="anchor" name="force-tlsv12"></a><a href="#5.1-force-tlsv12">force-tlsv12</a></b></div><pre class="text">This option enforces use of TLSv1.2 only on SSL connections instantiated from
this listener. See also &quot;force-tls*&quot;, &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">no-sslv3<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#no-sslv3%20%28Bind%20options%29">Bind options</a></li><li><a href="#no-sslv3%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;, and &quot;no-tls*&quot;.
</pre><a class="anchor" name="gid"></a><a class="anchor" name="5-gid"></a><a class="anchor" name="5.1-gid"></a><a class="anchor" name="gid (Bind and Server options)"></a><a class="anchor" name="gid (Bind options)"></a><div class="keyword"><b><a class="anchor" name="gid"></a><a href="#5.1-gid">gid</a></b> <span style="color: #080">&lt;gid&gt;</span></div><pre class="text">Sets the group of the UNIX sockets to the designated system gid. It can also
be set by default in the global section's &quot;<a href="#unix-bind">unix-bind</a>&quot; statement. Note that
some platforms simply ignore this. This setting is equivalent to the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">group<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#group%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#group%20%28Userlists%29">Userlists</a></li><li><a href="#group%20%28Bind%20options%29">Bind options</a></li></ul></span>&quot;
setting except that the group ID is used instead of its name. This setting is
ignored by non UNIX sockets.
</pre><a class="anchor" name="group"></a><a class="anchor" name="5-group"></a><a class="anchor" name="5.1-group"></a><a class="anchor" name="group (Bind and Server options)"></a><a class="anchor" name="group (Bind options)"></a><div class="keyword"><b><a class="anchor" name="group"></a><a href="#5.1-group">group</a></b> <span style="color: #080">&lt;group&gt;</span></div><pre class="text">Sets the group of the UNIX sockets to the designated system group. It can
also be set by default in the global section's &quot;<a href="#unix-bind">unix-bind</a>&quot; statement. Note
that some platforms simply ignore this. This setting is equivalent to the
&quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">gid<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#gid%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#gid%20%28Bind%20options%29">Bind options</a></li></ul></span>&quot; setting except that the group name is used instead of its gid. This
setting is ignored by non UNIX sockets.
</pre><a class="anchor" name="id"></a><a class="anchor" name="5-id"></a><a class="anchor" name="5.1-id"></a><a class="anchor" name="id (Bind and Server options)"></a><a class="anchor" name="id (Bind options)"></a><div class="keyword"><b><a class="anchor" name="id"></a><a href="#5.1-id">id</a></b> <span style="color: #080">&lt;id&gt;</span></div><pre class="text">Fixes the socket ID. By default, socket IDs are automatically assigned, but
sometimes it is more convenient to fix them to ease monitoring. This value
must be strictly positive and unique within the listener/frontend. This
option can only be used when defining only a single socket.
</pre><a class="anchor" name="interface"></a><a class="anchor" name="5-interface"></a><a class="anchor" name="5.1-interface"></a><a class="anchor" name="interface (Bind and Server options)"></a><a class="anchor" name="interface (Bind options)"></a><div class="keyword"><b><a class="anchor" name="interface"></a><a href="#5.1-interface">interface</a></b> <span style="color: #080">&lt;interface&gt;</span></div><pre class="text">Restricts the socket to a specific interface. When specified, only packets
received from that particular interface are processed by the socket. This is
currently only supported on Linux. The interface must be a primary system
interface, not an aliased interface. It is also possible to bind multiple
frontends to the same address if they are bound to different interfaces. Note
that binding to a network interface requires root privileges. This parameter
is only compatible with TCPv4/TCPv6 sockets.
</pre><a class="anchor" name="level"></a><a class="anchor" name="5-level"></a><a class="anchor" name="5.1-level"></a><a class="anchor" name="level (Bind and Server options)"></a><a class="anchor" name="level (Bind options)"></a><div class="keyword"><b><a class="anchor" name="level"></a><a href="#5.1-level">level</a></b> <span style="color: #080">&lt;level&gt;</span></div><pre class="text">This setting is used with the stats sockets only to restrict the nature of
the commands that can be issued on the socket. It is ignored by other
sockets. &lt;level&gt; can be one of :
- &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">user<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#user%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#user%20%28Userlists%29">Userlists</a></li><li><a href="#user%20%28Bind%20options%29">Bind options</a></li></ul></span>&quot; is the least privileged level ; only non-sensitive stats can be
  read, and no change is allowed. It would make sense on systems where it
  is not easy to restrict access to the socket.
- &quot;operator&quot; is the default level and fits most common uses. All data can
  be read, and only non-sensitive changes are permitted (eg: clear max
  counters).
- &quot;admin&quot; should be used with care, as everything is permitted (eg: clear
  all counters).
</pre><a class="anchor" name="maxconn"></a><a class="anchor" name="5-maxconn"></a><a class="anchor" name="5.1-maxconn"></a><a class="anchor" name="maxconn (Bind and Server options)"></a><a class="anchor" name="maxconn (Bind options)"></a><div class="keyword"><b><a class="anchor" name="maxconn"></a><a href="#5.1-maxconn">maxconn</a></b> <span style="color: #080">&lt;maxconn&gt;</span></div><pre class="text">Limits the sockets to this number of concurrent connections. Extraneous
connections will remain in the system's backlog until a connection is
released. If unspecified, the limit will be the same as the frontend's
maxconn. Note that in case of port ranges or multiple addresses, the same
value will be applied to each socket. This setting enables different
limitations on expensive sockets, for instance SSL entries which may easily
eat all memory.
</pre><a class="anchor" name="mode"></a><a class="anchor" name="5-mode"></a><a class="anchor" name="5.1-mode"></a><a class="anchor" name="mode (Bind and Server options)"></a><a class="anchor" name="mode (Bind options)"></a><div class="keyword"><b><a class="anchor" name="mode"></a><a href="#5.1-mode">mode</a></b> <span style="color: #080">&lt;mode&gt;</span></div><pre class="text">Sets the octal mode used to define access permissions on the UNIX socket. It
can also be set by default in the global section's &quot;<a href="#unix-bind">unix-bind</a>&quot; statement.
Note that some platforms simply ignore this. This setting is ignored by non
UNIX sockets.
</pre><a class="anchor" name="mss"></a><a class="anchor" name="5-mss"></a><a class="anchor" name="5.1-mss"></a><a class="anchor" name="mss (Bind and Server options)"></a><a class="anchor" name="mss (Bind options)"></a><div class="keyword"><b><a class="anchor" name="mss"></a><a href="#5.1-mss">mss</a></b> <span style="color: #080">&lt;maxseg&gt;</span></div><pre class="text">Sets the TCP Maximum Segment Size (MSS) value to be advertised on incoming
connections. This can be used to force a lower MSS for certain specific
ports, for instance for connections passing through a VPN. Note that this
relies on a kernel feature which is theoretically supported under Linux but
was buggy in all versions prior to 2.6.28. It may or may not work on other
operating systems. It may also not change the advertised value but change the
effective size of outgoing segments. The commonly advertised value for TCPv4
over Ethernet networks is 1460 = 1500(MTU) - 40(IP+TCP). If this value is
positive, it will be used as the advertised MSS. If it is negative, it will
indicate by how much to reduce the incoming connection's advertised MSS for
outgoing segments. This parameter is only compatible with TCP v4/v6 sockets.
</pre><a class="anchor" name="name"></a><a class="anchor" name="5-name"></a><a class="anchor" name="5.1-name"></a><a class="anchor" name="name (Bind and Server options)"></a><a class="anchor" name="name (Bind options)"></a><div class="keyword"><b><a class="anchor" name="name"></a><a href="#5.1-name">name</a></b> <span style="color: #080">&lt;name&gt;</span></div><pre class="text">Sets an optional name for these sockets, which will be reported on the stats
page.
</pre><a class="anchor" name="nice"></a><a class="anchor" name="5-nice"></a><a class="anchor" name="5.1-nice"></a><a class="anchor" name="nice (Bind and Server options)"></a><a class="anchor" name="nice (Bind options)"></a><div class="keyword"><b><a class="anchor" name="nice"></a><a href="#5.1-nice">nice</a></b> <span style="color: #080">&lt;nice&gt;</span></div><pre class="text">Sets the 'niceness' of connections initiated from the socket. Value must be
in the range -1024..1024 inclusive, and defaults to zero. Positive values
means that such connections are more friendly to others and easily offer
their place in the scheduler. On the opposite, negative values mean that
connections want to run with a higher priority than others. The difference
only happens under high loads when the system is close to saturation.
Negative values are appropriate for low-latency or administration services,
and high values are generally recommended for CPU intensive tasks such as SSL
processing or bulk transfers which are less sensible to latency. For example,
it may make sense to use a positive value for an SMTP socket and a negative
one for an RDP socket.
</pre><a class="anchor" name="no-sslv3"></a><a class="anchor" name="5-no-sslv3"></a><a class="anchor" name="5.1-no-sslv3"></a><a class="anchor" name="no-sslv3 (Bind and Server options)"></a><a class="anchor" name="no-sslv3 (Bind options)"></a><div class="keyword"><b><a class="anchor" name="no-sslv3"></a><a href="#5.1-no-sslv3">no-sslv3</a></b></div><pre class="text">This setting is only available when support for OpenSSL was built in. It
disables support for SSLv3 on any sockets instantiated from the listener when
SSL is supported. Note that SSLv2 is forced disabled in the code and cannot
be enabled using any configuration option. See also &quot;force-tls*&quot;,
and &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">force-sslv3<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#force-sslv3%20%28Bind%20options%29">Bind options</a></li><li><a href="#force-sslv3%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;.
</pre><a class="anchor" name="no-tls-tickets"></a><a class="anchor" name="5-no-tls-tickets"></a><a class="anchor" name="5.1-no-tls-tickets"></a><a class="anchor" name="no-tls-tickets (Bind and Server options)"></a><a class="anchor" name="no-tls-tickets (Bind options)"></a><div class="keyword"><b><a class="anchor" name="no-tls-tickets"></a><a href="#5.1-no-tls-tickets">no-tls-tickets</a></b></div><pre class="text">This setting is only available when support for OpenSSL was built in. It
disables the stateless session resumption (RFC 5077 TLS Ticket
extension) and force to use stateful session resumption. Stateless
session resumption is more expensive in CPU usage.
</pre><a class="anchor" name="no-tlsv10"></a><a class="anchor" name="5-no-tlsv10"></a><a class="anchor" name="5.1-no-tlsv10"></a><a class="anchor" name="no-tlsv10 (Bind and Server options)"></a><a class="anchor" name="no-tlsv10 (Bind options)"></a><div class="keyword"><b><a class="anchor" name="no-tlsv10"></a><a href="#5.1-no-tlsv10">no-tlsv10</a></b></div><pre class="text">This setting is only available when support for OpenSSL was built in. It
disables support for TLSv1.0 on any sockets instantiated from the listener
when SSL is supported. Note that SSLv2 is forced disabled in the code and
cannot be enabled using any configuration option. See also &quot;force-tls*&quot;,
and &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">force-sslv3<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#force-sslv3%20%28Bind%20options%29">Bind options</a></li><li><a href="#force-sslv3%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;.
</pre><a class="anchor" name="no-tlsv11"></a><a class="anchor" name="5-no-tlsv11"></a><a class="anchor" name="5.1-no-tlsv11"></a><a class="anchor" name="no-tlsv11 (Bind and Server options)"></a><a class="anchor" name="no-tlsv11 (Bind options)"></a><div class="keyword"><b><a class="anchor" name="no-tlsv11"></a><a href="#5.1-no-tlsv11">no-tlsv11</a></b></div><pre class="text">This setting is only available when support for OpenSSL was built in. It
disables support for TLSv1.1 on any sockets instantiated from the listener
when SSL is supported. Note that SSLv2 is forced disabled in the code and
cannot be enabled using any configuration option. See also &quot;force-tls*&quot;,
and &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">force-sslv3<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#force-sslv3%20%28Bind%20options%29">Bind options</a></li><li><a href="#force-sslv3%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;.
</pre><a class="anchor" name="no-tlsv12"></a><a class="anchor" name="5-no-tlsv12"></a><a class="anchor" name="5.1-no-tlsv12"></a><a class="anchor" name="no-tlsv12 (Bind and Server options)"></a><a class="anchor" name="no-tlsv12 (Bind options)"></a><div class="keyword"><b><a class="anchor" name="no-tlsv12"></a><a href="#5.1-no-tlsv12">no-tlsv12</a></b></div><pre class="text">This setting is only available when support for OpenSSL was built in. It
disables support for TLSv1.2 on any sockets instantiated from the listener
when SSL is supported. Note that SSLv2 is forced disabled in the code and
cannot be enabled using any configuration option. See also &quot;force-tls*&quot;,
and &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">force-sslv3<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#force-sslv3%20%28Bind%20options%29">Bind options</a></li><li><a href="#force-sslv3%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;.
</pre><a class="anchor" name="npn"></a><a class="anchor" name="5-npn"></a><a class="anchor" name="5.1-npn"></a><a class="anchor" name="npn (Bind and Server options)"></a><a class="anchor" name="npn (Bind options)"></a><div class="keyword"><b><a class="anchor" name="npn"></a><a href="#5.1-npn">npn</a></b> <span style="color: #080">&lt;protocols&gt;</span></div><pre class="text">This enables the NPN TLS extension and advertises the specified protocol list
as supported on top of NPN. The protocol list consists in a comma-delimited
list of protocol names, for instance: &quot;http/1.1,http/1.0&quot; (without quotes).
This requires that the SSL library is build with support for TLS extensions
enabled (check with haproxy -vv). Note that the NPN extension has been
replaced with the ALPN extension (see the &quot;<a href="#alpn">alpn</a>&quot; keyword).
</pre><a class="anchor" name="process"></a><a class="anchor" name="5-process"></a><a class="anchor" name="5.1-process"></a><a class="anchor" name="process (Bind and Server options)"></a><a class="anchor" name="process (Bind options)"></a><div class="keyword"><b><a class="anchor" name="process"></a><a href="#5.1-process">process</a></b> <span style="color: #008">[ all | odd | even | <span style="color: #080">&lt;number 1-64&gt;</span><span style="color: #008">[-<span style="color: #080">&lt;number 1-64&gt;</span>]</span> ]</span></div><pre class="text">This restricts the list of processes on which this listener is allowed to
run. It does not enforce any process but eliminates those which do not match.
If the frontend uses a &quot;<a href="#bind-process">bind-process</a>&quot; setting, the intersection between the
two is applied. If in the end the listener is not allowed to run on any
remaining process, a warning is emitted, and the listener will either run on
the first process of the listener if a single process was specified, or on
all of its processes if multiple processes were specified. For the unlikely
case where several ranges are needed, this directive may be repeated. The
main purpose of this directive is to be used with the stats sockets and have
one different socket per process. The second purpose is to have multiple bind
lines sharing the same IP:port but not the same process in a listener, so
that the system can distribute the incoming connections into multiple queues
and allow a smoother inter-process load balancing. Currently Linux 3.9 and
above is known for supporting this. See also &quot;<a href="#bind-process">bind-process</a>&quot; and &quot;<a href="#nbproc">nbproc</a>&quot;.
</pre><a class="anchor" name="ssl"></a><a class="anchor" name="5-ssl"></a><a class="anchor" name="5.1-ssl"></a><a class="anchor" name="ssl (Bind and Server options)"></a><a class="anchor" name="ssl (Bind options)"></a><div class="keyword"><b><a class="anchor" name="ssl"></a><a href="#5.1-ssl">ssl</a></b></div><pre class="text">This setting is only available when support for OpenSSL was built in. It
enables SSL deciphering on connections instantiated from this listener. A
certificate is necessary (see &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">crt<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#crt%20%28Bind%20options%29">Bind options</a></li><li><a href="#crt%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; above). All contents in the buffers will
appear in clear text, so that ACLs and HTTP processing will only have access
to deciphered contents.
</pre><a class="anchor" name="strict-sni"></a><a class="anchor" name="5-strict-sni"></a><a class="anchor" name="5.1-strict-sni"></a><a class="anchor" name="strict-sni (Bind and Server options)"></a><a class="anchor" name="strict-sni (Bind options)"></a><div class="keyword"><b><a class="anchor" name="strict-sni"></a><a href="#5.1-strict-sni">strict-sni</a></b></div><pre class="text">This setting is only available when support for OpenSSL was built in. The
SSL/TLS negotiation is allow only if the client provided an SNI which match
a certificate. The default certificate is not used.
See the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">crt<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#crt%20%28Bind%20options%29">Bind options</a></li><li><a href="#crt%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; option for more information.
</pre><a class="anchor" name="tfo"></a><a class="anchor" name="5-tfo"></a><a class="anchor" name="5.1-tfo"></a><a class="anchor" name="tfo (Bind and Server options)"></a><a class="anchor" name="tfo (Bind options)"></a><div class="keyword"><b><a class="anchor" name="tfo"></a><a href="#5.1-tfo">tfo</a></b></div><pre class="text">Is an optional keyword which is supported only on Linux kernels &gt;= 3.7. It
enables TCP Fast Open on the listening socket, which means that clients which
support this feature will be able to send a request and receive a response
during the 3-way handshake starting from second connection, thus saving one
round-trip after the first connection. This only makes sense with protocols
that use high connection rates and where each round trip matters. This can
possibly cause issues with many firewalls which do not accept data on SYN
packets, so this option should only be enabled once well tested. This option
is only supported on TCPv4/TCPv6 sockets and ignored by other ones. You may
need to build HAProxy with USE_TFO=1 if your libc doesn't define
TCP_FASTOPEN.
</pre><a class="anchor" name="transparent"></a><a class="anchor" name="5-transparent"></a><a class="anchor" name="5.1-transparent"></a><a class="anchor" name="transparent (Bind and Server options)"></a><a class="anchor" name="transparent (Bind options)"></a><div class="keyword"><b><a class="anchor" name="transparent"></a><a href="#5.1-transparent">transparent</a></b></div><pre class="text">Is an optional keyword which is supported only on certain Linux kernels. It
indicates that the addresses will be bound even if they do not belong to the
local machine, and that packets targeting any of these addresses will be
intercepted just as if the addresses were locally configured. This normally
requires that IP forwarding is enabled. Caution! do not use this with the
default address '*', as it would redirect any traffic for the specified port.
This keyword is available only when HAProxy is built with USE_LINUX_TPROXY=1.
This parameter is only compatible with TCPv4 and TCPv6 sockets, depending on
kernel version. Some distribution kernels include backports of the feature,
so check for support with your vendor.
</pre><a class="anchor" name="v4v6"></a><a class="anchor" name="5-v4v6"></a><a class="anchor" name="5.1-v4v6"></a><a class="anchor" name="v4v6 (Bind and Server options)"></a><a class="anchor" name="v4v6 (Bind options)"></a><div class="keyword"><b><a class="anchor" name="v4v6"></a><a href="#5.1-v4v6">v4v6</a></b></div><pre class="text">Is an optional keyword which is supported only on most recent systems
including Linux kernels &gt;= 2.4.21. It is used to bind a socket to both IPv4
and IPv6 when it uses the default address. Doing so is sometimes necessary
on systems which bind to IPv6 only by default. It has no effect on non-IPv6
sockets, and is overridden by the &quot;<a href="#v6only">v6only</a>&quot; option.
</pre><a class="anchor" name="v6only"></a><a class="anchor" name="5-v6only"></a><a class="anchor" name="5.1-v6only"></a><a class="anchor" name="v6only (Bind and Server options)"></a><a class="anchor" name="v6only (Bind options)"></a><div class="keyword"><b><a class="anchor" name="v6only"></a><a href="#5.1-v6only">v6only</a></b></div><pre class="text">Is an optional keyword which is supported only on most recent systems
including Linux kernels &gt;= 2.4.21. It is used to bind a socket to IPv6 only
when it uses the default address. Doing so is sometimes preferred to doing it
system-wide as it is per-listener. It has no effect on non-IPv6 sockets and
has precedence over the &quot;<a href="#v4v6">v4v6</a>&quot; option.
</pre><a class="anchor" name="uid"></a><a class="anchor" name="5-uid"></a><a class="anchor" name="5.1-uid"></a><a class="anchor" name="uid (Bind and Server options)"></a><a class="anchor" name="uid (Bind options)"></a><div class="keyword"><b><a class="anchor" name="uid"></a><a href="#5.1-uid">uid</a></b> <span style="color: #080">&lt;uid&gt;</span></div><pre class="text">Sets the owner of the UNIX sockets to the designated system uid. It can also
be set by default in the global section's &quot;<a href="#unix-bind">unix-bind</a>&quot; statement. Note that
some platforms simply ignore this. This setting is equivalent to the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">user<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#user%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#user%20%28Userlists%29">Userlists</a></li><li><a href="#user%20%28Bind%20options%29">Bind options</a></li></ul></span>&quot;
setting except that the user numeric ID is used instead of its name. This
setting is ignored by non UNIX sockets.
</pre><a class="anchor" name="user"></a><a class="anchor" name="5-user"></a><a class="anchor" name="5.1-user"></a><a class="anchor" name="user (Bind and Server options)"></a><a class="anchor" name="user (Bind options)"></a><div class="keyword"><b><a class="anchor" name="user"></a><a href="#5.1-user">user</a></b> <span style="color: #080">&lt;user&gt;</span></div><pre class="text">Sets the owner of the UNIX sockets to the designated system user. It can also
be set by default in the global section's &quot;<a href="#unix-bind">unix-bind</a>&quot; statement. Note that
some platforms simply ignore this. This setting is equivalent to the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">uid<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#uid%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#uid%20%28Bind%20options%29">Bind options</a></li></ul></span>&quot;
setting except that the user name is used instead of its uid. This setting is
ignored by non UNIX sockets.
</pre><a class="anchor" name="verify"></a><a class="anchor" name="5-verify"></a><a class="anchor" name="5.1-verify"></a><a class="anchor" name="verify (Bind and Server options)"></a><a class="anchor" name="verify (Bind options)"></a><div class="keyword"><b><a class="anchor" name="verify"></a><a href="#5.1-verify">verify</a></b> <span style="color: #008">[none|optional|required]</span></div><pre class="text">This setting is only available when support for OpenSSL was built in. If set
to 'none', client certificate is not requested. This is the default. In other
cases, a client certificate is requested. If the client does not provide a
certificate after the request and if 'verify' is set to 'required', then the
handshake is aborted, while it would have succeeded if set to 'optional'. The
certificate provided by the client is always verified using CAs from
'ca-file' and optional CRLs from 'crl-file'. On verify failure the handshake
is aborted, regardless of the 'verify' option, unless the error code exactly
matches one of those listed with 'ca-ignore-err' or 'crt-ignore-err'.
</pre></div>
<a class="anchor" id="5.2" name="5.2"></a>
<h2 id="chapter-5.2" data-target="5.2"><small><a class="small" href="#5.2">5.2.</a></small> Server and default-server options</h2>
<div><pre class="text">The &quot;<a href="#server">server</a>&quot; and &quot;<a href="#default-server">default-server</a>&quot; keywords support a certain number of settings
which are all passed as arguments on the server line. The order in which those
arguments appear does not count, and they are all optional. Some of those
settings are single words (booleans) while others expect one or several values
after them. In this case, the values must immediately follow the setting name.
Except default-server, all those settings must be specified after the server's
address if they are used:

  server &lt;name&gt; &lt;address&gt;[:port] [settings ...]
  default-server [settings ...]

The currently supported settings are the following ones.
</pre><a class="anchor" name="addr"></a><a class="anchor" name="5-addr"></a><a class="anchor" name="5.2-addr"></a><a class="anchor" name="addr (Bind and Server options)"></a><a class="anchor" name="addr (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="addr"></a><a href="#5.2-addr">addr</a></b> <span style="color: #080">&lt;ipv4|ipv6&gt;</span></div><pre class="text">Using the &quot;<a href="#addr">addr</a>&quot; parameter, it becomes possible to use a different IP address
to send health-checks. On some servers, it may be desirable to dedicate an IP
address to specific component able to perform complex tests which are more
suitable to health-checks than the application. This parameter is ignored if
the &quot;<a href="#check">check</a>&quot; parameter is not set. See also the &quot;<a href="#port">port</a>&quot; parameter.

Supported in default-server: No
</pre><a class="anchor" name="agent-check"></a><a class="anchor" name="5-agent-check"></a><a class="anchor" name="5.2-agent-check"></a><a class="anchor" name="agent-check (Bind and Server options)"></a><a class="anchor" name="agent-check (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="agent-check"></a><a href="#5.2-agent-check">agent-check</a></b></div><pre class="text">Enable an auxiliary agent check which is run independently of a regular
health check. An agent health check is performed by making a TCP connection
to the port set by the &quot;<a href="#agent-port">agent-port</a>&quot; parameter and reading an ASCII string.
The string is made of a series of words delimited by spaces, tabs or commas
in any order, optionally terminated by '\r' and/or '\n', each consisting of :

- An ASCII representation of a positive integer percentage, e.g. &quot;75%&quot;.
  Values in this format will set the weight proportional to the initial
  weight of a server as configured when haproxy starts.

- The word &quot;ready&quot;. This will turn the server's administrative state to the
  READY mode, thus cancelling any DRAIN or MAINT state

- The word &quot;drain&quot;. This will turn the server's administrative state to the
  DRAIN mode, thus it will not accept any new connections other than those
  that are accepted via persistence.

- The word &quot;maint&quot;. This will turn the server's administrative state to the
  MAINT mode, thus it will not accept any new connections at all, and health
  checks will be stopped.

- The words &quot;down&quot;, &quot;failed&quot;, or &quot;stopped&quot;, optionally followed by a
  description string after a sharp ('#'). All of these mark the server's
  operating state as DOWN, but since the word itself is reported on the stats
  page, the difference allows an administrator to know if the situation was
  expected or not : the service may intentionally be stopped, may appear up
  but fail some validity tests, or may be seen as down (eg: missing process,
  or port not responding).

- The word &quot;up&quot; sets back the server's operating state as UP if health checks
  also report that the service is accessible.

Parameters which are not advertised by the agent are not changed. For
example, an agent might be designed to monitor CPU usage and only report a
relative weight and never interact with the operating status. Similarly, an
agent could be designed as an end-user interface with 3 radio buttons
allowing an administrator to change only the administrative state. However,
it is important to consider that only the agent may revert its own actions,
so if a server is set to DRAIN mode or to DOWN state using the agent, the
agent must implement the other equivalent actions to bring the service into
operations again.

Failure to connect to the agent is not considered an error as connectivity
is tested by the regular health check which is enabled by the &quot;<a href="#check">check</a>&quot;
parameter. Warning though, it is not a good idea to stop an agent after it
reports &quot;down&quot;, since only an agent reporting &quot;up&quot; will be able to turn the
server up again. Note that the CLI on the Unix stats socket is also able to
force an agent's result in order to workaround a bogus agent if needed.

Requires the &quot;<a href="#agent-port">agent-port</a>&quot; parameter to be set. See also the &quot;<a href="#agent-inter">agent-inter</a>&quot;
parameter.

Supported in default-server: No
</pre><a class="anchor" name="agent-inter"></a><a class="anchor" name="5-agent-inter"></a><a class="anchor" name="5.2-agent-inter"></a><a class="anchor" name="agent-inter (Bind and Server options)"></a><a class="anchor" name="agent-inter (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="agent-inter"></a><a href="#5.2-agent-inter">agent-inter</a></b> <span style="color: #080">&lt;delay&gt;</span></div><pre class="text">The &quot;<a href="#agent-inter">agent-inter</a>&quot; parameter sets the interval between two agent checks
to &lt;delay&gt; milliseconds. If left unspecified, the delay defaults to 2000 ms.

Just as with every other time-based parameter, it may be entered in any
other explicit unit among { us, ms, s, m, h, d }. The &quot;<a href="#agent-inter">agent-inter</a>&quot;
parameter also serves as a timeout for agent checks &quot;<a href="#timeout%20check">timeout check</a>&quot; is
not set. In order to reduce &quot;resonance&quot; effects when multiple servers are
hosted on the same hardware, the agent and health checks of all servers
are started with a small time offset between them. It is also possible to
add some random noise in the agent and health checks interval using the
global &quot;<a href="#spread-checks">spread-checks</a>&quot; keyword. This makes sense for instance when a lot
of backends use the same servers.

See also the &quot;<a href="#agent-check">agent-check</a>&quot; and &quot;<a href="#agent-port">agent-port</a>&quot; parameters.

Supported in default-server: Yes
</pre><a class="anchor" name="agent-port"></a><a class="anchor" name="5-agent-port"></a><a class="anchor" name="5.2-agent-port"></a><a class="anchor" name="agent-port (Bind and Server options)"></a><a class="anchor" name="agent-port (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="agent-port"></a><a href="#5.2-agent-port">agent-port</a></b> <span style="color: #080">&lt;port&gt;</span></div><pre class="text">The &quot;<a href="#agent-port">agent-port</a>&quot; parameter sets the TCP port used for agent checks.

See also the &quot;<a href="#agent-check">agent-check</a>&quot; and &quot;<a href="#agent-inter">agent-inter</a>&quot; parameters.

Supported in default-server: Yes
</pre><a class="anchor" name="backup"></a><a class="anchor" name="5-backup"></a><a class="anchor" name="5.2-backup"></a><a class="anchor" name="backup (Bind and Server options)"></a><a class="anchor" name="backup (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="backup"></a><a href="#5.2-backup">backup</a></b></div><pre class="text">When &quot;<a href="#backup">backup</a>&quot; is present on a server line, the server is only used in load
balancing when all other non-backup servers are unavailable. Requests coming
with a persistence cookie referencing the server will always be served
though. By default, only the first operational backup server is used, unless
the &quot;<a href="#option%20allbackups">allbackups</a>&quot; option is set in the backend. See also the &quot;<a href="#option%20allbackups">allbackups</a>&quot;
option.

Supported in default-server: No
</pre><a class="anchor" name="ca-file"></a><a class="anchor" name="5-ca-file"></a><a class="anchor" name="5.2-ca-file"></a><a class="anchor" name="ca-file (Bind and Server options)"></a><a class="anchor" name="ca-file (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="ca-file"></a><a href="#5.2-ca-file">ca-file</a></b> <span style="color: #080">&lt;cafile&gt;</span></div><pre class="text">This setting is only available when support for OpenSSL was built in. It
designates a PEM file from which to load CA certificates used to verify
server's certificate.

Supported in default-server: No
</pre><a class="anchor" name="check"></a><a class="anchor" name="5-check"></a><a class="anchor" name="5.2-check"></a><a class="anchor" name="check (Bind and Server options)"></a><a class="anchor" name="check (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="check"></a><a href="#5.2-check">check</a></b></div><pre class="text">This option enables health checks on the server. By default, a server is
always considered available. If &quot;<a href="#check">check</a>&quot; is set, the server is available when
accepting periodic TCP connections, to ensure that it is really able to serve
requests. The default address and port to send the tests to are those of the
server, and the default source is the same as the one defined in the
backend. It is possible to change the address using the &quot;<a href="#addr">addr</a>&quot; parameter, the
port using the &quot;<a href="#port">port</a>&quot; parameter, the source address using the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#source%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;
address, and the interval and timers using the &quot;<a href="#inter">inter</a>&quot;, &quot;<a href="#rise">rise</a>&quot; and &quot;<a href="#fall">fall</a>&quot;
parameters. The request method is define in the backend using the &quot;<a href="#option%20httpchk">httpchk</a>&quot;,
&quot;<a href="#option%20smtpchk">smtpchk</a>&quot;, &quot;<a href="#option%20mysql-check">mysql-check</a>&quot;, &quot;<a href="#option%20pgsql-check">pgsql-check</a>&quot; and &quot;<a href="#option%20ssl-hello-chk">ssl-hello-chk</a>&quot; options. Please
refer to those options and parameters for more information.

Supported in default-server: No
</pre><a class="anchor" name="check-send-proxy"></a><a class="anchor" name="5-check-send-proxy"></a><a class="anchor" name="5.2-check-send-proxy"></a><a class="anchor" name="check-send-proxy (Bind and Server options)"></a><a class="anchor" name="check-send-proxy (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="check-send-proxy"></a><a href="#5.2-check-send-proxy">check-send-proxy</a></b></div><pre class="text">This option forces emission of a PROXY protocol line with outgoing health
checks, regardless of whether the server uses send-proxy or not for the
normal traffic. By default, the PROXY protocol is enabled for health checks
if it is already enabled for normal traffic and if no &quot;<a href="#port">port</a>&quot; nor &quot;<a href="#addr">addr</a>&quot;
directive is present. However, if such a directive is present, the
&quot;<a href="#check-send-proxy">check-send-proxy</a>&quot; option needs to be used to force the use of the
protocol. See also the &quot;<a href="#send-proxy">send-proxy</a>&quot; option for more information.

Supported in default-server: No
</pre><a class="anchor" name="check-ssl"></a><a class="anchor" name="5-check-ssl"></a><a class="anchor" name="5.2-check-ssl"></a><a class="anchor" name="check-ssl (Bind and Server options)"></a><a class="anchor" name="check-ssl (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="check-ssl"></a><a href="#5.2-check-ssl">check-ssl</a></b></div><pre class="text">This option forces encryption of all health checks over SSL, regardless of
whether the server uses SSL or not for the normal traffic. This is generally
used when an explicit &quot;<a href="#port">port</a>&quot; or &quot;<a href="#addr">addr</a>&quot; directive is specified and SSL health
checks are not inherited. It is important to understand that this option
inserts an SSL transport layer below the checks, so that a simple TCP connect
check becomes an SSL connect, which replaces the old ssl-hello-chk. The most
common use is to send HTTPS checks by combining &quot;<a href="#option%20httpchk">httpchk</a>&quot; with SSL checks.
All SSL settings are common to health checks and traffic (eg: ciphers).
See the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">ssl<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#ssl%20%28Bind%20options%29">Bind options</a></li><li><a href="#ssl%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; option for more information.

Supported in default-server: No
</pre><a class="anchor" name="ciphers"></a><a class="anchor" name="5-ciphers"></a><a class="anchor" name="5.2-ciphers"></a><a class="anchor" name="ciphers (Bind and Server options)"></a><a class="anchor" name="ciphers (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="ciphers"></a><a href="#5.2-ciphers">ciphers</a></b> <span style="color: #080">&lt;ciphers&gt;</span></div><pre class="text">This option sets the string describing the list of cipher algorithms that is
is negotiated during the SSL/TLS handshake with the server. The format of the
string is defined in &quot;man 1 ciphers&quot;. When SSL is used to communicate with
servers on the local network, it is common to see a weaker set of algorithms
than what is used over the internet. Doing so reduces CPU usage on both the
server and haproxy while still keeping it compatible with deployed software.
Some algorithms such as RC4-SHA1 are reasonably cheap. If no security at all
is needed and just connectivity, using DES can be appropriate.

Supported in default-server: No
</pre><a class="anchor" name="cookie"></a><a class="anchor" name="5-cookie"></a><a class="anchor" name="5.2-cookie"></a><a class="anchor" name="cookie (Bind and Server options)"></a><a class="anchor" name="cookie (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="cookie"></a><a href="#5.2-cookie">cookie</a></b> <span style="color: #080">&lt;value&gt;</span></div><pre class="text">The &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">cookie<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#cookie%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#cookie%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li><li><a href="#cookie%20%28Fetching%20HTTP%20samples%20%28Layer%207%29%29">Fetching HTTP samples (Layer 7)</a></li></ul></span>&quot; parameter sets the cookie value assigned to the server to
&lt;value&gt;. This value will be checked in incoming requests, and the first
operational server possessing the same value will be selected. In return, in
cookie insertion or rewrite modes, this value will be assigned to the cookie
sent to the client. There is nothing wrong in having several servers sharing
the same cookie value, and it is in fact somewhat common between normal and
backup servers. See also the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">cookie<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#cookie%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#cookie%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li><li><a href="#cookie%20%28Fetching%20HTTP%20samples%20%28Layer%207%29%29">Fetching HTTP samples (Layer 7)</a></li></ul></span>&quot; keyword in backend section.

Supported in default-server: No
</pre><a class="anchor" name="crl-file"></a><a class="anchor" name="5-crl-file"></a><a class="anchor" name="5.2-crl-file"></a><a class="anchor" name="crl-file (Bind and Server options)"></a><a class="anchor" name="crl-file (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="crl-file"></a><a href="#5.2-crl-file">crl-file</a></b> <span style="color: #080">&lt;crlfile&gt;</span></div><pre class="text">This setting is only available when support for OpenSSL was built in. It
designates a PEM file from which to load certificate revocation list used
to verify server's certificate.

Supported in default-server: No
</pre><a class="anchor" name="crt"></a><a class="anchor" name="5-crt"></a><a class="anchor" name="5.2-crt"></a><a class="anchor" name="crt (Bind and Server options)"></a><a class="anchor" name="crt (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="crt"></a><a href="#5.2-crt">crt</a></b> <span style="color: #080">&lt;cert&gt;</span></div><pre class="text">This setting is only available when support for OpenSSL was built in.
It designates a PEM file from which to load both a certificate and the
associated private key. This file can be built by concatenating both PEM
files into one. This certificate will be sent if the server send a client
certificate request.

Supported in default-server: No
</pre><a class="anchor" name="disabled"></a><a class="anchor" name="5-disabled"></a><a class="anchor" name="5.2-disabled"></a><a class="anchor" name="disabled (Bind and Server options)"></a><a class="anchor" name="disabled (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="disabled"></a><a href="#5.2-disabled">disabled</a></b></div><pre class="text">The &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">disabled<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#disabled%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#disabled%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; keyword starts the server in the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">disabled<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#disabled%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#disabled%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; state. That means
that it is marked down in maintenance mode, and no connection other than the
ones allowed by persist mode will reach it. It is very well suited to setup
new servers, because normal traffic will never reach them, while it is still
possible to test the service by making use of the force-persist mechanism.

Supported in default-server: No
</pre><a class="anchor" name="error-limit"></a><a class="anchor" name="5-error-limit"></a><a class="anchor" name="5.2-error-limit"></a><a class="anchor" name="error-limit (Bind and Server options)"></a><a class="anchor" name="error-limit (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="error-limit"></a><a href="#5.2-error-limit">error-limit</a></b> <span style="color: #080">&lt;count&gt;</span></div><pre class="text">If health observing is enabled, the &quot;<a href="#error-limit">error-limit</a>&quot; parameter specifies the
number of consecutive errors that triggers event selected by the &quot;<a href="#on-error">on-error</a>&quot;
option. By default it is set to 10 consecutive errors.

Supported in default-server: Yes

See also the &quot;<a href="#check">check</a>&quot;, &quot;<a href="#error-limit">error-limit</a>&quot; and &quot;<a href="#on-error">on-error</a>&quot;.
</pre><a class="anchor" name="fall"></a><a class="anchor" name="5-fall"></a><a class="anchor" name="5.2-fall"></a><a class="anchor" name="fall (Bind and Server options)"></a><a class="anchor" name="fall (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="fall"></a><a href="#5.2-fall">fall</a></b> <span style="color: #080">&lt;count&gt;</span></div><pre class="text">The &quot;<a href="#fall">fall</a>&quot; parameter states that a server will be considered as dead after
&lt;count&gt; consecutive unsuccessful health checks. This value defaults to 3 if
unspecified. See also the &quot;<a href="#check">check</a>&quot;, &quot;<a href="#inter">inter</a>&quot; and &quot;<a href="#rise">rise</a>&quot; parameters.

Supported in default-server: Yes
</pre><a class="anchor" name="force-sslv3"></a><a class="anchor" name="5-force-sslv3"></a><a class="anchor" name="5.2-force-sslv3"></a><a class="anchor" name="force-sslv3 (Bind and Server options)"></a><a class="anchor" name="force-sslv3 (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="force-sslv3"></a><a href="#5.2-force-sslv3">force-sslv3</a></b></div><pre class="text">This option enforces use of SSLv3 only when SSL is used to communicate with
the server. SSLv3 is generally less expensive than the TLS counterparts for
high connection rates. See also &quot;no-tlsv*&quot;, &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">no-sslv3<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#no-sslv3%20%28Bind%20options%29">Bind options</a></li><li><a href="#no-sslv3%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;.

Supported in default-server: No
</pre><a class="anchor" name="force-tlsv10"></a><a class="anchor" name="5-force-tlsv10"></a><a class="anchor" name="5.2-force-tlsv10"></a><a class="anchor" name="force-tlsv10 (Bind and Server options)"></a><a class="anchor" name="force-tlsv10 (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="force-tlsv10"></a><a href="#5.2-force-tlsv10">force-tlsv10</a></b></div><pre class="text">This option enforces use of TLSv1.0 only when SSL is used to communicate with
the server. See also &quot;no-tlsv*&quot;, &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">no-sslv3<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#no-sslv3%20%28Bind%20options%29">Bind options</a></li><li><a href="#no-sslv3%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;.

Supported in default-server: No
</pre><a class="anchor" name="force-tlsv11"></a><a class="anchor" name="5-force-tlsv11"></a><a class="anchor" name="5.2-force-tlsv11"></a><a class="anchor" name="force-tlsv11 (Bind and Server options)"></a><a class="anchor" name="force-tlsv11 (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="force-tlsv11"></a><a href="#5.2-force-tlsv11">force-tlsv11</a></b></div><pre class="text">This option enforces use of TLSv1.1 only when SSL is used to communicate with
the server. See also &quot;no-tlsv*&quot;, &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">no-sslv3<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#no-sslv3%20%28Bind%20options%29">Bind options</a></li><li><a href="#no-sslv3%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;.

Supported in default-server: No
</pre><a class="anchor" name="force-tlsv12"></a><a class="anchor" name="5-force-tlsv12"></a><a class="anchor" name="5.2-force-tlsv12"></a><a class="anchor" name="force-tlsv12 (Bind and Server options)"></a><a class="anchor" name="force-tlsv12 (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="force-tlsv12"></a><a href="#5.2-force-tlsv12">force-tlsv12</a></b></div><pre class="text">This option enforces use of TLSv1.2 only when SSL is used to communicate with
the server. See also &quot;no-tlsv*&quot;, &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">no-sslv3<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#no-sslv3%20%28Bind%20options%29">Bind options</a></li><li><a href="#no-sslv3%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;.

Supported in default-server: No
</pre><a class="anchor" name="id"></a><a class="anchor" name="5-id"></a><a class="anchor" name="5.2-id"></a><a class="anchor" name="id (Bind and Server options)"></a><a class="anchor" name="id (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="id"></a><a href="#5.2-id">id</a></b> <span style="color: #080">&lt;value&gt;</span></div><pre class="text">Set a persistent ID for the server. This ID must be positive and unique for
the proxy. An unused ID will automatically be assigned if unset. The first
assigned value will be 1. This ID is currently only returned in statistics.

Supported in default-server: No
</pre><a class="anchor" name="inter"></a><a class="anchor" name="5-inter"></a><a class="anchor" name="5.2-inter"></a><a class="anchor" name="inter (Bind and Server options)"></a><a class="anchor" name="inter (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="inter"></a><a href="#5.2-inter">inter</a></b> <span style="color: #080">&lt;delay&gt;</span></div><a class="anchor" name="fastinter"></a><a class="anchor" name="5-fastinter"></a><a class="anchor" name="5.2-fastinter"></a><a class="anchor" name="fastinter (Bind and Server options)"></a><a class="anchor" name="fastinter (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="fastinter"></a><a href="#5.2-fastinter">fastinter</a></b> <span style="color: #080">&lt;delay&gt;</span></div><a class="anchor" name="downinter"></a><a class="anchor" name="5-downinter"></a><a class="anchor" name="5.2-downinter"></a><a class="anchor" name="downinter (Bind and Server options)"></a><a class="anchor" name="downinter (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="downinter"></a><a href="#5.2-downinter">downinter</a></b> <span style="color: #080">&lt;delay&gt;</span></div><pre class="text">The &quot;<a href="#inter">inter</a>&quot; parameter sets the interval between two consecutive health checks
to &lt;delay&gt; milliseconds. If left unspecified, the delay defaults to 2000 ms.
It is also possible to use &quot;<a href="#fastinter">fastinter</a>&quot; and &quot;<a href="#downinter">downinter</a>&quot; to optimize delays
between checks depending on the server state :
</pre><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>Server state</th><th>Interval used</th></tr></thead>
<tr><td None>UP 100% (non-transitional)</td><td None>&quot;<a href="#inter">inter</a>&quot;</td></tr>
<tr><td None>Transitionally UP (going down),<br />Transitionally DOWN (going up),<br />or yet unchecked.</td><td None>&quot;<a href="#fastinter">fastinter</a>&quot; if set, &quot;<a href="#inter">inter</a>&quot; otherwise.<br /></td></tr>
<tr><td None>DOWN 100% (non-transitional)</td><td None>&quot;<a href="#downinter">downinter</a>&quot; if set, &quot;<a href="#inter">inter</a>&quot; otherwise.</td></tr>
</table><pre class="text">Just as with every other time-based parameter, they can be entered in any
other explicit unit among { us, ms, s, m, h, d }. The &quot;<a href="#inter">inter</a>&quot; parameter also
serves as a timeout for health checks sent to servers if &quot;<a href="#timeout%20check">timeout check</a>&quot; is
not set. In order to reduce &quot;resonance&quot; effects when multiple servers are
hosted on the same hardware, the agent and health checks of all servers
are started with a small time offset between them. It is also possible to
add some random noise in the agent and health checks interval using the
global &quot;<a href="#spread-checks">spread-checks</a>&quot; keyword. This makes sense for instance when a lot
of backends use the same servers.

Supported in default-server: Yes
</pre><a class="anchor" name="maxconn"></a><a class="anchor" name="5-maxconn"></a><a class="anchor" name="5.2-maxconn"></a><a class="anchor" name="maxconn (Bind and Server options)"></a><a class="anchor" name="maxconn (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="maxconn"></a><a href="#5.2-maxconn">maxconn</a></b> <span style="color: #080">&lt;maxconn&gt;</span></div><pre class="text">The &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Performance%20tuning%29">Performance tuning</a></li><li><a href="#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#maxconn%20%28Bind%20options%29">Bind options</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; parameter specifies the maximal number of concurrent
connections that will be sent to this server. If the number of incoming
concurrent requests goes higher than this value, they will be queued, waiting
for a connection to be released. This parameter is very important as it can
save fragile servers from going down under extreme loads. If a &quot;<a href="#minconn">minconn</a>&quot;
parameter is specified, the limit becomes dynamic. The default value is &quot;0&quot;
which means unlimited. See also the &quot;<a href="#minconn">minconn</a>&quot; and &quot;<a href="#maxqueue">maxqueue</a>&quot; parameters, and
the backend's &quot;<a href="#fullconn">fullconn</a>&quot; keyword.

Supported in default-server: Yes
</pre><a class="anchor" name="maxqueue"></a><a class="anchor" name="5-maxqueue"></a><a class="anchor" name="5.2-maxqueue"></a><a class="anchor" name="maxqueue (Bind and Server options)"></a><a class="anchor" name="maxqueue (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="maxqueue"></a><a href="#5.2-maxqueue">maxqueue</a></b> <span style="color: #080">&lt;maxqueue&gt;</span></div><pre class="text">The &quot;<a href="#maxqueue">maxqueue</a>&quot; parameter specifies the maximal number of connections which
will wait in the queue for this server. If this limit is reached, next
requests will be redispatched to other servers instead of indefinitely
waiting to be served. This will break persistence but may allow people to
quickly re-log in when the server they try to connect to is dying. The
default value is &quot;0&quot; which means the queue is unlimited. See also the
&quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Performance%20tuning%29">Performance tuning</a></li><li><a href="#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#maxconn%20%28Bind%20options%29">Bind options</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; and &quot;<a href="#minconn">minconn</a>&quot; parameters.

Supported in default-server: Yes
</pre><a class="anchor" name="minconn"></a><a class="anchor" name="5-minconn"></a><a class="anchor" name="5.2-minconn"></a><a class="anchor" name="minconn (Bind and Server options)"></a><a class="anchor" name="minconn (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="minconn"></a><a href="#5.2-minconn">minconn</a></b> <span style="color: #080">&lt;minconn&gt;</span></div><pre class="text">When the &quot;<a href="#minconn">minconn</a>&quot; parameter is set, the maxconn limit becomes a dynamic
limit following the backend's load. The server will always accept at least
&lt;minconn&gt; connections, never more than &lt;maxconn&gt;, and the limit will be on
the ramp between both values when the backend has less than &lt;fullconn&gt;
concurrent connections. This makes it possible to limit the load on the
server during normal loads, but push it further for important loads without
overloading the server during exceptional loads. See also the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Performance%20tuning%29">Performance tuning</a></li><li><a href="#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#maxconn%20%28Bind%20options%29">Bind options</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;
and &quot;<a href="#maxqueue">maxqueue</a>&quot; parameters, as well as the &quot;<a href="#fullconn">fullconn</a>&quot; backend keyword.

Supported in default-server: Yes
</pre><a class="anchor" name="no-sslv3"></a><a class="anchor" name="5-no-sslv3"></a><a class="anchor" name="5.2-no-sslv3"></a><a class="anchor" name="no-sslv3 (Bind and Server options)"></a><a class="anchor" name="no-sslv3 (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="no-sslv3"></a><a href="#5.2-no-sslv3">no-sslv3</a></b></div><pre class="text">This option disables support for SSLv3 when SSL is used to communicate with
the server. Note that SSLv2 is disabled in the code and cannot be enabled
using any configuration option. See also &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">force-sslv3<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#force-sslv3%20%28Bind%20options%29">Bind options</a></li><li><a href="#force-sslv3%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;, &quot;force-tlsv*&quot;.

Supported in default-server: No
</pre><a class="anchor" name="no-tls-tickets"></a><a class="anchor" name="5-no-tls-tickets"></a><a class="anchor" name="5.2-no-tls-tickets"></a><a class="anchor" name="no-tls-tickets (Bind and Server options)"></a><a class="anchor" name="no-tls-tickets (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="no-tls-tickets"></a><a href="#5.2-no-tls-tickets">no-tls-tickets</a></b></div><pre class="text">This setting is only available when support for OpenSSL was built in. It
disables the stateless session resumption (RFC 5077 TLS Ticket
extension) and force to use stateful session resumption. Stateless
session resumption is more expensive in CPU usage for servers.

Supported in default-server: No
</pre><a class="anchor" name="no-tlsv10"></a><a class="anchor" name="5-no-tlsv10"></a><a class="anchor" name="5.2-no-tlsv10"></a><a class="anchor" name="no-tlsv10 (Bind and Server options)"></a><a class="anchor" name="no-tlsv10 (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="no-tlsv10"></a><a href="#5.2-no-tlsv10">no-tlsv10</a></b></div><pre class="text">This option disables support for TLSv1.0 when SSL is used to communicate with
the server. Note that SSLv2 is disabled in the code and cannot be enabled
using any configuration option. TLSv1 is more expensive than SSLv3 so it
often makes sense to disable it when communicating with local servers. See
also &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">force-sslv3<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#force-sslv3%20%28Bind%20options%29">Bind options</a></li><li><a href="#force-sslv3%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;, &quot;force-tlsv*&quot;.

Supported in default-server: No
</pre><a class="anchor" name="no-tlsv11"></a><a class="anchor" name="5-no-tlsv11"></a><a class="anchor" name="5.2-no-tlsv11"></a><a class="anchor" name="no-tlsv11 (Bind and Server options)"></a><a class="anchor" name="no-tlsv11 (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="no-tlsv11"></a><a href="#5.2-no-tlsv11">no-tlsv11</a></b></div><pre class="text">This option disables support for TLSv1.1 when SSL is used to communicate with
the server. Note that SSLv2 is disabled in the code and cannot be enabled
using any configuration option. TLSv1 is more expensive than SSLv3 so it
often makes sense to disable it when communicating with local servers. See
also &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">force-sslv3<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#force-sslv3%20%28Bind%20options%29">Bind options</a></li><li><a href="#force-sslv3%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;, &quot;force-tlsv*&quot;.

Supported in default-server: No
</pre><a class="anchor" name="no-tlsv12"></a><a class="anchor" name="5-no-tlsv12"></a><a class="anchor" name="5.2-no-tlsv12"></a><a class="anchor" name="no-tlsv12 (Bind and Server options)"></a><a class="anchor" name="no-tlsv12 (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="no-tlsv12"></a><a href="#5.2-no-tlsv12">no-tlsv12</a></b></div><pre class="text">This option disables support for TLSv1.2 when SSL is used to communicate with
the server. Note that SSLv2 is disabled in the code and cannot be enabled
using any configuration option. TLSv1 is more expensive than SSLv3 so it
often makes sense to disable it when communicating with local servers. See
also &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">force-sslv3<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#force-sslv3%20%28Bind%20options%29">Bind options</a></li><li><a href="#force-sslv3%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;, &quot;force-tlsv*&quot;.

Supported in default-server: No
</pre><a class="anchor" name="non-stick"></a><a class="anchor" name="5-non-stick"></a><a class="anchor" name="5.2-non-stick"></a><a class="anchor" name="non-stick (Bind and Server options)"></a><a class="anchor" name="non-stick (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="non-stick"></a><a href="#5.2-non-stick">non-stick</a></b></div><pre class="text">Never add connections allocated to this sever to a stick-table.
This may be used in conjunction with backup to ensure that
stick-table persistence is disabled for backup servers.

Supported in default-server: No
</pre><a class="anchor" name="observe"></a><a class="anchor" name="5-observe"></a><a class="anchor" name="5.2-observe"></a><a class="anchor" name="observe (Bind and Server options)"></a><a class="anchor" name="observe (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="observe"></a><a href="#5.2-observe">observe</a></b> <span style="color: #080">&lt;mode&gt;</span></div><pre class="text">This option enables health adjusting based on observing communication with
the server. By default this functionality is disabled and enabling it also
requires to enable health checks. There are two supported modes: &quot;layer4&quot; and
&quot;layer7&quot;. In layer4 mode, only successful/unsuccessful tcp connections are
significant. In layer7, which is only allowed for http proxies, responses
received from server are verified, like valid/wrong http code, unparsable
headers, a timeout, etc. Valid status codes include 100 to 499, 501 and 505.

Supported in default-server: No

See also the &quot;<a href="#check">check</a>&quot;, &quot;<a href="#on-error">on-error</a>&quot; and &quot;<a href="#error-limit">error-limit</a>&quot;.
</pre><a class="anchor" name="on-error"></a><a class="anchor" name="5-on-error"></a><a class="anchor" name="5.2-on-error"></a><a class="anchor" name="on-error (Bind and Server options)"></a><a class="anchor" name="on-error (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="on-error"></a><a href="#5.2-on-error">on-error</a></b> <span style="color: #080">&lt;mode&gt;</span></div><pre class="text">Select what should happen when enough consecutive errors are detected.
Currently, four modes are available:
- fastinter: force fastinter
- fail-check: simulate a failed check, also forces fastinter (default)
- sudden-death: simulate a pre-fatal failed health check, one more failed
  check will mark a server down, forces fastinter
- mark-down: mark the server immediately down and force fastinter

Supported in default-server: Yes

See also the &quot;<a href="#check">check</a>&quot;, &quot;<a href="#observe">observe</a>&quot; and &quot;<a href="#error-limit">error-limit</a>&quot;.
</pre><a class="anchor" name="on-marked-down"></a><a class="anchor" name="5-on-marked-down"></a><a class="anchor" name="5.2-on-marked-down"></a><a class="anchor" name="on-marked-down (Bind and Server options)"></a><a class="anchor" name="on-marked-down (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="on-marked-down"></a><a href="#5.2-on-marked-down">on-marked-down</a></b> <span style="color: #080">&lt;action&gt;</span></div><pre class="text">Modify what occurs when a server is marked down.
Currently one action is available:
- shutdown-sessions: Shutdown peer sessions. When this setting is enabled,
  all connections to the server are immediately terminated when the server
  goes down. It might be used if the health check detects more complex cases
  than a simple connection status, and long timeouts would cause the service
  to remain unresponsive for too long a time. For instance, a health check
  might detect that a database is stuck and that there's no chance to reuse
  existing connections anymore. Connections killed this way are logged with
  a 'D' termination code (for &quot;Down&quot;).

Actions are disabled by default

Supported in default-server: Yes
</pre><a class="anchor" name="on-marked-up"></a><a class="anchor" name="5-on-marked-up"></a><a class="anchor" name="5.2-on-marked-up"></a><a class="anchor" name="on-marked-up (Bind and Server options)"></a><a class="anchor" name="on-marked-up (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="on-marked-up"></a><a href="#5.2-on-marked-up">on-marked-up</a></b> <span style="color: #080">&lt;action&gt;</span></div><pre class="text">Modify what occurs when a server is marked up.
Currently one action is available:
- shutdown-backup-sessions: Shutdown sessions on all backup servers. This is
  done only if the server is not in backup state and if it is not disabled
  (it must have an effective weight &gt; 0). This can be used sometimes to force
  an active server to take all the traffic back after recovery when dealing
  with long sessions (eg: LDAP, SQL, ...). Doing this can cause more trouble
  than it tries to solve (eg: incomplete transactions), so use this feature
  with extreme care. Sessions killed because a server comes up are logged
  with an 'U' termination code (for &quot;Up&quot;).

Actions are disabled by default

Supported in default-server: Yes
</pre><a class="anchor" name="port"></a><a class="anchor" name="5-port"></a><a class="anchor" name="5.2-port"></a><a class="anchor" name="port (Bind and Server options)"></a><a class="anchor" name="port (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="port"></a><a href="#5.2-port">port</a></b> <span style="color: #080">&lt;port&gt;</span></div><pre class="text">Using the &quot;<a href="#port">port</a>&quot; parameter, it becomes possible to use a different port to
send health-checks. On some servers, it may be desirable to dedicate a port
to a specific component able to perform complex tests which are more suitable
to health-checks than the application. It is common to run a simple script in
inetd for instance. This parameter is ignored if the &quot;<a href="#check">check</a>&quot; parameter is not
set. See also the &quot;<a href="#addr">addr</a>&quot; parameter.

Supported in default-server: Yes
</pre><a class="anchor" name="redir"></a><a class="anchor" name="5-redir"></a><a class="anchor" name="5.2-redir"></a><a class="anchor" name="redir (Bind and Server options)"></a><a class="anchor" name="redir (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="redir"></a><a href="#5.2-redir">redir</a></b> <span style="color: #080">&lt;prefix&gt;</span></div><pre class="text">The &quot;<a href="#redir">redir</a>&quot; parameter enables the redirection mode for all GET and HEAD
requests addressing this server. This means that instead of having HAProxy
forward the request to the server, it will send an &quot;HTTP 302&quot; response with
the &quot;Location&quot; header composed of this prefix immediately followed by the
requested URI beginning at the leading '/' of the path component. That means
that no trailing slash should be used after &lt;prefix&gt;. All invalid requests
will be rejected, and all non-GET or HEAD requests will be normally served by
the server. Note that since the response is completely forged, no header
mangling nor cookie insertion is possible in the response. However, cookies in
requests are still analysed, making this solution completely usable to direct
users to a remote location in case of local disaster. Main use consists in
increasing bandwidth for static servers by having the clients directly
connect to them. Note: never use a relative location here, it would cause a
loop between the client and HAProxy!
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>server srv1 192.168.1.1:80 redir http://image1.mydomain.com check
</code></pre>
</div><pre class="text">Supported in default-server: No
</pre><a class="anchor" name="rise"></a><a class="anchor" name="5-rise"></a><a class="anchor" name="5.2-rise"></a><a class="anchor" name="rise (Bind and Server options)"></a><a class="anchor" name="rise (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="rise"></a><a href="#5.2-rise">rise</a></b> <span style="color: #080">&lt;count&gt;</span></div><pre class="text">The &quot;<a href="#rise">rise</a>&quot; parameter states that a server will be considered as operational
after &lt;count&gt; consecutive successful health checks. This value defaults to 2
if unspecified. See also the &quot;<a href="#check">check</a>&quot;, &quot;<a href="#inter">inter</a>&quot; and &quot;<a href="#fall">fall</a>&quot; parameters.

Supported in default-server: Yes
</pre><a class="anchor" name="send-proxy"></a><a class="anchor" name="5-send-proxy"></a><a class="anchor" name="5.2-send-proxy"></a><a class="anchor" name="send-proxy (Bind and Server options)"></a><a class="anchor" name="send-proxy (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="send-proxy"></a><a href="#5.2-send-proxy">send-proxy</a></b></div><pre class="text">The &quot;<a href="#send-proxy">send-proxy</a>&quot; parameter enforces use of the PROXY protocol over any
connection established to this server. The PROXY protocol informs the other
end about the layer 3/4 addresses of the incoming connection, so that it can
know the client's address or the public address it accessed to, whatever the
upper layer protocol. For connections accepted by an &quot;<a href="#accept-proxy">accept-proxy</a>&quot; listener,
the advertised address will be used. Only TCPv4 and TCPv6 address families
are supported. Other families such as Unix sockets, will report an UNKNOWN
family. Servers using this option can fully be chained to another instance of
haproxy listening with an &quot;<a href="#accept-proxy">accept-proxy</a>&quot; setting. This setting must not be
used if the server isn't aware of the protocol. When health checks are sent
to the server, the PROXY protocol is automatically used when this option is
set, unless there is an explicit &quot;<a href="#port">port</a>&quot; or &quot;<a href="#addr">addr</a>&quot; directive, in which case an
explicit &quot;<a href="#check-send-proxy">check-send-proxy</a>&quot; directive would also be needed to use the PROXY
protocol. See also the &quot;<a href="#accept-proxy">accept-proxy</a>&quot; option of the &quot;<a href="#bind">bind</a>&quot; keyword.

Supported in default-server: No
</pre><a class="anchor" name="send-proxy-v2"></a><a class="anchor" name="5-send-proxy-v2"></a><a class="anchor" name="5.2-send-proxy-v2"></a><a class="anchor" name="send-proxy-v2 (Bind and Server options)"></a><a class="anchor" name="send-proxy-v2 (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="send-proxy-v2"></a><a href="#5.2-send-proxy-v2">send-proxy-v2</a></b></div><pre class="text">The &quot;<a href="#send-proxy-v2">send-proxy-v2</a>&quot; parameter enforces use of the PROXY protocol version 2
over any connection established to this server. The PROXY protocol informs
the other end about the layer 3/4 addresses of the incoming connection, so
that it can know the client's address or the public address it accessed to,
whatever the upper layer protocol. This setting must not be used if the
server isn't aware of this version of the protocol. See also the &quot;<a href="#send-proxy">send-proxy</a>&quot;
option of the &quot;<a href="#bind">bind</a>&quot; keyword.

Supported in default-server: No
</pre><a class="anchor" name="send-proxy-v2-ssl"></a><a class="anchor" name="5-send-proxy-v2-ssl"></a><a class="anchor" name="5.2-send-proxy-v2-ssl"></a><a class="anchor" name="send-proxy-v2-ssl (Bind and Server options)"></a><a class="anchor" name="send-proxy-v2-ssl (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="send-proxy-v2-ssl"></a><a href="#5.2-send-proxy-v2-ssl">send-proxy-v2-ssl</a></b></div><pre class="text">The &quot;<a href="#send-proxy-v2-ssl">send-proxy-v2-ssl</a>&quot; parameter enforces use of the PROXY protocol version
2 over any connection established to this server. The PROXY protocol informs
the other end about the layer 3/4 addresses of the incoming connection, so
that it can know the client's address or the public address it accessed to,
whatever the upper layer protocol. In addition, the SSL information extension
of the PROXY protocol is added to the PROXY protocol header. This setting
must not be used if the server isn't aware of this version of the protocol.
See also the &quot;<a href="#send-proxy-v2">send-proxy-v2</a>&quot; option of the &quot;<a href="#bind">bind</a>&quot; keyword.

Supported in default-server: No
</pre><a class="anchor" name="send-proxy-v2-ssl-cn"></a><a class="anchor" name="5-send-proxy-v2-ssl-cn"></a><a class="anchor" name="5.2-send-proxy-v2-ssl-cn"></a><a class="anchor" name="send-proxy-v2-ssl-cn (Bind and Server options)"></a><a class="anchor" name="send-proxy-v2-ssl-cn (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="send-proxy-v2-ssl-cn"></a><a href="#5.2-send-proxy-v2-ssl-cn">send-proxy-v2-ssl-cn</a></b></div><pre class="text">The &quot;<a href="#send-proxy-v2-ssl">send-proxy-v2-ssl</a>&quot; parameter enforces use of the PROXY protocol version
2 over any connection established to this server. The PROXY protocol informs
the other end about the layer 3/4 addresses of the incoming connection, so
that it can know the client's address or the public address it accessed to,
whatever the upper layer protocol. In addition, the SSL information extension
of the PROXY protocol, along along with the Common Name from the subject of
the client certificate (if any), is added to the PROXY protocol header. This
setting must not be used if the server isn't aware of this version of the
protocol. See also the &quot;<a href="#send-proxy-v2">send-proxy-v2</a>&quot; option of the &quot;<a href="#bind">bind</a>&quot; keyword.

Supported in default-server: No
</pre><a class="anchor" name="slowstart"></a><a class="anchor" name="5-slowstart"></a><a class="anchor" name="5.2-slowstart"></a><a class="anchor" name="slowstart (Bind and Server options)"></a><a class="anchor" name="slowstart (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="slowstart"></a><a href="#5.2-slowstart">slowstart</a></b> <span style="color: #080">&lt;start_time_in_ms&gt;</span></div><pre class="text">The &quot;<a href="#slowstart">slowstart</a>&quot; parameter for a server accepts a value in milliseconds which
indicates after how long a server which has just come back up will run at
full speed. Just as with every other time-based parameter, it can be entered
in any other explicit unit among { us, ms, s, m, h, d }. The speed grows
linearly from 0 to 100% during this time. The limitation applies to two
parameters :

- maxconn: the number of connections accepted by the server will grow from 1
  to 100% of the usual dynamic limit defined by (minconn,maxconn,fullconn).

- weight: when the backend uses a dynamic weighted algorithm, the weight
  grows linearly from 1 to 100%. In this case, the weight is updated at every
  health-check. For this reason, it is important that the &quot;<a href="#inter">inter</a>&quot; parameter
  is smaller than the &quot;<a href="#slowstart">slowstart</a>&quot;, in order to maximize the number of steps.

The slowstart never applies when haproxy starts, otherwise it would cause
trouble to running servers. It only applies when a server has been previously
seen as failed.

Supported in default-server: Yes
</pre><a class="anchor" name="source"></a><a class="anchor" name="5-source"></a><a class="anchor" name="5.2-source"></a><a class="anchor" name="source (Bind and Server options)"></a><a class="anchor" name="source (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="source"></a><a href="#5.2-source">source</a></b> <span style="color: #080">&lt;addr&gt;</span><span style="color: #008">[:<span style="color: #080">&lt;pl&gt;</span><span style="color: #008">[-<span style="color: #080">&lt;ph&gt;</span>]</span>]</span> <span style="color: #008">[usesrc <span style="color: #800">{ <span style="color: #080">&lt;addr2&gt;</span><span style="color: #008">[:<span style="color: #080">&lt;port2&gt;</span>]</span> | client | clientip }</span> ]</span></div><a class="anchor" name="source"></a><a class="anchor" name="5-source"></a><a class="anchor" name="5.2-source"></a><a class="anchor" name="source (Bind and Server options)"></a><a class="anchor" name="source (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="source"></a><a href="#5.2-source">source</a></b> <span style="color: #080">&lt;addr&gt;</span><span style="color: #008">[:<span style="color: #080">&lt;port&gt;</span>]</span> <span style="color: #008">[usesrc <span style="color: #800">{ <span style="color: #080">&lt;addr2&gt;</span><span style="color: #008">[:<span style="color: #080">&lt;port2&gt;</span>]</span> | hdr_ip(<span style="color: #080">&lt;hdr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;occ&gt;</span>]</span>) }</span> ]</span></div><a class="anchor" name="source"></a><a class="anchor" name="5-source"></a><a class="anchor" name="5.2-source"></a><a class="anchor" name="source (Bind and Server options)"></a><a class="anchor" name="source (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="source"></a><a href="#5.2-source">source</a></b> <span style="color: #080">&lt;addr&gt;</span><span style="color: #008">[:<span style="color: #080">&lt;pl&gt;</span><span style="color: #008">[-<span style="color: #080">&lt;ph&gt;</span>]</span>]</span> <span style="color: #008">[interface <span style="color: #080">&lt;name&gt;</span>]</span> ...</div><pre class="text">The &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#source%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; parameter sets the source address which will be used when
connecting to the server. It follows the exact same parameters and principle
as the backend &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#source%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; keyword, except that it only applies to the server
referencing it. Please consult the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#source%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; keyword for details.

Additionally, the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">source<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#source%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#source%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; statement on a server line allows one to specify a
source port range by indicating the lower and higher bounds delimited by a
dash ('-'). Some operating systems might require a valid IP address when a
source port range is specified. It is permitted to have the same IP/range for
several servers. Doing so makes it possible to bypass the maximum of 64k
total concurrent connections. The limit will then reach 64k connections per
server.

Supported in default-server: No
</pre><a class="anchor" name="ssl"></a><a class="anchor" name="5-ssl"></a><a class="anchor" name="5.2-ssl"></a><a class="anchor" name="ssl (Bind and Server options)"></a><a class="anchor" name="ssl (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="ssl"></a><a href="#5.2-ssl">ssl</a></b></div><pre class="text">This option enables SSL ciphering on outgoing connections to the server. It
is critical to verify server certificates using &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">verify<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#verify%20%28Bind%20options%29">Bind options</a></li><li><a href="#verify%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; when using SSL to
connect to servers, otherwise the communication is prone to trivial man in
the-middle attacks rendering SSL useless. When this option is used, health
checks are automatically sent in SSL too unless there is a &quot;<a href="#port">port</a>&quot; or an
&quot;<a href="#addr">addr</a>&quot; directive indicating the check should be sent to a different location.
See the &quot;<a href="#check-ssl">check-ssl</a>&quot; option to force SSL health checks.

Supported in default-server: No
</pre><a class="anchor" name="track"></a><a class="anchor" name="5-track"></a><a class="anchor" name="5.2-track"></a><a class="anchor" name="track (Bind and Server options)"></a><a class="anchor" name="track (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="track"></a><a href="#5.2-track">track</a></b> <span style="color: #008">[<span style="color: #080">&lt;proxy&gt;</span>/]</span><span style="color: #080">&lt;server&gt;</span></div><pre class="text">This option enables ability to set the current state of the server by tracking
another one. It is possible to track a server which itself tracks another
server, provided that at the end of the chain, a server has health checks
enabled. If &lt;proxy&gt; is omitted the current one is used. If disable-on-404 is
used, it has to be enabled on both proxies.

Supported in default-server: No
</pre><a class="anchor" name="verify"></a><a class="anchor" name="5-verify"></a><a class="anchor" name="5.2-verify"></a><a class="anchor" name="verify (Bind and Server options)"></a><a class="anchor" name="verify (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="verify"></a><a href="#5.2-verify">verify</a></b> <span style="color: #008">[none|required]</span></div><pre class="text">This setting is only available when support for OpenSSL was built in. If set
to 'none', server certificate is not verified. In the other case, The
certificate provided by the server is verified using CAs from 'ca-file'
and optional CRLs from 'crl-file'. If 'ssl_server_verify' is not specified
in global  section, this is the default. On verify failure the handshake
is aborted. It is critically important to verify server certificates when
using SSL to connect to servers, otherwise the communication is prone to
trivial man-in-the-middle attacks rendering SSL totally useless.

Supported in default-server: No
</pre><a class="anchor" name="verifyhost"></a><a class="anchor" name="5-verifyhost"></a><a class="anchor" name="5.2-verifyhost"></a><a class="anchor" name="verifyhost (Bind and Server options)"></a><a class="anchor" name="verifyhost (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="verifyhost"></a><a href="#5.2-verifyhost">verifyhost</a></b> <span style="color: #080">&lt;hostname&gt;</span></div><pre class="text">This setting is only available when support for OpenSSL was built in, and
only takes effect if 'verify required' is also specified. When set, the
hostnames in the subject and subjectAlternateNames of the certificate
provided by the server are checked. If none of the hostnames in the
certificate match the specified hostname, the handshake is aborted. The
hostnames in the server-provided certificate may include wildcards.

Supported in default-server: No
</pre><a class="anchor" name="weight"></a><a class="anchor" name="5-weight"></a><a class="anchor" name="5.2-weight"></a><a class="anchor" name="weight (Bind and Server options)"></a><a class="anchor" name="weight (Server and default-server options)"></a><div class="keyword"><b><a class="anchor" name="weight"></a><a href="#5.2-weight">weight</a></b> <span style="color: #080">&lt;weight&gt;</span></div><pre class="text">The &quot;<a href="#weight">weight</a>&quot; parameter is used to adjust the server's weight relative to
other servers. All servers will receive a load proportional to their weight
relative to the sum of all weights, so the higher the weight, the higher the
load. The default weight is 1, and the maximal value is 256. A value of 0
means the server will not participate in load-balancing but will still accept
persistent connections. If this parameter is used to distribute the load
according to server's capacity, it is recommended to start with values which
can both grow and shrink, for instance between 10 and 100 to leave enough
room above and below for later adjustments.

Supported in default-server: Yes
</pre></div>
<a class="anchor" id="6" name="6"></a>
<div class="page-header"><h1 id="chapter-6" data-target="6"><small><a class="small" href="#6">6.</a></small> HTTP header manipulation</h1>
</div><div><pre class="text">In HTTP mode, it is possible to rewrite, add or delete some of the request and
response headers based on regular expressions. It is also possible to block a
request or a response if a particular header matches a regular expression,
which is enough to stop most elementary protocol attacks, and to protect
against information leak from the internal network.

If HAProxy encounters an &quot;Informational Response&quot; (status code 1xx), it is able
to process all rsp* rules which can allow, deny, rewrite or delete a header,
but it will refuse to add a header to any such messages as this is not
HTTP-compliant. The reason for still processing headers in such responses is to
stop and/or fix any possible information leak which may happen, for instance
because another downstream equipment would unconditionally add a header, or if
a server name appears there. When such messages are seen, normal processing
still occurs on the next non-informational messages.

This section covers common usage of the following keywords, described in detail
in <a href="#4.2">section 4.2</a> :

  - reqadd     &lt;string&gt;
  - reqallow   &lt;search&gt;
  - reqiallow  &lt;search&gt;
  - reqdel     &lt;search&gt;
  - reqidel    &lt;search&gt;
  - reqdeny    &lt;search&gt;
  - reqideny   &lt;search&gt;
  - reqpass    &lt;search&gt;
  - reqipass   &lt;search&gt;
  - reqrep     &lt;search&gt; &lt;replace&gt;
  - reqirep    &lt;search&gt; &lt;replace&gt;
  - reqtarpit  &lt;search&gt;
  - reqitarpit &lt;search&gt;
  - rspadd     &lt;string&gt;
  - rspdel     &lt;search&gt;
  - rspidel    &lt;search&gt;
  - rspdeny    &lt;search&gt;
  - rspideny   &lt;search&gt;
  - rsprep     &lt;search&gt; &lt;replace&gt;
  - rspirep    &lt;search&gt; &lt;replace&gt;

With all these keywords, the same conventions are used. The &lt;search&gt; parameter
is a POSIX extended regular expression (regex) which supports grouping through
parenthesis (without the backslash). Spaces and other delimiters must be
prefixed with a backslash ('\') to avoid confusion with a field delimiter.
Other characters may be prefixed with a backslash to change their meaning :

  \t   for a tab
  \r   for a carriage return (CR)
  \n   for a new line (LF)
  \    to mark a space and differentiate it from a delimiter
  \#   to mark a sharp and differentiate it from a comment
  \\   to use a backslash in a regex
  \\\\ to use a backslash in the text (*2 for regex, *2 for haproxy)
  \xXX to write the ASCII hex code XX as in the C language

The &lt;replace&gt; parameter contains the string to be used to replace the largest
portion of text matching the regex. It can make use of the special characters
above, and can reference a substring which is delimited by parenthesis in the
regex, by writing a backslash ('\') immediately followed by one digit from 0 to
9 indicating the group position (0 designating the entire line). This practice
is very common to users of the &quot;sed&quot; program.

The &lt;string&gt; parameter represents the string which will systematically be added
after the last header line. It can also use special character sequences above.
</pre><h5>Notes related to these keywords :</h5><pre class="text">- these keywords are not always convenient to allow/deny based on header
  contents. It is strongly recommended to use ACLs with the &quot;<a href="#block">block</a>&quot; keyword
  instead, resulting in far more flexible and manageable rules.

- lines are always considered as a whole. It is not possible to reference
  a header name only or a value only. This is important because of the way
  headers are written (notably the number of spaces after the colon).

- the first line is always considered as a header, which makes it possible to
  rewrite or filter HTTP requests URIs or response codes, but in turn makes
  it harder to distinguish between headers and request line. The regex prefix
  ^[^\ \t]*[\ \t] matches any HTTP method followed by a space, and the prefix
  ^[^ \t:]*: matches any header name followed by a colon.

- for performances reasons, the number of characters added to a request or to
  a response is limited at build time to values between 1 and 4 kB. This
  should normally be far more than enough for most usages. If it is too short
  on occasional usages, it is possible to gain some space by removing some
  useless headers before adding new ones.

- keywords beginning with &quot;reqi&quot; and &quot;rspi&quot; are the same as their counterpart
  without the 'i' letter except that they ignore case when matching patterns.

- when a request passes through a frontend then a backend, all req* rules
  from the frontend will be evaluated, then all req* rules from the backend
  will be evaluated. The reverse path is applied to responses.

- req* statements are applied after &quot;<a href="#block">block</a>&quot; statements, so that &quot;<a href="#block">block</a>&quot; is
  always the first one, but before &quot;<a href="#use_backend">use_backend</a>&quot; in order to permit rewriting
  before switching.
</pre></div>
<a class="anchor" id="7" name="7"></a>
<div class="page-header"><h1 id="chapter-7" data-target="7"><small><a class="small" href="#7">7.</a></small> Using ACLs and fetching samples</h1>
</div><div><pre class="text">Haproxy is capable of extracting data from request or response streams, from
client or server information, from tables, environmental information etc...
The action of extracting such data is called fetching a sample. Once retrieved,
these samples may be used for various purposes such as a key to a stick-table,
but most common usages consist in matching them against predefined constant
data called patterns.
</pre></div>
<a class="anchor" id="7.1" name="7.1"></a>
<h2 id="chapter-7.1" data-target="7.1"><small><a class="small" href="#7.1">7.1.</a></small> ACL basics</h2>
<div><pre class="text">The use of Access Control Lists (ACL) provides a flexible solution to perform
content switching and generally to take decisions based on content extracted
from the request, the response or any environmental status. The principle is
simple :

  - extract a data sample from a stream, table or the environment
  - optionally apply some format conversion to the extracted sample
  - apply one or multiple pattern matching methods on this sample
  - perform actions only when a pattern matches the sample

The actions generally consist in blocking a request, selecting a backend, or
adding a header.

In order to define a test, the &quot;<a href="#acl">acl</a>&quot; keyword is used. The syntax is :

   acl &lt;aclname&gt; &lt;criterion&gt; [flags] [operator] [&lt;value&gt;] ...

This creates a new ACL &lt;aclname&gt; or completes an existing one with new tests.
Those tests apply to the portion of request/response specified in &lt;criterion&gt;
and may be adjusted with optional flags [flags]. Some criteria also support
an operator which may be specified before the set of values. Optionally some
conversion operators may be applied to the sample, and they will be specified
as a comma-delimited list of keywords just after the first keyword. The values
are of the type supported by the criterion, and are separated by spaces.

ACL names must be formed from upper and lower case letters, digits, '-' (dash),
'_' (underscore) , '.' (dot) and ':' (colon). ACL names are case-sensitive,
which means that &quot;my_acl&quot; and &quot;My_Acl&quot; are two different ACLs.

There is no enforced limit to the number of ACLs. The unused ones do not affect
performance, they just consume a small amount of memory.

The criterion generally is the name of a sample fetch method, or one of its ACL
specific declinations. The default test method is implied by the output type of
this sample fetch method. The ACL declinations can describe alternate matching
methods of a same sample fetch method. The sample fetch methods are the only
ones supporting a conversion.

Sample fetch methods return data which can be of the following types :
  - boolean
  - integer (signed or unsigned)
  - IPv4 or IPv6 address
  - string
  - data block

Converters transform any of these data into any of these. For example, some
converters might convert a string to a lower-case string while other ones
would turn a string to an IPv4 address, or apply a netmask to an IP address.
The resulting sample is of the type of the last converter applied to the list,
which defaults to the type of the sample fetch method.

Each sample or converter returns data of a specific type, specified with its
keyword in this documentation. When an ACL is declared using a standard sample
fetch method, certain types automatically involved a default matching method
which are summarized in the table below :

   +---------------------+-----------------+
   | Sample or converter | Default         |
   |    output type      | matching method |
   +---------------------+-----------------+
   | boolean             | bool            |
   +---------------------+-----------------+
   | integer             | int             |
   +---------------------+-----------------+
   | ip                  | ip              |
   +---------------------+-----------------+
   | string              | str             |
   +---------------------+-----------------+
   | binary              | none, use &quot;-m&quot;  |
   +---------------------+-----------------+

Note that in order to match a binary samples, it is mandatory to specify a
matching method, see below.

The ACL engine can match these types against patterns of the following types :
  - boolean
  - integer or integer range
  - IP address / network
  - string (exact, substring, suffix, prefix, subdir, domain)
  - regular expression
  - hex block

The following ACL flags are currently supported :

   -i : ignore case during matching of all subsequent patterns.
   -f : load patterns from a file.
   -m : use a specific pattern matching method
   -n : forbid the DNS resolutions
   -M : load the file pointed by -f like a map file.
   -u : force the unique id of the ACL
   -- : force end of flags. Useful when a string looks like one of the flags.

The &quot;-f&quot; flag is followed by the name of a file from which all lines will be
read as individual values. It is even possible to pass multiple &quot;-f&quot; arguments
if the patterns are to be loaded from multiple files. Empty lines as well as
lines beginning with a sharp ('#') will be ignored. All leading spaces and tabs
will be stripped. If it is absolutely necessary to insert a valid pattern
beginning with a sharp, just prefix it with a space so that it is not taken for
a comment. Depending on the data type and match method, haproxy may load the
lines into a binary tree, allowing very fast lookups. This is true for IPv4 and
exact string matching. In this case, duplicates will automatically be removed.

The &quot;-M&quot; flag allows an ACL to use a map file. If this flag is set, the file is
parsed as two column file. The first column contains the patterns used by the
ACL, and the second column contain the samples. The sample can be used later by
a map. This can be useful in some rare cases where an ACL would just be used to
check for the existence of a pattern in a map before a mapping is applied.

The &quot;-u&quot; flag forces the unique id of the ACL. This unique id is used with the
socket interface to identify ACL and dynamically change its values. Note that a
file is always identified by its name even if an id is set.

Also, note that the &quot;-i&quot; flag applies to subsequent entries and not to entries
loaded from files preceding it. For instance :

    acl valid-ua hdr(user-agent) -f exact-ua.lst -i -f generic-ua.lst test

In this example, each line of &quot;exact-ua.lst&quot; will be exactly matched against
the &quot;user-agent&quot; header of the request. Then each line of &quot;generic-ua&quot; will be
case-insensitively matched. Then the word &quot;test&quot; will be insensitively matched
as well.

The &quot;-m&quot; flag is used to select a specific pattern matching method on the input
sample. All ACL-specific criteria imply a pattern matching method and generally
do not need this flag. However, this flag is useful with generic sample fetch
methods to describe how they're going to be matched against the patterns. This
is required for sample fetches which return data type for which there is no
obvious matching method (eg: string or binary). When &quot;-m&quot; is specified and
followed by a pattern matching method name, this method is used instead of the
default one for the criterion. This makes it possible to match contents in ways
that were not initially planned, or with sample fetch methods which return a
string. The matching method also affects the way the patterns are parsed.

The &quot;-n&quot; flag forbids the dns resolutions. It is used with the load of ip files.
By default, if the parser cannot parse ip address it considers that the parsed
string is maybe a domain name and try dns resolution. The flag &quot;-n&quot; disable this
resolution. It is useful for detecting malformed ip lists. Note that if the DNS
server is not reachable, the haproxy configuration parsing may last many minutes
waiting fir the timeout. During this time no error messages are displayed. The
flag &quot;-n&quot; disable this behavior. Note also that during the runtime, this
function is disabled for the dynamic acl modifications.

There are some restrictions however. Not all methods can be used with all
sample fetch methods. Also, if &quot;-m&quot; is used in conjunction with &quot;-f&quot;, it must
be placed first. The pattern matching method must be one of the following :

  - &quot;found&quot; : only check if the requested sample could be found in the stream,
              but do not compare it against any pattern. It is recommended not
              to pass any pattern to avoid confusion. This matching method is
              particularly useful to detect presence of certain contents such
              as headers, cookies, etc... even if they are empty and without
              comparing them to anything nor counting them.

  - &quot;bool&quot;  : check the value as a boolean. It can only be applied to fetches
              which return a boolean or integer value, and takes no pattern.
              Value zero or false does not match, all other values do match.

  - &quot;int&quot;   : match the value as an integer. It can be used with integer and
              boolean samples. Boolean false is integer 0, true is integer 1.

  - &quot;ip&quot;    : match the value as an IPv4 or IPv6 address. It is compatible
              with IP address samples only, so it is implied and never needed.

  - &quot;bin&quot;   : match the contents against an hexadecimal string representing a
              binary sequence. This may be used with binary or string samples.

  - &quot;len&quot;   : match the sample's length as an integer. This may be used with
              binary or string samples.

  - &quot;str&quot;   : exact match : match the contents against a string. This may be
              used with binary or string samples.

  - &quot;sub&quot;   : substring match : check that the contents contain at least one of
              the provided string patterns. This may be used with binary or
              string samples.

  - &quot;reg&quot;   : regex match : match the contents against a list of regular
              expressions. This may be used with binary or string samples.

  - &quot;beg&quot;   : prefix match : check that the contents begin like the provided
              string patterns. This may be used with binary or string samples.

  - &quot;end&quot;   : suffix match : check that the contents end like the provided
              string patterns. This may be used with binary or string samples.

  - &quot;dir&quot;   : subdir match : check that a slash-delimited portion of the
              contents exactly matches one of the provided string patterns.
              This may be used with binary or string samples.

  - &quot;dom&quot;   : domain match : check that a dot-delimited portion of the contents
              exactly match one of the provided string patterns. This may be
              used with binary or string samples.

For example, to quickly detect the presence of cookie &quot;JSESSIONID&quot; in an HTTP
request, it is possible to do :

    acl jsess_present cook(JSESSIONID) -m found

In order to apply a regular expression on the 500 first bytes of data in the
buffer, one would use the following acl :

    acl script_tag payload(0,500) -m reg -i &lt;script&gt;

On systems where the regex library is much slower when using &quot;-i&quot;, it is
possible to convert the sample to lowercase before matching, like this :

    acl script_tag payload(0,500),lower -m reg &lt;script&gt;

All ACL-specific criteria imply a default matching method. Most often, these
criteria are composed by concatenating the name of the original sample fetch
method and the matching method. For example, &quot;hdr_beg&quot; applies the &quot;beg&quot; match
to samples retrieved using the &quot;<a href="#hdr">hdr</a>&quot; fetch method. Since all ACL-specific
criteria rely on a sample fetch method, it is always possible instead to use
the original sample fetch method and the explicit matching method using &quot;-m&quot;.

If an alternate match is specified using &quot;-m&quot; on an ACL-specific criterion,
the matching method is simply applied to the underlying sample fetch method.
For example, all ACLs below are exact equivalent :

    acl short_form  hdr_beg(host)        www.
    acl alternate1  hdr_beg(host) -m beg www.
    acl alternate2  hdr_dom(host) -m beg www.
    acl alternate3  hdr(host)     -m beg www.


The table below summarizes the compatibility matrix between sample or converter
types and the pattern types to fetch against. It indicates for each compatible
combination the name of the matching method to be used, surrounded with angle
brackets &quot;&gt;&quot; and &quot;&lt;&quot; when the method is the default one and will work by
default without &quot;-m&quot;.

                           +-------------------------------------------------+
                           |                Input sample type                |
    +----------------------+---------+---------+---------+---------+---------+
    |     pattern type     | boolean | integer |   ip    | string  | binary  |
    +----------------------+---------+---------+---------+---------+---------+
    | none (presence only) |  found  |  found  |  found  |  found  |  found  |
    +----------------------+---------+---------+---------+---------+---------+
    | none (boolean value) |&gt;  bool &lt;|   bool  |         |   bool  |         |
    +----------------------+---------+---------+---------+---------+---------+
    | integer (value)      |   int   |&gt;  int  &lt;|   int   |   int   |         |
    +----------------------+---------+---------+---------+---------+---------+
    | integer (length)     |   len   |   len   |   len   |   len   |   len   |
    +----------------------+---------+---------+---------+---------+---------+
    | IP address           |         |         |&gt;   ip  &lt;|    ip   |    ip   |
    +----------------------+---------+---------+---------+---------+---------+
    | exact string         |   str   |   str   |   str   |&gt;  str  &lt;|   str   |
    +----------------------+---------+---------+---------+---------+---------+
    | prefix               |   beg   |   beg   |   beg   |   beg   |   beg   |
    +----------------------+---------+---------+---------+---------+---------+
    | suffix               |   end   |   end   |   end   |   end   |   end   |
    +----------------------+---------+---------+---------+---------+---------+
    | substring            |   sub   |   sub   |   sub   |   sub   |   sub   |
    +----------------------+---------+---------+---------+---------+---------+
    | subdir               |   dir   |   dir   |   dir   |   dir   |   dir   |
    +----------------------+---------+---------+---------+---------+---------+
    | domain               |   dom   |   dom   |   dom   |   dom   |   dom   |
    +----------------------+---------+---------+---------+---------+---------+
    | regex                |   reg   |   reg   |   reg   |   reg   |   reg   |
    +----------------------+---------+---------+---------+---------+---------+
    | hex block            |         |         |         |   bin   |   bin   |
    +----------------------+---------+---------+---------+---------+---------+
</pre></div>
<a class="anchor" id="7.1.1" name="7.1.1"></a>
<h3 id="chapter-7.1.1" data-target="7.1.1"><small><a class="small" href="#7.1.1">7.1.1.</a></small> Matching booleans</h3>
<div><pre class="text">In order to match a boolean, no value is needed and all values are ignored.
Boolean matching is used by default for all fetch methods of type &quot;boolean&quot;.
When boolean matching is used, the fetched value is returned as-is, which means
that a boolean &quot;true&quot; will always match and a boolean &quot;false&quot; will never match.

Boolean matching may also be enforced using &quot;-m bool&quot; on fetch methods which
return an integer value. Then, integer value 0 is converted to the boolean
&quot;false&quot; and all other values are converted to &quot;true&quot;.
</pre></div>
<a class="anchor" id="7.1.2" name="7.1.2"></a>
<h3 id="chapter-7.1.2" data-target="7.1.2"><small><a class="small" href="#7.1.2">7.1.2.</a></small> Matching integers</h3>
<div><pre class="text">Integer matching applies by default to integer fetch methods. It can also be
enforced on boolean fetches using &quot;-m int&quot;. In this case, &quot;false&quot; is converted
to the integer 0, and &quot;true&quot; is converted to the integer 1.

Integer matching also supports integer ranges and operators. Note that integer
matching only applies to positive values. A range is a value expressed with a
lower and an upper bound separated with a colon, both of which may be omitted.

For instance, &quot;1024:65535&quot; is a valid range to represent a range of
unprivileged ports, and &quot;1024:&quot; would also work. &quot;0:1023&quot; is a valid
representation of privileged ports, and &quot;:1023&quot; would also work.

As a special case, some ACL functions support decimal numbers which are in fact
two integers separated by a dot. This is used with some version checks for
instance. All integer properties apply to those decimal numbers, including
ranges and operators.

For an easier usage, comparison operators are also supported. Note that using
operators with ranges does not make much sense and is strongly discouraged.
Similarly, it does not make much sense to perform order comparisons with a set
of values.

Available operators for integer matching are :

  eq : true if the tested value equals at least one value
  ge : true if the tested value is greater than or equal to at least one value
  gt : true if the tested value is greater than at least one value
  le : true if the tested value is less than or equal to at least one value
  lt : true if the tested value is less than at least one value

For instance, the following ACL matches any negative Content-Length header :

  acl negative-length hdr_val(content-length) lt 0

This one matches SSL versions between 3.0 and 3.1 (inclusive) :

  acl sslv3 req_ssl_ver 3:3.1
</pre></div>
<a class="anchor" id="7.1.3" name="7.1.3"></a>
<h3 id="chapter-7.1.3" data-target="7.1.3"><small><a class="small" href="#7.1.3">7.1.3.</a></small> Matching strings</h3>
<div><pre class="text">String matching applies to string or binary fetch methods, and exists in 6
different forms :

  - exact match     (-m str) : the extracted string must exactly match the
    patterns ;

  - substring match (-m sub) : the patterns are looked up inside the
    extracted string, and the ACL matches if any of them is found inside ;

  - prefix match    (-m beg) : the patterns are compared with the beginning of
    the extracted string, and the ACL matches if any of them matches.

  - suffix match    (-m end) : the patterns are compared with the end of the
    extracted string, and the ACL matches if any of them matches.

  - subdir match    (-m sub) : the patterns are looked up inside the extracted
    string, delimited with slashes (&quot;/&quot;), and the ACL matches if any of them
    matches.

  - domain match    (-m dom) : the patterns are looked up inside the extracted
    string, delimited with dots (&quot;.&quot;), and the ACL matches if any of them
    matches.

String matching applies to verbatim strings as they are passed, with the
exception of the backslash (&quot;\&quot;) which makes it possible to escape some
characters such as the space. If the &quot;-i&quot; flag is passed before the first
string, then the matching will be performed ignoring the case. In order
to match the string &quot;-i&quot;, either set it second, or pass the &quot;--&quot; flag
before the first string. Same applies of course to match the string &quot;--&quot;.
</pre></div>
<a class="anchor" id="7.1.4" name="7.1.4"></a>
<h3 id="chapter-7.1.4" data-target="7.1.4"><small><a class="small" href="#7.1.4">7.1.4.</a></small> Matching regular expressions (regexes)</h3>
<div><pre class="text">Just like with string matching, regex matching applies to verbatim strings as
they are passed, with the exception of the backslash (&quot;\&quot;) which makes it
possible to escape some characters such as the space. If the &quot;-i&quot; flag is
passed before the first regex, then the matching will be performed ignoring
the case. In order to match the string &quot;-i&quot;, either set it second, or pass
the &quot;--&quot; flag before the first string. Same principle applies of course to
match the string &quot;--&quot;.
</pre></div>
<a class="anchor" id="7.1.5" name="7.1.5"></a>
<h3 id="chapter-7.1.5" data-target="7.1.5"><small><a class="small" href="#7.1.5">7.1.5.</a></small> Matching arbitrary data blocks</h3>
<div><pre class="text">It is possible to match some extracted samples against a binary block which may
not safely be represented as a string. For this, the patterns must be passed as
a series of hexadecimal digits in an even number, when the match method is set
to binary. Each sequence of two digits will represent a byte. The hexadecimal
digits may be used upper or lower case.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># match &quot;Hello\n&quot; in the input stream (\x48 \x65 \x6c \x6c \x6f \x0a)</span>
acl hello payload(0,6) -m bin 48656c6c6f0a
</code></pre>
</div></div>
<a class="anchor" id="7.1.6" name="7.1.6"></a>
<h3 id="chapter-7.1.6" data-target="7.1.6"><small><a class="small" href="#7.1.6">7.1.6.</a></small> Matching IPv4 and IPv6 addresses</h3>
<div><pre class="text">IPv4 addresses values can be specified either as plain addresses or with a
netmask appended, in which case the IPv4 address matches whenever it is
within the network. Plain addresses may also be replaced with a resolvable
host name, but this practice is generally discouraged as it makes it more
difficult to read and debug configurations. If hostnames are used, you should
at least ensure that they are present in /etc/hosts so that the configuration
does not depend on any random DNS match at the moment the configuration is
parsed.

IPv6 may be entered in their usual form, with or without a netmask appended.
Only bit counts are accepted for IPv6 netmasks. In order to avoid any risk of
trouble with randomly resolved IP addresses, host names are never allowed in
IPv6 patterns.

HAProxy is also able to match IPv4 addresses with IPv6 addresses in the
following situations :
  - tested address is IPv4, pattern address is IPv4, the match applies
    in IPv4 using the supplied mask if any.
  - tested address is IPv6, pattern address is IPv6, the match applies
    in IPv6 using the supplied mask if any.
  - tested address is IPv6, pattern address is IPv4, the match applies in IPv4
    using the pattern's mask if the IPv6 address matches with 2002:IPV4::,
    ::IPV4 or ::ffff:IPV4, otherwise it fails.
  - tested address is IPv4, pattern address is IPv6, the IPv4 address is first
    converted to IPv6 by prefixing ::ffff: in front of it, then the match is
    applied in IPv6 using the supplied IPv6 mask.
</pre></div>
<a class="anchor" id="7.2" name="7.2"></a>
<h2 id="chapter-7.2" data-target="7.2"><small><a class="small" href="#7.2">7.2.</a></small> Using ACLs to form conditions</h2>
<div><pre class="text">Some actions are only performed upon a valid condition. A condition is a
combination of ACLs with operators. 3 operators are supported :

  - AND (implicit)
  - OR  (explicit with the &quot;or&quot; keyword or the &quot;||&quot; operator)
  - Negation with the exclamation mark (&quot;!&quot;)

A condition is formed as a disjunctive form:

   [!]acl1 [!]acl2 ... [!]acln  { or [!]acl1 [!]acl2 ... [!]acln } ...

Such conditions are generally used after an &quot;if&quot; or &quot;unless&quot; statement,
indicating when the condition will trigger the action.

For instance, to block HTTP requests to the &quot;*&quot; URL with methods other than
&quot;OPTIONS&quot;, as well as POST requests without content-length, and GET or HEAD
requests with a content-length greater than 0, and finally every request which
is not either GET/HEAD/POST/OPTIONS !

   acl missing_cl hdr_cnt(Content-length) eq 0
   block if HTTP_URL_STAR !METH_OPTIONS || METH_POST missing_cl
   block if METH_GET HTTP_CONTENT
   block unless METH_GET or METH_POST or METH_OPTIONS

To select a different backend for requests to static contents on the &quot;www&quot; site
and to every request on the &quot;img&quot;, &quot;video&quot;, &quot;download&quot; and &quot;ftp&quot; hosts :

   acl url_static  path_beg         /static /images /img /css
   acl url_static  path_end         .gif .png .jpg .css .js
   acl host_www    hdr_beg(host) -i www
   acl host_static hdr_beg(host) -i img. video. download. ftp.

   # now use backend &quot;static&quot; for all static-only hosts, and for static urls
   # of host &quot;www&quot;. Use backend &quot;www&quot; for the rest.
   use_backend static if host_static or host_www url_static
   use_backend www    if host_www

It is also possible to form rules using &quot;anonymous ACLs&quot;. Those are unnamed ACL
expressions that are built on the fly without needing to be declared. They must
be enclosed between braces, with a space before and after each brace (because
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>The following rule :

    acl missing_cl hdr_cnt(Content-length) eq 0
    block if METH_POST missing_cl

Can also be written that way :

    block if METH_POST { hdr_cnt(Content-length) eq 0 }
</code></pre>
</div><pre class="text">It is generally not recommended to use this construct because it's a lot easier
to leave errors in the configuration when written that way. However, for very
simple rules matching only one source IP address for instance, it can make more
sense to use them than to declare ACLs with random names. Another example of
good use is the following :

   With named ACLs :

        acl site_dead nbsrv(dynamic) lt 2
        acl site_dead nbsrv(static)  lt 2
        monitor fail  if site_dead

   With anonymous ACLs :

        monitor fail if { nbsrv(dynamic) lt 2 } || { nbsrv(static) lt 2 }

See <a href="#4.2">section 4.2</a> for detailed help on the &quot;<a href="#block">block</a>&quot; and &quot;<a href="#use_backend">use_backend</a>&quot; keywords.
</pre></div>
<a class="anchor" id="7.3" name="7.3"></a>
<h2 id="chapter-7.3" data-target="7.3"><small><a class="small" href="#7.3">7.3.</a></small> Fetching samples</h2>
<div><pre class="text">Historically, sample fetch methods were only used to retrieve data to match
against patterns using ACLs. With the arrival of stick-tables, a new class of
sample fetch methods was created, most often sharing the same syntax as their
ACL counterpart. These sample fetch methods are also known as &quot;fetches&quot;. As
of now, ACLs and fetches have converged. All ACL fetch methods have been made
available as fetch methods, and ACLs may use any sample fetch method as well.

This section details all available sample fetch methods and their output type.
Some sample fetch methods have deprecated aliases that are used to maintain
compatibility with existing configurations. They are then explicitly marked as
deprecated and should not be used in new setups.

The ACL derivatives are also indicated when available, with their respective
matching methods. These ones all have a well defined default pattern matching
method, so it is never necessary (though allowed) to pass the &quot;-m&quot; option to
indicate how the sample will be matched using ACLs.

As indicated in the sample type versus matching compatibility matrix above,
when using a generic sample fetch method in an ACL, the &quot;-m&quot; option is
mandatory unless the sample type is one of boolean, integer, IPv4 or IPv6. When
the same keyword exists as an ACL keyword and as a standard fetch method, the
ACL engine will automatically pick the ACL-only one by default.

Some of these keywords support one or multiple mandatory arguments, and one or
multiple optional arguments. These arguments are strongly typed and are checked
when the configuration is parsed so that there is no risk of running with an
incorrect argument (eg: an unresolved backend name). Fetch function arguments
are passed between parenthesis and are delimited by commas.  When an argument
is optional, it will be indicated below between square brackets ('[ ]'). When
all arguments are optional, the parenthesis may be omitted.

Thus, the syntax of a standard sample fetch method is one of the following :
   - <a href="#name">name</a>
   - name(arg1)
   - name(arg1,arg2)
</pre></div>
<a class="anchor" id="7.3.1" name="7.3.1"></a>
<h3 id="chapter-7.3.1" data-target="7.3.1"><small><a class="small" href="#7.3.1">7.3.1.</a></small> Converters</h3>
<div><pre class="text">Sample fetch methods may be combined with transformations to be applied on top
of the fetched sample (also called &quot;converters&quot;). These combinations form what
is called &quot;sample expressions&quot; and the result is a &quot;sample&quot;. Initially this
was only supported by &quot;<a href="#stick%20on">stick on</a>&quot; and &quot;<a href="#stick%20store-request">stick store-request</a>&quot; directives but this
has now be extended to all places where samples may be used (acls, log-format,
unique-id-format, add-header, ...).

These transformations are enumerated as a series of specific keywords after the
sample fetch method. These keywords may equally be appended immediately after
the fetch keyword's argument, delimited by a comma. These keywords can also
support some arguments (eg: a netmask) which must be passed in parenthesis.

The currently available list of transformation keywords include :
</pre><a class="anchor" name="base64"></a><a class="anchor" name="7-base64"></a><a class="anchor" name="7.3.1-base64"></a><a class="anchor" name="base64 (Using ACLs and fetching samples)"></a><a class="anchor" name="base64 (Converters)"></a><div class="keyword"><b><a class="anchor" name="base64"></a><a href="#7.3.1-base64">base64</a></b></div><pre class="text">Converts a binary input sample to a base64 string. It is used to log or
transfer binary content in a way that can be reliably transferred (eg:
an SSL ID can be copied in a header).
</pre><a class="anchor" name="lower"></a><a class="anchor" name="7-lower"></a><a class="anchor" name="7.3.1-lower"></a><a class="anchor" name="lower (Using ACLs and fetching samples)"></a><a class="anchor" name="lower (Converters)"></a><div class="keyword"><b><a class="anchor" name="lower"></a><a href="#7.3.1-lower">lower</a></b></div><pre class="text">Convert a string sample to lower case. This can only be placed after a string
sample fetch function or after a transformation keyword returning a string
type. The result is of type string.
</pre><a class="anchor" name="upper"></a><a class="anchor" name="7-upper"></a><a class="anchor" name="7.3.1-upper"></a><a class="anchor" name="upper (Using ACLs and fetching samples)"></a><a class="anchor" name="upper (Converters)"></a><div class="keyword"><b><a class="anchor" name="upper"></a><a href="#7.3.1-upper">upper</a></b></div><pre class="text">Convert a string sample to upper case. This can only be placed after a string
sample fetch function or after a transformation keyword returning a string
type. The result is of type string.
</pre><a class="anchor" name="hex"></a><a class="anchor" name="7-hex"></a><a class="anchor" name="7.3.1-hex"></a><a class="anchor" name="hex (Using ACLs and fetching samples)"></a><a class="anchor" name="hex (Converters)"></a><div class="keyword"><b><a class="anchor" name="hex"></a><a href="#7.3.1-hex">hex</a></b></div><pre class="text">Converts a binary input sample to an hex string containing two hex digits per
input byte. It is used to log or transfer hex dumps of some binary input data
in a way that can be reliably transferred (eg: an SSL ID can be copied in a
header).
</pre><a class="anchor" name="ipmask"></a><a class="anchor" name="7-ipmask"></a><a class="anchor" name="7.3.1-ipmask"></a><a class="anchor" name="ipmask (Using ACLs and fetching samples)"></a><a class="anchor" name="ipmask (Converters)"></a><div class="keyword"><b><a class="anchor" name="ipmask"></a><a href="#7.3.1-ipmask">ipmask</a></b>(<span style="color: #080">&lt;mask&gt;</span>)</div><pre class="text">Apply a mask to an IPv4 address, and use the result for lookups and storage.
This can be used to make all hosts within a certain mask to share the same
table entries and as such use the same server. The mask can be passed in
dotted form (eg: 255.255.255.0) or in CIDR form (eg: 24).
</pre><a class="anchor" name="http_date"></a><a class="anchor" name="7-http_date"></a><a class="anchor" name="7.3.1-http_date"></a><a class="anchor" name="http_date (Using ACLs and fetching samples)"></a><a class="anchor" name="http_date (Converters)"></a><div class="keyword"><b><a class="anchor" name="http_date"></a><a href="#7.3.1-http_date">http_date</a></b>(<span style="color: #008">[<span style="color: #080">&lt;offset&gt;</span>]</span>)</div><pre class="text">Converts an integer supposed to contain a date since epoch to a string
representing this date in a format suitable for use in HTTP header fields. If
an offset value is specified, then it is a number of seconds that is added to
the date before the conversion is operated. This is particularly useful to
emit Date header fields, Expires values in responses when combined with a
positive offset, or Last-Modified values when the offset is negative.
</pre><a class="anchor" name="language"></a><a class="anchor" name="7-language"></a><a class="anchor" name="7.3.1-language"></a><a class="anchor" name="language (Using ACLs and fetching samples)"></a><a class="anchor" name="language (Converters)"></a><div class="keyword"><b><a class="anchor" name="language"></a><a href="#7.3.1-language">language</a></b>(<span style="color: #080">&lt;value&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;default&gt;</span>]</span>)</div><pre class="text">Returns the value with the highest q-factor from a list as extracted from the
&quot;accept-language&quot; header using &quot;<a href="#req.fhdr">req.fhdr</a>&quot;. Values with no q-factor have a
q-factor of 1. Values with a q-factor of 0 are dropped. Only values which
belong to the list of semi-colon delimited &lt;values&gt; will be considered. The
argument &lt;value&gt; syntax is &quot;lang[;lang[;lang[;...]]]&quot;. If no value matches the
given list and a default value is provided, it is returned. Note that language
names may have a variant after a dash ('-'). If this variant is present in the
list, it will be matched, but if it is not, only the base language is checked.
The match is case-sensitive, and the output string is always one of those
provided in arguments.  The ordering of arguments is meaningless, only the
ordering of the values in the request counts, as the first value among
multiple sharing the same q-factor is used.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># this configuration switches to the backend matching a</span>
<span class="comment"># given language based on the request :</span>

acl es req.fhdr(accept-language),language(es;fr;en) -m str es
acl fr req.fhdr(accept-language),language(es;fr;en) -m str fr
acl en req.fhdr(accept-language),language(es;fr;en) -m str en
use_backend spanish if es
use_backend french  if fr
use_backend english if en
default_backend choose_your_language
</code></pre>
</div><a class="anchor" name="map"></a><a class="anchor" name="7-map"></a><a class="anchor" name="7.3.1-map"></a><a class="anchor" name="map (Using ACLs and fetching samples)"></a><a class="anchor" name="map (Converters)"></a><div class="keyword"><b><a class="anchor" name="map"></a><a href="#7.3.1-map">map</a></b>(<span style="color: #080">&lt;map_file&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;default_value&gt;</span>]</span>)</div><pre class="text">map_&lt;match_type&gt;(&lt;map_file&gt;[,&lt;default_value&gt;])
map_&lt;match_type&gt;_&lt;output_type&gt;(&lt;map_file&gt;[,&lt;default_value&gt;])
  Search the input value from &lt;map_file&gt; using the &lt;match_type&gt; matching method,
  and return the associated value converted to the type &lt;output_type&gt;. If the
  input value cannot be found in the &lt;map_file&gt;, the converter returns the
  &lt;default_value&gt;. If the &lt;default_value&gt; is not set, the converter fails and
  acts as if no input value could be fetched. If the &lt;match_type&gt; is not set, it
  defaults to &quot;str&quot;. Likewise, if the &lt;output_type&gt; is not set, it defaults to
  &quot;str&quot;. For convenience, the &quot;<a href="#map">map</a>&quot; keyword is an alias for &quot;map_str&quot; and maps a
  string to another string.

  It is important to avoid overlapping between the keys : IP addresses and
  strings are stored in trees, so the first of the finest match will be used.
  Other keys are stored in lists, so the first matching occurrence will be used.

  The following array contains the list of all map functions avalaible sorted by
  input type, match type and output type.
</pre><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>input type</th><th>match method</th><th>output type str</th><th>output type int</th><th>output type ip</th></tr></thead>
<tr><td None>str</td><td None>str</td><td None>map_str</td><td None>map_str_int</td><td None>map_str_ip</td></tr>
<tr><td None>str</td><td None>beg</td><td None>map_beg</td><td None>map_beg_int</td><td None>map_end_ip</td></tr>
<tr><td None>str</td><td None>sub</td><td None>map_sub</td><td None>map_sub_int</td><td None>map_sub_ip</td></tr>
<tr><td None>str</td><td None>dir</td><td None>map_dir</td><td None>map_dir_int</td><td None>map_dir_ip</td></tr>
<tr><td None>str</td><td None>dom</td><td None>map_dom</td><td None>map_dom_int</td><td None>map_dom_ip</td></tr>
<tr><td None>str</td><td None>end</td><td None>map_end</td><td None>map_end_int</td><td None>map_end_ip</td></tr>
<tr><td None>str</td><td None>reg</td><td None>map_reg</td><td None>map_reg_int</td><td None>map_reg_ip</td></tr>
<tr><td None>int</td><td None>int</td><td None>map_int</td><td None>map_int_int</td><td None>map_int_ip</td></tr>
<tr><td None>ip</td><td None>ip</td><td None>map_ip</td><td None>map_ip_int</td><td None>map_ip_ip</td></tr>
</table><pre class="text">The file contains one key + value per line. Lines which start with '#' are
ignored, just like empty lines. Leading tabs and spaces are stripped. The key
is then the first &quot;word&quot; (series of non-space/tabs characters), and the value
is what follows this series of space/tab till the end of the line excluding
trailing spaces/tabs.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># this is a comment and is ignored</span>
   2.22.246.0/23    United Kingdom      \n
&lt;-&gt;&lt;-----------&gt;&lt;--&gt;&lt;------------&gt;&lt;----&gt;
 |       |       |         |        `- trailing spaces ignored
 |       |       |         `---------- value
 |       |       `-------------------- middle spaces ignored
 |       `---------------------------- key
 `------------------------------------ leading spaces ignored
</code></pre>
</div></div>
<a class="anchor" id="7.3.2" name="7.3.2"></a>
<h3 id="chapter-7.3.2" data-target="7.3.2"><small><a class="small" href="#7.3.2">7.3.2.</a></small> Fetching samples from internal states</h3>
<div><pre class="text">A first set of sample fetch methods applies to internal information which does
not even relate to any client information. These ones are sometimes used with
&quot;monitor-fail&quot; directives to report an internal status to external watchers.
The sample fetch methods described in this section are usable anywhere.
</pre><a class="anchor" name="always_false"></a><a class="anchor" name="7-always_false"></a><a class="anchor" name="7.3.2-always_false"></a><a class="anchor" name="always_false (Using ACLs and fetching samples)"></a><a class="anchor" name="always_false (Fetching samples from internal states)"></a><div class="keyword"><b><a class="anchor" name="always_false"></a><a href="#7.3.2-always_false">always_false</a></b> : boolean</div><pre class="text">Always returns the boolean &quot;false&quot; value. It may be used with ACLs as a
temporary replacement for another one when adjusting configurations.
</pre><a class="anchor" name="always_true"></a><a class="anchor" name="7-always_true"></a><a class="anchor" name="7.3.2-always_true"></a><a class="anchor" name="always_true (Using ACLs and fetching samples)"></a><a class="anchor" name="always_true (Fetching samples from internal states)"></a><div class="keyword"><b><a class="anchor" name="always_true"></a><a href="#7.3.2-always_true">always_true</a></b> : boolean</div><pre class="text">Always returns the boolean &quot;true&quot; value. It may be used with ACLs as a
temporary replacement for another one when adjusting configurations.
</pre><a class="anchor" name="avg_queue"></a><a class="anchor" name="7-avg_queue"></a><a class="anchor" name="7.3.2-avg_queue"></a><a class="anchor" name="avg_queue (Using ACLs and fetching samples)"></a><a class="anchor" name="avg_queue (Fetching samples from internal states)"></a><div class="keyword"><b><a class="anchor" name="avg_queue"></a><a href="#7.3.2-avg_queue">avg_queue</a></b>(<span style="color: #008">[<span style="color: #080">&lt;backend&gt;</span>]</span>) : integer</div><pre class="text">Returns the total number of queued connections of the designated backend
divided by the number of active servers. The current backend is used if no
backend is specified. This is very similar to &quot;<a href="#queue">queue</a>&quot; except that the size of
the farm is considered, in order to give a more accurate measurement of the
time it may take for a new connection to be processed. The main usage is with
ACL to return a sorry page to new users when it becomes certain they will get
a degraded service, or to pass to the backend servers in a header so that
they decide to work in degraded mode or to disable some functions to speed up
the processing a bit. Note that in the event there would not be any active
server anymore, twice the number of queued connections would be considered as
the measured value. This is a fair estimate, as we expect one server to get
back soon anyway, but we still prefer to send new traffic to another backend
if in better shape. See also the &quot;<a href="#queue">queue</a>&quot;, &quot;<a href="#be_conn">be_conn</a>&quot;, and &quot;<a href="#be_sess_rate">be_sess_rate</a>&quot;
sample fetches.
</pre><a class="anchor" name="be_conn"></a><a class="anchor" name="7-be_conn"></a><a class="anchor" name="7.3.2-be_conn"></a><a class="anchor" name="be_conn (Using ACLs and fetching samples)"></a><a class="anchor" name="be_conn (Fetching samples from internal states)"></a><div class="keyword"><b><a class="anchor" name="be_conn"></a><a href="#7.3.2-be_conn">be_conn</a></b>(<span style="color: #008">[<span style="color: #080">&lt;backend&gt;</span>]</span>) : integer</div><pre class="text">Applies to the number of currently established connections on the backend,
possibly including the connection being evaluated. If no backend name is
specified, the current one is used. But it is also possible to check another
backend. It can be used to use a specific farm when the nominal one is full.
See also the &quot;<a href="#fe_conn">fe_conn</a>&quot;, &quot;<a href="#queue">queue</a>&quot; and &quot;<a href="#be_sess_rate">be_sess_rate</a>&quot; criteria.
</pre><a class="anchor" name="be_sess_rate"></a><a class="anchor" name="7-be_sess_rate"></a><a class="anchor" name="7.3.2-be_sess_rate"></a><a class="anchor" name="be_sess_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="be_sess_rate (Fetching samples from internal states)"></a><div class="keyword"><b><a class="anchor" name="be_sess_rate"></a><a href="#7.3.2-be_sess_rate">be_sess_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;backend&gt;</span>]</span>) : integer</div><pre class="text">Returns an integer value corresponding to the sessions creation rate on the
backend, in number of new sessions per second. This is used with ACLs to
switch to an alternate backend when an expensive or fragile one reaches too
high a session rate, or to limit abuse of service (eg. prevent sucking of an
online dictionary). It can also be useful to add this element to logs using a
log-format directive.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># Redirect to an error page if the dictionary is requested too often</span>
backend dynamic
    mode http
    acl being_scanned be_sess_rate gt 100
    redirect location /denied.html if being_scanned
</code></pre>
</div><a class="anchor" name="connslots"></a><a class="anchor" name="7-connslots"></a><a class="anchor" name="7.3.2-connslots"></a><a class="anchor" name="connslots (Using ACLs and fetching samples)"></a><a class="anchor" name="connslots (Fetching samples from internal states)"></a><div class="keyword"><b><a class="anchor" name="connslots"></a><a href="#7.3.2-connslots">connslots</a></b>(<span style="color: #008">[<span style="color: #080">&lt;backend&gt;</span>]</span>) : integer</div><pre class="text">Returns an integer value corresponding to the number of connection slots
still available in the backend, by totaling the maximum amount of
connections on all servers and the maximum queue size. This is probably only
used with ACLs.

The basic idea here is to be able to measure the number of connection &quot;slots&quot;
still available (connection + queue), so that anything beyond that (intended
usage; see &quot;<a href="#use_backend">use_backend</a>&quot; keyword) can be redirected to a different backend.

'connslots' = number of available server connection slots, + number of
available server queue slots.

Note that while &quot;<a href="#fe_conn">fe_conn</a>&quot; may be used, &quot;<a href="#connslots">connslots</a>&quot; comes in especially
useful when you have a case of traffic going to one single ip, splitting into
multiple backends (perhaps using ACLs to do name-based load balancing) and
you want to be able to differentiate between different backends, and their
available &quot;<a href="#connslots">connslots</a>&quot;.  Also, whereas &quot;<a href="#nbsrv">nbsrv</a>&quot; only measures servers that are
actually *down*, this fetch is more fine-grained and looks into the number of
available connection slots as well. See also &quot;<a href="#queue">queue</a>&quot; and &quot;<a href="#avg_queue">avg_queue</a>&quot;.

OTHER CAVEATS AND NOTES: at this point in time, the code does not take care
of dynamic connections. Also, if any of the server maxconn, or maxqueue is 0,
then this fetch clearly does not make sense, in which case the value returned
will be -1.
</pre><a class="anchor" name="date"></a><a class="anchor" name="7-date"></a><a class="anchor" name="7.3.2-date"></a><a class="anchor" name="date (Using ACLs and fetching samples)"></a><a class="anchor" name="date (Fetching samples from internal states)"></a><div class="keyword"><b><a class="anchor" name="date"></a><a href="#7.3.2-date">date</a></b>(<span style="color: #008">[<span style="color: #080">&lt;offset&gt;</span>]</span>) : integer</div><pre class="text">Returns the current date as the epoch (number of seconds since 01/01/1970).
If an offset value is specified, then it is a number of seconds that is added
to the current date before returning the value. This is particularly useful
to compute relative dates, as both positive and negative offsets are allowed.
It is useful combined with the http_date converter.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># set an expires header to now+1 hour in every response</span>
http-response set-header Expires %[date(3600),http_date]
</code></pre>
</div><a class="anchor" name="env"></a><a class="anchor" name="7-env"></a><a class="anchor" name="7.3.2-env"></a><a class="anchor" name="env (Using ACLs and fetching samples)"></a><a class="anchor" name="env (Fetching samples from internal states)"></a><div class="keyword"><b><a class="anchor" name="env"></a><a href="#7.3.2-env">env</a></b>(<span style="color: #080">&lt;name&gt;</span>) : string</div><pre class="text">Returns a string containing the value of environment variable &lt;name&gt;. As a
reminder, environment variables are per-process and are sampled when the
process starts. This can be useful to pass some information to a next hop
server, or with ACLs to take specific action when the process is started a
certain way.
</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code><span class="comment"># Pass the Via header to next hop with the local hostname in it</span>
http-request add-header Via 1.1\ %[env(HOSTNAME)]

<span class="comment"># reject cookie-less requests when the STOP environment variable is set</span>
http-request deny if !{ cook(SESSIONID) -m found } { env(STOP) -m found }
</code></pre>
</div><a class="anchor" name="fe_conn"></a><a class="anchor" name="7-fe_conn"></a><a class="anchor" name="7.3.2-fe_conn"></a><a class="anchor" name="fe_conn (Using ACLs and fetching samples)"></a><a class="anchor" name="fe_conn (Fetching samples from internal states)"></a><div class="keyword"><b><a class="anchor" name="fe_conn"></a><a href="#7.3.2-fe_conn">fe_conn</a></b>(<span style="color: #008">[<span style="color: #080">&lt;frontend&gt;</span>]</span>) : integer</div><pre class="text">Returns the number of currently established connections on the frontend,
possibly including the connection being evaluated. If no frontend name is
specified, the current one is used. But it is also possible to check another
frontend. It can be used to return a sorry page before hard-blocking, or to
use a specific backend to drain new requests when the farm is considered
full.  This is mostly used with ACLs but can also be used to pass some
statistics to servers in HTTP headers. See also the &quot;<a href="#dst_conn">dst_conn</a>&quot;, &quot;<a href="#be_conn">be_conn</a>&quot;,
&quot;<a href="#fe_sess_rate">fe_sess_rate</a>&quot; fetches.
</pre><a class="anchor" name="fe_sess_rate"></a><a class="anchor" name="7-fe_sess_rate"></a><a class="anchor" name="7.3.2-fe_sess_rate"></a><a class="anchor" name="fe_sess_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="fe_sess_rate (Fetching samples from internal states)"></a><div class="keyword"><b><a class="anchor" name="fe_sess_rate"></a><a href="#7.3.2-fe_sess_rate">fe_sess_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;frontend&gt;</span>]</span>) : integer</div><pre class="text">Returns an integer value corresponding to the sessions creation rate on the
frontend, in number of new sessions per second. This is used with ACLs to
limit the incoming session rate to an acceptable range in order to prevent
abuse of service at the earliest moment, for example when combined with other
layer 4 ACLs in order to force the clients to wait a bit for the rate to go
down below the limit. It can also be useful to add this element to logs using
a log-format directive. See also the &quot;<a href="#rate-limit%20sessions">rate-limit sessions</a>&quot; directive for use
in frontends.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># This frontend limits incoming mails to 10/s with a max of 100</span>
<span class="comment"># concurrent connections. We accept any connection below 10/s, and</span>
<span class="comment"># force excess clients to wait for 100 ms. Since clients are limited to</span>
<span class="comment"># 100 max, there cannot be more than 10 incoming mails per second.</span>
frontend mail
    bind :25
    mode tcp
    maxconn 100
    acl too_fast fe_sess_rate ge 10
    tcp-request inspect-delay 100ms
    tcp-request content accept if ! too_fast
    tcp-request content accept if WAIT_END
</code></pre>
</div><a class="anchor" name="nbsrv"></a><a class="anchor" name="7-nbsrv"></a><a class="anchor" name="7.3.2-nbsrv"></a><a class="anchor" name="nbsrv (Using ACLs and fetching samples)"></a><a class="anchor" name="nbsrv (Fetching samples from internal states)"></a><div class="keyword"><b><a class="anchor" name="nbsrv"></a><a href="#7.3.2-nbsrv">nbsrv</a></b>(<span style="color: #008">[<span style="color: #080">&lt;backend&gt;</span>]</span>) : integer</div><pre class="text">Returns an integer value corresponding to the number of usable servers of
either the current backend or the named backend. This is mostly used with
ACLs but can also be useful when added to logs. This is normally used to
switch to an alternate backend when the number of servers is too low to
to handle some load. It is useful to report a failure when combined with
&quot;<a href="#monitor%20fail">monitor fail</a>&quot;.
</pre><a class="anchor" name="queue"></a><a class="anchor" name="7-queue"></a><a class="anchor" name="7.3.2-queue"></a><a class="anchor" name="queue (Using ACLs and fetching samples)"></a><a class="anchor" name="queue (Fetching samples from internal states)"></a><div class="keyword"><b><a class="anchor" name="queue"></a><a href="#7.3.2-queue">queue</a></b>(<span style="color: #008">[<span style="color: #080">&lt;backend&gt;</span>]</span>) : integer</div><pre class="text">Returns the total number of queued connections of the designated backend,
including all the connections in server queues. If no backend name is
specified, the current one is used, but it is also possible to check another
one. This is useful with ACLs or to pass statistics to backend servers. This
can be used to take actions when queuing goes above a known level, generally
indicating a surge of traffic or a massive slowdown on the servers. One
possible action could be to reject new users but still accept old ones. See
also the &quot;<a href="#avg_queue">avg_queue</a>&quot;, &quot;<a href="#be_conn">be_conn</a>&quot;, and &quot;<a href="#be_sess_rate">be_sess_rate</a>&quot; fetches.
</pre><a class="anchor" name="rand"></a><a class="anchor" name="7-rand"></a><a class="anchor" name="7.3.2-rand"></a><a class="anchor" name="rand (Using ACLs and fetching samples)"></a><a class="anchor" name="rand (Fetching samples from internal states)"></a><div class="keyword"><b><a class="anchor" name="rand"></a><a href="#7.3.2-rand">rand</a></b>(<span style="color: #008">[<span style="color: #080">&lt;range&gt;</span>]</span>) : integer</div><pre class="text">Returns a random integer value within a range of &lt;range&gt; possible values,
starting at zero. If the range is not specified, it defaults to 2^32, which
gives numbers between 0 and 4294967295. It can be useful to pass some values
needed to take some routing decisions for example, or just for debugging
purposes. This random must not be used for security purposes.
</pre><a class="anchor" name="srv_conn"></a><a class="anchor" name="7-srv_conn"></a><a class="anchor" name="7.3.2-srv_conn"></a><a class="anchor" name="srv_conn (Using ACLs and fetching samples)"></a><a class="anchor" name="srv_conn (Fetching samples from internal states)"></a><div class="keyword"><b><a class="anchor" name="srv_conn"></a><a href="#7.3.2-srv_conn">srv_conn</a></b>(<span style="color: #008">[<span style="color: #080">&lt;backend&gt;</span>/]</span><span style="color: #080">&lt;server&gt;</span>) : integer</div><pre class="text">Returns an integer value corresponding to the number of currently established
connections on the designated server, possibly including the connection being
evaluated. If &lt;backend&gt; is omitted, then the server is looked up in the
current backend. It can be used to use a specific farm when one server is
full, or to inform the server about our view of the number of active
connections with it. See also the &quot;<a href="#fe_conn">fe_conn</a>&quot;, &quot;<a href="#be_conn">be_conn</a>&quot; and &quot;<a href="#queue">queue</a>&quot; fetch
methods.
</pre><a class="anchor" name="srv_is_up"></a><a class="anchor" name="7-srv_is_up"></a><a class="anchor" name="7.3.2-srv_is_up"></a><a class="anchor" name="srv_is_up (Using ACLs and fetching samples)"></a><a class="anchor" name="srv_is_up (Fetching samples from internal states)"></a><div class="keyword"><b><a class="anchor" name="srv_is_up"></a><a href="#7.3.2-srv_is_up">srv_is_up</a></b>(<span style="color: #008">[<span style="color: #080">&lt;backend&gt;</span>/]</span><span style="color: #080">&lt;server&gt;</span>) : boolean</div><pre class="text">Returns true when the designated server is UP, and false when it is either
DOWN or in maintenance mode. If &lt;backend&gt; is omitted, then the server is
looked up in the current backend. It is mainly used to take action based on
an external status reported via a health check (eg: a geographical site's
availability). Another possible use which is more of a hack consists in
using dummy servers as boolean variables that can be enabled or disabled from
the CLI, so that rules depending on those ACLs can be tweaked in realtime.
</pre><a class="anchor" name="srv_sess_rate"></a><a class="anchor" name="7-srv_sess_rate"></a><a class="anchor" name="7.3.2-srv_sess_rate"></a><a class="anchor" name="srv_sess_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="srv_sess_rate (Fetching samples from internal states)"></a><div class="keyword"><b><a class="anchor" name="srv_sess_rate"></a><a href="#7.3.2-srv_sess_rate">srv_sess_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;backend&gt;</span>/]</span><span style="color: #080">&lt;server&gt;</span>) : integer</div><pre class="text">Returns an integer corresponding to the sessions creation rate on the
designated server, in number of new sessions per second. If &lt;backend&gt; is
omitted, then the server is looked up in the current backend. This is mostly
used with ACLs but can make sense with logs too. This is used to switch to an
alternate backend when an expensive or fragile one reaches too high a session
rate, or to limit abuse of service (eg. prevent latent requests from
overloading servers).
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># Redirect to a separate back</span>
acl srv1_full srv_sess_rate(be1/srv1) gt 50
acl srv2_full srv_sess_rate(be1/srv2) gt 50
use_backend be2 if srv1_full or srv2_full
</code></pre>
</div><a class="anchor" name="table_avl"></a><a class="anchor" name="7-table_avl"></a><a class="anchor" name="7.3.2-table_avl"></a><a class="anchor" name="table_avl (Using ACLs and fetching samples)"></a><a class="anchor" name="table_avl (Fetching samples from internal states)"></a><div class="keyword"><b><a class="anchor" name="table_avl"></a><a href="#7.3.2-table_avl">table_avl</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the total number of available entries in the current proxy's
stick-table or in the designated stick-table. See also table_cnt.
</pre><a class="anchor" name="table_cnt"></a><a class="anchor" name="7-table_cnt"></a><a class="anchor" name="7.3.2-table_cnt"></a><a class="anchor" name="table_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="table_cnt (Fetching samples from internal states)"></a><div class="keyword"><b><a class="anchor" name="table_cnt"></a><a href="#7.3.2-table_cnt">table_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the total number of entries currently in use in the current proxy's
stick-table or in the designated stick-table. See also src_conn_cnt and
table_avl for other entry counting methods.
</pre></div>
<a class="anchor" id="7.3.3" name="7.3.3"></a>
<h3 id="chapter-7.3.3" data-target="7.3.3"><small><a class="small" href="#7.3.3">7.3.3.</a></small> Fetching samples at Layer 4</h3>
<div><pre class="text">The layer 4 usually describes just the transport layer which in haproxy is
closest to the connection, where no content is yet made available. The fetch
methods described here are usable as low as the &quot;<a href="#tcp-request%20connection">tcp-request connection</a>&quot; rule
sets unless they require some future information. Those generally include
TCP/IP addresses and ports, as well as elements from stick-tables related to
the incoming connection. For retrieving a value from a sticky counters, the
counter number can be explicitly set as 0, 1, or 2 using the pre-defined
&quot;sc0_&quot;, &quot;sc1_&quot;, or &quot;sc2_&quot; prefix, or it can be specified as the first integer
argument when using the &quot;sc_&quot; prefix. An optional table may be specified with
the &quot;sc*&quot; form, in which case the currently tracked key will be looked up into
this alternate table instead of the table currently being tracked.
</pre><a class="anchor" name="be_id"></a><a class="anchor" name="7-be_id"></a><a class="anchor" name="7.3.3-be_id"></a><a class="anchor" name="be_id (Using ACLs and fetching samples)"></a><a class="anchor" name="be_id (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="be_id"></a><a href="#7.3.3-be_id">be_id</a></b> : integer</div><pre class="text">Returns an integer containing the current backend's id. It can be used in
frontends with responses to check which backend processed the request.
</pre><a class="anchor" name="dst"></a><a class="anchor" name="7-dst"></a><a class="anchor" name="7.3.3-dst"></a><a class="anchor" name="dst (Using ACLs and fetching samples)"></a><a class="anchor" name="dst (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="dst"></a><a href="#7.3.3-dst">dst</a></b> : ip</div><pre class="text">This is the destination IPv4 address of the connection on the client side,
which is the address the client connected to. It can be useful when running
in transparent mode. It is of type IP and works on both IPv4 and IPv6 tables.
On IPv6 tables, IPv4 address is mapped to its IPv6 equivalent, according to
RFC 4291.
</pre><a class="anchor" name="dst_conn"></a><a class="anchor" name="7-dst_conn"></a><a class="anchor" name="7.3.3-dst_conn"></a><a class="anchor" name="dst_conn (Using ACLs and fetching samples)"></a><a class="anchor" name="dst_conn (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="dst_conn"></a><a href="#7.3.3-dst_conn">dst_conn</a></b> : integer</div><pre class="text">Returns an integer value corresponding to the number of currently established
connections on the same socket including the one being evaluated. It is
normally used with ACLs but can as well be used to pass the information to
servers in an HTTP header or in logs. It can be used to either return a sorry
page before hard-blocking, or to use a specific backend to drain new requests
when the socket is considered saturated. This offers the ability to assign
different limits to different listening ports or addresses. See also the
&quot;<a href="#fe_conn">fe_conn</a>&quot; and &quot;<a href="#be_conn">be_conn</a>&quot; fetches.
</pre><a class="anchor" name="dst_port"></a><a class="anchor" name="7-dst_port"></a><a class="anchor" name="7.3.3-dst_port"></a><a class="anchor" name="dst_port (Using ACLs and fetching samples)"></a><a class="anchor" name="dst_port (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="dst_port"></a><a href="#7.3.3-dst_port">dst_port</a></b> : integer</div><pre class="text">Returns an integer value corresponding to the destination TCP port of the
connection on the client side, which is the port the client connected to.
This might be used when running in transparent mode, when assigning dynamic
ports to some clients for a whole application session, to stick all users to
a same server, or to pass the destination port information to a server using
an HTTP header.
</pre><a class="anchor" name="fe_id"></a><a class="anchor" name="7-fe_id"></a><a class="anchor" name="7.3.3-fe_id"></a><a class="anchor" name="fe_id (Using ACLs and fetching samples)"></a><a class="anchor" name="fe_id (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="fe_id"></a><a href="#7.3.3-fe_id">fe_id</a></b> : integer</div><pre class="text">Returns an integer containing the current frontend's id. It can be used in
backends to check from which backend it was called, or to stick all users
coming via a same frontend to the same server.
</pre><a class="anchor" name="sc_bytes_in_rate"></a><a class="anchor" name="7-sc_bytes_in_rate"></a><a class="anchor" name="7.3.3-sc_bytes_in_rate"></a><a class="anchor" name="sc_bytes_in_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc_bytes_in_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc_bytes_in_rate"></a><a href="#7.3.3-sc_bytes_in_rate">sc_bytes_in_rate</a></b>(<span style="color: #080">&lt;ctr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc0_bytes_in_rate"></a><a class="anchor" name="7-sc0_bytes_in_rate"></a><a class="anchor" name="7.3.3-sc0_bytes_in_rate"></a><a class="anchor" name="sc0_bytes_in_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc0_bytes_in_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc0_bytes_in_rate"></a><a href="#7.3.3-sc0_bytes_in_rate">sc0_bytes_in_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc1_bytes_in_rate"></a><a class="anchor" name="7-sc1_bytes_in_rate"></a><a class="anchor" name="7.3.3-sc1_bytes_in_rate"></a><a class="anchor" name="sc1_bytes_in_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc1_bytes_in_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc1_bytes_in_rate"></a><a href="#7.3.3-sc1_bytes_in_rate">sc1_bytes_in_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc2_bytes_in_rate"></a><a class="anchor" name="7-sc2_bytes_in_rate"></a><a class="anchor" name="7.3.3-sc2_bytes_in_rate"></a><a class="anchor" name="sc2_bytes_in_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc2_bytes_in_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc2_bytes_in_rate"></a><a href="#7.3.3-sc2_bytes_in_rate">sc2_bytes_in_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the average client-to-server bytes rate from the currently tracked
counters, measured in amount of bytes over the period configured in the
table. See also src_bytes_in_rate.
</pre><a class="anchor" name="sc_bytes_out_rate"></a><a class="anchor" name="7-sc_bytes_out_rate"></a><a class="anchor" name="7.3.3-sc_bytes_out_rate"></a><a class="anchor" name="sc_bytes_out_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc_bytes_out_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc_bytes_out_rate"></a><a href="#7.3.3-sc_bytes_out_rate">sc_bytes_out_rate</a></b>(<span style="color: #080">&lt;ctr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc0_bytes_out_rate"></a><a class="anchor" name="7-sc0_bytes_out_rate"></a><a class="anchor" name="7.3.3-sc0_bytes_out_rate"></a><a class="anchor" name="sc0_bytes_out_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc0_bytes_out_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc0_bytes_out_rate"></a><a href="#7.3.3-sc0_bytes_out_rate">sc0_bytes_out_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc1_bytes_out_rate"></a><a class="anchor" name="7-sc1_bytes_out_rate"></a><a class="anchor" name="7.3.3-sc1_bytes_out_rate"></a><a class="anchor" name="sc1_bytes_out_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc1_bytes_out_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc1_bytes_out_rate"></a><a href="#7.3.3-sc1_bytes_out_rate">sc1_bytes_out_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc2_bytes_out_rate"></a><a class="anchor" name="7-sc2_bytes_out_rate"></a><a class="anchor" name="7.3.3-sc2_bytes_out_rate"></a><a class="anchor" name="sc2_bytes_out_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc2_bytes_out_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc2_bytes_out_rate"></a><a href="#7.3.3-sc2_bytes_out_rate">sc2_bytes_out_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the average server-to-client bytes rate from the currently tracked
counters, measured in amount of bytes over the period configured in the
table. See also src_bytes_out_rate.
</pre><a class="anchor" name="sc_clr_gpc0"></a><a class="anchor" name="7-sc_clr_gpc0"></a><a class="anchor" name="7.3.3-sc_clr_gpc0"></a><a class="anchor" name="sc_clr_gpc0 (Using ACLs and fetching samples)"></a><a class="anchor" name="sc_clr_gpc0 (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc_clr_gpc0"></a><a href="#7.3.3-sc_clr_gpc0">sc_clr_gpc0</a></b>(<span style="color: #080">&lt;ctr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc0_clr_gpc0"></a><a class="anchor" name="7-sc0_clr_gpc0"></a><a class="anchor" name="7.3.3-sc0_clr_gpc0"></a><a class="anchor" name="sc0_clr_gpc0 (Using ACLs and fetching samples)"></a><a class="anchor" name="sc0_clr_gpc0 (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc0_clr_gpc0"></a><a href="#7.3.3-sc0_clr_gpc0">sc0_clr_gpc0</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc1_clr_gpc0"></a><a class="anchor" name="7-sc1_clr_gpc0"></a><a class="anchor" name="7.3.3-sc1_clr_gpc0"></a><a class="anchor" name="sc1_clr_gpc0 (Using ACLs and fetching samples)"></a><a class="anchor" name="sc1_clr_gpc0 (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc1_clr_gpc0"></a><a href="#7.3.3-sc1_clr_gpc0">sc1_clr_gpc0</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc2_clr_gpc0"></a><a class="anchor" name="7-sc2_clr_gpc0"></a><a class="anchor" name="7.3.3-sc2_clr_gpc0"></a><a class="anchor" name="sc2_clr_gpc0 (Using ACLs and fetching samples)"></a><a class="anchor" name="sc2_clr_gpc0 (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc2_clr_gpc0"></a><a href="#7.3.3-sc2_clr_gpc0">sc2_clr_gpc0</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Clears the first General Purpose Counter associated to the currently tracked
counters, and returns its previous value. Before the first invocation, the
stored value is zero, so first invocation will always return zero. This is
typically used as a second ACL in an expression in order to mark a connection
when a first ACL was verified :

      # block if 5 consecutive requests continue to come faster than 10 sess
      # per second, and reset the counter as soon as the traffic slows down.
      acl abuse sc0_http_req_rate gt 10
      acl kill  sc0_inc_gpc0 gt 5
      acl save  sc0_clr_gpc0 ge 0
      tcp-request connection accept if !abuse save
      tcp-request connection reject if abuse kill
</pre><a class="anchor" name="sc_conn_cnt"></a><a class="anchor" name="7-sc_conn_cnt"></a><a class="anchor" name="7.3.3-sc_conn_cnt"></a><a class="anchor" name="sc_conn_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="sc_conn_cnt (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc_conn_cnt"></a><a href="#7.3.3-sc_conn_cnt">sc_conn_cnt</a></b>(<span style="color: #080">&lt;ctr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc0_conn_cnt"></a><a class="anchor" name="7-sc0_conn_cnt"></a><a class="anchor" name="7.3.3-sc0_conn_cnt"></a><a class="anchor" name="sc0_conn_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="sc0_conn_cnt (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc0_conn_cnt"></a><a href="#7.3.3-sc0_conn_cnt">sc0_conn_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc1_conn_cnt"></a><a class="anchor" name="7-sc1_conn_cnt"></a><a class="anchor" name="7.3.3-sc1_conn_cnt"></a><a class="anchor" name="sc1_conn_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="sc1_conn_cnt (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc1_conn_cnt"></a><a href="#7.3.3-sc1_conn_cnt">sc1_conn_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc2_conn_cnt"></a><a class="anchor" name="7-sc2_conn_cnt"></a><a class="anchor" name="7.3.3-sc2_conn_cnt"></a><a class="anchor" name="sc2_conn_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="sc2_conn_cnt (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc2_conn_cnt"></a><a href="#7.3.3-sc2_conn_cnt">sc2_conn_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the cumulated number of incoming connections from currently tracked
counters. See also src_conn_cnt.
</pre><a class="anchor" name="sc_conn_cur"></a><a class="anchor" name="7-sc_conn_cur"></a><a class="anchor" name="7.3.3-sc_conn_cur"></a><a class="anchor" name="sc_conn_cur (Using ACLs and fetching samples)"></a><a class="anchor" name="sc_conn_cur (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc_conn_cur"></a><a href="#7.3.3-sc_conn_cur">sc_conn_cur</a></b>(<span style="color: #080">&lt;ctr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc0_conn_cur"></a><a class="anchor" name="7-sc0_conn_cur"></a><a class="anchor" name="7.3.3-sc0_conn_cur"></a><a class="anchor" name="sc0_conn_cur (Using ACLs and fetching samples)"></a><a class="anchor" name="sc0_conn_cur (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc0_conn_cur"></a><a href="#7.3.3-sc0_conn_cur">sc0_conn_cur</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc1_conn_cur"></a><a class="anchor" name="7-sc1_conn_cur"></a><a class="anchor" name="7.3.3-sc1_conn_cur"></a><a class="anchor" name="sc1_conn_cur (Using ACLs and fetching samples)"></a><a class="anchor" name="sc1_conn_cur (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc1_conn_cur"></a><a href="#7.3.3-sc1_conn_cur">sc1_conn_cur</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc2_conn_cur"></a><a class="anchor" name="7-sc2_conn_cur"></a><a class="anchor" name="7.3.3-sc2_conn_cur"></a><a class="anchor" name="sc2_conn_cur (Using ACLs and fetching samples)"></a><a class="anchor" name="sc2_conn_cur (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc2_conn_cur"></a><a href="#7.3.3-sc2_conn_cur">sc2_conn_cur</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the current amount of concurrent connections tracking the same
tracked counters. This number is automatically incremented when tracking
begins and decremented when tracking stops. See also src_conn_cur.
</pre><a class="anchor" name="sc_conn_rate"></a><a class="anchor" name="7-sc_conn_rate"></a><a class="anchor" name="7.3.3-sc_conn_rate"></a><a class="anchor" name="sc_conn_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc_conn_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc_conn_rate"></a><a href="#7.3.3-sc_conn_rate">sc_conn_rate</a></b>(<span style="color: #080">&lt;ctr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc0_conn_rate"></a><a class="anchor" name="7-sc0_conn_rate"></a><a class="anchor" name="7.3.3-sc0_conn_rate"></a><a class="anchor" name="sc0_conn_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc0_conn_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc0_conn_rate"></a><a href="#7.3.3-sc0_conn_rate">sc0_conn_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc1_conn_rate"></a><a class="anchor" name="7-sc1_conn_rate"></a><a class="anchor" name="7.3.3-sc1_conn_rate"></a><a class="anchor" name="sc1_conn_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc1_conn_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc1_conn_rate"></a><a href="#7.3.3-sc1_conn_rate">sc1_conn_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc2_conn_rate"></a><a class="anchor" name="7-sc2_conn_rate"></a><a class="anchor" name="7.3.3-sc2_conn_rate"></a><a class="anchor" name="sc2_conn_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc2_conn_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc2_conn_rate"></a><a href="#7.3.3-sc2_conn_rate">sc2_conn_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the average connection rate from the currently tracked counters,
measured in amount of connections over the period configured in the table.
See also src_conn_rate.
</pre><a class="anchor" name="sc_get_gpc0"></a><a class="anchor" name="7-sc_get_gpc0"></a><a class="anchor" name="7.3.3-sc_get_gpc0"></a><a class="anchor" name="sc_get_gpc0 (Using ACLs and fetching samples)"></a><a class="anchor" name="sc_get_gpc0 (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc_get_gpc0"></a><a href="#7.3.3-sc_get_gpc0">sc_get_gpc0</a></b>(<span style="color: #080">&lt;ctr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc0_get_gpc0"></a><a class="anchor" name="7-sc0_get_gpc0"></a><a class="anchor" name="7.3.3-sc0_get_gpc0"></a><a class="anchor" name="sc0_get_gpc0 (Using ACLs and fetching samples)"></a><a class="anchor" name="sc0_get_gpc0 (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc0_get_gpc0"></a><a href="#7.3.3-sc0_get_gpc0">sc0_get_gpc0</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc1_get_gpc0"></a><a class="anchor" name="7-sc1_get_gpc0"></a><a class="anchor" name="7.3.3-sc1_get_gpc0"></a><a class="anchor" name="sc1_get_gpc0 (Using ACLs and fetching samples)"></a><a class="anchor" name="sc1_get_gpc0 (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc1_get_gpc0"></a><a href="#7.3.3-sc1_get_gpc0">sc1_get_gpc0</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc2_get_gpc0"></a><a class="anchor" name="7-sc2_get_gpc0"></a><a class="anchor" name="7.3.3-sc2_get_gpc0"></a><a class="anchor" name="sc2_get_gpc0 (Using ACLs and fetching samples)"></a><a class="anchor" name="sc2_get_gpc0 (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc2_get_gpc0"></a><a href="#7.3.3-sc2_get_gpc0">sc2_get_gpc0</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the value of the first General Purpose Counter associated to the
currently tracked counters. See also src_get_gpc0 and sc/sc0/sc1/sc2_inc_gpc0.
</pre><a class="anchor" name="sc_gpc0_rate"></a><a class="anchor" name="7-sc_gpc0_rate"></a><a class="anchor" name="7.3.3-sc_gpc0_rate"></a><a class="anchor" name="sc_gpc0_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc_gpc0_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc_gpc0_rate"></a><a href="#7.3.3-sc_gpc0_rate">sc_gpc0_rate</a></b>(<span style="color: #080">&lt;ctr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc0_gpc0_rate"></a><a class="anchor" name="7-sc0_gpc0_rate"></a><a class="anchor" name="7.3.3-sc0_gpc0_rate"></a><a class="anchor" name="sc0_gpc0_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc0_gpc0_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc0_gpc0_rate"></a><a href="#7.3.3-sc0_gpc0_rate">sc0_gpc0_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc1_gpc0_rate"></a><a class="anchor" name="7-sc1_gpc0_rate"></a><a class="anchor" name="7.3.3-sc1_gpc0_rate"></a><a class="anchor" name="sc1_gpc0_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc1_gpc0_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc1_gpc0_rate"></a><a href="#7.3.3-sc1_gpc0_rate">sc1_gpc0_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc2_gpc0_rate"></a><a class="anchor" name="7-sc2_gpc0_rate"></a><a class="anchor" name="7.3.3-sc2_gpc0_rate"></a><a class="anchor" name="sc2_gpc0_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc2_gpc0_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc2_gpc0_rate"></a><a href="#7.3.3-sc2_gpc0_rate">sc2_gpc0_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the average increment rate of the first General Purpose Counter
associated to the currently tracked counters. It reports the frequency
which the gpc0 counter was incremented over the configured period. See also
src_gpc0_rate, sc/sc0/sc1/sc2_get_gpc0, and sc/sc0/sc1/sc2_inc_gpc0. Note
that the &quot;gpc0_rate&quot; counter must be stored in the stick-table for a value to
be returned, as &quot;gpc0&quot; only holds the event count.
</pre><a class="anchor" name="sc_http_err_cnt"></a><a class="anchor" name="7-sc_http_err_cnt"></a><a class="anchor" name="7.3.3-sc_http_err_cnt"></a><a class="anchor" name="sc_http_err_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="sc_http_err_cnt (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc_http_err_cnt"></a><a href="#7.3.3-sc_http_err_cnt">sc_http_err_cnt</a></b>(<span style="color: #080">&lt;ctr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc0_http_err_cnt"></a><a class="anchor" name="7-sc0_http_err_cnt"></a><a class="anchor" name="7.3.3-sc0_http_err_cnt"></a><a class="anchor" name="sc0_http_err_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="sc0_http_err_cnt (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc0_http_err_cnt"></a><a href="#7.3.3-sc0_http_err_cnt">sc0_http_err_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc1_http_err_cnt"></a><a class="anchor" name="7-sc1_http_err_cnt"></a><a class="anchor" name="7.3.3-sc1_http_err_cnt"></a><a class="anchor" name="sc1_http_err_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="sc1_http_err_cnt (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc1_http_err_cnt"></a><a href="#7.3.3-sc1_http_err_cnt">sc1_http_err_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc2_http_err_cnt"></a><a class="anchor" name="7-sc2_http_err_cnt"></a><a class="anchor" name="7.3.3-sc2_http_err_cnt"></a><a class="anchor" name="sc2_http_err_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="sc2_http_err_cnt (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc2_http_err_cnt"></a><a href="#7.3.3-sc2_http_err_cnt">sc2_http_err_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the cumulated number of HTTP errors from the currently tracked
counters. This includes the both request errors and 4xx error responses.
See also src_http_err_cnt.
</pre><a class="anchor" name="sc_http_err_rate"></a><a class="anchor" name="7-sc_http_err_rate"></a><a class="anchor" name="7.3.3-sc_http_err_rate"></a><a class="anchor" name="sc_http_err_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc_http_err_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc_http_err_rate"></a><a href="#7.3.3-sc_http_err_rate">sc_http_err_rate</a></b>(<span style="color: #080">&lt;ctr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc0_http_err_rate"></a><a class="anchor" name="7-sc0_http_err_rate"></a><a class="anchor" name="7.3.3-sc0_http_err_rate"></a><a class="anchor" name="sc0_http_err_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc0_http_err_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc0_http_err_rate"></a><a href="#7.3.3-sc0_http_err_rate">sc0_http_err_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc1_http_err_rate"></a><a class="anchor" name="7-sc1_http_err_rate"></a><a class="anchor" name="7.3.3-sc1_http_err_rate"></a><a class="anchor" name="sc1_http_err_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc1_http_err_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc1_http_err_rate"></a><a href="#7.3.3-sc1_http_err_rate">sc1_http_err_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc2_http_err_rate"></a><a class="anchor" name="7-sc2_http_err_rate"></a><a class="anchor" name="7.3.3-sc2_http_err_rate"></a><a class="anchor" name="sc2_http_err_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc2_http_err_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc2_http_err_rate"></a><a href="#7.3.3-sc2_http_err_rate">sc2_http_err_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the average rate of HTTP errors from the currently tracked counters,
measured in amount of errors over the period configured in the table. This
includes the both request errors and 4xx error responses. See also
src_http_err_rate.
</pre><a class="anchor" name="sc_http_req_cnt"></a><a class="anchor" name="7-sc_http_req_cnt"></a><a class="anchor" name="7.3.3-sc_http_req_cnt"></a><a class="anchor" name="sc_http_req_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="sc_http_req_cnt (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc_http_req_cnt"></a><a href="#7.3.3-sc_http_req_cnt">sc_http_req_cnt</a></b>(<span style="color: #080">&lt;ctr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc0_http_req_cnt"></a><a class="anchor" name="7-sc0_http_req_cnt"></a><a class="anchor" name="7.3.3-sc0_http_req_cnt"></a><a class="anchor" name="sc0_http_req_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="sc0_http_req_cnt (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc0_http_req_cnt"></a><a href="#7.3.3-sc0_http_req_cnt">sc0_http_req_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc1_http_req_cnt"></a><a class="anchor" name="7-sc1_http_req_cnt"></a><a class="anchor" name="7.3.3-sc1_http_req_cnt"></a><a class="anchor" name="sc1_http_req_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="sc1_http_req_cnt (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc1_http_req_cnt"></a><a href="#7.3.3-sc1_http_req_cnt">sc1_http_req_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc2_http_req_cnt"></a><a class="anchor" name="7-sc2_http_req_cnt"></a><a class="anchor" name="7.3.3-sc2_http_req_cnt"></a><a class="anchor" name="sc2_http_req_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="sc2_http_req_cnt (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc2_http_req_cnt"></a><a href="#7.3.3-sc2_http_req_cnt">sc2_http_req_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the cumulated number of HTTP requests from the currently tracked
counters. This includes every started request, valid or not. See also
src_http_req_cnt.
</pre><a class="anchor" name="sc_http_req_rate"></a><a class="anchor" name="7-sc_http_req_rate"></a><a class="anchor" name="7.3.3-sc_http_req_rate"></a><a class="anchor" name="sc_http_req_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc_http_req_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc_http_req_rate"></a><a href="#7.3.3-sc_http_req_rate">sc_http_req_rate</a></b>(<span style="color: #080">&lt;ctr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc0_http_req_rate"></a><a class="anchor" name="7-sc0_http_req_rate"></a><a class="anchor" name="7.3.3-sc0_http_req_rate"></a><a class="anchor" name="sc0_http_req_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc0_http_req_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc0_http_req_rate"></a><a href="#7.3.3-sc0_http_req_rate">sc0_http_req_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc1_http_req_rate"></a><a class="anchor" name="7-sc1_http_req_rate"></a><a class="anchor" name="7.3.3-sc1_http_req_rate"></a><a class="anchor" name="sc1_http_req_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc1_http_req_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc1_http_req_rate"></a><a href="#7.3.3-sc1_http_req_rate">sc1_http_req_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc2_http_req_rate"></a><a class="anchor" name="7-sc2_http_req_rate"></a><a class="anchor" name="7.3.3-sc2_http_req_rate"></a><a class="anchor" name="sc2_http_req_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc2_http_req_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc2_http_req_rate"></a><a href="#7.3.3-sc2_http_req_rate">sc2_http_req_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the average rate of HTTP requests from the currently tracked
counters, measured in amount of requests over the period configured in
the table. This includes every started request, valid or not. See also
src_http_req_rate.
</pre><a class="anchor" name="sc_inc_gpc0"></a><a class="anchor" name="7-sc_inc_gpc0"></a><a class="anchor" name="7.3.3-sc_inc_gpc0"></a><a class="anchor" name="sc_inc_gpc0 (Using ACLs and fetching samples)"></a><a class="anchor" name="sc_inc_gpc0 (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc_inc_gpc0"></a><a href="#7.3.3-sc_inc_gpc0">sc_inc_gpc0</a></b>(<span style="color: #080">&lt;ctr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc0_inc_gpc0"></a><a class="anchor" name="7-sc0_inc_gpc0"></a><a class="anchor" name="7.3.3-sc0_inc_gpc0"></a><a class="anchor" name="sc0_inc_gpc0 (Using ACLs and fetching samples)"></a><a class="anchor" name="sc0_inc_gpc0 (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc0_inc_gpc0"></a><a href="#7.3.3-sc0_inc_gpc0">sc0_inc_gpc0</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc1_inc_gpc0"></a><a class="anchor" name="7-sc1_inc_gpc0"></a><a class="anchor" name="7.3.3-sc1_inc_gpc0"></a><a class="anchor" name="sc1_inc_gpc0 (Using ACLs and fetching samples)"></a><a class="anchor" name="sc1_inc_gpc0 (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc1_inc_gpc0"></a><a href="#7.3.3-sc1_inc_gpc0">sc1_inc_gpc0</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc2_inc_gpc0"></a><a class="anchor" name="7-sc2_inc_gpc0"></a><a class="anchor" name="7.3.3-sc2_inc_gpc0"></a><a class="anchor" name="sc2_inc_gpc0 (Using ACLs and fetching samples)"></a><a class="anchor" name="sc2_inc_gpc0 (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc2_inc_gpc0"></a><a href="#7.3.3-sc2_inc_gpc0">sc2_inc_gpc0</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Increments the first General Purpose Counter associated to the currently
tracked counters, and returns its new value. Before the first invocation,
the stored value is zero, so first invocation will increase it to 1 and will
return 1. This is typically used as a second ACL in an expression in order
to mark a connection when a first ACL was verified :

      acl abuse sc0_http_req_rate gt 10
      acl kill  sc0_inc_gpc0 gt 0
      tcp-request connection reject if abuse kill
</pre><a class="anchor" name="sc_kbytes_in"></a><a class="anchor" name="7-sc_kbytes_in"></a><a class="anchor" name="7.3.3-sc_kbytes_in"></a><a class="anchor" name="sc_kbytes_in (Using ACLs and fetching samples)"></a><a class="anchor" name="sc_kbytes_in (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc_kbytes_in"></a><a href="#7.3.3-sc_kbytes_in">sc_kbytes_in</a></b>(<span style="color: #080">&lt;ctr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc0_kbytes_in"></a><a class="anchor" name="7-sc0_kbytes_in"></a><a class="anchor" name="7.3.3-sc0_kbytes_in"></a><a class="anchor" name="sc0_kbytes_in (Using ACLs and fetching samples)"></a><a class="anchor" name="sc0_kbytes_in (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc0_kbytes_in"></a><a href="#7.3.3-sc0_kbytes_in">sc0_kbytes_in</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc1_kbytes_in"></a><a class="anchor" name="7-sc1_kbytes_in"></a><a class="anchor" name="7.3.3-sc1_kbytes_in"></a><a class="anchor" name="sc1_kbytes_in (Using ACLs and fetching samples)"></a><a class="anchor" name="sc1_kbytes_in (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc1_kbytes_in"></a><a href="#7.3.3-sc1_kbytes_in">sc1_kbytes_in</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc2_kbytes_in"></a><a class="anchor" name="7-sc2_kbytes_in"></a><a class="anchor" name="7.3.3-sc2_kbytes_in"></a><a class="anchor" name="sc2_kbytes_in (Using ACLs and fetching samples)"></a><a class="anchor" name="sc2_kbytes_in (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc2_kbytes_in"></a><a href="#7.3.3-sc2_kbytes_in">sc2_kbytes_in</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the amount of client-to-server data from the currently tracked
counters, measured in kilobytes over the period configured in the table. The
test is currently performed on 32-bit integers, which limits values to 4
terabytes. See also src_kbytes_in.
</pre><a class="anchor" name="sc_kbytes_out"></a><a class="anchor" name="7-sc_kbytes_out"></a><a class="anchor" name="7.3.3-sc_kbytes_out"></a><a class="anchor" name="sc_kbytes_out (Using ACLs and fetching samples)"></a><a class="anchor" name="sc_kbytes_out (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc_kbytes_out"></a><a href="#7.3.3-sc_kbytes_out">sc_kbytes_out</a></b>(<span style="color: #080">&lt;ctr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc0_kbytes_out"></a><a class="anchor" name="7-sc0_kbytes_out"></a><a class="anchor" name="7.3.3-sc0_kbytes_out"></a><a class="anchor" name="sc0_kbytes_out (Using ACLs and fetching samples)"></a><a class="anchor" name="sc0_kbytes_out (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc0_kbytes_out"></a><a href="#7.3.3-sc0_kbytes_out">sc0_kbytes_out</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc1_kbytes_out"></a><a class="anchor" name="7-sc1_kbytes_out"></a><a class="anchor" name="7.3.3-sc1_kbytes_out"></a><a class="anchor" name="sc1_kbytes_out (Using ACLs and fetching samples)"></a><a class="anchor" name="sc1_kbytes_out (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc1_kbytes_out"></a><a href="#7.3.3-sc1_kbytes_out">sc1_kbytes_out</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc2_kbytes_out"></a><a class="anchor" name="7-sc2_kbytes_out"></a><a class="anchor" name="7.3.3-sc2_kbytes_out"></a><a class="anchor" name="sc2_kbytes_out (Using ACLs and fetching samples)"></a><a class="anchor" name="sc2_kbytes_out (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc2_kbytes_out"></a><a href="#7.3.3-sc2_kbytes_out">sc2_kbytes_out</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the amount of server-to-client data from the currently tracked
counters, measured in kilobytes over the period configured in the table. The
test is currently performed on 32-bit integers, which limits values to 4
terabytes. See also src_kbytes_out.
</pre><a class="anchor" name="sc_sess_cnt"></a><a class="anchor" name="7-sc_sess_cnt"></a><a class="anchor" name="7.3.3-sc_sess_cnt"></a><a class="anchor" name="sc_sess_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="sc_sess_cnt (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc_sess_cnt"></a><a href="#7.3.3-sc_sess_cnt">sc_sess_cnt</a></b>(<span style="color: #080">&lt;ctr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc0_sess_cnt"></a><a class="anchor" name="7-sc0_sess_cnt"></a><a class="anchor" name="7.3.3-sc0_sess_cnt"></a><a class="anchor" name="sc0_sess_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="sc0_sess_cnt (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc0_sess_cnt"></a><a href="#7.3.3-sc0_sess_cnt">sc0_sess_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc1_sess_cnt"></a><a class="anchor" name="7-sc1_sess_cnt"></a><a class="anchor" name="7.3.3-sc1_sess_cnt"></a><a class="anchor" name="sc1_sess_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="sc1_sess_cnt (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc1_sess_cnt"></a><a href="#7.3.3-sc1_sess_cnt">sc1_sess_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc2_sess_cnt"></a><a class="anchor" name="7-sc2_sess_cnt"></a><a class="anchor" name="7.3.3-sc2_sess_cnt"></a><a class="anchor" name="sc2_sess_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="sc2_sess_cnt (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc2_sess_cnt"></a><a href="#7.3.3-sc2_sess_cnt">sc2_sess_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the cumulated number of incoming connections that were transformed
into sessions, which means that they were accepted by a &quot;tcp-request
connection&quot; rule, from the currently tracked counters. A backend may count
more sessions than connections because each connection could result in many
backend sessions if some HTTP keep-alive is performed over the connection
with the client. See also src_sess_cnt.
</pre><a class="anchor" name="sc_sess_rate"></a><a class="anchor" name="7-sc_sess_rate"></a><a class="anchor" name="7.3.3-sc_sess_rate"></a><a class="anchor" name="sc_sess_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc_sess_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc_sess_rate"></a><a href="#7.3.3-sc_sess_rate">sc_sess_rate</a></b>(<span style="color: #080">&lt;ctr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc0_sess_rate"></a><a class="anchor" name="7-sc0_sess_rate"></a><a class="anchor" name="7.3.3-sc0_sess_rate"></a><a class="anchor" name="sc0_sess_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc0_sess_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc0_sess_rate"></a><a href="#7.3.3-sc0_sess_rate">sc0_sess_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc1_sess_rate"></a><a class="anchor" name="7-sc1_sess_rate"></a><a class="anchor" name="7.3.3-sc1_sess_rate"></a><a class="anchor" name="sc1_sess_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc1_sess_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc1_sess_rate"></a><a href="#7.3.3-sc1_sess_rate">sc1_sess_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc2_sess_rate"></a><a class="anchor" name="7-sc2_sess_rate"></a><a class="anchor" name="7.3.3-sc2_sess_rate"></a><a class="anchor" name="sc2_sess_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="sc2_sess_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc2_sess_rate"></a><a href="#7.3.3-sc2_sess_rate">sc2_sess_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the average session rate from the currently tracked counters,
measured in amount of sessions over the period configured in the table. A
session is a connection that got past the early &quot;<a href="#tcp-request%20connection">tcp-request connection</a>&quot;
rules. A backend may count more sessions than connections because each
connection could result in many backend sessions if some HTTP keep-alive is
performed over the connection with the client. See also src_sess_rate.
</pre><a class="anchor" name="sc_tracked"></a><a class="anchor" name="7-sc_tracked"></a><a class="anchor" name="7.3.3-sc_tracked"></a><a class="anchor" name="sc_tracked (Using ACLs and fetching samples)"></a><a class="anchor" name="sc_tracked (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc_tracked"></a><a href="#7.3.3-sc_tracked">sc_tracked</a></b>(<span style="color: #080">&lt;ctr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;table&gt;</span>]</span>) : boolean</div><a class="anchor" name="sc0_tracked"></a><a class="anchor" name="7-sc0_tracked"></a><a class="anchor" name="7.3.3-sc0_tracked"></a><a class="anchor" name="sc0_tracked (Using ACLs and fetching samples)"></a><a class="anchor" name="sc0_tracked (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc0_tracked"></a><a href="#7.3.3-sc0_tracked">sc0_tracked</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : boolean</div><a class="anchor" name="sc1_tracked"></a><a class="anchor" name="7-sc1_tracked"></a><a class="anchor" name="7.3.3-sc1_tracked"></a><a class="anchor" name="sc1_tracked (Using ACLs and fetching samples)"></a><a class="anchor" name="sc1_tracked (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc1_tracked"></a><a href="#7.3.3-sc1_tracked">sc1_tracked</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : boolean</div><a class="anchor" name="sc2_tracked"></a><a class="anchor" name="7-sc2_tracked"></a><a class="anchor" name="7.3.3-sc2_tracked"></a><a class="anchor" name="sc2_tracked (Using ACLs and fetching samples)"></a><a class="anchor" name="sc2_tracked (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc2_tracked"></a><a href="#7.3.3-sc2_tracked">sc2_tracked</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : boolean</div><pre class="text">Returns true if the designated session counter is currently being tracked by
the current session. This can be useful when deciding whether or not we want
to set some values in a header passed to the server.
</pre><a class="anchor" name="sc_trackers"></a><a class="anchor" name="7-sc_trackers"></a><a class="anchor" name="7.3.3-sc_trackers"></a><a class="anchor" name="sc_trackers (Using ACLs and fetching samples)"></a><a class="anchor" name="sc_trackers (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc_trackers"></a><a href="#7.3.3-sc_trackers">sc_trackers</a></b>(<span style="color: #080">&lt;ctr&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc0_trackers"></a><a class="anchor" name="7-sc0_trackers"></a><a class="anchor" name="7.3.3-sc0_trackers"></a><a class="anchor" name="sc0_trackers (Using ACLs and fetching samples)"></a><a class="anchor" name="sc0_trackers (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc0_trackers"></a><a href="#7.3.3-sc0_trackers">sc0_trackers</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc1_trackers"></a><a class="anchor" name="7-sc1_trackers"></a><a class="anchor" name="7.3.3-sc1_trackers"></a><a class="anchor" name="sc1_trackers (Using ACLs and fetching samples)"></a><a class="anchor" name="sc1_trackers (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc1_trackers"></a><a href="#7.3.3-sc1_trackers">sc1_trackers</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><a class="anchor" name="sc2_trackers"></a><a class="anchor" name="7-sc2_trackers"></a><a class="anchor" name="7.3.3-sc2_trackers"></a><a class="anchor" name="sc2_trackers (Using ACLs and fetching samples)"></a><a class="anchor" name="sc2_trackers (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="sc2_trackers"></a><a href="#7.3.3-sc2_trackers">sc2_trackers</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the current amount of concurrent connections tracking the same
tracked counters. This number is automatically incremented when tracking
begins and decremented when tracking stops. It differs from sc0_conn_cur in
that it does not rely on any stored information but on the table's reference
count (the &quot;use&quot; value which is returned by &quot;<a href="#show%20table">show table</a>&quot; on the CLI). This
may sometimes be more suited for layer7 tracking. It can be used to tell a
server how many concurrent connections there are from a given address for
example.
</pre><a class="anchor" name="so_id"></a><a class="anchor" name="7-so_id"></a><a class="anchor" name="7.3.3-so_id"></a><a class="anchor" name="so_id (Using ACLs and fetching samples)"></a><a class="anchor" name="so_id (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="so_id"></a><a href="#7.3.3-so_id">so_id</a></b> : integer</div><pre class="text">Returns an integer containing the current listening socket's id. It is useful
in frontends involving many &quot;<a href="#bind">bind</a>&quot; lines, or to stick all users coming via a
same socket to the same server.
</pre><a class="anchor" name="src"></a><a class="anchor" name="7-src"></a><a class="anchor" name="7.3.3-src"></a><a class="anchor" name="src (Using ACLs and fetching samples)"></a><a class="anchor" name="src (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="src"></a><a href="#7.3.3-src">src</a></b> : ip</div><pre class="text">This is the source IPv4 address of the client of the session.  It is of type
IP and works on both IPv4 and IPv6 tables. On IPv6 tables, IPv4 addresses are
mapped to their IPv6 equivalent, according to RFC 4291. Note that it is the
TCP-level source address which is used, and not the address of a client
behind a proxy. However if the &quot;<a href="#accept-proxy">accept-proxy</a>&quot; bind directive is used, it can
be the address of a client behind another PROXY-protocol compatible component
for all rule sets except &quot;<a href="#tcp-request%20connection">tcp-request connection</a>&quot; which sees the real address.
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code><span class="comment"># add an HTTP header in requests with the originating address' country</span>
http-request set-header X-Country %[src,map_ip(geoip.lst)]
</code></pre>
</div><a class="anchor" name="src_bytes_in_rate"></a><a class="anchor" name="7-src_bytes_in_rate"></a><a class="anchor" name="7.3.3-src_bytes_in_rate"></a><a class="anchor" name="src_bytes_in_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="src_bytes_in_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="src_bytes_in_rate"></a><a href="#7.3.3-src_bytes_in_rate">src_bytes_in_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the average bytes rate from the incoming connection's source address
in the current proxy's stick-table or in the designated stick-table, measured
in amount of bytes over the period configured in the table. If the address is
not found, zero is returned. See also sc/sc0/sc1/sc2_bytes_in_rate.
</pre><a class="anchor" name="src_bytes_out_rate"></a><a class="anchor" name="7-src_bytes_out_rate"></a><a class="anchor" name="7.3.3-src_bytes_out_rate"></a><a class="anchor" name="src_bytes_out_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="src_bytes_out_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="src_bytes_out_rate"></a><a href="#7.3.3-src_bytes_out_rate">src_bytes_out_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the average bytes rate to the incoming connection's source address in
the current proxy's stick-table or in the designated stick-table, measured in
amount of bytes over the period configured in the table. If the address is
not found, zero is returned. See also sc/sc0/sc1/sc2_bytes_out_rate.
</pre><a class="anchor" name="src_clr_gpc0"></a><a class="anchor" name="7-src_clr_gpc0"></a><a class="anchor" name="7.3.3-src_clr_gpc0"></a><a class="anchor" name="src_clr_gpc0 (Using ACLs and fetching samples)"></a><a class="anchor" name="src_clr_gpc0 (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="src_clr_gpc0"></a><a href="#7.3.3-src_clr_gpc0">src_clr_gpc0</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Clears the first General Purpose Counter associated to the incoming
connection's source address in the current proxy's stick-table or in the
designated stick-table, and returns its previous value. If the address is not
found, an entry is created and 0 is returned. This is typically used as a
second ACL in an expression in order to mark a connection when a first ACL
was verified :

      # block if 5 consecutive requests continue to come faster than 10 sess
      # per second, and reset the counter as soon as the traffic slows down.
      acl abuse src_http_req_rate gt 10
      acl kill  src_inc_gpc0 gt 5
      acl save  src_clr_gpc0 ge 0
      tcp-request connection accept if !abuse save
      tcp-request connection reject if abuse kill
</pre><a class="anchor" name="src_conn_cnt"></a><a class="anchor" name="7-src_conn_cnt"></a><a class="anchor" name="7.3.3-src_conn_cnt"></a><a class="anchor" name="src_conn_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="src_conn_cnt (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="src_conn_cnt"></a><a href="#7.3.3-src_conn_cnt">src_conn_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the cumulated number of connections initiated from the current
incoming connection's source address in the current proxy's stick-table or in
the designated stick-table. If the address is not found, zero is returned.
See also sc/sc0/sc1/sc2_conn_cnt.
</pre><a class="anchor" name="src_conn_cur"></a><a class="anchor" name="7-src_conn_cur"></a><a class="anchor" name="7.3.3-src_conn_cur"></a><a class="anchor" name="src_conn_cur (Using ACLs and fetching samples)"></a><a class="anchor" name="src_conn_cur (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="src_conn_cur"></a><a href="#7.3.3-src_conn_cur">src_conn_cur</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the current amount of concurrent connections initiated from the
current incoming connection's source address in the current proxy's
stick-table or in the designated stick-table. If the address is not found,
zero is returned. See also sc/sc0/sc1/sc2_conn_cur.
</pre><a class="anchor" name="src_conn_rate"></a><a class="anchor" name="7-src_conn_rate"></a><a class="anchor" name="7.3.3-src_conn_rate"></a><a class="anchor" name="src_conn_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="src_conn_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="src_conn_rate"></a><a href="#7.3.3-src_conn_rate">src_conn_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the average connection rate from the incoming connection's source
address in the current proxy's stick-table or in the designated stick-table,
measured in amount of connections over the period configured in the table. If
the address is not found, zero is returned. See also sc/sc0/sc1/sc2_conn_rate.
</pre><a class="anchor" name="src_get_gpc0"></a><a class="anchor" name="7-src_get_gpc0"></a><a class="anchor" name="7.3.3-src_get_gpc0"></a><a class="anchor" name="src_get_gpc0 (Using ACLs and fetching samples)"></a><a class="anchor" name="src_get_gpc0 (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="src_get_gpc0"></a><a href="#7.3.3-src_get_gpc0">src_get_gpc0</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the value of the first General Purpose Counter associated to the
incoming connection's source address in the current proxy's stick-table or in
the designated stick-table. If the address is not found, zero is returned.
See also sc/sc0/sc1/sc2_get_gpc0 and src_inc_gpc0.
</pre><a class="anchor" name="src_gpc0_rate"></a><a class="anchor" name="7-src_gpc0_rate"></a><a class="anchor" name="7.3.3-src_gpc0_rate"></a><a class="anchor" name="src_gpc0_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="src_gpc0_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="src_gpc0_rate"></a><a href="#7.3.3-src_gpc0_rate">src_gpc0_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the average increment rate of the first General Purpose Counter
associated to the incoming connection's source address in the current proxy's
stick-table or in the designated stick-table. It reports the frequency
which the gpc0 counter was incremented over the configured period. See also
sc/sc0/sc1/sc2_gpc0_rate, src_get_gpc0, and sc/sc0/sc1/sc2_inc_gpc0. Note
that the &quot;gpc0_rate&quot; counter must be stored in the stick-table for a value to
be returned, as &quot;gpc0&quot; only holds the event count.
</pre><a class="anchor" name="src_http_err_cnt"></a><a class="anchor" name="7-src_http_err_cnt"></a><a class="anchor" name="7.3.3-src_http_err_cnt"></a><a class="anchor" name="src_http_err_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="src_http_err_cnt (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="src_http_err_cnt"></a><a href="#7.3.3-src_http_err_cnt">src_http_err_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the cumulated number of HTTP errors from the incoming connection's
source address in the current proxy's stick-table or in the designated
stick-table. This includes the both request errors and 4xx error responses.
See also sc/sc0/sc1/sc2_http_err_cnt. If the address is not found, zero is
returned.
</pre><a class="anchor" name="src_http_err_rate"></a><a class="anchor" name="7-src_http_err_rate"></a><a class="anchor" name="7.3.3-src_http_err_rate"></a><a class="anchor" name="src_http_err_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="src_http_err_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="src_http_err_rate"></a><a href="#7.3.3-src_http_err_rate">src_http_err_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the average rate of HTTP errors from the incoming connection's source
address in the current proxy's stick-table or in the designated stick-table,
measured in amount of errors over the period configured in the table. This
includes the both request errors and 4xx error responses. If the address is
not found, zero is returned. See also sc/sc0/sc1/sc2_http_err_rate.
</pre><a class="anchor" name="src_http_req_cnt"></a><a class="anchor" name="7-src_http_req_cnt"></a><a class="anchor" name="7.3.3-src_http_req_cnt"></a><a class="anchor" name="src_http_req_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="src_http_req_cnt (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="src_http_req_cnt"></a><a href="#7.3.3-src_http_req_cnt">src_http_req_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the cumulated number of HTTP requests from the incoming connection's
source address in the current proxy's stick-table or in the designated stick-
table. This includes every started request, valid or not. If the address is
not found, zero is returned. See also sc/sc0/sc1/sc2_http_req_cnt.
</pre><a class="anchor" name="src_http_req_rate"></a><a class="anchor" name="7-src_http_req_rate"></a><a class="anchor" name="7.3.3-src_http_req_rate"></a><a class="anchor" name="src_http_req_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="src_http_req_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="src_http_req_rate"></a><a href="#7.3.3-src_http_req_rate">src_http_req_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the average rate of HTTP requests from the incoming connection's
source address in the current proxy's stick-table or in the designated stick-
table, measured in amount of requests over the period configured in the
table. This includes every started request, valid or not. If the address is
not found, zero is returned. See also sc/sc0/sc1/sc2_http_req_rate.
</pre><a class="anchor" name="src_inc_gpc0"></a><a class="anchor" name="7-src_inc_gpc0"></a><a class="anchor" name="7.3.3-src_inc_gpc0"></a><a class="anchor" name="src_inc_gpc0 (Using ACLs and fetching samples)"></a><a class="anchor" name="src_inc_gpc0 (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="src_inc_gpc0"></a><a href="#7.3.3-src_inc_gpc0">src_inc_gpc0</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Increments the first General Purpose Counter associated to the incoming
connection's source address in the current proxy's stick-table or in the
designated stick-table, and returns its new value. If the address is not
found, an entry is created and 1 is returned. See also sc0/sc2/sc2_inc_gpc0.
This is typically used as a second ACL in an expression in order to mark a
connection when a first ACL was verified :

      acl abuse src_http_req_rate gt 10
      acl kill  src_inc_gpc0 gt 0
      tcp-request connection reject if abuse kill
</pre><a class="anchor" name="src_kbytes_in"></a><a class="anchor" name="7-src_kbytes_in"></a><a class="anchor" name="7.3.3-src_kbytes_in"></a><a class="anchor" name="src_kbytes_in (Using ACLs and fetching samples)"></a><a class="anchor" name="src_kbytes_in (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="src_kbytes_in"></a><a href="#7.3.3-src_kbytes_in">src_kbytes_in</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the amount of data received from the incoming connection's source
address in the current proxy's stick-table or in the designated stick-table,
measured in kilobytes over the period configured in the table. If the address
is not found, zero is returned. The test is currently performed on 32-bit
integers, which limits values to 4 terabytes. See also
sc/sc0/sc1/sc2_kbytes_in.
</pre><a class="anchor" name="src_kbytes_out"></a><a class="anchor" name="7-src_kbytes_out"></a><a class="anchor" name="7.3.3-src_kbytes_out"></a><a class="anchor" name="src_kbytes_out (Using ACLs and fetching samples)"></a><a class="anchor" name="src_kbytes_out (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="src_kbytes_out"></a><a href="#7.3.3-src_kbytes_out">src_kbytes_out</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the amount of data sent to the incoming connection's source address
in the current proxy's stick-table or in the designated stick-table, measured
in kilobytes over the period configured in the table. If the address is not
found, zero is returned. The test is currently performed on 32-bit integers,
which limits values to 4 terabytes. See also sc/sc0/sc1/sc2_kbytes_out.
</pre><a class="anchor" name="src_port"></a><a class="anchor" name="7-src_port"></a><a class="anchor" name="7.3.3-src_port"></a><a class="anchor" name="src_port (Using ACLs and fetching samples)"></a><a class="anchor" name="src_port (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="src_port"></a><a href="#7.3.3-src_port">src_port</a></b> : integer</div><pre class="text">Returns an integer value corresponding to the TCP source port of the
connection on the client side, which is the port the client connected from.
Usage of this function is very limited as modern protocols do not care much
about source ports nowadays.
</pre><a class="anchor" name="src_sess_cnt"></a><a class="anchor" name="7-src_sess_cnt"></a><a class="anchor" name="7.3.3-src_sess_cnt"></a><a class="anchor" name="src_sess_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="src_sess_cnt (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="src_sess_cnt"></a><a href="#7.3.3-src_sess_cnt">src_sess_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the cumulated number of connections initiated from the incoming
connection's source IPv4 address in the current proxy's stick-table or in the
designated stick-table, that were transformed into sessions, which means that
they were accepted by &quot;<a href="#tcp-request">tcp-request</a>&quot; rules. If the address is not found, zero
is returned. See also sc/sc0/sc1/sc2_sess_cnt.
</pre><a class="anchor" name="src_sess_rate"></a><a class="anchor" name="7-src_sess_rate"></a><a class="anchor" name="7.3.3-src_sess_rate"></a><a class="anchor" name="src_sess_rate (Using ACLs and fetching samples)"></a><a class="anchor" name="src_sess_rate (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="src_sess_rate"></a><a href="#7.3.3-src_sess_rate">src_sess_rate</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Returns the average session rate from the incoming connection's source
address in the current proxy's stick-table or in the designated stick-table,
measured in amount of sessions over the period configured in the table. A
session is a connection that went past the early &quot;<a href="#tcp-request">tcp-request</a>&quot; rules. If the
address is not found, zero is returned. See also sc/sc0/sc1/sc2_sess_rate.
</pre><a class="anchor" name="src_updt_conn_cnt"></a><a class="anchor" name="7-src_updt_conn_cnt"></a><a class="anchor" name="7.3.3-src_updt_conn_cnt"></a><a class="anchor" name="src_updt_conn_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="src_updt_conn_cnt (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="src_updt_conn_cnt"></a><a href="#7.3.3-src_updt_conn_cnt">src_updt_conn_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;table&gt;</span>]</span>) : integer</div><pre class="text">Creates or updates the entry associated to the incoming connection's source
address in the current proxy's stick-table or in the designated stick-table.
This table must be configured to store the &quot;conn_cnt&quot; data type, otherwise
the match will be ignored. The current count is incremented by one, and the
expiration timer refreshed. The updated count is returned, so this match
can't return zero. This was used to reject service abusers based on their
source address. Note: it is recommended to use the more complete &quot;track-sc*&quot;
actions in &quot;<a href="#tcp-request">tcp-request</a>&quot; rules instead.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># This frontend limits incoming SSH connections to 3 per 10 second for</span>
<span class="comment"># each source address, and rejects excess connections until a 10 second</span>
<span class="comment"># silence is observed. At most 20 addresses are tracked.</span>
listen ssh
    bind :22
    mode tcp
    maxconn 100
    stick-table type ip size 20 expire 10s store conn_cnt
    tcp-request content reject if { src_updt_conn_cnt gt 3 }
    server local 127.0.0.1:22
</code></pre>
</div><a class="anchor" name="srv_id"></a><a class="anchor" name="7-srv_id"></a><a class="anchor" name="7.3.3-srv_id"></a><a class="anchor" name="srv_id (Using ACLs and fetching samples)"></a><a class="anchor" name="srv_id (Fetching samples at Layer 4)"></a><div class="keyword"><b><a class="anchor" name="srv_id"></a><a href="#7.3.3-srv_id">srv_id</a></b> : integer</div><pre class="text">Returns an integer containing the server's id when processing the response.
While it's almost only used with ACLs, it may be used for logging or
debugging.
</pre></div>
<a class="anchor" id="7.3.4" name="7.3.4"></a>
<h3 id="chapter-7.3.4" data-target="7.3.4"><small><a class="small" href="#7.3.4">7.3.4.</a></small> Fetching samples at Layer 5</h3>
<div><pre class="text">The layer 5 usually describes just the session layer which in haproxy is
closest to the session once all the connection handshakes are finished, but
when no content is yet made available. The fetch methods described here are
usable as low as the &quot;<a href="#tcp-request%20content">tcp-request content</a>&quot; rule sets unless they require some
future information. Those generally include the results of SSL negotiations.
</pre><a class="anchor" name="ssl_bc"></a><a class="anchor" name="7-ssl_bc"></a><a class="anchor" name="7.3.4-ssl_bc"></a><a class="anchor" name="ssl_bc (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_bc (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_bc"></a><a href="#7.3.4-ssl_bc">ssl_bc</a></b> : boolean</div><pre class="text">Returns true when the back connection was made via an SSL/TLS transport
layer and is locally deciphered. This means the outgoing connection was made
other a server with the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">ssl<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#ssl%20%28Bind%20options%29">Bind options</a></li><li><a href="#ssl%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; option.
</pre><a class="anchor" name="ssl_bc_alg_keysize"></a><a class="anchor" name="7-ssl_bc_alg_keysize"></a><a class="anchor" name="7.3.4-ssl_bc_alg_keysize"></a><a class="anchor" name="ssl_bc_alg_keysize (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_bc_alg_keysize (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_bc_alg_keysize"></a><a href="#7.3.4-ssl_bc_alg_keysize">ssl_bc_alg_keysize</a></b> : integer</div><pre class="text">Returns the symmetric cipher key size supported in bits when the outgoing
connection was made over an SSL/TLS transport layer.
</pre><a class="anchor" name="ssl_bc_cipher"></a><a class="anchor" name="7-ssl_bc_cipher"></a><a class="anchor" name="7.3.4-ssl_bc_cipher"></a><a class="anchor" name="ssl_bc_cipher (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_bc_cipher (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_bc_cipher"></a><a href="#7.3.4-ssl_bc_cipher">ssl_bc_cipher</a></b> : string</div><pre class="text">Returns the name of the used cipher when the outgoing connection was made
over an SSL/TLS transport layer.
</pre><a class="anchor" name="ssl_bc_protocol"></a><a class="anchor" name="7-ssl_bc_protocol"></a><a class="anchor" name="7.3.4-ssl_bc_protocol"></a><a class="anchor" name="ssl_bc_protocol (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_bc_protocol (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_bc_protocol"></a><a href="#7.3.4-ssl_bc_protocol">ssl_bc_protocol</a></b> : string</div><pre class="text">Returns the name of the used protocol when the outgoing connection was made
over an SSL/TLS transport layer.
</pre><a class="anchor" name="ssl_bc_unique_id"></a><a class="anchor" name="7-ssl_bc_unique_id"></a><a class="anchor" name="7.3.4-ssl_bc_unique_id"></a><a class="anchor" name="ssl_bc_unique_id (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_bc_unique_id (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_bc_unique_id"></a><a href="#7.3.4-ssl_bc_unique_id">ssl_bc_unique_id</a></b> : binary</div><pre class="text">When the outgoing connection was made over an SSL/TLS transport layer,
returns the TLS unique ID as defined in RFC5929 <a href="#3">section 3</a>. The unique id
can be encoded to base64 using the converter: &quot;ssl_bc_unique_id,base64&quot;.
</pre><a class="anchor" name="ssl_bc_session_id"></a><a class="anchor" name="7-ssl_bc_session_id"></a><a class="anchor" name="7.3.4-ssl_bc_session_id"></a><a class="anchor" name="ssl_bc_session_id (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_bc_session_id (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_bc_session_id"></a><a href="#7.3.4-ssl_bc_session_id">ssl_bc_session_id</a></b> : binary</div><pre class="text">Returns the SSL ID of the back connection when the outgoing connection was
made over an SSL/TLS transport layer. It is useful to log if we want to know
if session was reused or not.
</pre><a class="anchor" name="ssl_bc_use_keysize"></a><a class="anchor" name="7-ssl_bc_use_keysize"></a><a class="anchor" name="7.3.4-ssl_bc_use_keysize"></a><a class="anchor" name="ssl_bc_use_keysize (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_bc_use_keysize (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_bc_use_keysize"></a><a href="#7.3.4-ssl_bc_use_keysize">ssl_bc_use_keysize</a></b> : integer</div><pre class="text">Returns the symmetric cipher key size used in bits when the outgoing
connection was made over an SSL/TLS transport layer.
</pre><a class="anchor" name="ssl_c_ca_err"></a><a class="anchor" name="7-ssl_c_ca_err"></a><a class="anchor" name="7.3.4-ssl_c_ca_err"></a><a class="anchor" name="ssl_c_ca_err (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_c_ca_err (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_c_ca_err"></a><a href="#7.3.4-ssl_c_ca_err">ssl_c_ca_err</a></b> : integer</div><pre class="text">When the incoming connection was made over an SSL/TLS transport layer,
returns the ID of the first error detected during verification of the client
certificate at depth &gt; 0, or 0 if no error was encountered during this
verification process. Please refer to your SSL library's documentation to
find the exhaustive list of error codes.
</pre><a class="anchor" name="ssl_c_ca_err_depth"></a><a class="anchor" name="7-ssl_c_ca_err_depth"></a><a class="anchor" name="7.3.4-ssl_c_ca_err_depth"></a><a class="anchor" name="ssl_c_ca_err_depth (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_c_ca_err_depth (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_c_ca_err_depth"></a><a href="#7.3.4-ssl_c_ca_err_depth">ssl_c_ca_err_depth</a></b> : integer</div><pre class="text">When the incoming connection was made over an SSL/TLS transport layer,
returns the depth in the CA chain of the first error detected during the
verification of the client certificate. If no error is encountered, 0 is
returned.
</pre><a class="anchor" name="ssl_c_err"></a><a class="anchor" name="7-ssl_c_err"></a><a class="anchor" name="7.3.4-ssl_c_err"></a><a class="anchor" name="ssl_c_err (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_c_err (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_c_err"></a><a href="#7.3.4-ssl_c_err">ssl_c_err</a></b> : integer</div><pre class="text">When the incoming connection was made over an SSL/TLS transport layer,
returns the ID of the first error detected during verification at depth 0, or
0 if no error was encountered during this verification process. Please refer
to your SSL library's documentation to find the exhaustive list of error
codes.
</pre><a class="anchor" name="ssl_c_i_dn"></a><a class="anchor" name="7-ssl_c_i_dn"></a><a class="anchor" name="7.3.4-ssl_c_i_dn"></a><a class="anchor" name="ssl_c_i_dn (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_c_i_dn (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_c_i_dn"></a><a href="#7.3.4-ssl_c_i_dn">ssl_c_i_dn</a></b>(<span style="color: #008">[<span style="color: #080">&lt;entry&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;occ&gt;</span>]</span>]</span>) : string</div><pre class="text">When the incoming connection was made over an SSL/TLS transport layer,
returns the full distinguished name of the issuer of the certificate
presented by the client when no &lt;entry&gt; is specified, or the value of the
first given entry found from the beginning of the DN. If a positive/negative
occurrence number is specified as the optional second argument, it returns
the value of the nth given entry value from the beginning/end of the DN.
For instance, &quot;ssl_c_i_dn(OU,2)&quot; the second organization unit, and
&quot;ssl_c_i_dn(CN)&quot; retrieves the common name.
</pre><a class="anchor" name="ssl_c_key_alg"></a><a class="anchor" name="7-ssl_c_key_alg"></a><a class="anchor" name="7.3.4-ssl_c_key_alg"></a><a class="anchor" name="ssl_c_key_alg (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_c_key_alg (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_c_key_alg"></a><a href="#7.3.4-ssl_c_key_alg">ssl_c_key_alg</a></b> : string</div><pre class="text">Returns the name of the algorithm used to generate the key of the certificate
presented by the client when the incoming connection was made over an SSL/TLS
transport layer.
</pre><a class="anchor" name="ssl_c_notafter"></a><a class="anchor" name="7-ssl_c_notafter"></a><a class="anchor" name="7.3.4-ssl_c_notafter"></a><a class="anchor" name="ssl_c_notafter (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_c_notafter (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_c_notafter"></a><a href="#7.3.4-ssl_c_notafter">ssl_c_notafter</a></b> : string</div><pre class="text">Returns the end date presented by the client as a formatted string
YYMMDDhhmmss[Z] when the incoming connection was made over an SSL/TLS
transport layer.
</pre><a class="anchor" name="ssl_c_notbefore"></a><a class="anchor" name="7-ssl_c_notbefore"></a><a class="anchor" name="7.3.4-ssl_c_notbefore"></a><a class="anchor" name="ssl_c_notbefore (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_c_notbefore (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_c_notbefore"></a><a href="#7.3.4-ssl_c_notbefore">ssl_c_notbefore</a></b> : string</div><pre class="text">Returns the start date presented by the client as a formatted string
YYMMDDhhmmss[Z] when the incoming connection was made over an SSL/TLS
transport layer.
</pre><a class="anchor" name="ssl_c_s_dn"></a><a class="anchor" name="7-ssl_c_s_dn"></a><a class="anchor" name="7.3.4-ssl_c_s_dn"></a><a class="anchor" name="ssl_c_s_dn (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_c_s_dn (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_c_s_dn"></a><a href="#7.3.4-ssl_c_s_dn">ssl_c_s_dn</a></b>(<span style="color: #008">[<span style="color: #080">&lt;entry&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;occ&gt;</span>]</span>]</span>) : string</div><pre class="text">When the incoming connection was made over an SSL/TLS transport layer,
returns the full distinguished name of the subject of the certificate
presented by the client when no &lt;entry&gt; is specified, or the value of the
first given entry found from the beginning of the DN. If a positive/negative
occurrence number is specified as the optional second argument, it returns
the value of the nth given entry value from the beginning/end of the DN.
For instance, &quot;ssl_c_s_dn(OU,2)&quot; the second organization unit, and
&quot;ssl_c_s_dn(CN)&quot; retrieves the common name.
</pre><a class="anchor" name="ssl_c_serial"></a><a class="anchor" name="7-ssl_c_serial"></a><a class="anchor" name="7.3.4-ssl_c_serial"></a><a class="anchor" name="ssl_c_serial (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_c_serial (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_c_serial"></a><a href="#7.3.4-ssl_c_serial">ssl_c_serial</a></b> : binary</div><pre class="text">Returns the serial of the certificate presented by the client when the
incoming connection was made over an SSL/TLS transport layer. When used for
an ACL, the value(s) to match against can be passed in hexadecimal form.
</pre><a class="anchor" name="ssl_c_sha1"></a><a class="anchor" name="7-ssl_c_sha1"></a><a class="anchor" name="7.3.4-ssl_c_sha1"></a><a class="anchor" name="ssl_c_sha1 (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_c_sha1 (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_c_sha1"></a><a href="#7.3.4-ssl_c_sha1">ssl_c_sha1</a></b> : binary</div><pre class="text">Returns the SHA-1 fingerprint of the certificate presented by the client when
the incoming connection was made over an SSL/TLS transport layer. This can be
used to stick a client to a server, or to pass this information to a server.
</pre><a class="anchor" name="ssl_c_sig_alg"></a><a class="anchor" name="7-ssl_c_sig_alg"></a><a class="anchor" name="7.3.4-ssl_c_sig_alg"></a><a class="anchor" name="ssl_c_sig_alg (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_c_sig_alg (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_c_sig_alg"></a><a href="#7.3.4-ssl_c_sig_alg">ssl_c_sig_alg</a></b> : string</div><pre class="text">Returns the name of the algorithm used to sign the certificate presented by
the client when the incoming connection was made over an SSL/TLS transport
layer.
</pre><a class="anchor" name="ssl_c_used"></a><a class="anchor" name="7-ssl_c_used"></a><a class="anchor" name="7.3.4-ssl_c_used"></a><a class="anchor" name="ssl_c_used (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_c_used (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_c_used"></a><a href="#7.3.4-ssl_c_used">ssl_c_used</a></b> : boolean</div><pre class="text">Returns true if current SSL session uses a client certificate even if current
connection uses SSL session resumption. See also &quot;<a href="#ssl_fc_has_crt">ssl_fc_has_crt</a>&quot;.
</pre><a class="anchor" name="ssl_c_verify"></a><a class="anchor" name="7-ssl_c_verify"></a><a class="anchor" name="7.3.4-ssl_c_verify"></a><a class="anchor" name="ssl_c_verify (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_c_verify (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_c_verify"></a><a href="#7.3.4-ssl_c_verify">ssl_c_verify</a></b> : integer</div><pre class="text">Returns the verify result error ID when the incoming connection was made over
an SSL/TLS transport layer, otherwise zero if no error is encountered. Please
refer to your SSL library's documentation for an exhaustive list of error
codes.
</pre><a class="anchor" name="ssl_c_version"></a><a class="anchor" name="7-ssl_c_version"></a><a class="anchor" name="7.3.4-ssl_c_version"></a><a class="anchor" name="ssl_c_version (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_c_version (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_c_version"></a><a href="#7.3.4-ssl_c_version">ssl_c_version</a></b> : integer</div><pre class="text">Returns the version of the certificate presented by the client when the
incoming connection was made over an SSL/TLS transport layer.
</pre><a class="anchor" name="ssl_f_i_dn"></a><a class="anchor" name="7-ssl_f_i_dn"></a><a class="anchor" name="7.3.4-ssl_f_i_dn"></a><a class="anchor" name="ssl_f_i_dn (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_f_i_dn (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_f_i_dn"></a><a href="#7.3.4-ssl_f_i_dn">ssl_f_i_dn</a></b>(<span style="color: #008">[<span style="color: #080">&lt;entry&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;occ&gt;</span>]</span>]</span>) : string</div><pre class="text">When the incoming connection was made over an SSL/TLS transport layer,
returns the full distinguished name of the issuer of the certificate
presented by the frontend when no &lt;entry&gt; is specified, or the value of the
first given entry found from the beginning of the DN. If a positive/negative
occurrence number is specified as the optional second argument, it returns
the value of the nth given entry value from the beginning/end of the DN.
For instance, &quot;ssl_f_i_dn(OU,2)&quot; the second organization unit, and
&quot;ssl_f_i_dn(CN)&quot; retrieves the common name.
</pre><a class="anchor" name="ssl_f_key_alg"></a><a class="anchor" name="7-ssl_f_key_alg"></a><a class="anchor" name="7.3.4-ssl_f_key_alg"></a><a class="anchor" name="ssl_f_key_alg (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_f_key_alg (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_f_key_alg"></a><a href="#7.3.4-ssl_f_key_alg">ssl_f_key_alg</a></b> : string</div><pre class="text">Returns the name of the algorithm used to generate the key of the certificate
presented by the frontend when the incoming connection was made over an
SSL/TLS transport layer.
</pre><a class="anchor" name="ssl_f_notafter"></a><a class="anchor" name="7-ssl_f_notafter"></a><a class="anchor" name="7.3.4-ssl_f_notafter"></a><a class="anchor" name="ssl_f_notafter (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_f_notafter (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_f_notafter"></a><a href="#7.3.4-ssl_f_notafter">ssl_f_notafter</a></b> : string</div><pre class="text">Returns the end date presented by the frontend as a formatted string
YYMMDDhhmmss[Z] when the incoming connection was made over an SSL/TLS
transport layer.
</pre><a class="anchor" name="ssl_f_notbefore"></a><a class="anchor" name="7-ssl_f_notbefore"></a><a class="anchor" name="7.3.4-ssl_f_notbefore"></a><a class="anchor" name="ssl_f_notbefore (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_f_notbefore (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_f_notbefore"></a><a href="#7.3.4-ssl_f_notbefore">ssl_f_notbefore</a></b> : string</div><pre class="text">Returns the start date presented by the frontend as a formatted string
YYMMDDhhmmss[Z] when the incoming connection was made over an SSL/TLS
transport layer.
</pre><a class="anchor" name="ssl_f_s_dn"></a><a class="anchor" name="7-ssl_f_s_dn"></a><a class="anchor" name="7.3.4-ssl_f_s_dn"></a><a class="anchor" name="ssl_f_s_dn (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_f_s_dn (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_f_s_dn"></a><a href="#7.3.4-ssl_f_s_dn">ssl_f_s_dn</a></b>(<span style="color: #008">[<span style="color: #080">&lt;entry&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;occ&gt;</span>]</span>]</span>) : string</div><pre class="text">When the incoming connection was made over an SSL/TLS transport layer,
returns the full distinguished name of the subject of the certificate
presented by the frontend when no &lt;entry&gt; is specified, or the value of the
first given entry found from the beginning of the DN. If a positive/negative
occurrence number is specified as the optional second argument, it returns
the value of the nth given entry value from the beginning/end of the DN.
For instance, &quot;ssl_f_s_dn(OU,2)&quot; the second organization unit, and
&quot;ssl_f_s_dn(CN)&quot; retrieves the common name.
</pre><a class="anchor" name="ssl_f_serial"></a><a class="anchor" name="7-ssl_f_serial"></a><a class="anchor" name="7.3.4-ssl_f_serial"></a><a class="anchor" name="ssl_f_serial (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_f_serial (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_f_serial"></a><a href="#7.3.4-ssl_f_serial">ssl_f_serial</a></b> : binary</div><pre class="text">Returns the serial of the certificate presented by the frontend when the
incoming connection was made over an SSL/TLS transport layer. When used for
an ACL, the value(s) to match against can be passed in hexadecimal form.
</pre><a class="anchor" name="ssl_f_sha1"></a><a class="anchor" name="7-ssl_f_sha1"></a><a class="anchor" name="7.3.4-ssl_f_sha1"></a><a class="anchor" name="ssl_f_sha1 (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_f_sha1 (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_f_sha1"></a><a href="#7.3.4-ssl_f_sha1">ssl_f_sha1</a></b> : binary</div><pre class="text">Returns the SHA-1 fingerprint of the certificate presented by the frontend
when the incoming connection was made over an SSL/TLS transport layer. This
can be used to know which certificate was chosen using SNI.
</pre><a class="anchor" name="ssl_f_sig_alg"></a><a class="anchor" name="7-ssl_f_sig_alg"></a><a class="anchor" name="7.3.4-ssl_f_sig_alg"></a><a class="anchor" name="ssl_f_sig_alg (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_f_sig_alg (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_f_sig_alg"></a><a href="#7.3.4-ssl_f_sig_alg">ssl_f_sig_alg</a></b> : string</div><pre class="text">Returns the name of the algorithm used to sign the certificate presented by
the frontend when the incoming connection was made over an SSL/TLS transport
layer.
</pre><a class="anchor" name="ssl_f_version"></a><a class="anchor" name="7-ssl_f_version"></a><a class="anchor" name="7.3.4-ssl_f_version"></a><a class="anchor" name="ssl_f_version (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_f_version (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_f_version"></a><a href="#7.3.4-ssl_f_version">ssl_f_version</a></b> : integer</div><pre class="text">Returns the version of the certificate presented by the frontend when the
incoming connection was made over an SSL/TLS transport layer.
</pre><a class="anchor" name="ssl_fc"></a><a class="anchor" name="7-ssl_fc"></a><a class="anchor" name="7.3.4-ssl_fc"></a><a class="anchor" name="ssl_fc (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_fc (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_fc"></a><a href="#7.3.4-ssl_fc">ssl_fc</a></b> : boolean</div><pre class="text">Returns true when the front connection was made via an SSL/TLS transport
layer and is locally deciphered. This means it has matched a socket declared
with a &quot;<a href="#bind">bind</a>&quot; line having the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">ssl<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#ssl%20%28Bind%20options%29">Bind options</a></li><li><a href="#ssl%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; option.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># This passes &quot;X-Proto: https&quot; to servers when client connects over SSL</span>
listen http-https
    bind :80
    bind :443 ssl crt /etc/haproxy.pem
    http-request add-header X-Proto https if { ssl_fc }
</code></pre>
</div><a class="anchor" name="ssl_fc_alg_keysize"></a><a class="anchor" name="7-ssl_fc_alg_keysize"></a><a class="anchor" name="7.3.4-ssl_fc_alg_keysize"></a><a class="anchor" name="ssl_fc_alg_keysize (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_fc_alg_keysize (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_fc_alg_keysize"></a><a href="#7.3.4-ssl_fc_alg_keysize">ssl_fc_alg_keysize</a></b> : integer</div><pre class="text">Returns the symmetric cipher key size supported in bits when the incoming
connection was made over an SSL/TLS transport layer.
</pre><a class="anchor" name="ssl_fc_alpn"></a><a class="anchor" name="7-ssl_fc_alpn"></a><a class="anchor" name="7.3.4-ssl_fc_alpn"></a><a class="anchor" name="ssl_fc_alpn (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_fc_alpn (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_fc_alpn"></a><a href="#7.3.4-ssl_fc_alpn">ssl_fc_alpn</a></b> : string</div><pre class="text">This extracts the Application Layer Protocol Negotiation field from an
incoming connection made via a TLS transport layer and locally deciphered by
haproxy. The result is a string containing the protocol name advertised by
the client. The SSL library must have been built with support for TLS
extensions enabled (check haproxy -vv). Note that the TLS ALPN extension is
not advertised unless the &quot;<a href="#alpn">alpn</a>&quot; keyword on the &quot;<a href="#bind">bind</a>&quot; line specifies a
protocol list. Also, nothing forces the client to pick a protocol from this
list, any other one may be requested. The TLS ALPN extension is meant to
replace the TLS NPN extension. See also &quot;<a href="#ssl_fc_npn">ssl_fc_npn</a>&quot;.
</pre><a class="anchor" name="ssl_fc_cipher"></a><a class="anchor" name="7-ssl_fc_cipher"></a><a class="anchor" name="7.3.4-ssl_fc_cipher"></a><a class="anchor" name="ssl_fc_cipher (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_fc_cipher (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_fc_cipher"></a><a href="#7.3.4-ssl_fc_cipher">ssl_fc_cipher</a></b> : string</div><pre class="text">Returns the name of the used cipher when the incoming connection was made
over an SSL/TLS transport layer.
</pre><a class="anchor" name="ssl_fc_has_crt"></a><a class="anchor" name="7-ssl_fc_has_crt"></a><a class="anchor" name="7.3.4-ssl_fc_has_crt"></a><a class="anchor" name="ssl_fc_has_crt (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_fc_has_crt (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_fc_has_crt"></a><a href="#7.3.4-ssl_fc_has_crt">ssl_fc_has_crt</a></b> : boolean</div><pre class="text">Returns true if a client certificate is present in an incoming connection over
SSL/TLS transport layer. Useful if 'verify' statement is set to 'optional'.
Note: on SSL session resumption with Session ID or TLS ticket, client
certificate is not present in the current connection but may be retrieved
from the cache or the ticket. So prefer &quot;<a href="#ssl_c_used">ssl_c_used</a>&quot; if you want to check if
current SSL session uses a client certificate.
</pre><a class="anchor" name="ssl_fc_has_sni"></a><a class="anchor" name="7-ssl_fc_has_sni"></a><a class="anchor" name="7.3.4-ssl_fc_has_sni"></a><a class="anchor" name="ssl_fc_has_sni (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_fc_has_sni (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_fc_has_sni"></a><a href="#7.3.4-ssl_fc_has_sni">ssl_fc_has_sni</a></b> : boolean</div><pre class="text">This checks for the presence of a Server Name Indication TLS extension (SNI)
in an incoming connection was made over an SSL/TLS transport layer. Returns
true when the incoming connection presents a TLS SNI field. This requires
that the SSL library is build with support for TLS extensions enabled (check
haproxy -vv).
</pre><a class="anchor" name="ssl_fc_npn"></a><a class="anchor" name="7-ssl_fc_npn"></a><a class="anchor" name="7.3.4-ssl_fc_npn"></a><a class="anchor" name="ssl_fc_npn (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_fc_npn (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_fc_npn"></a><a href="#7.3.4-ssl_fc_npn">ssl_fc_npn</a></b> : string</div><pre class="text">This extracts the Next Protocol Negotiation field from an incoming connection
made via a TLS transport layer and locally deciphered by haproxy. The result
is a string containing the protocol name advertised by the client. The SSL
library must have been built with support for TLS extensions enabled (check
haproxy -vv). Note that the TLS NPN extension is not advertised unless the
&quot;<a href="#npn">npn</a>&quot; keyword on the &quot;<a href="#bind">bind</a>&quot; line specifies a protocol list. Also, nothing
forces the client to pick a protocol from this list, any other one may be
requested. Please note that the TLS NPN extension was replaced with ALPN.
</pre><a class="anchor" name="ssl_fc_protocol"></a><a class="anchor" name="7-ssl_fc_protocol"></a><a class="anchor" name="7.3.4-ssl_fc_protocol"></a><a class="anchor" name="ssl_fc_protocol (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_fc_protocol (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_fc_protocol"></a><a href="#7.3.4-ssl_fc_protocol">ssl_fc_protocol</a></b> : string</div><pre class="text">Returns the name of the used protocol when the incoming connection was made
over an SSL/TLS transport layer.
</pre><a class="anchor" name="ssl_fc_unique_id"></a><a class="anchor" name="7-ssl_fc_unique_id"></a><a class="anchor" name="7.3.4-ssl_fc_unique_id"></a><a class="anchor" name="ssl_fc_unique_id (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_fc_unique_id (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_fc_unique_id"></a><a href="#7.3.4-ssl_fc_unique_id">ssl_fc_unique_id</a></b> : binary</div><pre class="text">When the incoming connection was made over an SSL/TLS transport layer,
returns the TLS unique ID as defined in RFC5929 <a href="#3">section 3</a>. The unique id
can be encoded to base64 using the converter: &quot;ssl_bc_unique_id,base64&quot;.
</pre><a class="anchor" name="ssl_fc_session_id"></a><a class="anchor" name="7-ssl_fc_session_id"></a><a class="anchor" name="7.3.4-ssl_fc_session_id"></a><a class="anchor" name="ssl_fc_session_id (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_fc_session_id (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_fc_session_id"></a><a href="#7.3.4-ssl_fc_session_id">ssl_fc_session_id</a></b> : binary</div><pre class="text">Returns the SSL ID of the front connection when the incoming connection was
made over an SSL/TLS transport layer. It is useful to stick a given client to
a server. It is important to note that some browsers refresh their session ID
every few minutes.
</pre><a class="anchor" name="ssl_fc_sni"></a><a class="anchor" name="7-ssl_fc_sni"></a><a class="anchor" name="7.3.4-ssl_fc_sni"></a><a class="anchor" name="ssl_fc_sni (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_fc_sni (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_fc_sni"></a><a href="#7.3.4-ssl_fc_sni">ssl_fc_sni</a></b> : string</div><pre class="text">This extracts the Server Name Indication TLS extension (SNI) field from an
incoming connection made via an SSL/TLS transport layer and locally
deciphered by haproxy. The result (when present) typically is a string
matching the HTTPS host name (253 chars or less). The SSL library must have
been built with support for TLS extensions enabled (check haproxy -vv).

This fetch is different from &quot;<a href="#req_ssl_sni">req_ssl_sni</a>&quot; above in that it applies to the
connection being deciphered by haproxy and not to SSL contents being blindly
forwarded. See also &quot;ssl_fc_sni_end&quot; and &quot;ssl_fc_sni_reg&quot; below. This
requires that the SSL library is build with support for TLS extensions
enabled (check haproxy -vv).

ACL derivatives :
  ssl_fc_sni_end : suffix match
  ssl_fc_sni_reg : regex match
</pre><a class="anchor" name="ssl_fc_use_keysize"></a><a class="anchor" name="7-ssl_fc_use_keysize"></a><a class="anchor" name="7.3.4-ssl_fc_use_keysize"></a><a class="anchor" name="ssl_fc_use_keysize (Using ACLs and fetching samples)"></a><a class="anchor" name="ssl_fc_use_keysize (Fetching samples at Layer 5)"></a><div class="keyword"><b><a class="anchor" name="ssl_fc_use_keysize"></a><a href="#7.3.4-ssl_fc_use_keysize">ssl_fc_use_keysize</a></b> : integer</div><pre class="text">Returns the symmetric cipher key size used in bits when the incoming
connection was made over an SSL/TLS transport layer.
</pre></div>
<a class="anchor" id="7.3.5" name="7.3.5"></a>
<h3 id="chapter-7.3.5" data-target="7.3.5"><small><a class="small" href="#7.3.5">7.3.5.</a></small> Fetching samples from buffer contents (Layer 6)</h3>
<div><pre class="text">Fetching samples from buffer contents is a bit different from the previous
sample fetches above because the sampled data are ephemeral. These data can
only be used when they're available and will be lost when they're forwarded.
For this reason, samples fetched from buffer contents during a request cannot
be used in a response for example. Even while the data are being fetched, they
can change. Sometimes it is necessary to set some delays or combine multiple
sample fetch methods to ensure that the expected data are complete and usable,
for example through TCP request content inspection. Please see the &quot;tcp-request
content&quot; keyword for more detailed information on the subject.
</pre><a class="anchor" name="payload"></a><a class="anchor" name="7-payload"></a><a class="anchor" name="7.3.5-payload"></a><a class="anchor" name="payload (Using ACLs and fetching samples)"></a><a class="anchor" name="payload (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="payload"></a><a href="#7.3.5-payload">payload</a></b>(<span style="color: #080">&lt;offset&gt;</span>,<span style="color: #080">&lt;length&gt;</span>) : binary <span class="label label-warning">(deprecated)</span></div><pre class="text">This is an alias for &quot;<a href="#req.payload">req.payload</a>&quot; when used in the context of a request (eg:
&quot;<a href="#stick%20on">stick on</a>&quot;, &quot;<a href="#stick%20match">stick match</a>&quot;), and for &quot;<a href="#res.payload">res.payload</a>&quot; when used in the context of
a response such as in &quot;stick store response&quot;.
</pre><a class="anchor" name="payload_lv"></a><a class="anchor" name="7-payload_lv"></a><a class="anchor" name="7.3.5-payload_lv"></a><a class="anchor" name="payload_lv (Using ACLs and fetching samples)"></a><a class="anchor" name="payload_lv (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="payload_lv"></a><a href="#7.3.5-payload_lv">payload_lv</a></b>(<span style="color: #080">&lt;offset1&gt;</span>,<span style="color: #080">&lt;length&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;offset2&gt;</span>]</span>) : binary <span class="label label-warning">(deprecated)</span></div><pre class="text">This is an alias for &quot;<a href="#req.payload_lv">req.payload_lv</a>&quot; when used in the context of a request
(eg: &quot;<a href="#stick%20on">stick on</a>&quot;, &quot;<a href="#stick%20match">stick match</a>&quot;), and for &quot;<a href="#res.payload_lv">res.payload_lv</a>&quot; when used in the
context of a response such as in &quot;stick store response&quot;.
</pre><a class="anchor" name="req.len"></a><a class="anchor" name="7-req.len"></a><a class="anchor" name="7.3.5-req.len"></a><a class="anchor" name="req.len (Using ACLs and fetching samples)"></a><a class="anchor" name="req.len (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="req.len"></a><a href="#7.3.5-req.len">req.len</a></b> : integer</div><a class="anchor" name="req_len"></a><a class="anchor" name="7-req_len"></a><a class="anchor" name="7.3.5-req_len"></a><a class="anchor" name="req_len (Using ACLs and fetching samples)"></a><a class="anchor" name="req_len (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="req_len"></a><a href="#7.3.5-req_len">req_len</a></b> : integer <span class="label label-warning">(deprecated)</span></div><pre class="text">Returns an integer value corresponding to the number of bytes present in the
request buffer. This is mostly used in ACL. It is important to understand
that this test does not return false as long as the buffer is changing. This
means that a check with equality to zero will almost always immediately match
at the beginning of the session, while a test for more data will wait for
that data to come in and return false only when haproxy is certain that no
more data will come in. This test was designed to be used with TCP request
content inspection.
</pre><a class="anchor" name="req.payload"></a><a class="anchor" name="7-req.payload"></a><a class="anchor" name="7.3.5-req.payload"></a><a class="anchor" name="req.payload (Using ACLs and fetching samples)"></a><a class="anchor" name="req.payload (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="req.payload"></a><a href="#7.3.5-req.payload">req.payload</a></b>(<span style="color: #080">&lt;offset&gt;</span>,<span style="color: #080">&lt;length&gt;</span>) : binary</div><pre class="text">This extracts a binary block of &lt;length&gt; bytes and starting at byte &lt;offset&gt;
in the request buffer. As a special case, if the &lt;length&gt; argument is zero,
the the whole buffer from &lt;offset&gt; to the end is extracted. This can be used
with ACLs in order to check for the presence of some content in a buffer at
any location.

ACL alternatives :
  payload(&lt;offset&gt;,&lt;length&gt;) : hex binary match
</pre><a class="anchor" name="req.payload_lv"></a><a class="anchor" name="7-req.payload_lv"></a><a class="anchor" name="7.3.5-req.payload_lv"></a><a class="anchor" name="req.payload_lv (Using ACLs and fetching samples)"></a><a class="anchor" name="req.payload_lv (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="req.payload_lv"></a><a href="#7.3.5-req.payload_lv">req.payload_lv</a></b>(<span style="color: #080">&lt;offset1&gt;</span>,<span style="color: #080">&lt;length&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;offset2&gt;</span>]</span>) : binary</div><pre class="text">This extracts a binary block whose size is specified at &lt;offset1&gt; for &lt;length&gt;
bytes, and which starts at &lt;offset2&gt; if specified or just after the length in
the request buffer. The &lt;offset2&gt; parameter also supports relative offsets if
prepended with a '+' or '-' sign.

ACL alternatives :
  payload_lv(&lt;offset1&gt;,&lt;length&gt;[,&lt;offset2&gt;]) : hex binary match
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<div class="example-desc">please consult the example from the &quot;<a href="#stick%20store-response">stick store-response</a>&quot; keyword.</div><code></code></pre>
</div><a class="anchor" name="req.proto_http"></a><a class="anchor" name="7-req.proto_http"></a><a class="anchor" name="7.3.5-req.proto_http"></a><a class="anchor" name="req.proto_http (Using ACLs and fetching samples)"></a><a class="anchor" name="req.proto_http (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="req.proto_http"></a><a href="#7.3.5-req.proto_http">req.proto_http</a></b> : boolean</div><a class="anchor" name="req_proto_http"></a><a class="anchor" name="7-req_proto_http"></a><a class="anchor" name="7.3.5-req_proto_http"></a><a class="anchor" name="req_proto_http (Using ACLs and fetching samples)"></a><a class="anchor" name="req_proto_http (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="req_proto_http"></a><a href="#7.3.5-req_proto_http">req_proto_http</a></b> : boolean <span class="label label-warning">(deprecated)</span></div><pre class="text">Returns true when data in the request buffer look like HTTP and correctly
parses as such. It is the same parser as the common HTTP request parser which
is used so there should be no surprises. The test does not match until the
request is complete, failed or timed out. This test may be used to report the
protocol in TCP logs, but the biggest use is to block TCP request analysis
until a complete HTTP request is present in the buffer, for example to track
a header.
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code><span class="comment"># track request counts per &quot;<a href="#base">base</a>&quot; (concatenation of Host+URL)</span>
tcp-request inspect-delay 10s
tcp-request content reject if !HTTP
tcp-request content track-sc0 base table req-rate
</code></pre>
</div><a class="anchor" name="req.rdp_cookie"></a><a class="anchor" name="7-req.rdp_cookie"></a><a class="anchor" name="7.3.5-req.rdp_cookie"></a><a class="anchor" name="req.rdp_cookie (Using ACLs and fetching samples)"></a><a class="anchor" name="req.rdp_cookie (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="req.rdp_cookie"></a><a href="#7.3.5-req.rdp_cookie">req.rdp_cookie</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span>]</span>) : string</div><a class="anchor" name="rdp_cookie"></a><a class="anchor" name="7-rdp_cookie"></a><a class="anchor" name="7.3.5-rdp_cookie"></a><a class="anchor" name="rdp_cookie (Using ACLs and fetching samples)"></a><a class="anchor" name="rdp_cookie (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="rdp_cookie"></a><a href="#7.3.5-rdp_cookie">rdp_cookie</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span>]</span>) : string <span class="label label-warning">(deprecated)</span></div><pre class="text">When the request buffer looks like the RDP protocol, extracts the RDP cookie
&lt;name&gt;, or any cookie if unspecified. The parser only checks for the first
cookie, as illustrated in the RDP protocol specification. The cookie name is
case insensitive. Generally the &quot;MSTS&quot; cookie name will be used, as it can
contain the user name of the client connecting to the server if properly
configured on the client. The &quot;MSTSHASH&quot; cookie is often used as well for
session stickiness to servers.

This differs from &quot;balance rdp-cookie&quot; in that any balancing algorithm may be
used and thus the distribution of clients to backend servers is not linked to
a hash of the RDP cookie. It is envisaged that using a balancing algorithm
such as &quot;balance roundrobin&quot; or &quot;balance leastconn&quot; will lead to a more even
distribution of clients to backend servers than the hash used by &quot;balance
rdp-cookie&quot;.

ACL derivatives :
  req_rdp_cookie([&lt;name&gt;]) : exact string match
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>listen tse-farm
    bind 0.0.0.0:3389
    <span class="comment"># wait up to 5s for an RDP cookie in the request</span>
    tcp-request inspect-delay 5s
    tcp-request content accept if RDP_COOKIE
    <span class="comment"># apply RDP cookie persistence</span>
    persist rdp-cookie
    <span class="comment"># Persist based on the mstshash cookie</span>
    <span class="comment"># This is only useful makes sense if</span>
    <span class="comment"># balance rdp-cookie is not used</span>
    stick-table type string size 204800
    stick on req.rdp_cookie(mstshash)
    server srv1 1.1.1.1:3389
    server srv1 1.1.1.2:3389
</code></pre>
</div><div class="page-header"><b>See also :</b> &quot;balance rdp-cookie&quot;, &quot;<a href="#persist%20rdp-cookie">persist rdp-cookie</a>&quot;, &quot;<a href="#tcp-request">tcp-request</a>&quot; and the &quot;req_rdp_cookie&quot; ACL.</div>
<a class="anchor" name="req.rdp_cookie_cnt"></a><a class="anchor" name="7-req.rdp_cookie_cnt"></a><a class="anchor" name="7.3.5-req.rdp_cookie_cnt"></a><a class="anchor" name="req.rdp_cookie_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="req.rdp_cookie_cnt (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="req.rdp_cookie_cnt"></a><a href="#7.3.5-req.rdp_cookie_cnt">req.rdp_cookie_cnt</a></b>(<span style="color: #008">[name]</span>) : integer</div><a class="anchor" name="rdp_cookie_cnt"></a><a class="anchor" name="7-rdp_cookie_cnt"></a><a class="anchor" name="7.3.5-rdp_cookie_cnt"></a><a class="anchor" name="rdp_cookie_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="rdp_cookie_cnt (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="rdp_cookie_cnt"></a><a href="#7.3.5-rdp_cookie_cnt">rdp_cookie_cnt</a></b>(<span style="color: #008">[name]</span>) : integer <span class="label label-warning">(deprecated)</span></div><pre class="text">Tries to parse the request buffer as RDP protocol, then returns an integer
corresponding to the number of RDP cookies found. If an optional cookie name
is passed, only cookies matching this name are considered. This is mostly
used in ACL.

ACL derivatives :
  req_rdp_cookie_cnt([&lt;name&gt;]) : integer match
</pre><a class="anchor" name="req.ssl_hello_type"></a><a class="anchor" name="7-req.ssl_hello_type"></a><a class="anchor" name="7.3.5-req.ssl_hello_type"></a><a class="anchor" name="req.ssl_hello_type (Using ACLs and fetching samples)"></a><a class="anchor" name="req.ssl_hello_type (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="req.ssl_hello_type"></a><a href="#7.3.5-req.ssl_hello_type">req.ssl_hello_type</a></b> : integer</div><a class="anchor" name="req_ssl_hello_type"></a><a class="anchor" name="7-req_ssl_hello_type"></a><a class="anchor" name="7.3.5-req_ssl_hello_type"></a><a class="anchor" name="req_ssl_hello_type (Using ACLs and fetching samples)"></a><a class="anchor" name="req_ssl_hello_type (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="req_ssl_hello_type"></a><a href="#7.3.5-req_ssl_hello_type">req_ssl_hello_type</a></b> : integer <span class="label label-warning">(deprecated)</span></div><pre class="text">Returns an integer value containing the type of the SSL hello message found
in the request buffer if the buffer contains data that parse as a complete
SSL (v3 or superior) client hello message. Note that this only applies to raw
contents found in the request buffer and not to contents deciphered via an
SSL data layer, so this will not work with &quot;<a href="#bind">bind</a>&quot; lines having the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">ssl<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#ssl%20%28Bind%20options%29">Bind options</a></li><li><a href="#ssl%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;
option. This is mostly used in ACL to detect presence of an SSL hello message
that is supposed to contain an SSL session ID usable for stickiness.
</pre><a class="anchor" name="req.ssl_sni"></a><a class="anchor" name="7-req.ssl_sni"></a><a class="anchor" name="7.3.5-req.ssl_sni"></a><a class="anchor" name="req.ssl_sni (Using ACLs and fetching samples)"></a><a class="anchor" name="req.ssl_sni (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="req.ssl_sni"></a><a href="#7.3.5-req.ssl_sni">req.ssl_sni</a></b> : string</div><a class="anchor" name="req_ssl_sni"></a><a class="anchor" name="7-req_ssl_sni"></a><a class="anchor" name="7.3.5-req_ssl_sni"></a><a class="anchor" name="req_ssl_sni (Using ACLs and fetching samples)"></a><a class="anchor" name="req_ssl_sni (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="req_ssl_sni"></a><a href="#7.3.5-req_ssl_sni">req_ssl_sni</a></b> : string <span class="label label-warning">(deprecated)</span></div><pre class="text">Returns a string containing the value of the Server Name TLS extension sent
by a client in a TLS stream passing through the request buffer if the buffer
contains data that parse as a complete SSL (v3 or superior) client hello
message. Note that this only applies to raw contents found in the request
buffer and not to contents deciphered via an SSL data layer, so this will not
work with &quot;<a href="#bind">bind</a>&quot; lines having the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">ssl<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#ssl%20%28Bind%20options%29">Bind options</a></li><li><a href="#ssl%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; option. SNI normally contains the
name of the host the client tries to connect to (for recent browsers). SNI is
useful for allowing or denying access to certain hosts when SSL/TLS is used
by the client. This test was designed to be used with TCP request content
inspection. If content switching is needed, it is recommended to first wait
for a complete client hello (type 1), like in the example below. See also
&quot;<a href="#ssl_fc_sni">ssl_fc_sni</a>&quot;.

ACL derivatives :
  req_ssl_sni : exact string match
</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code><span class="comment"># Wait for a client hello for at most 5 seconds</span>
tcp-request inspect-delay 5s
tcp-request content accept if { req_ssl_hello_type 1 }
use_backend bk_allow if { req_ssl_sni -f allowed_sites }
default_backend bk_sorry_page
</code></pre>
</div><a class="anchor" name="res.ssl_hello_type"></a><a class="anchor" name="7-res.ssl_hello_type"></a><a class="anchor" name="7.3.5-res.ssl_hello_type"></a><a class="anchor" name="res.ssl_hello_type (Using ACLs and fetching samples)"></a><a class="anchor" name="res.ssl_hello_type (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="res.ssl_hello_type"></a><a href="#7.3.5-res.ssl_hello_type">res.ssl_hello_type</a></b> : integer</div><a class="anchor" name="rep_ssl_hello_type"></a><a class="anchor" name="7-rep_ssl_hello_type"></a><a class="anchor" name="7.3.5-rep_ssl_hello_type"></a><a class="anchor" name="rep_ssl_hello_type (Using ACLs and fetching samples)"></a><a class="anchor" name="rep_ssl_hello_type (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="rep_ssl_hello_type"></a><a href="#7.3.5-rep_ssl_hello_type">rep_ssl_hello_type</a></b> : integer <span class="label label-warning">(deprecated)</span></div><pre class="text">Returns an integer value containing the type of the SSL hello message found
in the response buffer if the buffer contains data that parses as a complete
SSL (v3 or superior) hello message. Note that this only applies to raw
contents found in the response buffer and not to contents deciphered via an
SSL data layer, so this will not work with &quot;<a href="#server">server</a>&quot; lines having the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">ssl<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#ssl%20%28Bind%20options%29">Bind options</a></li><li><a href="#ssl%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;
option. This is mostly used in ACL to detect presence of an SSL hello message
that is supposed to contain an SSL session ID usable for stickiness.
</pre><a class="anchor" name="req.ssl_ver"></a><a class="anchor" name="7-req.ssl_ver"></a><a class="anchor" name="7.3.5-req.ssl_ver"></a><a class="anchor" name="req.ssl_ver (Using ACLs and fetching samples)"></a><a class="anchor" name="req.ssl_ver (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="req.ssl_ver"></a><a href="#7.3.5-req.ssl_ver">req.ssl_ver</a></b> : integer</div><a class="anchor" name="req_ssl_ver"></a><a class="anchor" name="7-req_ssl_ver"></a><a class="anchor" name="7.3.5-req_ssl_ver"></a><a class="anchor" name="req_ssl_ver (Using ACLs and fetching samples)"></a><a class="anchor" name="req_ssl_ver (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="req_ssl_ver"></a><a href="#7.3.5-req_ssl_ver">req_ssl_ver</a></b> : integer <span class="label label-warning">(deprecated)</span></div><pre class="text">Returns an integer value containing the version of the SSL/TLS protocol of a
stream present in the request buffer. Both SSLv2 hello messages and SSLv3
messages are supported. TLSv1 is announced as SSL version 3.1. The value is
composed of the major version multiplied by 65536, added to the minor
version. Note that this only applies to raw contents found in the request
buffer and not to contents deciphered via an SSL data layer, so this will not
work with &quot;<a href="#bind">bind</a>&quot; lines having the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">ssl<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#ssl%20%28Bind%20options%29">Bind options</a></li><li><a href="#ssl%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; option. The ACL version of the test
matches against a decimal notation in the form MAJOR.MINOR (eg: 3.1). This
fetch is mostly used in ACL.

ACL derivatives :
  req_ssl_ver : decimal match
</pre><a class="anchor" name="res.len"></a><a class="anchor" name="7-res.len"></a><a class="anchor" name="7.3.5-res.len"></a><a class="anchor" name="res.len (Using ACLs and fetching samples)"></a><a class="anchor" name="res.len (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="res.len"></a><a href="#7.3.5-res.len">res.len</a></b> : integer</div><pre class="text">Returns an integer value corresponding to the number of bytes present in the
response buffer. This is mostly used in ACL. It is important to understand
that this test does not return false as long as the buffer is changing. This
means that a check with equality to zero will almost always immediately match
at the beginning of the session, while a test for more data will wait for
that data to come in and return false only when haproxy is certain that no
more data will come in. This test was designed to be used with TCP response
content inspection.
</pre><a class="anchor" name="res.payload"></a><a class="anchor" name="7-res.payload"></a><a class="anchor" name="7.3.5-res.payload"></a><a class="anchor" name="res.payload (Using ACLs and fetching samples)"></a><a class="anchor" name="res.payload (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="res.payload"></a><a href="#7.3.5-res.payload">res.payload</a></b>(<span style="color: #080">&lt;offset&gt;</span>,<span style="color: #080">&lt;length&gt;</span>) : binary</div><pre class="text">This extracts a binary block of &lt;length&gt; bytes and starting at byte &lt;offset&gt;
in the response buffer. As a special case, if the &lt;length&gt; argument is zero,
the the whole buffer from &lt;offset&gt; to the end is extracted. This can be used
with ACLs in order to check for the presence of some content in a buffer at
any location.
</pre><a class="anchor" name="res.payload_lv"></a><a class="anchor" name="7-res.payload_lv"></a><a class="anchor" name="7.3.5-res.payload_lv"></a><a class="anchor" name="res.payload_lv (Using ACLs and fetching samples)"></a><a class="anchor" name="res.payload_lv (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="res.payload_lv"></a><a href="#7.3.5-res.payload_lv">res.payload_lv</a></b>(<span style="color: #080">&lt;offset1&gt;</span>,<span style="color: #080">&lt;length&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;offset2&gt;</span>]</span>) : binary</div><pre class="text">This extracts a binary block whose size is specified at &lt;offset1&gt; for &lt;length&gt;
bytes, and which starts at &lt;offset2&gt; if specified or just after the length in
the response buffer. The &lt;offset2&gt; parameter also supports relative offsets
if prepended with a '+' or '-' sign.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<div class="example-desc">please consult the example from the &quot;<a href="#stick%20store-response">stick store-response</a>&quot; keyword.</div><code></code></pre>
</div><a class="anchor" name="wait_end"></a><a class="anchor" name="7-wait_end"></a><a class="anchor" name="7.3.5-wait_end"></a><a class="anchor" name="wait_end (Using ACLs and fetching samples)"></a><a class="anchor" name="wait_end (Fetching samples from buffer contents (Layer 6))"></a><div class="keyword"><b><a class="anchor" name="wait_end"></a><a href="#7.3.5-wait_end">wait_end</a></b> : boolean</div><pre class="text">This fetch either returns true when the inspection period is over, or does
not fetch. It is only used in ACLs, in conjunction with content analysis to
avoid returning a wrong verdict early.  It may also be used to delay some
actions, such as a delayed reject for some special addresses. Since it either
stops the rules evaluation or immediately returns true, it is recommended to
use this acl as the last one in a rule.  Please note that the default ACL
&quot;WAIT_END&quot; is always usable without prior declaration. This test was designed
to be used with TCP request content inspection.
</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code><span class="comment"># delay every incoming request by 2 seconds</span>
tcp-request inspect-delay 2s
tcp-request content accept if WAIT_END

<span class="comment"># don't immediately tell bad guys they are rejected</span>
tcp-request inspect-delay 10s
acl goodguys src 10.0.0.0/24
acl badguys  src 10.0.1.0/24
tcp-request content accept if goodguys
tcp-request content reject if badguys WAIT_END
tcp-request content reject
</code></pre>
</div></div>
<a class="anchor" id="7.3.6" name="7.3.6"></a>
<h3 id="chapter-7.3.6" data-target="7.3.6"><small><a class="small" href="#7.3.6">7.3.6.</a></small> Fetching HTTP samples (Layer 7)</h3>
<div><pre class="text">It is possible to fetch samples from HTTP contents, requests and responses.
This application layer is also called layer 7. It is only possible to fetch the
data in this section when a full HTTP request or response has been parsed from
its respective request or response buffer. This is always the case with all
HTTP specific rules and for sections running with &quot;mode http&quot;. When using TCP
content inspection, it may be necessary to support an inspection delay in order
to let the request or response come in first. These fetches may require a bit
more CPU resources than the layer 4 ones, but not much since the request and
response are indexed.
</pre><a class="anchor" name="base"></a><a class="anchor" name="7-base"></a><a class="anchor" name="7.3.6-base"></a><a class="anchor" name="base (Using ACLs and fetching samples)"></a><a class="anchor" name="base (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="base"></a><a href="#7.3.6-base">base</a></b> : string</div><pre class="text">This returns the concatenation of the first Host header and the path part of
the request, which starts at the first slash and ends before the question
mark. It can be useful in virtual hosted environments to detect URL abuses as
well as to improve shared caches efficiency. Using this with a limited size
stick table also allows one to collect statistics about most commonly
requested objects by host/path. With ACLs it can allow simple content
switching rules involving the host and the path at the same time, such as
&quot;www.example.com/favicon.ico&quot;. See also &quot;<a href="#path">path</a>&quot; and &quot;uri&quot;.

ACL derivatives :
  base     : exact string match
  base_beg : prefix match
  base_dir : subdir match
  base_dom : domain match
  base_end : suffix match
  base_len : length match
  base_reg : regex match
  base_sub : substring match
</pre><a class="anchor" name="base32"></a><a class="anchor" name="7-base32"></a><a class="anchor" name="7.3.6-base32"></a><a class="anchor" name="base32 (Using ACLs and fetching samples)"></a><a class="anchor" name="base32 (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="base32"></a><a href="#7.3.6-base32">base32</a></b> : integer</div><pre class="text">  This returns a 32-bit hash of the value returned by the &quot;<a href="#base">base</a>&quot; fetch method
  above. This is useful to track per-URL activity on high traffic sites without
  having to store all URLs. Instead a shorter hash is stored, saving a lot of
  memory. The output type is an unsigned integer.

base32+src : binary
  This returns the concatenation of the base32 fetch above and the src fetch
  below. The resulting type is of type binary, with a size of 8 or 20 bytes
  depending on the source address family. This can be used to track per-IP,
  per-URL counters.
</pre><a class="anchor" name="capture.req.hdr"></a><a class="anchor" name="7-capture.req.hdr"></a><a class="anchor" name="7.3.6-capture.req.hdr"></a><a class="anchor" name="capture.req.hdr (Using ACLs and fetching samples)"></a><a class="anchor" name="capture.req.hdr (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="capture.req.hdr"></a><a href="#7.3.6-capture.req.hdr">capture.req.hdr</a></b>(<span style="color: #080">&lt;idx&gt;</span>) : string</div><pre class="text">This extracts the content of the header captured by the &quot;capture request
header&quot;, idx is the position of the capture keyword in the configuration.
</pre><div class="page-header"><b>See also:</b> &quot;<a href="#capture%20request%20header">capture request header</a>&quot;.</div>
<a class="anchor" name="capture.req.method"></a><a class="anchor" name="7-capture.req.method"></a><a class="anchor" name="7.3.6-capture.req.method"></a><a class="anchor" name="capture.req.method (Using ACLs and fetching samples)"></a><a class="anchor" name="capture.req.method (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="capture.req.method"></a><a href="#7.3.6-capture.req.method">capture.req.method</a></b> : string</div><pre class="text">This extracts the METHOD of an HTTP request. It can be used in both request
and response. Unlike &quot;<a href="#method">method</a>&quot;, it can be used in both request and response
because it's allocated.
</pre><a class="anchor" name="capture.req.uri"></a><a class="anchor" name="7-capture.req.uri"></a><a class="anchor" name="7.3.6-capture.req.uri"></a><a class="anchor" name="capture.req.uri (Using ACLs and fetching samples)"></a><a class="anchor" name="capture.req.uri (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="capture.req.uri"></a><a href="#7.3.6-capture.req.uri">capture.req.uri</a></b> : string</div><pre class="text">This extracts the request's URI, which starts at the first slash and ends
before the first space in the request (without the host part). Unlike &quot;<a href="#path">path</a>&quot;
and &quot;<a href="#url">url</a>&quot;, it can be used in both request and response because it's
allocated.
</pre><a class="anchor" name="capture.req.ver"></a><a class="anchor" name="7-capture.req.ver"></a><a class="anchor" name="7.3.6-capture.req.ver"></a><a class="anchor" name="capture.req.ver (Using ACLs and fetching samples)"></a><a class="anchor" name="capture.req.ver (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="capture.req.ver"></a><a href="#7.3.6-capture.req.ver">capture.req.ver</a></b> : string</div><pre class="text">This extracts the request's HTTP version and returns either &quot;HTTP/1.0&quot; or
&quot;HTTP/1.1&quot;. Unlike &quot;<a href="#req.ver">req.ver</a>&quot;, it can be used in both request, response, and
logs because it relies on a persistent flag.
</pre><a class="anchor" name="capture.res.hdr"></a><a class="anchor" name="7-capture.res.hdr"></a><a class="anchor" name="7.3.6-capture.res.hdr"></a><a class="anchor" name="capture.res.hdr (Using ACLs and fetching samples)"></a><a class="anchor" name="capture.res.hdr (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="capture.res.hdr"></a><a href="#7.3.6-capture.res.hdr">capture.res.hdr</a></b>(<span style="color: #080">&lt;idx&gt;</span>) : string</div><pre class="text">This extracts the content of the header captured by the &quot;capture response
header&quot;, idx is the position of the capture keyword in the configuration.
The first entry is an index of 0.
</pre><div class="page-header"><b>See also:</b> &quot;<a href="#capture%20response%20header">capture response header</a>&quot;</div>
<a class="anchor" name="capture.res.ver"></a><a class="anchor" name="7-capture.res.ver"></a><a class="anchor" name="7.3.6-capture.res.ver"></a><a class="anchor" name="capture.res.ver (Using ACLs and fetching samples)"></a><a class="anchor" name="capture.res.ver (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="capture.res.ver"></a><a href="#7.3.6-capture.res.ver">capture.res.ver</a></b> : string</div><pre class="text">This extracts the response's HTTP version and returns either &quot;HTTP/1.0&quot; or
&quot;HTTP/1.1&quot;. Unlike &quot;<a href="#res.ver">res.ver</a>&quot;, it can be used in logs because it relies on a
persistent flag.
</pre><a class="anchor" name="req.cook"></a><a class="anchor" name="7-req.cook"></a><a class="anchor" name="7.3.6-req.cook"></a><a class="anchor" name="req.cook (Using ACLs and fetching samples)"></a><a class="anchor" name="req.cook (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="req.cook"></a><a href="#7.3.6-req.cook">req.cook</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span>]</span>) : string</div><a class="anchor" name="cook"></a><a class="anchor" name="7-cook"></a><a class="anchor" name="7.3.6-cook"></a><a class="anchor" name="cook (Using ACLs and fetching samples)"></a><a class="anchor" name="cook (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="cook"></a><a href="#7.3.6-cook">cook</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span>]</span>) : string <span class="label label-warning">(deprecated)</span></div><pre class="text">This extracts the last occurrence of the cookie name &lt;name&gt; on a &quot;Cookie&quot;
header line from the request, and returns its value as string. If no name is
specified, the first cookie value is returned. When used with ACLs, all
matching cookies are evaluated. Spaces around the name and the value are
ignored as requested by the Cookie header specification (RFC6265). The cookie
name is case-sensitive. Empty cookies are valid, so an empty cookie may very
well return an empty value if it is present. Use the &quot;found&quot; match to detect
presence. Use the res.cook() variant for response cookies sent by the server.

ACL derivatives :
  cook([&lt;name&gt;])     : exact string match
  cook_beg([&lt;name&gt;]) : prefix match
  cook_dir([&lt;name&gt;]) : subdir match
  cook_dom([&lt;name&gt;]) : domain match
  cook_end([&lt;name&gt;]) : suffix match
  cook_len([&lt;name&gt;]) : length match
  cook_reg([&lt;name&gt;]) : regex match
  cook_sub([&lt;name&gt;]) : substring match
</pre><a class="anchor" name="req.cook_cnt"></a><a class="anchor" name="7-req.cook_cnt"></a><a class="anchor" name="7.3.6-req.cook_cnt"></a><a class="anchor" name="req.cook_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="req.cook_cnt (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="req.cook_cnt"></a><a href="#7.3.6-req.cook_cnt">req.cook_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span>]</span>) : integer</div><a class="anchor" name="cook_cnt"></a><a class="anchor" name="7-cook_cnt"></a><a class="anchor" name="7.3.6-cook_cnt"></a><a class="anchor" name="cook_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="cook_cnt (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="cook_cnt"></a><a href="#7.3.6-cook_cnt">cook_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span>]</span>) : integer <span class="label label-warning">(deprecated)</span></div><pre class="text">Returns an integer value representing the number of occurrences of the cookie
&lt;name&gt; in the request, or all cookies if &lt;name&gt; is not specified.
</pre><a class="anchor" name="req.cook_val"></a><a class="anchor" name="7-req.cook_val"></a><a class="anchor" name="7.3.6-req.cook_val"></a><a class="anchor" name="req.cook_val (Using ACLs and fetching samples)"></a><a class="anchor" name="req.cook_val (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="req.cook_val"></a><a href="#7.3.6-req.cook_val">req.cook_val</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span>]</span>) : integer</div><a class="anchor" name="cook_val"></a><a class="anchor" name="7-cook_val"></a><a class="anchor" name="7.3.6-cook_val"></a><a class="anchor" name="cook_val (Using ACLs and fetching samples)"></a><a class="anchor" name="cook_val (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="cook_val"></a><a href="#7.3.6-cook_val">cook_val</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span>]</span>) : integer <span class="label label-warning">(deprecated)</span></div><pre class="text">This extracts the last occurrence of the cookie name &lt;name&gt; on a &quot;Cookie&quot;
header line from the request, and converts its value to an integer which is
returned. If no name is specified, the first cookie value is returned. When
used in ACLs, all matching names are iterated over until a value matches.
</pre><a class="anchor" name="cookie"></a><a class="anchor" name="7-cookie"></a><a class="anchor" name="7.3.6-cookie"></a><a class="anchor" name="cookie (Using ACLs and fetching samples)"></a><a class="anchor" name="cookie (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="cookie"></a><a href="#7.3.6-cookie">cookie</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span>]</span>) : string <span class="label label-warning">(deprecated)</span></div><pre class="text">This extracts the last occurrence of the cookie name &lt;name&gt; on a &quot;Cookie&quot;
header line from the request, or a &quot;Set-Cookie&quot; header from the response, and
returns its value as a string. A typical use is to get multiple clients
sharing a same profile use the same server. This can be similar to what
&quot;<a href="#appsession">appsession</a>&quot; does with the &quot;request-learn&quot; statement, but with support for
multi-peer synchronization and state keeping across restarts. If no name is
specified, the first cookie value is returned. This fetch should not be used
anymore and should be replaced by req.cook() or res.cook() instead as it
ambiguously uses the direction based on the context where it is used.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#appsession">appsession</a>&quot;.</div>
<a class="anchor" name="hdr"></a><a class="anchor" name="7-hdr"></a><a class="anchor" name="7.3.6-hdr"></a><a class="anchor" name="hdr (Using ACLs and fetching samples)"></a><a class="anchor" name="hdr (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="hdr"></a><a href="#7.3.6-hdr">hdr</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;occ&gt;</span>]</span>]</span>) : string</div><pre class="text">This is equivalent to req.hdr() when used on requests, and to res.hdr() when
used on responses. Please refer to these respective fetches for more details.
In case of doubt about the fetch direction, please use the explicit ones.
Note that contrary to the hdr() sample fetch method, the hdr_* ACL keywords
unambiguously apply to the request headers.
</pre><a class="anchor" name="req.fhdr"></a><a class="anchor" name="7-req.fhdr"></a><a class="anchor" name="7.3.6-req.fhdr"></a><a class="anchor" name="req.fhdr (Using ACLs and fetching samples)"></a><a class="anchor" name="req.fhdr (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="req.fhdr"></a><a href="#7.3.6-req.fhdr">req.fhdr</a></b>(<span style="color: #080">&lt;name&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;occ&gt;</span>]</span>) : string</div><pre class="text">This extracts the last occurrence of header &lt;name&gt; in an HTTP request. When
used from an ACL, all occurrences are iterated over until a match is found.
Optionally, a specific occurrence might be specified as a position number.
Positive values indicate a position from the first occurrence, with 1 being
the first one. Negative values indicate positions relative to the last one,
with -1 being the last one. It differs from req.hdr() in that any commas
present in the value are returned and are not used as delimiters. This is
sometimes useful with headers such as User-Agent.
</pre><a class="anchor" name="req.fhdr_cnt"></a><a class="anchor" name="7-req.fhdr_cnt"></a><a class="anchor" name="7.3.6-req.fhdr_cnt"></a><a class="anchor" name="req.fhdr_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="req.fhdr_cnt (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="req.fhdr_cnt"></a><a href="#7.3.6-req.fhdr_cnt">req.fhdr_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span>]</span>) : integer</div><pre class="text">Returns an integer value representing the number of occurrences of request
header field name &lt;name&gt;, or the total number of header fields if &lt;name&gt; is
not specified. Contrary to its req.hdr_cnt() cousin, this function returns
the number of full line headers and does not stop on commas.
</pre><a class="anchor" name="req.hdr"></a><a class="anchor" name="7-req.hdr"></a><a class="anchor" name="7.3.6-req.hdr"></a><a class="anchor" name="req.hdr (Using ACLs and fetching samples)"></a><a class="anchor" name="req.hdr (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="req.hdr"></a><a href="#7.3.6-req.hdr">req.hdr</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;occ&gt;</span>]</span>]</span>) : string</div><pre class="text">This extracts the last occurrence of header &lt;name&gt; in an HTTP request. When
used from an ACL, all occurrences are iterated over until a match is found.
Optionally, a specific occurrence might be specified as a position number.
Positive values indicate a position from the first occurrence, with 1 being
the first one. Negative values indicate positions relative to the last one,
with -1 being the last one. A typical use is with the X-Forwarded-For header
once converted to IP, associated with an IP stick-table. The function
considers any comma as a delimiter for distinct values. If full-line headers
are desired instead, use req.fhdr(). Please carefully check RFC2616 to know
how certain headers are supposed to be parsed. Also, some of them are case
insensitive (eg: Connection).

ACL derivatives :
  hdr([&lt;name&gt;[,&lt;occ&gt;]])     : exact string match
  hdr_beg([&lt;name&gt;[,&lt;occ&gt;]]) : prefix match
  hdr_dir([&lt;name&gt;[,&lt;occ&gt;]]) : subdir match
  hdr_dom([&lt;name&gt;[,&lt;occ&gt;]]) : domain match
  hdr_end([&lt;name&gt;[,&lt;occ&gt;]]) : suffix match
  hdr_len([&lt;name&gt;[,&lt;occ&gt;]]) : length match
  hdr_reg([&lt;name&gt;[,&lt;occ&gt;]]) : regex match
  hdr_sub([&lt;name&gt;[,&lt;occ&gt;]]) : substring match
</pre><a class="anchor" name="req.hdr_cnt"></a><a class="anchor" name="7-req.hdr_cnt"></a><a class="anchor" name="7.3.6-req.hdr_cnt"></a><a class="anchor" name="req.hdr_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="req.hdr_cnt (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="req.hdr_cnt"></a><a href="#7.3.6-req.hdr_cnt">req.hdr_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span>]</span>) : integer</div><a class="anchor" name="hdr_cnt"></a><a class="anchor" name="7-hdr_cnt"></a><a class="anchor" name="7.3.6-hdr_cnt"></a><a class="anchor" name="hdr_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="hdr_cnt (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="hdr_cnt"></a><a href="#7.3.6-hdr_cnt">hdr_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;header&gt;</span>]</span>) : integer <span class="label label-warning">(deprecated)</span></div><pre class="text">Returns an integer value representing the number of occurrences of request
header field name &lt;name&gt;, or the total number of header field values if
&lt;name&gt; is not specified. It is important to remember that one header line may
count as several headers if it has several values. The function considers any
comma as a delimiter for distinct values. If full-line headers are desired
instead, req.fhdr_cnt() should be used instead. With ACLs, it can be used to
detect presence, absence or abuse of a specific header, as well as to block
request smuggling attacks by rejecting requests which contain more than one
of certain headers. See &quot;<a href="#req.hdr">req.hdr</a>&quot; for more information on header matching.
</pre><a class="anchor" name="req.hdr_ip"></a><a class="anchor" name="7-req.hdr_ip"></a><a class="anchor" name="7.3.6-req.hdr_ip"></a><a class="anchor" name="req.hdr_ip (Using ACLs and fetching samples)"></a><a class="anchor" name="req.hdr_ip (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="req.hdr_ip"></a><a href="#7.3.6-req.hdr_ip">req.hdr_ip</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;occ&gt;</span>]</span>]</span>) : ip</div><a class="anchor" name="hdr_ip"></a><a class="anchor" name="7-hdr_ip"></a><a class="anchor" name="7.3.6-hdr_ip"></a><a class="anchor" name="hdr_ip (Using ACLs and fetching samples)"></a><a class="anchor" name="hdr_ip (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="hdr_ip"></a><a href="#7.3.6-hdr_ip">hdr_ip</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;occ&gt;</span>]</span>]</span>) : ip <span class="label label-warning">(deprecated)</span></div><pre class="text">This extracts the last occurrence of header &lt;name&gt; in an HTTP request,
converts it to an IPv4 or IPv6 address and returns this address. When used
with ACLs, all occurrences are checked, and if &lt;name&gt; is omitted, every value
of every header is checked. Optionally, a specific occurrence might be
specified as a position number. Positive values indicate a position from the
first occurrence, with 1 being the first one.  Negative values indicate
positions relative to the last one, with -1 being the last one. A typical use
is with the X-Forwarded-For and X-Client-IP headers.
</pre><a class="anchor" name="req.hdr_val"></a><a class="anchor" name="7-req.hdr_val"></a><a class="anchor" name="7.3.6-req.hdr_val"></a><a class="anchor" name="req.hdr_val (Using ACLs and fetching samples)"></a><a class="anchor" name="req.hdr_val (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="req.hdr_val"></a><a href="#7.3.6-req.hdr_val">req.hdr_val</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;occ&gt;</span>]</span>]</span>) : integer</div><a class="anchor" name="hdr_val"></a><a class="anchor" name="7-hdr_val"></a><a class="anchor" name="7.3.6-hdr_val"></a><a class="anchor" name="hdr_val (Using ACLs and fetching samples)"></a><a class="anchor" name="hdr_val (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="hdr_val"></a><a href="#7.3.6-hdr_val">hdr_val</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;occ&gt;</span>]</span>]</span>) : integer <span class="label label-warning">(deprecated)</span></div><pre class="text">This extracts the last occurrence of header &lt;name&gt; in an HTTP request, and
converts it to an integer value. When used with ACLs, all occurrences are
checked, and if &lt;name&gt; is omitted, every value of every header is checked.
Optionally, a specific occurrence might be specified as a position number.
Positive values indicate a position from the first occurrence, with 1 being
the first one. Negative values indicate positions relative to the last one,
with -1 being the last one. A typical use is with the X-Forwarded-For header.
</pre><a class="anchor" name="http_auth"></a><a class="anchor" name="7-http_auth"></a><a class="anchor" name="7.3.6-http_auth"></a><a class="anchor" name="http_auth (Using ACLs and fetching samples)"></a><a class="anchor" name="http_auth (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="http_auth"></a><a href="#7.3.6-http_auth">http_auth</a></b>(<span style="color: #080">&lt;userlist&gt;</span>) : boolean</div><pre class="text">Returns a boolean indicating whether the authentication data received from
the client match a username &amp; password stored in the specified userlist. This
fetch function is not really useful outside of ACLs. Currently only http
basic auth is supported.
</pre><a class="anchor" name="http_auth_group"></a><a class="anchor" name="7-http_auth_group"></a><a class="anchor" name="7.3.6-http_auth_group"></a><a class="anchor" name="http_auth_group (Using ACLs and fetching samples)"></a><a class="anchor" name="http_auth_group (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="http_auth_group"></a><a href="#7.3.6-http_auth_group">http_auth_group</a></b>(<span style="color: #080">&lt;userlist&gt;</span>) : string</div><pre class="text">Returns a string corresponding to the user name found in the authentication
data received from the client if both the user name and password are valid
according to the specified userlist. The main purpose is to use it in ACLs
where it is then checked whether the user belongs to any group within a list.
This fetch function is not really useful outside of ACLs. Currently only http
basic auth is supported.

ACL derivatives :
  http_auth_group(&lt;userlist&gt;) : group ...
  Returns true when the user extracted from the request and whose password is
  valid according to the specified userlist belongs to at least one of the
  groups.
</pre><a class="anchor" name="http_first_req"></a><a class="anchor" name="7-http_first_req"></a><a class="anchor" name="7.3.6-http_first_req"></a><a class="anchor" name="http_first_req (Using ACLs and fetching samples)"></a><a class="anchor" name="http_first_req (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="http_first_req"></a><a href="#7.3.6-http_first_req">http_first_req</a></b> : boolean</div><pre class="text">Returns true when the request being processed is the first one of the
connection. This can be used to add or remove headers that may be missing
from some requests when a request is not the first one, or to help grouping
requests in the logs.
</pre><a class="anchor" name="method"></a><a class="anchor" name="7-method"></a><a class="anchor" name="7.3.6-method"></a><a class="anchor" name="method (Using ACLs and fetching samples)"></a><a class="anchor" name="method (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="method"></a><a href="#7.3.6-method">method</a></b> : integer + string</div><pre class="text">Returns an integer value corresponding to the method in the HTTP request. For
example, &quot;GET&quot; equals 1 (check sources to establish the matching). Value 9
means &quot;other method&quot; and may be converted to a string extracted from the
stream. This should not be used directly as a sample, this is only meant to
be used from ACLs, which transparently convert methods from patterns to these
integer + string values. Some predefined ACL already check for most common
methods.

ACL derivatives :
  method : case insensitive method match
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># only accept GET and HEAD requests</span>
acl valid_method method GET HEAD
http-request deny if ! valid_method
</code></pre>
</div><a class="anchor" name="path"></a><a class="anchor" name="7-path"></a><a class="anchor" name="7.3.6-path"></a><a class="anchor" name="path (Using ACLs and fetching samples)"></a><a class="anchor" name="path (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="path"></a><a href="#7.3.6-path">path</a></b> : string</div><pre class="text">This extracts the request's URL path, which starts at the first slash and
ends before the question mark (without the host part). A typical use is with
prefetch-capable caches, and with portals which need to aggregate multiple
information from databases and keep them in caches. Note that with outgoing
caches, it would be wiser to use &quot;<a href="#url">url</a>&quot; instead. With ACLs, it's typically
used to match exact file names (eg: &quot;/login.php&quot;), or directory parts using
the derivative forms. See also the &quot;<a href="#url">url</a>&quot; and &quot;<a href="#base">base</a>&quot; fetch methods.

ACL derivatives :
  path     : exact string match
  path_beg : prefix match
  path_dir : subdir match
  path_dom : domain match
  path_end : suffix match
  path_len : length match
  path_reg : regex match
  path_sub : substring match
</pre><a class="anchor" name="req.ver"></a><a class="anchor" name="7-req.ver"></a><a class="anchor" name="7.3.6-req.ver"></a><a class="anchor" name="req.ver (Using ACLs and fetching samples)"></a><a class="anchor" name="req.ver (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="req.ver"></a><a href="#7.3.6-req.ver">req.ver</a></b> : string</div><a class="anchor" name="req_ver"></a><a class="anchor" name="7-req_ver"></a><a class="anchor" name="7.3.6-req_ver"></a><a class="anchor" name="req_ver (Using ACLs and fetching samples)"></a><a class="anchor" name="req_ver (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="req_ver"></a><a href="#7.3.6-req_ver">req_ver</a></b> : string <span class="label label-warning">(deprecated)</span></div><pre class="text">Returns the version string from the HTTP request, for example &quot;1.1&quot;. This can
be useful for logs, but is mostly there for ACL. Some predefined ACL already
check for versions 1.0 and 1.1.

ACL derivatives :
  req_ver : exact string match
</pre><a class="anchor" name="res.comp"></a><a class="anchor" name="7-res.comp"></a><a class="anchor" name="7.3.6-res.comp"></a><a class="anchor" name="res.comp (Using ACLs and fetching samples)"></a><a class="anchor" name="res.comp (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="res.comp"></a><a href="#7.3.6-res.comp">res.comp</a></b> : boolean</div><pre class="text">Returns the boolean &quot;true&quot; value if the response has been compressed by
HAProxy, otherwise returns boolean &quot;false&quot;. This may be used to add
information in the logs.
</pre><a class="anchor" name="res.comp_algo"></a><a class="anchor" name="7-res.comp_algo"></a><a class="anchor" name="7.3.6-res.comp_algo"></a><a class="anchor" name="res.comp_algo (Using ACLs and fetching samples)"></a><a class="anchor" name="res.comp_algo (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="res.comp_algo"></a><a href="#7.3.6-res.comp_algo">res.comp_algo</a></b> : string</div><pre class="text">Returns a string containing the name of the algorithm used if the response
was compressed by HAProxy, for example : &quot;deflate&quot;. This may be used to add
some information in the logs.
</pre><a class="anchor" name="res.cook"></a><a class="anchor" name="7-res.cook"></a><a class="anchor" name="7.3.6-res.cook"></a><a class="anchor" name="res.cook (Using ACLs and fetching samples)"></a><a class="anchor" name="res.cook (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="res.cook"></a><a href="#7.3.6-res.cook">res.cook</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span>]</span>) : string</div><a class="anchor" name="scook"></a><a class="anchor" name="7-scook"></a><a class="anchor" name="7.3.6-scook"></a><a class="anchor" name="scook (Using ACLs and fetching samples)"></a><a class="anchor" name="scook (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="scook"></a><a href="#7.3.6-scook">scook</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span>]</span>) : string <span class="label label-warning">(deprecated)</span></div><pre class="text">This extracts the last occurrence of the cookie name &lt;name&gt; on a &quot;Set-Cookie&quot;
header line from the response, and returns its value as string. If no name is
specified, the first cookie value is returned.

ACL derivatives :
  scook([&lt;name&gt;] : exact string match
</pre><a class="anchor" name="res.cook_cnt"></a><a class="anchor" name="7-res.cook_cnt"></a><a class="anchor" name="7.3.6-res.cook_cnt"></a><a class="anchor" name="res.cook_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="res.cook_cnt (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="res.cook_cnt"></a><a href="#7.3.6-res.cook_cnt">res.cook_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span>]</span>) : integer</div><a class="anchor" name="scook_cnt"></a><a class="anchor" name="7-scook_cnt"></a><a class="anchor" name="7.3.6-scook_cnt"></a><a class="anchor" name="scook_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="scook_cnt (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="scook_cnt"></a><a href="#7.3.6-scook_cnt">scook_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span>]</span>) : integer <span class="label label-warning">(deprecated)</span></div><pre class="text">Returns an integer value representing the number of occurrences of the cookie
&lt;name&gt; in the response, or all cookies if &lt;name&gt; is not specified. This is
mostly useful when combined with ACLs to detect suspicious responses.
</pre><a class="anchor" name="res.cook_val"></a><a class="anchor" name="7-res.cook_val"></a><a class="anchor" name="7.3.6-res.cook_val"></a><a class="anchor" name="res.cook_val (Using ACLs and fetching samples)"></a><a class="anchor" name="res.cook_val (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="res.cook_val"></a><a href="#7.3.6-res.cook_val">res.cook_val</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span>]</span>) : integer</div><a class="anchor" name="scook_val"></a><a class="anchor" name="7-scook_val"></a><a class="anchor" name="7.3.6-scook_val"></a><a class="anchor" name="scook_val (Using ACLs and fetching samples)"></a><a class="anchor" name="scook_val (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="scook_val"></a><a href="#7.3.6-scook_val">scook_val</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span>]</span>) : integer <span class="label label-warning">(deprecated)</span></div><pre class="text">This extracts the last occurrence of the cookie name &lt;name&gt; on a &quot;Set-Cookie&quot;
header line from the response, and converts its value to an integer which is
returned. If no name is specified, the first cookie value is returned.
</pre><a class="anchor" name="res.fhdr"></a><a class="anchor" name="7-res.fhdr"></a><a class="anchor" name="7.3.6-res.fhdr"></a><a class="anchor" name="res.fhdr (Using ACLs and fetching samples)"></a><a class="anchor" name="res.fhdr (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="res.fhdr"></a><a href="#7.3.6-res.fhdr">res.fhdr</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;occ&gt;</span>]</span>]</span>) : string</div><pre class="text">This extracts the last occurrence of header &lt;name&gt; in an HTTP response, or of
the last header if no &lt;name&gt; is specified. Optionally, a specific occurrence
might be specified as a position number. Positive values indicate a position
from the first occurrence, with 1 being the first one. Negative values
indicate positions relative to the last one, with -1 being the last one. It
differs from res.hdr() in that any commas present in the value are returned
and are not used as delimiters. If this is not desired, the res.hdr() fetch
should be used instead. This is sometimes useful with headers such as Date or
Expires.
</pre><a class="anchor" name="res.fhdr_cnt"></a><a class="anchor" name="7-res.fhdr_cnt"></a><a class="anchor" name="7.3.6-res.fhdr_cnt"></a><a class="anchor" name="res.fhdr_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="res.fhdr_cnt (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="res.fhdr_cnt"></a><a href="#7.3.6-res.fhdr_cnt">res.fhdr_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span>]</span>) : integer</div><pre class="text">Returns an integer value representing the number of occurrences of response
header field name &lt;name&gt;, or the total number of header fields if &lt;name&gt; is
not specified. Contrary to its res.hdr_cnt() cousin, this function returns
the number of full line headers and does not stop on commas. If this is not
desired, the res.hdr_cnt() fetch should be used instead.
</pre><a class="anchor" name="res.hdr"></a><a class="anchor" name="7-res.hdr"></a><a class="anchor" name="7.3.6-res.hdr"></a><a class="anchor" name="res.hdr (Using ACLs and fetching samples)"></a><a class="anchor" name="res.hdr (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="res.hdr"></a><a href="#7.3.6-res.hdr">res.hdr</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;occ&gt;</span>]</span>]</span>) : string</div><a class="anchor" name="shdr"></a><a class="anchor" name="7-shdr"></a><a class="anchor" name="7.3.6-shdr"></a><a class="anchor" name="shdr (Using ACLs and fetching samples)"></a><a class="anchor" name="shdr (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="shdr"></a><a href="#7.3.6-shdr">shdr</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;occ&gt;</span>]</span>]</span>) : string <span class="label label-warning">(deprecated)</span></div><pre class="text">This extracts the last occurrence of header &lt;name&gt; in an HTTP response, or of
the last header if no &lt;name&gt; is specified. Optionally, a specific occurrence
might be specified as a position number. Positive values indicate a position
from the first occurrence, with 1 being the first one. Negative values
indicate positions relative to the last one, with -1 being the last one. This
can be useful to learn some data into a stick-table. The function considers
any comma as a delimiter for distinct values. If this is not desired, the
res.fhdr() fetch should be used instead.

ACL derivatives :
  shdr([&lt;name&gt;[,&lt;occ&gt;]])     : exact string match
  shdr_beg([&lt;name&gt;[,&lt;occ&gt;]]) : prefix match
  shdr_dir([&lt;name&gt;[,&lt;occ&gt;]]) : subdir match
  shdr_dom([&lt;name&gt;[,&lt;occ&gt;]]) : domain match
  shdr_end([&lt;name&gt;[,&lt;occ&gt;]]) : suffix match
  shdr_len([&lt;name&gt;[,&lt;occ&gt;]]) : length match
  shdr_reg([&lt;name&gt;[,&lt;occ&gt;]]) : regex match
  shdr_sub([&lt;name&gt;[,&lt;occ&gt;]]) : substring match
</pre><a class="anchor" name="res.hdr_cnt"></a><a class="anchor" name="7-res.hdr_cnt"></a><a class="anchor" name="7.3.6-res.hdr_cnt"></a><a class="anchor" name="res.hdr_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="res.hdr_cnt (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="res.hdr_cnt"></a><a href="#7.3.6-res.hdr_cnt">res.hdr_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span>]</span>) : integer</div><a class="anchor" name="shdr_cnt"></a><a class="anchor" name="7-shdr_cnt"></a><a class="anchor" name="7.3.6-shdr_cnt"></a><a class="anchor" name="shdr_cnt (Using ACLs and fetching samples)"></a><a class="anchor" name="shdr_cnt (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="shdr_cnt"></a><a href="#7.3.6-shdr_cnt">shdr_cnt</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span>]</span>) : integer <span class="label label-warning">(deprecated)</span></div><pre class="text">Returns an integer value representing the number of occurrences of response
header field name &lt;name&gt;, or the total number of header fields if &lt;name&gt; is
not specified. The function considers any comma as a delimiter for distinct
values. If this is not desired, the res.fhdr_cnt() fetch should be used
instead.
</pre><a class="anchor" name="res.hdr_ip"></a><a class="anchor" name="7-res.hdr_ip"></a><a class="anchor" name="7.3.6-res.hdr_ip"></a><a class="anchor" name="res.hdr_ip (Using ACLs and fetching samples)"></a><a class="anchor" name="res.hdr_ip (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="res.hdr_ip"></a><a href="#7.3.6-res.hdr_ip">res.hdr_ip</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;occ&gt;</span>]</span>]</span>) : ip</div><a class="anchor" name="shdr_ip"></a><a class="anchor" name="7-shdr_ip"></a><a class="anchor" name="7.3.6-shdr_ip"></a><a class="anchor" name="shdr_ip (Using ACLs and fetching samples)"></a><a class="anchor" name="shdr_ip (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="shdr_ip"></a><a href="#7.3.6-shdr_ip">shdr_ip</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;occ&gt;</span>]</span>]</span>) : ip <span class="label label-warning">(deprecated)</span></div><pre class="text">This extracts the last occurrence of header &lt;name&gt; in an HTTP response,
convert it to an IPv4 or IPv6 address and returns this address. Optionally, a
specific occurrence might be specified as a position number. Positive values
indicate a position from the first occurrence, with 1 being the first one.
Negative values indicate positions relative to the last one, with -1 being
the last one. This can be useful to learn some data into a stick table.
</pre><a class="anchor" name="res.hdr_val"></a><a class="anchor" name="7-res.hdr_val"></a><a class="anchor" name="7.3.6-res.hdr_val"></a><a class="anchor" name="res.hdr_val (Using ACLs and fetching samples)"></a><a class="anchor" name="res.hdr_val (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="res.hdr_val"></a><a href="#7.3.6-res.hdr_val">res.hdr_val</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;occ&gt;</span>]</span>]</span>) : integer</div><a class="anchor" name="shdr_val"></a><a class="anchor" name="7-shdr_val"></a><a class="anchor" name="7.3.6-shdr_val"></a><a class="anchor" name="shdr_val (Using ACLs and fetching samples)"></a><a class="anchor" name="shdr_val (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="shdr_val"></a><a href="#7.3.6-shdr_val">shdr_val</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;occ&gt;</span>]</span>]</span>) : integer <span class="label label-warning">(deprecated)</span></div><pre class="text">This extracts the last occurrence of header &lt;name&gt; in an HTTP response, and
converts it to an integer value. Optionally, a specific occurrence might be
specified as a position number. Positive values indicate a position from the
first occurrence, with 1 being the first one. Negative values indicate
positions relative to the last one, with -1 being the last one. This can be
useful to learn some data into a stick table.
</pre><a class="anchor" name="res.ver"></a><a class="anchor" name="7-res.ver"></a><a class="anchor" name="7.3.6-res.ver"></a><a class="anchor" name="res.ver (Using ACLs and fetching samples)"></a><a class="anchor" name="res.ver (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="res.ver"></a><a href="#7.3.6-res.ver">res.ver</a></b> : string</div><a class="anchor" name="resp_ver"></a><a class="anchor" name="7-resp_ver"></a><a class="anchor" name="7.3.6-resp_ver"></a><a class="anchor" name="resp_ver (Using ACLs and fetching samples)"></a><a class="anchor" name="resp_ver (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="resp_ver"></a><a href="#7.3.6-resp_ver">resp_ver</a></b> : string <span class="label label-warning">(deprecated)</span></div><pre class="text">Returns the version string from the HTTP response, for example &quot;1.1&quot;. This
can be useful for logs, but is mostly there for ACL.

ACL derivatives :
  resp_ver : exact string match
</pre><a class="anchor" name="set-cookie"></a><a class="anchor" name="7-set-cookie"></a><a class="anchor" name="7.3.6-set-cookie"></a><a class="anchor" name="set-cookie (Using ACLs and fetching samples)"></a><a class="anchor" name="set-cookie (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="set-cookie"></a><a href="#7.3.6-set-cookie">set-cookie</a></b>(<span style="color: #008">[<span style="color: #080">&lt;name&gt;</span>]</span>) : string <span class="label label-warning">(deprecated)</span></div><pre class="text">This extracts the last occurrence of the cookie name &lt;name&gt; on a &quot;Set-Cookie&quot;
header line from the response and uses the corresponding value to match. This
can be comparable to what &quot;<a href="#appsession">appsession</a>&quot; does with default options, but with
support for multi-peer synchronization and state keeping across restarts.

This fetch function is deprecated and has been superseded by the &quot;<a href="#res.cook">res.cook</a>&quot;
fetch. This keyword will disappear soon.
</pre><div class="page-header"><b>See also :</b> &quot;<a href="#appsession">appsession</a>&quot;</div>
<a class="anchor" name="status"></a><a class="anchor" name="7-status"></a><a class="anchor" name="7.3.6-status"></a><a class="anchor" name="status (Using ACLs and fetching samples)"></a><a class="anchor" name="status (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="status"></a><a href="#7.3.6-status">status</a></b> : integer</div><pre class="text">Returns an integer containing the HTTP status code in the HTTP response, for
example, 302. It is mostly used within ACLs and integer ranges, for example,
to remove any Location header if the response is not a 3xx.
</pre><a class="anchor" name="url"></a><a class="anchor" name="7-url"></a><a class="anchor" name="7.3.6-url"></a><a class="anchor" name="url (Using ACLs and fetching samples)"></a><a class="anchor" name="url (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="url"></a><a href="#7.3.6-url">url</a></b> : string</div><pre class="text">This extracts the request's URL as presented in the request. A typical use is
with prefetch-capable caches, and with portals which need to aggregate
multiple information from databases and keep them in caches. With ACLs, using
&quot;<a href="#path">path</a>&quot; is preferred over using &quot;<a href="#url">url</a>&quot;, because clients may send a full URL as
is normally done with proxies. The only real use is to match &quot;*&quot; which does
not match in &quot;<a href="#path">path</a>&quot;, and for which there is already a predefined ACL. See
also &quot;<a href="#path">path</a>&quot; and &quot;<a href="#base">base</a>&quot;.

ACL derivatives :
  url     : exact string match
  url_beg : prefix match
  url_dir : subdir match
  url_dom : domain match
  url_end : suffix match
  url_len : length match
  url_reg : regex match
  url_sub : substring match
</pre><a class="anchor" name="url_ip"></a><a class="anchor" name="7-url_ip"></a><a class="anchor" name="7.3.6-url_ip"></a><a class="anchor" name="url_ip (Using ACLs and fetching samples)"></a><a class="anchor" name="url_ip (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="url_ip"></a><a href="#7.3.6-url_ip">url_ip</a></b> : ip</div><pre class="text">This extracts the IP address from the request's URL when the host part is
presented as an IP address. Its use is very limited. For instance, a
monitoring system might use this field as an alternative for the source IP in
order to test what path a given source address would follow, or to force an
entry in a table for a given source address. With ACLs it can be used to
restrict access to certain systems through a proxy, for example when combined
with option &quot;<a href="#option%20http_proxy">http_proxy</a>&quot;.
</pre><a class="anchor" name="url_port"></a><a class="anchor" name="7-url_port"></a><a class="anchor" name="7.3.6-url_port"></a><a class="anchor" name="url_port (Using ACLs and fetching samples)"></a><a class="anchor" name="url_port (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="url_port"></a><a href="#7.3.6-url_port">url_port</a></b> : integer</div><pre class="text">This extracts the port part from the request's URL. Note that if the port is
not specified in the request, port 80 is assumed. With ACLs it can be used to
restrict access to certain systems through a proxy, for example when combined
with option &quot;<a href="#option%20http_proxy">http_proxy</a>&quot;.
</pre><a class="anchor" name="urlp"></a><a class="anchor" name="7-urlp"></a><a class="anchor" name="7.3.6-urlp"></a><a class="anchor" name="urlp (Using ACLs and fetching samples)"></a><a class="anchor" name="urlp (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="urlp"></a><a href="#7.3.6-urlp">urlp</a></b>(<span style="color: #080">&lt;name&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;delim&gt;</span>]</span>) : string</div><a class="anchor" name="url_param"></a><a class="anchor" name="7-url_param"></a><a class="anchor" name="7.3.6-url_param"></a><a class="anchor" name="url_param (Using ACLs and fetching samples)"></a><a class="anchor" name="url_param (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="url_param"></a><a href="#7.3.6-url_param">url_param</a></b>(<span style="color: #080">&lt;name&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;delim&gt;</span>]</span>) : string</div><pre class="text">This extracts the first occurrence of the parameter &lt;name&gt; in the query
string, which begins after either '?' or &lt;delim&gt;, and which ends before '&amp;',
';' or &lt;delim&gt;. The parameter name is case-sensitive. The result is a string
corresponding to the value of the parameter &lt;name&gt; as presented in the
request (no URL decoding is performed). This can be used for session
stickiness based on a client ID, to extract an application cookie passed as a
URL parameter, or in ACLs to apply some checks. Note that the ACL version of
this fetch do not iterate over multiple parameters and stop at the first one
as well.

ACL derivatives :
  urlp(&lt;name&gt;[,&lt;delim&gt;])     : exact string match
  urlp_beg(&lt;name&gt;[,&lt;delim&gt;]) : prefix match
  urlp_dir(&lt;name&gt;[,&lt;delim&gt;]) : subdir match
  urlp_dom(&lt;name&gt;[,&lt;delim&gt;]) : domain match
  urlp_end(&lt;name&gt;[,&lt;delim&gt;]) : suffix match
  urlp_len(&lt;name&gt;[,&lt;delim&gt;]) : length match
  urlp_reg(&lt;name&gt;[,&lt;delim&gt;]) : regex match
  urlp_sub(&lt;name&gt;[,&lt;delim&gt;]) : substring match
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code><span class="comment"># match http://example.com/foo?PHPSESSIONID=some_id</span>
stick on urlp(PHPSESSIONID)
<span class="comment"># match http://example.com/foo;JSESSIONID=some_id</span>
stick on urlp(JSESSIONID,;)
</code></pre>
</div><a class="anchor" name="urlp_val"></a><a class="anchor" name="7-urlp_val"></a><a class="anchor" name="7.3.6-urlp_val"></a><a class="anchor" name="urlp_val (Using ACLs and fetching samples)"></a><a class="anchor" name="urlp_val (Fetching HTTP samples (Layer 7))"></a><div class="keyword"><b><a class="anchor" name="urlp_val"></a><a href="#7.3.6-urlp_val">urlp_val</a></b>(<span style="color: #080">&lt;name&gt;</span><span style="color: #008">[,<span style="color: #080">&lt;delim&gt;</span>]</span>) : integer</div><pre class="text">See &quot;<a href="#urlp">urlp</a>&quot; above. This one extracts the URL parameter &lt;name&gt; in the request
and converts it to an integer value. This can be used for session stickiness
based on a user ID for example, or with ACLs to match a page number or price.
</pre></div>
<a class="anchor" id="7.4" name="7.4"></a>
<h2 id="chapter-7.4" data-target="7.4"><small><a class="small" href="#7.4">7.4.</a></small> Pre-defined ACLs</h2>
<div><pre class="text">Some predefined ACLs are hard-coded so that they do not have to be declared in
every frontend which needs them. They all have their names in upper case in
order to avoid confusion. Their equivalence is provided below.
</pre><table class="table table-bordered" border="0" cellspacing="0" cellpadding="0">
<thead><tr><th>ACL name</th><th>Equivalent to</th><th>Usage</th></tr></thead>
<tr><td None>FALSE</td><td None>always_false</td><td None>never match</td></tr>
<tr><td None>HTTP</td><td None>req_proto_http</td><td None>match if protocol is valid HTTP</td></tr>
<tr><td None>HTTP_1.0</td><td None>req_ver 1.0</td><td None>match HTTP version 1.0</td></tr>
<tr><td None>HTTP_1.1</td><td None>req_ver 1.1</td><td None>match HTTP version 1.1</td></tr>
<tr><td None>HTTP_CONTENT</td><td None>hdr_val(content-length) gt 0</td><td None>match an existing content-length</td></tr>
<tr><td None>HTTP_URL_ABS</td><td None>url_reg ^[^/:]*://</td><td None>match absolute URL with scheme</td></tr>
<tr><td None>HTTP_URL_SLASH</td><td None>url_beg /</td><td None>match URL beginning with &quot;/&quot;</td></tr>
<tr><td None>HTTP_URL_STAR</td><td None>url     *</td><td None>match URL equal to &quot;*&quot;</td></tr>
<tr><td None>LOCALHOST</td><td None>src 127.0.0.1/8</td><td None>match connection from local host</td></tr>
<tr><td None>METH_CONNECT</td><td None>method  CONNECT</td><td None>match HTTP CONNECT method</td></tr>
<tr><td None>METH_GET</td><td None>method  GET HEAD</td><td None>match HTTP GET or HEAD method</td></tr>
<tr><td None>METH_HEAD</td><td None>method  HEAD</td><td None>match HTTP HEAD method</td></tr>
<tr><td None>METH_OPTIONS</td><td None>method  OPTIONS</td><td None>match HTTP OPTIONS method</td></tr>
<tr><td None>METH_POST</td><td None>method  POST</td><td None>match HTTP POST method</td></tr>
<tr><td None>METH_TRACE</td><td None>method  TRACE</td><td None>match HTTP TRACE method</td></tr>
<tr><td None>RDP_COOKIE</td><td None>req_rdp_cookie_cnt gt 0</td><td None>match presence of an RDP cookie</td></tr>
<tr><td None>REQ_CONTENT</td><td None>req_len gt 0</td><td None>match data in the request buffer</td></tr>
<tr><td None>TRUE</td><td None>always_true</td><td None>always match</td></tr>
<tr><td None>WAIT_END</td><td None>wait_end</td><td None>wait for end of content analysis</td></tr>
</table></div>
<a class="anchor" id="8" name="8"></a>
<div class="page-header"><h1 id="chapter-8" data-target="8"><small><a class="small" href="#8">8.</a></small> Logging</h1>
</div><div><pre class="text">One of HAProxy's strong points certainly lies is its precise logs. It probably
provides the finest level of information available for such a product, which is
very important for troubleshooting complex environments. Standard information
provided in logs include client ports, TCP/HTTP state timers, precise session
state at termination and precise termination cause, information about decisions
to direct traffic to a server, and of course the ability to capture arbitrary
headers.

In order to improve administrators reactivity, it offers a great transparency
about encountered problems, both internal and external, and it is possible to
send logs to different sources at the same time with different level filters :

  - global process-level logs (system errors, start/stop, etc..)
  - per-instance system and internal errors (lack of resource, bugs, ...)
  - per-instance external troubles (servers up/down, max connections)
  - per-instance activity (client connections), either at the establishment or
    at the termination.

The ability to distribute different levels of logs to different log servers
allow several production teams to interact and to fix their problems as soon
as possible. For example, the system team might monitor system-wide errors,
while the application team might be monitoring the up/down for their servers in
real time, and the security team might analyze the activity logs with one hour
delay.
</pre></div>
<a class="anchor" id="8.1" name="8.1"></a>
<h2 id="chapter-8.1" data-target="8.1"><small><a class="small" href="#8.1">8.1.</a></small> Log levels</h2>
<div><pre class="text">TCP and HTTP connections can be logged with information such as the date, time,
source IP address, destination address, connection duration, response times,
HTTP request, HTTP return code, number of bytes transmitted, conditions
in which the session ended, and even exchanged cookies values. For example
track a particular user's problems. All messages may be sent to up to two
syslog servers. Check the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">log<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#log%20%28Process%20management%20and%20security%29">Process management and security</a></li><li><a href="#log%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li></ul></span>&quot; keyword in <a href="#4.2">section 4.2</a> for more information
about log facilities.
</pre></div>
<a class="anchor" id="8.2" name="8.2"></a>
<h2 id="chapter-8.2" data-target="8.2"><small><a class="small" href="#8.2">8.2.</a></small> Log formats</h2>
<div><pre class="text">HAProxy supports 5 log formats. Several fields are common between these formats
and will be detailed in the following sections. A few of them may vary
slightly with the configuration, due to indicators specific to certain
options. The supported formats are as follows :

  - the default format, which is very basic and very rarely used. It only
    provides very basic information about the incoming connection at the moment
    it is accepted : source IP:port, destination IP:port, and frontend-name.
    This mode will eventually disappear so it will not be described to great
    extents.

  - the TCP format, which is more advanced. This format is enabled when &quot;option
    tcplog&quot; is set on the frontend. HAProxy will then usually wait for the
    connection to terminate before logging. This format provides much richer
    information, such as timers, connection counts, queue size, etc... This
    format is recommended for pure TCP proxies.

  - the HTTP format, which is the most advanced for HTTP proxying. This format
    is enabled when &quot;<a href="#option%20httplog">option httplog</a>&quot; is set on the frontend. It provides the
    same information as the TCP format with some HTTP-specific fields such as
    the request, the status code, and captures of headers and cookies. This
    format is recommended for HTTP proxies.

  - the CLF HTTP format, which is equivalent to the HTTP format, but with the
    fields arranged in the same order as the CLF format. In this mode, all
    timers, captures, flags, etc... appear one per field after the end of the
    common fields, in the same order they appear in the standard HTTP format.

  - the custom log format, allows you to make your own log line.

Next sections will go deeper into details for each of these formats. Format
specification will be performed on a &quot;field&quot; basis. Unless stated otherwise, a
field is a portion of text delimited by any number of spaces. Since syslog
servers are susceptible of inserting fields at the beginning of a line, it is
always assumed that the first field is the one containing the process name and
identifier.

Note : Since log lines may be quite long, the log examples in sections below
       might be broken into multiple lines. The example log lines will be
       prefixed with 3 closing angle brackets ('&gt;&gt;&gt;') and each time a log is
       broken into multiple lines, each non-final line will end with a
       backslash ('\') and the next line will start indented by two characters.
</pre></div>
<a class="anchor" id="8.2.1" name="8.2.1"></a>
<h3 id="chapter-8.2.1" data-target="8.2.1"><small><a class="small" href="#8.2.1">8.2.1.</a></small> Default log format</h3>
<div><pre class="text">This format is used when no specific option is set. The log is emitted as soon
as the connection is accepted. One should note that this currently is the only
format which logs the request's destination IP and ports.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>    listen www
        mode http
        log global
        server srv1 127.0.0.1:8000

&gt;&gt;&gt; Feb  6 12:12:09 localhost \
      haproxy[14385]: Connect from 10.0.1.2:33312 to 10.0.3.31:8012 \
      (www/HTTP)
</code></pre>
</div><pre class="text">  Field   Format                                Extract from the example above
      1   process_name '[' pid ']:'                            haproxy[14385]:
      2   'Connect from'                                          Connect from
      3   source_ip ':' source_port                             10.0.1.2:33312
      4   'to'                                                              to
      5   destination_ip ':' destination_port                   10.0.3.31:8012
      6   '(' frontend_name '/' mode ')'                            (www/HTTP)

Detailed fields description :
  - &quot;source_ip&quot; is the IP address of the client which initiated the connection.
  - &quot;source_port&quot; is the TCP port of the client which initiated the connection.
  - &quot;destination_ip&quot; is the IP address the client connected to.
  - &quot;destination_port&quot; is the TCP port the client connected to.
  - &quot;frontend_name&quot; is the name of the frontend (or listener) which received
    and processed the connection.
  - &quot;mode is the mode the frontend is operating (TCP or HTTP).

In case of a UNIX socket, the source and destination addresses are marked as
&quot;unix:&quot; and the ports reflect the internal ID of the socket which accepted the
connection (the same ID as reported in the stats).

It is advised not to use this deprecated format for newer installations as it
will eventually disappear.
</pre></div>
<a class="anchor" id="8.2.2" name="8.2.2"></a>
<h3 id="chapter-8.2.2" data-target="8.2.2"><small><a class="small" href="#8.2.2">8.2.2.</a></small> TCP log format</h3>
<div><pre class="text">The TCP format is used when &quot;<a href="#option%20tcplog">option tcplog</a>&quot; is specified in the frontend, and
is the recommended format for pure TCP proxies. It provides a lot of precious
information for troubleshooting. Since this format includes timers and byte
counts, the log is normally emitted at the end of the session. It can be
emitted earlier if &quot;<a href="#option%20logasap">option logasap</a>&quot; is specified, which makes sense in most
environments with long sessions such as remote terminals. Sessions which match
the &quot;<a href="#monitor">monitor</a>&quot; rules are never logged. It is also possible not to emit logs for
sessions for which no data were exchanged between the client and the server, by
specifying &quot;<a href="#option%20dontlognull">option dontlognull</a>&quot; in the frontend. Successful connections will
not be logged if &quot;<a href="#option%20dontlog-normal">option dontlog-normal</a>&quot; is specified in the frontend. A few
fields may slightly vary depending on some configuration options, those are
marked with a star ('*') after the field name below.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>    frontend fnt
        mode tcp
        option tcplog
        log global
        default_backend bck

    backend bck
        server srv1 127.0.0.1:8000

&gt;&gt;&gt; Feb  6 12:12:56 localhost \
      haproxy[14387]: 10.0.1.2:33313 [06/Feb/2009:12:12:51.443] fnt \
      bck/srv1 0/0/5007 212 -- 0/0/0/0/3 0/0
</code></pre>
</div><pre class="text">  Field   Format                                Extract from the example above
      1   process_name '[' pid ']:'                            haproxy[14387]:
      2   client_ip ':' client_port                             10.0.1.2:33313
      3   '[' accept_date ']'                       [06/Feb/2009:12:12:51.443]
      4   frontend_name                                                    fnt
      5   backend_name '/' server_name                                bck/srv1
      6   Tw '/' Tc '/' Tt*                                           0/0/5007
      7   bytes_read*                                                      212
      8   termination_state                                                 --
      9   actconn '/' feconn '/' beconn '/' srv_conn '/' retries*    0/0/0/0/3
     10   srv_queue '/' backend_queue                                      0/0

Detailed fields description :
  - &quot;client_ip&quot; is the IP address of the client which initiated the TCP
    connection to haproxy. If the connection was accepted on a UNIX socket
    instead, the IP address would be replaced with the word &quot;unix&quot;. Note that
    when the connection is accepted on a socket configured with &quot;<a href="#accept-proxy">accept-proxy</a>&quot;
    and the PROXY protocol is correctly used, then the logs will reflect the
    forwarded connection's information.

  - &quot;client_port&quot; is the TCP port of the client which initiated the connection.
    If the connection was accepted on a UNIX socket instead, the port would be
    replaced with the ID of the accepting socket, which is also reported in the
    stats interface.

  - &quot;accept_date&quot; is the exact date when the connection was received by haproxy
    (which might be very slightly different from the date observed on the
    network if there was some queuing in the system's backlog). This is usually
    the same date which may appear in any upstream firewall's log.

  - &quot;frontend_name&quot; is the name of the frontend (or listener) which received
    and processed the connection.

  - &quot;backend_name&quot; is the name of the backend (or listener) which was selected
    to manage the connection to the server. This will be the same as the
    frontend if no switching rule has been applied, which is common for TCP
    applications.

  - &quot;server_name&quot; is the name of the last server to which the connection was
    sent, which might differ from the first one if there were connection errors
    and a redispatch occurred. Note that this server belongs to the backend
    which processed the request. If the connection was aborted before reaching
    a server, &quot;&lt;NOSRV&gt;&quot; is indicated instead of a server name.

  - &quot;Tw&quot; is the total time in milliseconds spent waiting in the various queues.
    It can be &quot;-1&quot; if the connection was aborted before reaching the queue.
    See &quot;Timers&quot; below for more details.

  - &quot;Tc&quot; is the total time in milliseconds spent waiting for the connection to
    establish to the final server, including retries. It can be &quot;-1&quot; if the
    connection was aborted before a connection could be established. See
    &quot;Timers&quot; below for more details.

  - &quot;Tt&quot; is the total time in milliseconds elapsed between the accept and the
    last close. It covers all possible processing. There is one exception, if
    &quot;<a href="#option%20logasap">option logasap</a>&quot; was specified, then the time counting stops at the moment
    the log is emitted. In this case, a '+' sign is prepended before the value,
    indicating that the final one will be larger. See &quot;Timers&quot; below for more
    details.

  - &quot;bytes_read&quot; is the total number of bytes transmitted from the server to
    the client when the log is emitted. If &quot;<a href="#option%20logasap">option logasap</a>&quot; is specified, the
    this value will be prefixed with a '+' sign indicating that the final one
    may be larger. Please note that this value is a 64-bit counter, so log
    analysis tools must be able to handle it without overflowing.

  - &quot;termination_state&quot; is the condition the session was in when the session
    ended. This indicates the session state, which side caused the end of
    session to happen, and for what reason (timeout, error, ...). The normal
    flags should be &quot;--&quot;, indicating the session was closed by either end with
    no data remaining in buffers. See below &quot;Session state at disconnection&quot;
    for more details.

  - &quot;actconn&quot; is the total number of concurrent connections on the process when
    the session was logged. It is useful to detect when some per-process system
    limits have been reached. For instance, if actconn is close to 512 when
    multiple connection errors occur, chances are high that the system limits
    the process to use a maximum of 1024 file descriptors and that all of them
    are used. See <a href="#3">section 3</a> &quot;Global parameters&quot; to find how to tune the system.

  - &quot;feconn&quot; is the total number of concurrent connections on the frontend when
    the session was logged. It is useful to estimate the amount of resource
    required to sustain high loads, and to detect when the frontend's &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Performance%20tuning%29">Performance tuning</a></li><li><a href="#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#maxconn%20%28Bind%20options%29">Bind options</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;
    has been reached. Most often when this value increases by huge jumps, it is
    because there is congestion on the backend servers, but sometimes it can be
    caused by a denial of service attack.

  - &quot;beconn&quot; is the total number of concurrent connections handled by the
    backend when the session was logged. It includes the total number of
    concurrent connections active on servers as well as the number of
    connections pending in queues. It is useful to estimate the amount of
    additional servers needed to support high loads for a given application.
    Most often when this value increases by huge jumps, it is because there is
    congestion on the backend servers, but sometimes it can be caused by a
    denial of service attack.

  - &quot;<a href="#srv_conn">srv_conn</a>&quot; is the total number of concurrent connections still active on
    the server when the session was logged. It can never exceed the server's
    configured &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Performance%20tuning%29">Performance tuning</a></li><li><a href="#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#maxconn%20%28Bind%20options%29">Bind options</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; parameter. If this value is very often close or equal
    to the server's &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Performance%20tuning%29">Performance tuning</a></li><li><a href="#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#maxconn%20%28Bind%20options%29">Bind options</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;, it means that traffic regulation is involved a
    lot, meaning that either the server's maxconn value is too low, or that
    there aren't enough servers to process the load with an optimal response
    time. When only one of the server's &quot;<a href="#srv_conn">srv_conn</a>&quot; is high, it usually means
    that this server has some trouble causing the connections to take longer to
    be processed than on other servers.

  - &quot;<a href="#retries">retries</a>&quot; is the number of connection retries experienced by this session
    when trying to connect to the server. It must normally be zero, unless a
    server is being stopped at the same moment the connection was attempted.
    Frequent retries generally indicate either a network problem between
    haproxy and the server, or a misconfigured system backlog on the server
    preventing new connections from being queued. This field may optionally be
    prefixed with a '+' sign, indicating that the session has experienced a
    redispatch after the maximal retry count has been reached on the initial
    server. In this case, the server name appearing in the log is the one the
    connection was redispatched to, and not the first one, though both may
    sometimes be the same in case of hashing for instance. So as a general rule
    of thumb, when a '+' is present in front of the retry count, this count
    should not be attributed to the logged server.

  - &quot;srv_queue&quot; is the total number of requests which were processed before
    this one in the server queue. It is zero when the request has not gone
    through the server queue. It makes it possible to estimate the approximate
    server's response time by dividing the time spent in queue by the number of
    requests in the queue. It is worth noting that if a session experiences a
    redispatch and passes through two server queues, their positions will be
    cumulated. A request should not pass through both the server queue and the
    backend queue unless a redispatch occurs.

  - &quot;backend_queue&quot; is the total number of requests which were processed before
    this one in the backend's global queue. It is zero when the request has not
    gone through the global queue. It makes it possible to estimate the average
    queue length, which easily translates into a number of missing servers when
    divided by a server's &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Performance%20tuning%29">Performance tuning</a></li><li><a href="#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#maxconn%20%28Bind%20options%29">Bind options</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; parameter. It is worth noting that if a
    session experiences a redispatch, it may pass twice in the backend's queue,
    and then both positions will be cumulated. A request should not pass
    through both the server queue and the backend queue unless a redispatch
    occurs.
</pre></div>
<a class="anchor" id="8.2.3" name="8.2.3"></a>
<h3 id="chapter-8.2.3" data-target="8.2.3"><small><a class="small" href="#8.2.3">8.2.3.</a></small> HTTP log format</h3>
<div><pre class="text">The HTTP format is the most complete and the best suited for HTTP proxies. It
is enabled by when &quot;<a href="#option%20httplog">option httplog</a>&quot; is specified in the frontend. It provides
the same level of information as the TCP format with additional features which
are specific to the HTTP protocol. Just like the TCP format, the log is usually
emitted at the end of the session, unless &quot;<a href="#option%20logasap">option logasap</a>&quot; is specified, which
generally only makes sense for download sites. A session which matches the
&quot;<a href="#monitor">monitor</a>&quot; rules will never logged. It is also possible not to log sessions for
which no data were sent by the client by specifying &quot;<a href="#option%20dontlognull">option dontlognull</a>&quot; in the
frontend. Successful connections will not be logged if &quot;<a href="#option%20dontlog-normal">option dontlog-normal</a>&quot;
is specified in the frontend.

Most fields are shared with the TCP log, some being different. A few fields may
slightly vary depending on some configuration options. Those ones are marked
with a star ('*') after the field name below.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>    frontend http-in
        mode http
        option httplog
        log global
        default_backend bck

    backend static
        server srv1 127.0.0.1:8000

&gt;&gt;&gt; Feb  6 12:14:14 localhost \
      haproxy[14389]: 10.0.1.2:33317 [06/Feb/2009:12:14:14.655] http-in \
      static/srv1 10/0/30/69/109 200 2750 - - ---- 1/1/1/1/0 0/0 {1wt.eu} \
      {} &quot;GET /index.html HTTP/1.1&quot;
</code></pre>
</div><pre class="text">  Field   Format                                Extract from the example above
      1   process_name '[' pid ']:'                            haproxy[14389]:
      2   client_ip ':' client_port                             10.0.1.2:33317
      3   '[' accept_date ']'                       [06/Feb/2009:12:14:14.655]
      4   frontend_name                                                http-in
      5   backend_name '/' server_name                             static/srv1
      6   Tq '/' Tw '/' Tc '/' Tr '/' Tt*                       10/0/30/69/109
      7   status_code                                                      200
      8   bytes_read*                                                     2750
      9   captured_request_cookie                                            -
     10   captured_response_cookie                                           -
     11   termination_state                                               ----
     12   actconn '/' feconn '/' beconn '/' srv_conn '/' retries*    1/1/1/1/0
     13   srv_queue '/' backend_queue                                      0/0
     14   '{' captured_request_headers* '}'                   {haproxy.1wt.eu}
     15   '{' captured_response_headers* '}'                                {}
     16   '&quot;' http_request '&quot;'                      &quot;GET /index.html HTTP/1.1&quot;


Detailed fields description :
  - &quot;client_ip&quot; is the IP address of the client which initiated the TCP
    connection to haproxy. If the connection was accepted on a UNIX socket
    instead, the IP address would be replaced with the word &quot;unix&quot;. Note that
    when the connection is accepted on a socket configured with &quot;<a href="#accept-proxy">accept-proxy</a>&quot;
    and the PROXY protocol is correctly used, then the logs will reflect the
    forwarded connection's information.

  - &quot;client_port&quot; is the TCP port of the client which initiated the connection.
    If the connection was accepted on a UNIX socket instead, the port would be
    replaced with the ID of the accepting socket, which is also reported in the
    stats interface.

  - &quot;accept_date&quot; is the exact date when the TCP connection was received by
    haproxy (which might be very slightly different from the date observed on
    the network if there was some queuing in the system's backlog). This is
    usually the same date which may appear in any upstream firewall's log. This
    does not depend on the fact that the client has sent the request or not.

  - &quot;frontend_name&quot; is the name of the frontend (or listener) which received
    and processed the connection.

  - &quot;backend_name&quot; is the name of the backend (or listener) which was selected
    to manage the connection to the server. This will be the same as the
    frontend if no switching rule has been applied.

  - &quot;server_name&quot; is the name of the last server to which the connection was
    sent, which might differ from the first one if there were connection errors
    and a redispatch occurred. Note that this server belongs to the backend
    which processed the request. If the request was aborted before reaching a
    server, &quot;&lt;NOSRV&gt;&quot; is indicated instead of a server name. If the request was
    intercepted by the stats subsystem, &quot;&lt;STATS&gt;&quot; is indicated instead.

  - &quot;Tq&quot; is the total time in milliseconds spent waiting for the client to send
    a full HTTP request, not counting data. It can be &quot;-1&quot; if the connection
    was aborted before a complete request could be received. It should always
    be very small because a request generally fits in one single packet. Large
    times here generally indicate network trouble between the client and
    haproxy. See &quot;Timers&quot; below for more details.

  - &quot;Tw&quot; is the total time in milliseconds spent waiting in the various queues.
    It can be &quot;-1&quot; if the connection was aborted before reaching the queue.
    See &quot;Timers&quot; below for more details.

  - &quot;Tc&quot; is the total time in milliseconds spent waiting for the connection to
    establish to the final server, including retries. It can be &quot;-1&quot; if the
    request was aborted before a connection could be established. See &quot;Timers&quot;
    below for more details.

  - &quot;Tr&quot; is the total time in milliseconds spent waiting for the server to send
    a full HTTP response, not counting data. It can be &quot;-1&quot; if the request was
    aborted before a complete response could be received. It generally matches
    the server's processing time for the request, though it may be altered by
    the amount of data sent by the client to the server. Large times here on
    &quot;GET&quot; requests generally indicate an overloaded server. See &quot;Timers&quot; below
    for more details.

  - &quot;Tt&quot; is the total time in milliseconds elapsed between the accept and the
    last close. It covers all possible processing. There is one exception, if
    &quot;<a href="#option%20logasap">option logasap</a>&quot; was specified, then the time counting stops at the moment
    the log is emitted. In this case, a '+' sign is prepended before the value,
    indicating that the final one will be larger. See &quot;Timers&quot; below for more
    details.

  - &quot;status_code&quot; is the HTTP status code returned to the client. This status
    is generally set by the server, but it might also be set by haproxy when
    the server cannot be reached or when its response is blocked by haproxy.

  - &quot;bytes_read&quot; is the total number of bytes transmitted to the client when
    the log is emitted. This does include HTTP headers. If &quot;<a href="#option%20logasap">option logasap</a>&quot; is
    specified, the this value will be prefixed with a '+' sign indicating that
    the final one may be larger. Please note that this value is a 64-bit
    counter, so log analysis tools must be able to handle it without
    overflowing.

  - &quot;captured_request_cookie&quot; is an optional &quot;name=value&quot; entry indicating that
    the client had this cookie in the request. The cookie name and its maximum
    length are defined by the &quot;<a href="#capture%20cookie">capture cookie</a>&quot; statement in the frontend
    configuration. The field is a single dash ('-') when the option is not
    set. Only one cookie may be captured, it is generally used to track session
    ID exchanges between a client and a server to detect session crossing
    between clients due to application bugs. For more details, please consult
    the section &quot;Capturing HTTP headers and cookies&quot; below.

  - &quot;captured_response_cookie&quot; is an optional &quot;name=value&quot; entry indicating
    that the server has returned a cookie with its response. The cookie name
    and its maximum length are defined by the &quot;<a href="#capture%20cookie">capture cookie</a>&quot; statement in the
    frontend configuration. The field is a single dash ('-') when the option is
    not set. Only one cookie may be captured, it is generally used to track
    session ID exchanges between a client and a server to detect session
    crossing between clients due to application bugs. For more details, please
    consult the section &quot;Capturing HTTP headers and cookies&quot; below.

  - &quot;termination_state&quot; is the condition the session was in when the session
    ended. This indicates the session state, which side caused the end of
    session to happen, for what reason (timeout, error, ...), just like in TCP
    logs, and information about persistence operations on cookies in the last
    two characters. The normal flags should begin with &quot;--&quot;, indicating the
    session was closed by either end with no data remaining in buffers. See
    below &quot;Session state at disconnection&quot; for more details.

  - &quot;actconn&quot; is the total number of concurrent connections on the process when
    the session was logged. It is useful to detect when some per-process system
    limits have been reached. For instance, if actconn is close to 512 or 1024
    when multiple connection errors occur, chances are high that the system
    limits the process to use a maximum of 1024 file descriptors and that all
    of them are used. See <a href="#3">section 3</a> &quot;Global parameters&quot; to find how to tune the
    system.

  - &quot;feconn&quot; is the total number of concurrent connections on the frontend when
    the session was logged. It is useful to estimate the amount of resource
    required to sustain high loads, and to detect when the frontend's &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Performance%20tuning%29">Performance tuning</a></li><li><a href="#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#maxconn%20%28Bind%20options%29">Bind options</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;
    has been reached. Most often when this value increases by huge jumps, it is
    because there is congestion on the backend servers, but sometimes it can be
    caused by a denial of service attack.

  - &quot;beconn&quot; is the total number of concurrent connections handled by the
    backend when the session was logged. It includes the total number of
    concurrent connections active on servers as well as the number of
    connections pending in queues. It is useful to estimate the amount of
    additional servers needed to support high loads for a given application.
    Most often when this value increases by huge jumps, it is because there is
    congestion on the backend servers, but sometimes it can be caused by a
    denial of service attack.

  - &quot;<a href="#srv_conn">srv_conn</a>&quot; is the total number of concurrent connections still active on
    the server when the session was logged. It can never exceed the server's
    configured &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Performance%20tuning%29">Performance tuning</a></li><li><a href="#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#maxconn%20%28Bind%20options%29">Bind options</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; parameter. If this value is very often close or equal
    to the server's &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Performance%20tuning%29">Performance tuning</a></li><li><a href="#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#maxconn%20%28Bind%20options%29">Bind options</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;, it means that traffic regulation is involved a
    lot, meaning that either the server's maxconn value is too low, or that
    there aren't enough servers to process the load with an optimal response
    time. When only one of the server's &quot;<a href="#srv_conn">srv_conn</a>&quot; is high, it usually means
    that this server has some trouble causing the requests to take longer to be
    processed than on other servers.

  - &quot;<a href="#retries">retries</a>&quot; is the number of connection retries experienced by this session
    when trying to connect to the server. It must normally be zero, unless a
    server is being stopped at the same moment the connection was attempted.
    Frequent retries generally indicate either a network problem between
    haproxy and the server, or a misconfigured system backlog on the server
    preventing new connections from being queued. This field may optionally be
    prefixed with a '+' sign, indicating that the session has experienced a
    redispatch after the maximal retry count has been reached on the initial
    server. In this case, the server name appearing in the log is the one the
    connection was redispatched to, and not the first one, though both may
    sometimes be the same in case of hashing for instance. So as a general rule
    of thumb, when a '+' is present in front of the retry count, this count
    should not be attributed to the logged server.

  - &quot;srv_queue&quot; is the total number of requests which were processed before
    this one in the server queue. It is zero when the request has not gone
    through the server queue. It makes it possible to estimate the approximate
    server's response time by dividing the time spent in queue by the number of
    requests in the queue. It is worth noting that if a session experiences a
    redispatch and passes through two server queues, their positions will be
    cumulated. A request should not pass through both the server queue and the
    backend queue unless a redispatch occurs.

  - &quot;backend_queue&quot; is the total number of requests which were processed before
    this one in the backend's global queue. It is zero when the request has not
    gone through the global queue. It makes it possible to estimate the average
    queue length, which easily translates into a number of missing servers when
    divided by a server's &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Performance%20tuning%29">Performance tuning</a></li><li><a href="#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#maxconn%20%28Bind%20options%29">Bind options</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; parameter. It is worth noting that if a
    session experiences a redispatch, it may pass twice in the backend's queue,
    and then both positions will be cumulated. A request should not pass
    through both the server queue and the backend queue unless a redispatch
    occurs.

  - &quot;captured_request_headers&quot; is a list of headers captured in the request due
    to the presence of the &quot;<a href="#capture%20request%20header">capture request header</a>&quot; statement in the frontend.
    Multiple headers can be captured, they will be delimited by a vertical bar
    ('|'). When no capture is enabled, the braces do not appear, causing a
    shift of remaining fields. It is important to note that this field may
    contain spaces, and that using it requires a smarter log parser than when
    it's not used. Please consult the section &quot;Capturing HTTP headers and
    cookies&quot; below for more details.

  - &quot;captured_response_headers&quot; is a list of headers captured in the response
    due to the presence of the &quot;<a href="#capture%20response%20header">capture response header</a>&quot; statement in the
    frontend. Multiple headers can be captured, they will be delimited by a
    vertical bar ('|'). When no capture is enabled, the braces do not appear,
    causing a shift of remaining fields. It is important to note that this
    field may contain spaces, and that using it requires a smarter log parser
    than when it's not used. Please consult the section &quot;Capturing HTTP headers
    and cookies&quot; below for more details.

  - &quot;http_request&quot; is the complete HTTP request line, including the method,
    request and HTTP version string. Non-printable characters are encoded (see
    below the section &quot;Non-printable characters&quot;). This is always the last
    field, and it is always delimited by quotes and is the only one which can
    contain quotes. If new fields are added to the log format, they will be
    added before this field. This field might be truncated if the request is
    huge and does not fit in the standard syslog buffer (1024 characters). This
    is the reason why this field must always remain the last one.
</pre></div>
<a class="anchor" id="8.2.4" name="8.2.4"></a>
<h3 id="chapter-8.2.4" data-target="8.2.4"><small><a class="small" href="#8.2.4">8.2.4.</a></small> Custom log format</h3>
<div><pre class="text">The directive log-format allows you to customize the logs in http mode and tcp
mode. It takes a string as argument.

HAproxy understands some log format variables. % precedes log format variables.
Variables can take arguments using braces ('{}'), and multiple arguments are
separated by commas within the braces. Flags may be added or removed by
prefixing them with a '+' or '-' sign.

Special variable &quot;%o&quot; may be used to propagate its flags to all other
variables on the same format string. This is particularly handy with quoted
string formats (&quot;Q&quot;).

If a variable is named between square brackets ('[' .. ']') then it is used
as a sample expression rule (see <a href="#7.3">section 7.3</a>). This it useful to add some
less common information such as the client's SSL certificate's DN, or to log
the key that would be used to store an entry into a stick table.

Note: spaces must be escaped. A space character is considered as a separator.
In order to emit a verbatim '%', it must be preceded by another '%' resulting
in '%%'. HAProxy will automatically merge consecutive separators.

Flags are :
  * Q: quote a string
  * X: hexadecimal representation (IPs, Ports, %Ts, %rt, %pid)
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>log-format %T\ %t\ Some\ Text
log-format %{+Q}o\ %t\ %s\ %{-Q}r
</code></pre>
</div><pre class="text">At the moment, the default HTTP format is defined this way :

    log-format %ci:%cp\ [%t]\ %ft\ %b/%s\ %Tq/%Tw/%Tc/%Tr/%Tt\ %ST\ %B\ %CC\ \
               %CS\ %tsc\ %ac/%fc/%bc/%sc/%rc\ %sq/%bq\ %hr\ %hs\ %{+Q}r

the default CLF format is defined this way :

    log-format %{+Q}o\ %{-Q}ci\ -\ -\ [%T]\ %r\ %ST\ %B\ \&quot;\&quot;\ \&quot;\&quot;\ %cp\ \
               %ms\ %ft\ %b\ %s\ \%Tq\ %Tw\ %Tc\ %Tr\ %Tt\ %tsc\ %ac\ %fc\ \
               %bc\ %sc\ %rc\ %sq\ %bq\ %CC\ %CS\ \%hrl\ %hsl

and the default TCP format is defined this way :

    log-format %ci:%cp\ [%t]\ %ft\ %b/%s\ %Tw/%Tc/%Tt\ %B\ %ts\ \
               %ac/%fc/%bc/%sc/%rc\ %sq/%bq

Please refer to the table below for currently defined variables :

  +---+------+-----------------------------------------------+-------------+
  | R | var  | field name (8.2.2 and 8.2.3 for description)  | type        |
  +---+------+-----------------------------------------------+-------------+
  |   | %o   | special variable, apply flags on all next var |             |
  +---+------+-----------------------------------------------+-------------+
  |   | %B   | bytes_read           (from server to client)  | numeric     |
  | H | %CC  | captured_request_cookie                       | string      |
  | H | %CS  | captured_response_cookie                      | string      |
  |   | %H   | hostname                                      | string      |
  |   | %ID  | unique-id                                     | string      |
  |   | %ST  | status_code                                   | numeric     |
  |   | %T   | gmt_date_time                                 | date        |
  |   | %Tc  | Tc                                            | numeric     |
  |   | %Tl  | local_date_time                               | date        |
  | H | %Tq  | Tq                                            | numeric     |
  | H | %Tr  | Tr                                            | numeric     |
  |   | %Ts  | timestamp                                     | numeric     |
  |   | %Tt  | Tt                                            | numeric     |
  |   | %Tw  | Tw                                            | numeric     |
  |   | %U   | bytes_uploaded       (from client to server)  | numeric     |
  |   | %ac  | actconn                                       | numeric     |
  |   | %b   | backend_name                                  | string      |
  |   | %bc  | beconn      (backend concurrent connections)  | numeric     |
  |   | %bi  | backend_source_ip       (connecting address)  | IP          |
  |   | %bp  | backend_source_port     (connecting address)  | numeric     |
  |   | %bq  | backend_queue                                 | numeric     |
  |   | %ci  | client_ip                 (accepted address)  | IP          |
  |   | %cp  | client_port               (accepted address)  | numeric     |
  |   | %f   | frontend_name                                 | string      |
  |   | %fc  | feconn     (frontend concurrent connections)  | numeric     |
  |   | %fi  | frontend_ip              (accepting address)  | IP          |
  |   | %fp  | frontend_port            (accepting address)  | numeric     |
  |   | %ft  | frontend_name_transport ('~' suffix for SSL)  | string      |
  |   | %hr  | captured_request_headers default style        | string      |
  |   | %hrl | captured_request_headers CLF style            | string list |
  |   | %hs  | captured_response_headers default style       | string      |
  |   | %hsl | captured_response_headers CLF style           | string list |
  |   | %ms  | accept date milliseconds                      | numeric     |
  |   | %pid | PID                                           | numeric     |
  | H | %r   | http_request                                  | string      |
  |   | %rc  | retries                                       | numeric     |
  |   | %rt  | request_counter (HTTP req or TCP session)     | numeric     |
  |   | %s   | server_name                                   | string      |
  |   | %sc  | srv_conn     (server concurrent connections)  | numeric     |
  |   | %si  | server_IP                   (target address)  | IP          |
  |   | %sp  | server_port                 (target address)  | numeric     |
  |   | %sq  | srv_queue                                     | numeric     |
  | S | %sslc| ssl_ciphers (ex: AES-SHA)                     | string      |
  | S | %sslv| ssl_version (ex: TLSv1)                       | string      |
  |   | %t   | date_time      (with millisecond resolution)  | date        |
  |   | %ts  | termination_state                             | string      |
  | H | %tsc | termination_state with cookie status          | string      |
  +---+------+-----------------------------------------------+-------------+

    R = Restrictions : H = mode http only ; S = SSL only
</pre></div>
<a class="anchor" id="8.2.5" name="8.2.5"></a>
<h3 id="chapter-8.2.5" data-target="8.2.5"><small><a class="small" href="#8.2.5">8.2.5.</a></small> Error log format</h3>
<div><pre class="text">When an incoming connection fails due to an SSL handshake or an invalid PROXY
protocol header, haproxy will log the event using a shorter, fixed line format.
By default, logs are emitted at the LOG_INFO level, unless the option
&quot;<a href="#option%20log-separate-errors">log-separate-errors</a>&quot; is set in the backend, in which case the LOG_ERR level
will be used. Connections on which no data are exchanged (eg: probes) are not
logged if the &quot;<a href="#option%20dontlognull">dontlognull</a>&quot; option is set.

The format looks like this :

    &gt;&gt;&gt; Dec  3 18:27:14 localhost \
          haproxy[6103]: 127.0.0.1:56059 [03/Dec/2012:17:35:10.380] frt/f1: \
          Connection error during SSL handshake

  Field   Format                                Extract from the example above
      1   process_name '[' pid ']:'                             haproxy[6103]:
      2   client_ip ':' client_port                            127.0.0.1:56059
      3   '[' accept_date ']'                       [03/Dec/2012:17:35:10.380]
      4   frontend_name &quot;/&quot; bind_name &quot;:&quot;                              frt/f1:
      5   message                        Connection error during SSL handshake

These fields just provide minimal information to help debugging connection
failures.
</pre></div>
<a class="anchor" id="8.3" name="8.3"></a>
<h2 id="chapter-8.3" data-target="8.3"><small><a class="small" href="#8.3">8.3.</a></small> Advanced logging options</h2>
<div><pre class="text">Some advanced logging options are often looked for but are not easy to find out
just by looking at the various options. Here is an entry point for the few
options which can enable better logging. Please refer to the keywords reference
for more information about their usage.
</pre></div>
<a class="anchor" id="8.3.1" name="8.3.1"></a>
<h3 id="chapter-8.3.1" data-target="8.3.1"><small><a class="small" href="#8.3.1">8.3.1.</a></small> Disabling logging of external tests</h3>
<div><pre class="text">It is quite common to have some monitoring tools perform health checks on
haproxy. Sometimes it will be a layer 3 load-balancer such as LVS or any
commercial load-balancer, and sometimes it will simply be a more complete
monitoring system such as Nagios. When the tests are very frequent, users often
ask how to disable logging for those checks. There are three possibilities :

  - if connections come from everywhere and are just TCP probes, it is often
    desired to simply disable logging of connections without data exchange, by
    setting &quot;<a href="#option%20dontlognull">option dontlognull</a>&quot; in the frontend. It also disables logging of
    port scans, which may or may not be desired.

  - if the connection come from a known source network, use &quot;<a href="#monitor-net">monitor-net</a>&quot; to
    declare this network as monitoring only. Any host in this network will then
    only be able to perform health checks, and their requests will not be
    logged. This is generally appropriate to designate a list of equipment
    such as other load-balancers.

  - if the tests are performed on a known URI, use &quot;<a href="#monitor-uri">monitor-uri</a>&quot; to declare
    this URI as dedicated to monitoring. Any host sending this request will
    only get the result of a health-check, and the request will not be logged.
</pre></div>
<a class="anchor" id="8.3.2" name="8.3.2"></a>
<h3 id="chapter-8.3.2" data-target="8.3.2"><small><a class="small" href="#8.3.2">8.3.2.</a></small> Logging before waiting for the session to terminate</h3>
<div><pre class="text">The problem with logging at end of connection is that you have no clue about
what is happening during very long sessions, such as remote terminal sessions
or large file downloads. This problem can be worked around by specifying
&quot;<a href="#option%20logasap">option logasap</a>&quot; in the frontend. Haproxy will then log as soon as possible,
just before data transfer begins. This means that in case of TCP, it will still
log the connection status to the server, and in case of HTTP, it will log just
after processing the server headers. In this case, the number of bytes reported
is the number of header bytes sent to the client. In order to avoid confusion
with normal logs, the total time field and the number of bytes are prefixed
with a '+' sign which means that real numbers are certainly larger.
</pre></div>
<a class="anchor" id="8.3.3" name="8.3.3"></a>
<h3 id="chapter-8.3.3" data-target="8.3.3"><small><a class="small" href="#8.3.3">8.3.3.</a></small> Raising log level upon errors</h3>
<div><pre class="text">Sometimes it is more convenient to separate normal traffic from errors logs,
for instance in order to ease error monitoring from log files. When the option
&quot;<a href="#option%20log-separate-errors">log-separate-errors</a>&quot; is used, connections which experience errors, timeouts,
retries, redispatches or HTTP status codes 5xx will see their syslog level
raised from &quot;info&quot; to &quot;err&quot;. This will help a syslog daemon store the log in
a separate file. It is very important to keep the errors in the normal traffic
file too, so that log ordering is not altered. You should also be careful if
you already have configured your syslog daemon to store all logs higher than
&quot;notice&quot; in an &quot;admin&quot; file, because the &quot;err&quot; level is higher than &quot;notice&quot;.
</pre></div>
<a class="anchor" id="8.3.4" name="8.3.4"></a>
<h3 id="chapter-8.3.4" data-target="8.3.4"><small><a class="small" href="#8.3.4">8.3.4.</a></small> Disabling logging of successful connections</h3>
<div><pre class="text">Although this may sound strange at first, some large sites have to deal with
multiple thousands of logs per second and are experiencing difficulties keeping
them intact for a long time or detecting errors within them. If the option
&quot;<a href="#option%20dontlog-normal">dontlog-normal</a>&quot; is set on the frontend, all normal connections will not be
logged. In this regard, a normal connection is defined as one without any
error, timeout, retry nor redispatch. In HTTP, the status code is checked too,
and a response with a status 5xx is not considered normal and will be logged
too. Of course, doing is is really discouraged as it will remove most of the
useful information from the logs. Do this only if you have no other
alternative.
</pre></div>
<a class="anchor" id="8.4" name="8.4"></a>
<h2 id="chapter-8.4" data-target="8.4"><small><a class="small" href="#8.4">8.4.</a></small> Timing events</h2>
<div><pre class="text">Timers provide a great help in troubleshooting network problems. All values are
reported in milliseconds (ms). These timers should be used in conjunction with
the session termination flags. In TCP mode with &quot;<a href="#option%20tcplog">option tcplog</a>&quot; set on the
frontend, 3 control points are reported under the form &quot;Tw/Tc/Tt&quot;, and in HTTP
mode, 5 control points are reported under the form &quot;Tq/Tw/Tc/Tr/Tt&quot; :

  - Tq: total time to get the client request (HTTP mode only). It's the time
    elapsed between the moment the client connection was accepted and the
    moment the proxy received the last HTTP header. The value &quot;-1&quot; indicates
    that the end of headers (empty line) has never been seen. This happens when
    the client closes prematurely or times out.

  - Tw: total time spent in the queues waiting for a connection slot. It
    accounts for backend queue as well as the server queues, and depends on the
    queue size, and the time needed for the server to complete previous
    requests. The value &quot;-1&quot; means that the request was killed before reaching
    the queue, which is generally what happens with invalid or denied requests.

  - Tc: total time to establish the TCP connection to the server. It's the time
    elapsed between the moment the proxy sent the connection request, and the
    moment it was acknowledged by the server, or between the TCP SYN packet and
    the matching SYN/ACK packet in return. The value &quot;-1&quot; means that the
    connection never established.

  - Tr: server response time (HTTP mode only). It's the time elapsed between
    the moment the TCP connection was established to the server and the moment
    the server sent its complete response headers. It purely shows its request
    processing time, without the network overhead due to the data transmission.
    It is worth noting that when the client has data to send to the server, for
    instance during a POST request, the time already runs, and this can distort
    apparent response time. For this reason, it's generally wise not to trust
    too much this field for POST requests initiated from clients behind an
    untrusted network. A value of &quot;-1&quot; here means that the last the response
    header (empty line) was never seen, most likely because the server timeout
    stroke before the server managed to process the request.

  - Tt: total session duration time, between the moment the proxy accepted it
    and the moment both ends were closed. The exception is when the &quot;<a href="#option%20logasap">logasap</a>&quot;
    option is specified. In this case, it only equals (Tq+Tw+Tc+Tr), and is
    prefixed with a '+' sign. From this field, we can deduce &quot;Td&quot;, the data
    transmission time, by subtracting other timers when valid :

        Td = Tt - (Tq + Tw + Tc + Tr)

    Timers with &quot;-1&quot; values have to be excluded from this equation. In TCP
    mode, &quot;Tq&quot; and &quot;Tr&quot; have to be excluded too. Note that &quot;Tt&quot; can never be
    negative.

These timers provide precious indications on trouble causes. Since the TCP
protocol defines retransmit delays of 3, 6, 12... seconds, we know for sure
that timers close to multiples of 3s are nearly always related to lost packets
due to network problems (wires, negotiation, congestion). Moreover, if &quot;Tt&quot; is
close to a timeout value specified in the configuration, it often means that a
session has been aborted on timeout.

Most common cases :

  - If &quot;Tq&quot; is close to 3000, a packet has probably been lost between the
    client and the proxy. This is very rare on local networks but might happen
    when clients are on far remote networks and send large requests. It may
    happen that values larger than usual appear here without any network cause.
    Sometimes, during an attack or just after a resource starvation has ended,
    haproxy may accept thousands of connections in a few milliseconds. The time
    spent accepting these connections will inevitably slightly delay processing
    of other connections, and it can happen that request times in the order of
    a few tens of milliseconds are measured after a few thousands of new
    connections have been accepted at once. Setting &quot;<a href="#option%20http-server-close">option http-server-close</a>&quot;
    may display larger request times since &quot;Tq&quot; also measures the time spent
    waiting for additional requests.

  - If &quot;Tc&quot; is close to 3000, a packet has probably been lost between the
    server and the proxy during the server connection phase. This value should
    always be very low, such as 1 ms on local networks and less than a few tens
    of ms on remote networks.

  - If &quot;Tr&quot; is nearly always lower than 3000 except some rare values which seem
    to be the average majored by 3000, there are probably some packets lost
    between the proxy and the server.

  - If &quot;Tt&quot; is large even for small byte counts, it generally is because
    neither the client nor the server decides to close the connection, for
    instance because both have agreed on a keep-alive connection mode. In order
    to solve this issue, it will be needed to specify &quot;<a href="#option%20httpclose">option httpclose</a>&quot; on
    either the frontend or the backend. If the problem persists, it means that
    the server ignores the &quot;close&quot; connection mode and expects the client to
    close. Then it will be required to use &quot;<a href="#option%20forceclose">option forceclose</a>&quot;. Having the
    smallest possible 'Tt' is important when connection regulation is used with
    the &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Performance%20tuning%29">Performance tuning</a></li><li><a href="#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#maxconn%20%28Bind%20options%29">Bind options</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; option on the servers, since no new connection will be sent
    to the server until another one is released.

Other noticeable HTTP log cases ('xx' means any value to be ignored) :

  Tq/Tw/Tc/Tr/+Tt  The &quot;<a href="#option%20logasap">option logasap</a>&quot; is present on the frontend and the log
                   was emitted before the data phase. All the timers are valid
                   except &quot;Tt&quot; which is shorter than reality.

  -1/xx/xx/xx/Tt   The client was not able to send a complete request in time
                   or it aborted too early. Check the session termination flags
                   then &quot;<a href="#timeout%20http-request">timeout http-request</a>&quot; and &quot;<a href="#timeout%20client">timeout client</a>&quot; settings.

  Tq/-1/xx/xx/Tt   It was not possible to process the request, maybe because
                   servers were out of order, because the request was invalid
                   or forbidden by ACL rules. Check the session termination
                   flags.

  Tq/Tw/-1/xx/Tt   The connection could not establish on the server. Either it
                   actively refused it or it timed out after Tt-(Tq+Tw) ms.
                   Check the session termination flags, then check the
                   &quot;<a href="#timeout%20connect">timeout connect</a>&quot; setting. Note that the tarpit action might
                   return similar-looking patterns, with &quot;Tw&quot; equal to the time
                   the client connection was maintained open.

  Tq/Tw/Tc/-1/Tt   The server has accepted the connection but did not return
                   a complete response in time, or it closed its connection
                   unexpectedly after Tt-(Tq+Tw+Tc) ms. Check the session
                   termination flags, then check the &quot;<a href="#timeout%20server">timeout server</a>&quot; setting.
</pre></div>
<a class="anchor" id="8.5" name="8.5"></a>
<h2 id="chapter-8.5" data-target="8.5"><small><a class="small" href="#8.5">8.5.</a></small> Session state at disconnection</h2>
<div><pre class="text">TCP and HTTP logs provide a session termination indicator in the
&quot;termination_state&quot; field, just before the number of active connections. It is
2-characters long in TCP mode, and is extended to 4 characters in HTTP mode,
each of which has a special meaning :

  - On the first character, a code reporting the first event which caused the
    session to terminate :

        C : the TCP session was unexpectedly aborted by the client.

        S : the TCP session was unexpectedly aborted by the server, or the
            server explicitly refused it.

        P : the session was prematurely aborted by the proxy, because of a
            connection limit enforcement, because a DENY filter was matched,
            because of a security check which detected and blocked a dangerous
            error in server response which might have caused information leak
            (eg: cacheable cookie).

        L : the session was locally processed by haproxy and was not passed to
            a server. This is what happens for stats and redirects.

        R : a resource on the proxy has been exhausted (memory, sockets, source
            ports, ...). Usually, this appears during the connection phase, and
            system logs should contain a copy of the precise error. If this
            happens, it must be considered as a very serious anomaly which
            should be fixed as soon as possible by any means.

        I : an internal error was identified by the proxy during a self-check.
            This should NEVER happen, and you are encouraged to report any log
            containing this, because this would almost certainly be a bug. It
            would be wise to preventively restart the process after such an
            event too, in case it would be caused by memory corruption.

        D : the session was killed by haproxy because the server was detected
            as down and was configured to kill all connections when going down.

        U : the session was killed by haproxy on this backup server because an
            active server was detected as up and was configured to kill all
            backup connections when going up.

        K : the session was actively killed by an admin operating on haproxy.

        c : the client-side timeout expired while waiting for the client to
            send or receive data.

        s : the server-side timeout expired while waiting for the server to
            send or receive data.

        - : normal session completion, both the client and the server closed
            with nothing left in the buffers.

  - on the second character, the TCP or HTTP session state when it was closed :

        R : the proxy was waiting for a complete, valid REQUEST from the client
            (HTTP mode only). Nothing was sent to any server.

        Q : the proxy was waiting in the QUEUE for a connection slot. This can
            only happen when servers have a 'maxconn' parameter set. It can
            also happen in the global queue after a redispatch consecutive to
            a failed attempt to connect to a dying server. If no redispatch is
            reported, then no connection attempt was made to any server.

        C : the proxy was waiting for the CONNECTION to establish on the
            server. The server might at most have noticed a connection attempt.

        H : the proxy was waiting for complete, valid response HEADERS from the
            server (HTTP only).

        D : the session was in the DATA phase.

        L : the proxy was still transmitting LAST data to the client while the
            server had already finished. This one is very rare as it can only
            happen when the client dies while receiving the last packets.

        T : the request was tarpitted. It has been held open with the client
            during the whole &quot;<a href="#timeout%20tarpit">timeout tarpit</a>&quot; duration or until the client
            closed, both of which will be reported in the &quot;Tw&quot; timer.

        - : normal session completion after end of data transfer.

  - the third character tells whether the persistence cookie was provided by
    the client (only in HTTP mode) :

        N : the client provided NO cookie. This is usually the case for new
            visitors, so counting the number of occurrences of this flag in the
            logs generally indicate a valid trend for the site frequentation.

        I : the client provided an INVALID cookie matching no known server.
            This might be caused by a recent configuration change, mixed
            cookies between HTTP/HTTPS sites, persistence conditionally
            ignored, or an attack.

        D : the client provided a cookie designating a server which was DOWN,
            so either &quot;<a href="#option%20persist">option persist</a>&quot; was used and the client was sent to
            this server, or it was not set and the client was redispatched to
            another server.

        V : the client provided a VALID cookie, and was sent to the associated
            server.

        E : the client provided a valid cookie, but with a last date which was
            older than what is allowed by the &quot;maxidle&quot; cookie parameter, so
            the cookie is consider EXPIRED and is ignored. The request will be
            redispatched just as if there was no cookie.

        O : the client provided a valid cookie, but with a first date which was
            older than what is allowed by the &quot;maxlife&quot; cookie parameter, so
            the cookie is consider too OLD and is ignored. The request will be
            redispatched just as if there was no cookie.

        U : a cookie was present but was not used to select the server because
            some other server selection mechanism was used instead (typically a
            &quot;<a href="#use-server">use-server</a>&quot; rule).

        - : does not apply (no cookie set in configuration).

  - the last character reports what operations were performed on the persistence
    cookie returned by the server (only in HTTP mode) :

        N : NO cookie was provided by the server, and none was inserted either.

        I : no cookie was provided by the server, and the proxy INSERTED one.
            Note that in &quot;cookie insert&quot; mode, if the server provides a cookie,
            it will still be overwritten and reported as &quot;I&quot; here.

        U : the proxy UPDATED the last date in the cookie that was presented by
            the client. This can only happen in insert mode with &quot;maxidle&quot;. It
            happens every time there is activity at a different date than the
            date indicated in the cookie. If any other change happens, such as
            a redispatch, then the cookie will be marked as inserted instead.

        P : a cookie was PROVIDED by the server and transmitted as-is.

        R : the cookie provided by the server was REWRITTEN by the proxy, which
            happens in &quot;cookie rewrite&quot; or &quot;cookie prefix&quot; modes.

        D : the cookie provided by the server was DELETED by the proxy.

        - : does not apply (no cookie set in configuration).

The combination of the two first flags gives a lot of information about what
was happening when the session terminated, and why it did terminate. It can be
helpful to detect server saturation, network troubles, local system resource
starvation, attacks, etc...

The most common termination flags combinations are indicated below. They are
alphabetically sorted, with the lowercase set just after the upper case for
easier finding and understanding.

  Flags   Reason

     --   Normal termination.

     CC   The client aborted before the connection could be established to the
          server. This can happen when haproxy tries to connect to a recently
          dead (or unchecked) server, and the client aborts while haproxy is
          waiting for the server to respond or for &quot;<a href="#timeout%20connect">timeout connect</a>&quot; to expire.

     CD   The client unexpectedly aborted during data transfer. This can be
          caused by a browser crash, by an intermediate equipment between the
          client and haproxy which decided to actively break the connection,
          by network routing issues between the client and haproxy, or by a
          keep-alive session between the server and the client terminated first
          by the client.

     cD   The client did not send nor acknowledge any data for as long as the
          &quot;<a href="#timeout%20client">timeout client</a>&quot; delay. This is often caused by network failures on
          the client side, or the client simply leaving the net uncleanly.

     CH   The client aborted while waiting for the server to start responding.
          It might be the server taking too long to respond or the client
          clicking the 'Stop' button too fast.

     cH   The &quot;<a href="#timeout%20client">timeout client</a>&quot; stroke while waiting for client data during a
          POST request. This is sometimes caused by too large TCP MSS values
          for PPPoE networks which cannot transport full-sized packets. It can
          also happen when client timeout is smaller than server timeout and
          the server takes too long to respond.

     CQ   The client aborted while its session was queued, waiting for a server
          with enough empty slots to accept it. It might be that either all the
          servers were saturated or that the assigned server was taking too
          long a time to respond.

     CR   The client aborted before sending a full HTTP request. Most likely
          the request was typed by hand using a telnet client, and aborted
          too early. The HTTP status code is likely a 400 here. Sometimes this
          might also be caused by an IDS killing the connection between haproxy
          and the client.

     cR   The &quot;<a href="#timeout%20http-request">timeout http-request</a>&quot; stroke before the client sent a full HTTP
          request. This is sometimes caused by too large TCP MSS values on the
          client side for PPPoE networks which cannot transport full-sized
          packets, or by clients sending requests by hand and not typing fast
          enough, or forgetting to enter the empty line at the end of the
          request. The HTTP status code is likely a 408 here. Note: recently,
          some browsers such as Google Chrome started to break the deployed Web
          infrastructure by aggressively implementing a new &quot;pre-connect&quot;
          feature, consisting in sending connections to sites recently visited
          without sending any request on them until the user starts to browse
          the site. This mechanism causes massive disruption among resource-
          limited servers, and causes a lot of 408 errors in HAProxy logs.
          Worse, some people report that sometimes the browser displays the 408
          error when the user expects to see the actual content (Mozilla fixed
          this bug in 2004, while Chrome users continue to report it in 2014),
          so in this case, using &quot;errorfile 408 /dev/null&quot; can be used as a
          workaround. More information on the subject is available here :
              https://bugzilla.mozilla.org/show_bug.cgi?id=248827
              https://code.google.com/p/chromium/issues/detail?id=85229

     CT   The client aborted while its session was tarpitted. It is important to
          check if this happens on valid requests, in order to be sure that no
          wrong tarpit rules have been written. If a lot of them happen, it
          might make sense to lower the &quot;<a href="#timeout%20tarpit">timeout tarpit</a>&quot; value to something
          closer to the average reported &quot;Tw&quot; timer, in order not to consume
          resources for just a few attackers.

     LR   The request was intercepted and locally handled by haproxy. Generally
          it means that this was a redirect or a stats request.

     SC   The server or an equipment between it and haproxy explicitly refused
          the TCP connection (the proxy received a TCP RST or an ICMP message
          in return). Under some circumstances, it can also be the network
          stack telling the proxy that the server is unreachable (eg: no route,
          or no ARP response on local network). When this happens in HTTP mode,
          the status code is likely a 502 or 503 here.

     sC   The &quot;<a href="#timeout%20connect">timeout connect</a>&quot; stroke before a connection to the server could
          complete. When this happens in HTTP mode, the status code is likely a
          503 or 504 here.

     SD   The connection to the server died with an error during the data
          transfer. This usually means that haproxy has received an RST from
          the server or an ICMP message from an intermediate equipment while
          exchanging data with the server. This can be caused by a server crash
          or by a network issue on an intermediate equipment.

     sD   The server did not send nor acknowledge any data for as long as the
          &quot;<a href="#timeout%20server">timeout server</a>&quot; setting during the data phase. This is often caused
          by too short timeouts on L4 equipments before the server (firewalls,
          load-balancers, ...), as well as keep-alive sessions maintained
          between the client and the server expiring first on haproxy.

     SH   The server aborted before sending its full HTTP response headers, or
          it crashed while processing the request. Since a server aborting at
          this moment is very rare, it would be wise to inspect its logs to
          control whether it crashed and why. The logged request may indicate a
          small set of faulty requests, demonstrating bugs in the application.
          Sometimes this might also be caused by an IDS killing the connection
          between haproxy and the server.

     sH   The &quot;<a href="#timeout%20server">timeout server</a>&quot; stroke before the server could return its
          response headers. This is the most common anomaly, indicating too
          long transactions, probably caused by server or database saturation.
          The immediate workaround consists in increasing the &quot;<a href="#timeout%20server">timeout server</a>&quot;
          setting, but it is important to keep in mind that the user experience
          will suffer from these long response times. The only long term
          solution is to fix the application.

     sQ   The session spent too much time in queue and has been expired. See
          the &quot;<a href="#timeout%20queue">timeout queue</a>&quot; and &quot;<a href="#timeout%20connect">timeout connect</a>&quot; settings to find out how to
          fix this if it happens too often. If it often happens massively in
          short periods, it may indicate general problems on the affected
          servers due to I/O or database congestion, or saturation caused by
          external attacks.

     PC   The proxy refused to establish a connection to the server because the
          process' socket limit has been reached while attempting to connect.
          The global &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">maxconn<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#maxconn%20%28Performance%20tuning%29">Performance tuning</a></li><li><a href="#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29">Alphabetically sorted keywords reference</a></li><li><a href="#maxconn%20%28Bind%20options%29">Bind options</a></li><li><a href="#maxconn%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot; parameter may be increased in the configuration
          so that it does not happen anymore. This status is very rare and
          might happen when the global &quot;<a href="#ulimit-n">ulimit-n</a>&quot; parameter is forced by hand.

     PD   The proxy blocked an incorrectly formatted chunked encoded message in
          a request or a response, after the server has emitted its headers. In
          most cases, this will indicate an invalid message from the server to
          the client. Haproxy supports chunk sizes of up to 2GB - 1 (2147483647
          bytes). Any larger size will be considered as an error.

     PH   The proxy blocked the server's response, because it was invalid,
          incomplete, dangerous (cache control), or matched a security filter.
          In any case, an HTTP 502 error is sent to the client. One possible
          cause for this error is an invalid syntax in an HTTP header name
          containing unauthorized characters. It is also possible but quite
          rare, that the proxy blocked a chunked-encoding request from the
          client due to an invalid syntax, before the server responded. In this
          case, an HTTP 400 error is sent to the client and reported in the
          logs.

     PR   The proxy blocked the client's HTTP request, either because of an
          invalid HTTP syntax, in which case it returned an HTTP 400 error to
          the client, or because a deny filter matched, in which case it
          returned an HTTP 403 error.

     PT   The proxy blocked the client's request and has tarpitted its
          connection before returning it a 500 server error. Nothing was sent
          to the server. The connection was maintained open for as long as
          reported by the &quot;Tw&quot; timer field.

     RC   A local resource has been exhausted (memory, sockets, source ports)
          preventing the connection to the server from establishing. The error
          logs will tell precisely what was missing. This is very rare and can
          only be solved by proper system tuning.

The combination of the two last flags gives a lot of information about how
persistence was handled by the client, the server and by haproxy. This is very
important to troubleshoot disconnections, when users complain they have to
re-authenticate. The commonly encountered flags are :

     --   Persistence cookie is not enabled.

     NN   No cookie was provided by the client, none was inserted in the
          response. For instance, this can be in insert mode with &quot;postonly&quot;
          set on a GET request.

     II   A cookie designating an invalid server was provided by the client,
          a valid one was inserted in the response. This typically happens when
          a &quot;<a href="#server">server</a>&quot; entry is removed from the configuration, since its cookie
          value can be presented by a client when no other server knows it.

     NI   No cookie was provided by the client, one was inserted in the
          response. This typically happens for first requests from every user
          in &quot;insert&quot; mode, which makes it an easy way to count real users.

     VN   A cookie was provided by the client, none was inserted in the
          response. This happens for most responses for which the client has
          already got a cookie.

     VU   A cookie was provided by the client, with a last visit date which is
          not completely up-to-date, so an updated cookie was provided in
          response. This can also happen if there was no date at all, or if
          there was a date but the &quot;maxidle&quot; parameter was not set, so that the
          cookie can be switched to unlimited time.

     EI   A cookie was provided by the client, with a last visit date which is
          too old for the &quot;maxidle&quot; parameter, so the cookie was ignored and a
          new cookie was inserted in the response.

     OI   A cookie was provided by the client, with a first visit date which is
          too old for the &quot;maxlife&quot; parameter, so the cookie was ignored and a
          new cookie was inserted in the response.

     DI   The server designated by the cookie was down, a new server was
          selected and a new cookie was emitted in the response.

     VI   The server designated by the cookie was not marked dead but could not
          be reached. A redispatch happened and selected another one, which was
          then advertised in the response.
</pre></div>
<a class="anchor" id="8.6" name="8.6"></a>
<h2 id="chapter-8.6" data-target="8.6"><small><a class="small" href="#8.6">8.6.</a></small> Non-printable characters</h2>
<div><pre class="text">In order not to cause trouble to log analysis tools or terminals during log
consulting, non-printable characters are not sent as-is into log files, but are
converted to the two-digits hexadecimal representation of their ASCII code,
prefixed by the character '#'. The only characters that can be logged without
being escaped are comprised between 32 and 126 (inclusive). Obviously, the
escape character '#' itself is also encoded to avoid any ambiguity (&quot;#23&quot;). It
is the same for the character '&quot;' which becomes &quot;#22&quot;, as well as '{', '|' and
'}' when logging headers.

Note that the space character (' ') is not encoded in headers, which can cause
issues for tools relying on space count to locate fields. A typical header
containing spaces is &quot;User-Agent&quot;.

Last, it has been observed that some syslog daemons such as syslog-ng escape
the quote ('&quot;') with a backslash ('\'). The reverse operation can safely be
performed since no quote may appear anywhere else in the logs.
</pre></div>
<a class="anchor" id="8.7" name="8.7"></a>
<h2 id="chapter-8.7" data-target="8.7"><small><a class="small" href="#8.7">8.7.</a></small> Capturing HTTP cookies</h2>
<div><pre class="text">Cookie capture simplifies the tracking a complete user session. This can be
achieved using the &quot;<a href="#capture%20cookie">capture cookie</a>&quot; statement in the frontend. Please refer to
<a href="#4.2">section 4.2</a> for more details. Only one cookie can be captured, and the same
cookie will simultaneously be checked in the request (&quot;Cookie:&quot; header) and in
the response (&quot;Set-Cookie:&quot; header). The respective values will be reported in
the HTTP logs at the &quot;captured_request_cookie&quot; and &quot;captured_response_cookie&quot;
locations (see <a href="#8.2.3">section 8.2.3</a> about HTTP log format). When either cookie is
not seen, a dash ('-') replaces the value. This way, it's easy to detect when a
user switches to a new session for example, because the server will reassign it
a new cookie. It is also possible to detect if a server unexpectedly sets a
wrong cookie to a client, leading to session crossing.
</pre><div class="separator">
<span class="label label-success">Examples :</span>
<pre class="prettyprint">
<code><span class="comment"># capture the first cookie whose name starts with &quot;ASPSESSION&quot;</span>
capture cookie ASPSESSION len 32

<span class="comment"># capture the first cookie whose name is exactly &quot;vgnvisitor&quot;</span>
capture cookie vgnvisitor= len 32
</code></pre>
</div></div>
<a class="anchor" id="8.8" name="8.8"></a>
<h2 id="chapter-8.8" data-target="8.8"><small><a class="small" href="#8.8">8.8.</a></small> Capturing HTTP headers</h2>
<div><pre class="text">Header captures are useful to track unique request identifiers set by an upper
proxy, virtual host names, user-agents, POST content-length, referrers, etc. In
the response, one can search for information about the response length, how the
server asked the cache to behave, or an object location during a redirection.

Header captures are performed using the &quot;<a href="#capture%20request%20header">capture request header</a>&quot; and &quot;capture
response header&quot; statements in the frontend. Please consult their definition in
<a href="#4.2">section 4.2</a> for more details.

It is possible to include both request headers and response headers at the same
time. Non-existent headers are logged as empty strings, and if one header
appears more than once, only its last occurrence will be logged. Request headers
are grouped within braces '{' and '}' in the same order as they were declared,
and delimited with a vertical bar '|' without any space. Response headers
follow the same representation, but are displayed after a space following the
request headers block. These blocks are displayed just before the HTTP request
in the logs.

As a special case, it is possible to specify an HTTP header capture in a TCP
frontend. The purpose is to enable logging of headers which will be parsed in
an HTTP backend if the request is then switched to this HTTP backend.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>    <span class="comment"># This instance chains to the outgoing proxy</span>
    listen proxy-out
        mode http
        option httplog
        option logasap
        log global
        server cache1 192.168.1.1:3128

        <span class="comment"># log the name of the virtual server</span>
        capture request  header Host len 20

        <span class="comment"># log the amount of data uploaded during a POST</span>
        capture request  header Content-Length len 10

        <span class="comment"># log the beginning of the referrer</span>
        capture request  header Referer len 20

        <span class="comment"># server name (useful for outgoing proxies only)</span>
        capture response header Server len 20

        <span class="comment"># logging the content-length is useful with &quot;<a href="#option%20logasap">option logasap</a>&quot;</span>
        capture response header Content-Length len 10

        <span class="comment"># log the expected cache behaviour on the response</span>
        capture response header Cache-Control len 8

        <span class="comment"># the Via header will report the next proxy's name</span>
        capture response header Via len 20

        <span class="comment"># log the URL location during a redirection</span>
        capture response header Location len 20

&gt;&gt;&gt; Aug  9 20:26:09 localhost \
      haproxy[2022]: 127.0.0.1:34014 [09/Aug/2004:20:26:09] proxy-out \
      proxy-out/cache1 0/0/0/162/+162 200 +350 - - ---- 0/0/0/0/0 0/0 \
      {fr.adserver.yahoo.co||http://fr.f416.mail.} {|864|private||} \
      &quot;GET http://fr.adserver.yahoo.com/&quot;

&gt;&gt;&gt; Aug  9 20:30:46 localhost \
      haproxy[2022]: 127.0.0.1:34020 [09/Aug/2004:20:30:46] proxy-out \
      proxy-out/cache1 0/0/0/182/+182 200 +279 - - ---- 0/0/0/0/0 0/0 \
      {w.ods.org||} {Formilux/0.1.8|3495|||} \
      &quot;GET http://trafic.1wt.eu/ HTTP/1.1&quot;

&gt;&gt;&gt; Aug  9 20:30:46 localhost \
      haproxy[2022]: 127.0.0.1:34028 [09/Aug/2004:20:30:46] proxy-out \
      proxy-out/cache1 0/0/2/126/+128 301 +223 - - ---- 0/0/0/0/0 0/0 \
      {www.sytadin.equipement.gouv.fr||http://trafic.1wt.eu/} \
      {Apache|230|||http://www.sytadin.} \
      &quot;GET http://www.sytadin.equipement.gouv.fr/ HTTP/1.1&quot;
</code></pre>
</div></div>
<a class="anchor" id="8.9" name="8.9"></a>
<h2 id="chapter-8.9" data-target="8.9"><small><a class="small" href="#8.9">8.9.</a></small> Examples of logs</h2>
<div><pre class="text">These are real-world examples of logs accompanied with an explanation. Some of
them have been made up by hand. The syslog part has been removed for better
reading. Their sole purpose is to explain how to decipher them.

    &gt;&gt;&gt; haproxy[674]: 127.0.0.1:33318 [15/Oct/2003:08:31:57.130] px-http \
          px-http/srv1 6559/0/7/147/6723 200 243 - - ---- 5/3/3/1/0 0/0 \
          &quot;HEAD / HTTP/1.0&quot;

    =&gt; long request (6.5s) entered by hand through 'telnet'. The server replied
       in 147 ms, and the session ended normally ('----')

    &gt;&gt;&gt; haproxy[674]: 127.0.0.1:33319 [15/Oct/2003:08:31:57.149] px-http \
          px-http/srv1 6559/1230/7/147/6870 200 243 - - ---- 324/239/239/99/0 \
          0/9 &quot;HEAD / HTTP/1.0&quot;

    =&gt; Idem, but the request was queued in the global queue behind 9 other
       requests, and waited there for 1230 ms.

    &gt;&gt;&gt; haproxy[674]: 127.0.0.1:33320 [15/Oct/2003:08:32:17.654] px-http \
          px-http/srv1 9/0/7/14/+30 200 +243 - - ---- 3/3/3/1/0 0/0 \
          &quot;GET /image.iso HTTP/1.0&quot;

    =&gt; request for a long data transfer. The &quot;<a href="#option%20logasap">logasap</a>&quot; option was specified, so
       the log was produced just before transferring data. The server replied in
       14 ms, 243 bytes of headers were sent to the client, and total time from
       accept to first data byte is 30 ms.

    &gt;&gt;&gt; haproxy[674]: 127.0.0.1:33320 [15/Oct/2003:08:32:17.925] px-http \
          px-http/srv1 9/0/7/14/30 502 243 - - PH-- 3/2/2/0/0 0/0 \
          &quot;GET /cgi-bin/bug.cgi? HTTP/1.0&quot;

    =&gt; the proxy blocked a server response either because of an &quot;<a href="#rspdeny">rspdeny</a>&quot; or
       &quot;<a href="#rspideny">rspideny</a>&quot; filter, or because the response was improperly formatted and
       not HTTP-compliant, or because it blocked sensitive information which
       risked being cached. In this case, the response is replaced with a &quot;502
       bad gateway&quot;. The flags (&quot;PH--&quot;) tell us that it was haproxy who decided
       to return the 502 and not the server.

    &gt;&gt;&gt; haproxy[18113]: 127.0.0.1:34548 [15/Oct/2003:15:18:55.798] px-http \
          px-http/&lt;NOSRV&gt; -1/-1/-1/-1/8490 -1 0 - - CR-- 2/2/2/0/0 0/0 &quot;&quot;

    =&gt; the client never completed its request and aborted itself (&quot;C---&quot;) after
       8.5s, while the proxy was waiting for the request headers (&quot;-R--&quot;).
       Nothing was sent to any server.

    &gt;&gt;&gt; haproxy[18113]: 127.0.0.1:34549 [15/Oct/2003:15:19:06.103] px-http \
         px-http/&lt;NOSRV&gt; -1/-1/-1/-1/50001 408 0 - - cR-- 2/2/2/0/0 0/0 &quot;&quot;

    =&gt; The client never completed its request, which was aborted by the
       time-out (&quot;c---&quot;) after 50s, while the proxy was waiting for the request
       headers (&quot;-R--&quot;).  Nothing was sent to any server, but the proxy could
       send a 408 return code to the client.

    &gt;&gt;&gt; haproxy[18989]: 127.0.0.1:34550 [15/Oct/2003:15:24:28.312] px-tcp \
          px-tcp/srv1 0/0/5007 0 cD 0/0/0/0/0 0/0

    =&gt; This log was produced with &quot;<a href="#option%20tcplog">option tcplog</a>&quot;. The client timed out after
       5 seconds (&quot;c----&quot;).

    &gt;&gt;&gt; haproxy[18989]: 10.0.0.1:34552 [15/Oct/2003:15:26:31.462] px-http \
          px-http/srv1 3183/-1/-1/-1/11215 503 0 - - SC-- 205/202/202/115/3 \
          0/0 &quot;HEAD / HTTP/1.0&quot;

    =&gt; The request took 3s to complete (probably a network problem), and the
       connection to the server failed ('SC--') after 4 attempts of 2 seconds
       (config says 'retries 3'), and no redispatch (otherwise we would have
       seen &quot;/+3&quot;). Status code 503 was returned to the client. There were 115
       connections on this server, 202 connections on this proxy, and 205 on
       the global process. It is possible that the server refused the
       connection because of too many already established.
</pre></div>
<a class="anchor" id="9" name="9"></a>
<div class="page-header"><h1 id="chapter-9" data-target="9"><small><a class="small" href="#9">9.</a></small> Statistics and monitoring</h1>
</div><div><pre class="text">It is possible to query HAProxy about its status. The most commonly used
mechanism is the HTTP statistics page. This page also exposes an alternative
CSV output format for monitoring tools. The same format is provided on the
Unix socket.
</pre></div>
<a class="anchor" id="9.1" name="9.1"></a>
<h2 id="chapter-9.1" data-target="9.1"><small><a class="small" href="#9.1">9.1.</a></small> CSV format</h2>
<div><pre class="text">The statistics may be consulted either from the unix socket or from the HTTP
page. Both means provide a CSV format whose fields follow. The first line
begins with a sharp ('#') and has one word per comma-delimited field which
represents the title of the column. All other lines starting at the second one
use a classical CSV format using a comma as the delimiter, and the double quote
('&quot;') as an optional text delimiter, but only if the enclosed text is ambiguous
(if it contains a quote or a comma). The double-quote character ('&quot;') in the
text is doubled ('&quot;&quot;'), which is the format that most tools recognize. Please
do not insert any column before these ones in order not to break tools which
use hard-coded column positions.

  0. pxname: proxy name
  1. svname: service name (FRONTEND for frontend, BACKEND for backend, any name
    for server)
  2. qcur: current queued requests
  3. qmax: max queued requests
  4. scur: current sessions
  5. smax: max sessions
  6. slim: sessions limit
  7. stot: total sessions
  8. bin: bytes in
  9. bout: bytes out
 10. dreq: denied requests
 11. dresp: denied responses
 12. ereq: request errors
 13. econ: connection errors
 14. eresp: response errors (among which srv_abrt)
 15. wretr: retries (warning)
 16. wredis: redispatches (warning)
 17. status: status (UP/DOWN/NOLB/MAINT/MAINT(via)...)
 18. weight: server weight (server), total weight (backend)
 19. act: server is active (server), number of active servers (backend)
 20. bck: server is backup (server), number of backup servers (backend)
 21. chkfail: number of failed checks
 22. chkdown: number of UP-&gt;DOWN transitions
 23. lastchg: last status change (in seconds)
 24. downtime: total downtime (in seconds)
 25. qlimit: queue limit
 26. pid: process id (0 for first instance, 1 for second, ...)
 27. iid: unique proxy id
 28. sid: service id (unique inside a proxy)
 29. throttle: warm up status
 30. lbtot: total number of times a server was selected
 31. tracked: id of proxy/server if tracking is enabled
 32. type (0=frontend, 1=backend, 2=server, 3=socket)
 33. rate: number of sessions per second over last elapsed second
 34. rate_lim: limit on new sessions per second
 35. rate_max: max number of new sessions per second
 36. check_status: status of last health check, one of:
        UNK     -&gt; unknown
        INI     -&gt; initializing
        SOCKERR -&gt; socket error
        L4OK    -&gt; check passed on layer 4, no upper layers testing enabled
        L4TMOUT -&gt; layer 1-4 timeout
        L4CON   -&gt; layer 1-4 connection problem, for example
                   &quot;Connection refused&quot; (tcp rst) or &quot;No route to host&quot; (icmp)
        L6OK    -&gt; check passed on layer 6
        L6TOUT  -&gt; layer 6 (SSL) timeout
        L6RSP   -&gt; layer 6 invalid response - protocol error
        L7OK    -&gt; check passed on layer 7
        L7OKC   -&gt; check conditionally passed on layer 7, for example 404 with
                   disable-on-404
        L7TOUT  -&gt; layer 7 (HTTP/SMTP) timeout
        L7RSP   -&gt; layer 7 invalid response - protocol error
        L7STS   -&gt; layer 7 response error, for example HTTP 5xx
 37. check_code: layer5-7 code, if available
 38. check_duration: time in ms took to finish last health check
 39. hrsp_1xx: http responses with 1xx code
 40. hrsp_2xx: http responses with 2xx code
 41. hrsp_3xx: http responses with 3xx code
 42. hrsp_4xx: http responses with 4xx code
 43. hrsp_5xx: http responses with 5xx code
 44. hrsp_other: http responses with other codes (protocol error)
 45. hanafail: failed health checks details
 46. req_rate: HTTP requests per second over last elapsed second
 47. req_rate_max: max number of HTTP requests per second observed
 48. req_tot: total number of HTTP requests received
 49. cli_abrt: number of data transfers aborted by the client
 50. srv_abrt: number of data transfers aborted by the server (inc. in eresp)
 51. comp_in: number of HTTP response bytes fed to the compressor
 52. comp_out: number of HTTP response bytes emitted by the compressor
 53. comp_byp: number of bytes that bypassed the HTTP compressor (CPU/BW limit)
 54. comp_rsp: number of HTTP responses that were compressed
 55. lastsess: number of seconds since last session assigned to server/backend
 56. last_chk: last health check contents or textual error
 57. last_agt: last agent check contents or textual error
 58. qtime: the average queue time in ms over the 1024 last requests
 59. ctime: the average connect time in ms over the 1024 last requests
 60. rtime: the average response time in ms over the 1024 last requests (0 for TCP)
 61. ttime: the average total session time in ms over the 1024 last requests
</pre></div>
<a class="anchor" id="9.2" name="9.2"></a>
<h2 id="chapter-9.2" data-target="9.2"><small><a class="small" href="#9.2">9.2.</a></small> Unix Socket commands</h2>
<div><pre class="text">The stats socket is not enabled by default. In order to enable it, it is
necessary to add one line in the global section of the haproxy configuration.
A second line is recommended to set a larger timeout, always appreciated when
issuing commands by hand :

    global
        stats socket /var/run/haproxy.sock mode 600 level admin
        stats timeout 2m

It is also possible to add multiple instances of the stats socket by repeating
the line, and make them listen to a TCP port instead of a UNIX socket. This is
never done by default because this is dangerous, but can be handy in some
situations :

    global
        stats socket /var/run/haproxy.sock mode 600 level admin
        stats socket ipv4@192.168.0.1:9999 level admin
        stats timeout 2m

To access the socket, an external utility such as &quot;socat&quot; is required. Socat is a
swiss-army knife to connect anything to anything. We use it to connect terminals
to the socket, or a couple of stdin/stdout pipes to it for scripts. The two main
syntaxes we'll use are the following :

    # socat /var/run/haproxy.sock stdio
    # socat /var/run/haproxy.sock readline

The first one is used with scripts. It is possible to send the output of a
script to haproxy, and pass haproxy's output to another script. That's useful
for retrieving counters or attack traces for example.

The second one is only useful for issuing commands by hand. It has the benefit
that the terminal is handled by the readline library which supports line
editing and history, which is very convenient when issuing repeated commands
(eg: watch a counter).

The socket supports two operation modes :
  - interactive
  - non-interactive

The non-interactive mode is the default when socat connects to the socket. In
this mode, a single line may be sent. It is processed as a whole, responses are
sent back, and the connection closes after the end of the response. This is the
mode that scripts and monitoring tools use. It is possible to send multiple
commands in this mode, they need to be delimited by a semi-colon (';'). For
example :

    # echo &quot;show info;show stat;show table&quot; | socat /var/run/haproxy stdio

The interactive mode displays a prompt ('&gt;') and waits for commands to be
entered on the line, then processes them, and displays the prompt again to wait
for a new command. This mode is entered via the &quot;<a href="#prompt">prompt</a>&quot; command which must be
sent on the first line in non-interactive mode. The mode is a flip switch, if
&quot;<a href="#prompt">prompt</a>&quot; is sent in interactive mode, it is disabled and the connection closes
after processing the last command of the same line.

For this reason, when debugging by hand, it's quite common to start with the
&quot;<a href="#prompt">prompt</a>&quot; command :

   # socat /var/run/haproxy readline
   prompt
   &gt; show info
   ...
   &gt;

Since multiple commands may be issued at once, haproxy uses the empty line as a
delimiter to mark an end of output for each command, and takes care of ensuring
that no command can emit an empty line on output. A script can thus easily
parse the output even when multiple commands were pipelined on a single line.

It is important to understand that when multiple haproxy processes are started
on the same sockets, any process may pick up the request and will output its
own stats.

The list of commands currently supported on the stats socket is provided below.
If an unknown command is sent, haproxy displays the usage message which reminds
all supported commands. Some commands support a more complex syntax, generally
it will explain what part of the command is invalid when this happens.
</pre><a class="anchor" name="add"></a><a class="anchor" name="9-add"></a><a class="anchor" name="9.2-add"></a><a class="anchor" name="add (Statistics and monitoring)"></a><a class="anchor" name="add (Unix Socket commands)"></a><a class="anchor" name="add acl"></a><a class="anchor" name="9-add acl"></a><a class="anchor" name="9.2-add acl"></a><a class="anchor" name="add acl (Statistics and monitoring)"></a><a class="anchor" name="add acl (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="add acl"></a><a href="#9.2-add%20acl">add acl</a></b> <span style="color: #080">&lt;acl&gt;</span> <span style="color: #080">&lt;pattern&gt;</span></div><pre class="text">Add an entry into the acl &lt;acl&gt;. &lt;acl&gt; is the #&lt;id&gt; or the &lt;file&gt; returned by
&quot;<a href="#show%20acl">show acl</a>&quot;. This command does not verify if the entry already exists. This
command cannot be used if the reference &lt;acl&gt; is a file also used with a map.
In this case, you must use the command &quot;<a href="#add%20map">add map</a>&quot; in place of &quot;<a href="#add%20acl">add acl</a>&quot;.
</pre><a class="anchor" name="add"></a><a class="anchor" name="9-add"></a><a class="anchor" name="9.2-add"></a><a class="anchor" name="add (Statistics and monitoring)"></a><a class="anchor" name="add (Unix Socket commands)"></a><a class="anchor" name="add map"></a><a class="anchor" name="9-add map"></a><a class="anchor" name="9.2-add map"></a><a class="anchor" name="add map (Statistics and monitoring)"></a><a class="anchor" name="add map (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="add map"></a><a href="#9.2-add%20map">add map</a></b> <span style="color: #080">&lt;map&gt;</span> <span style="color: #080">&lt;key&gt;</span> <span style="color: #080">&lt;value&gt;</span></div><pre class="text">Add an entry into the map &lt;map&gt; to associate the value &lt;value&gt; to the key
&lt;key&gt;. This command does not verify if the entry already exists. It is
mainly used to fill a map after a clear operation. Note that if the reference
&lt;map&gt; is a file and is shared with a map, this map will contain also a new
pattern entry.
</pre><a class="anchor" name="clear"></a><a class="anchor" name="9-clear"></a><a class="anchor" name="9.2-clear"></a><a class="anchor" name="clear (Statistics and monitoring)"></a><a class="anchor" name="clear (Unix Socket commands)"></a><a class="anchor" name="clear counters"></a><a class="anchor" name="9-clear counters"></a><a class="anchor" name="9.2-clear counters"></a><a class="anchor" name="clear counters (Statistics and monitoring)"></a><a class="anchor" name="clear counters (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="clear counters"></a><a href="#9.2-clear%20counters">clear counters</a></b></div><pre class="text">Clear the max values of the statistics counters in each proxy (frontend &amp;
backend) and in each server. The cumulated counters are not affected. This
can be used to get clean counters after an incident, without having to
restart nor to clear traffic counters. This command is restricted and can
only be issued on sockets configured for levels &quot;operator&quot; or &quot;admin&quot;.
</pre><a class="anchor" name="clear"></a><a class="anchor" name="9-clear"></a><a class="anchor" name="9.2-clear"></a><a class="anchor" name="clear (Statistics and monitoring)"></a><a class="anchor" name="clear (Unix Socket commands)"></a><a class="anchor" name="clear counters"></a><a class="anchor" name="9-clear counters"></a><a class="anchor" name="9.2-clear counters"></a><a class="anchor" name="clear counters (Statistics and monitoring)"></a><a class="anchor" name="clear counters (Unix Socket commands)"></a><a class="anchor" name="clear counters all"></a><a class="anchor" name="9-clear counters all"></a><a class="anchor" name="9.2-clear counters all"></a><a class="anchor" name="clear counters all (Statistics and monitoring)"></a><a class="anchor" name="clear counters all (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="clear counters all"></a><a href="#9.2-clear%20counters%20all">clear counters all</a></b></div><pre class="text">Clear all statistics counters in each proxy (frontend &amp; backend) and in each
server. This has the same effect as restarting. This command is restricted
and can only be issued on sockets configured for level &quot;admin&quot;.
</pre><a class="anchor" name="clear"></a><a class="anchor" name="9-clear"></a><a class="anchor" name="9.2-clear"></a><a class="anchor" name="clear (Statistics and monitoring)"></a><a class="anchor" name="clear (Unix Socket commands)"></a><a class="anchor" name="clear acl"></a><a class="anchor" name="9-clear acl"></a><a class="anchor" name="9.2-clear acl"></a><a class="anchor" name="clear acl (Statistics and monitoring)"></a><a class="anchor" name="clear acl (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="clear acl"></a><a href="#9.2-clear%20acl">clear acl</a></b> <span style="color: #080">&lt;acl&gt;</span></div><pre class="text">Remove all entries from the acl &lt;acl&gt;. &lt;acl&gt; is the #&lt;id&gt; or the &lt;file&gt;
returned by &quot;<a href="#show%20acl">show acl</a>&quot;. Note that if the reference &lt;acl&gt; is a file and is
shared with a map, this map will be also cleared.
</pre><a class="anchor" name="clear"></a><a class="anchor" name="9-clear"></a><a class="anchor" name="9.2-clear"></a><a class="anchor" name="clear (Statistics and monitoring)"></a><a class="anchor" name="clear (Unix Socket commands)"></a><a class="anchor" name="clear map"></a><a class="anchor" name="9-clear map"></a><a class="anchor" name="9.2-clear map"></a><a class="anchor" name="clear map (Statistics and monitoring)"></a><a class="anchor" name="clear map (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="clear map"></a><a href="#9.2-clear%20map">clear map</a></b> <span style="color: #080">&lt;map&gt;</span></div><pre class="text">Remove all entries from the map &lt;map&gt;. &lt;map&gt; is the #&lt;id&gt; or the &lt;file&gt;
returned by &quot;<a href="#show%20map">show map</a>&quot;. Note that if the reference &lt;map&gt; is a file and is
shared with a acl, this acl will be also cleared.
</pre><a class="anchor" name="clear"></a><a class="anchor" name="9-clear"></a><a class="anchor" name="9.2-clear"></a><a class="anchor" name="clear (Statistics and monitoring)"></a><a class="anchor" name="clear (Unix Socket commands)"></a><a class="anchor" name="clear table"></a><a class="anchor" name="9-clear table"></a><a class="anchor" name="9.2-clear table"></a><a class="anchor" name="clear table (Statistics and monitoring)"></a><a class="anchor" name="clear table (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="clear table"></a><a href="#9.2-clear%20table">clear table</a></b> <span style="color: #080">&lt;table&gt;</span> <span style="color: #008">[ data.<span style="color: #080">&lt;type&gt;</span> <span style="color: #080">&lt;operator&gt;</span> <span style="color: #080">&lt;value&gt;</span> ]</span> | <span style="color: #008">[ key <span style="color: #080">&lt;key&gt;</span> ]</span></div><pre class="text">Remove entries from the stick-table &lt;table&gt;.

This is typically used to unblock some users complaining they have been
abusively denied access to a service, but this can also be used to clear some
stickiness entries matching a server that is going to be replaced (see &quot;show
table&quot; below for details).  Note that sometimes, removal of an entry will be
refused because it is currently tracked by a session. Retrying a few seconds
later after the session ends is usual enough.

In the case where no options arguments are given all entries will be removed.

When the &quot;data.&quot; form is used entries matching a filter applied using the
stored data (see &quot;<a href="#stick-table">stick-table</a>&quot; in <a href="#4.2">section 4.2</a>) are removed.  A stored data
type must be specified in &lt;type&gt;, and this data type must be stored in the
table otherwise an error is reported. The data is compared according to
&lt;operator&gt; with the 64-bit integer &lt;value&gt;.  Operators are the same as with
the ACLs :

  - eq : match entries whose data is equal to this value
  - ne : match entries whose data is not equal to this value
  - le : match entries whose data is less than or equal to this value
  - ge : match entries whose data is greater than or equal to this value
  - lt : match entries whose data is less than this value
  - gt : match entries whose data is greater than this value

When the key form is used the entry &lt;key&gt; is removed.  The key must be of the
same type as the table, which currently is limited to IPv4, IPv6, integer and
string.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>    $ echo &quot;show table http_proxy&quot; | socat stdio /tmp/sock1
&gt;&gt;&gt; <span class="comment"># table: http_proxy, type: ip, size:204800, used:2</span>
&gt;&gt;&gt; 0x80e6a4c: key=127.0.0.1 use=0 exp=3594729 gpc0=0 conn_rate(30000)=1 \
      bytes_out_rate(60000)=187
&gt;&gt;&gt; 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \
      bytes_out_rate(60000)=191

    $ echo &quot;clear table http_proxy key 127.0.0.1&quot; | socat stdio /tmp/sock1

    $ echo &quot;show table http_proxy&quot; | socat stdio /tmp/sock1
&gt;&gt;&gt; <span class="comment"># table: http_proxy, type: ip, size:204800, used:1</span>
&gt;&gt;&gt; 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \
      bytes_out_rate(60000)=191
    $ echo &quot;clear table http_proxy data.gpc0 eq 1&quot; | socat stdio /tmp/sock1
    $ echo &quot;show table http_proxy&quot; | socat stdio /tmp/sock1
&gt;&gt;&gt; <span class="comment"># table: http_proxy, type: ip, size:204800, used:1</span>
</code></pre>
</div><a class="anchor" name="del"></a><a class="anchor" name="9-del"></a><a class="anchor" name="9.2-del"></a><a class="anchor" name="del (Statistics and monitoring)"></a><a class="anchor" name="del (Unix Socket commands)"></a><a class="anchor" name="del acl"></a><a class="anchor" name="9-del acl"></a><a class="anchor" name="9.2-del acl"></a><a class="anchor" name="del acl (Statistics and monitoring)"></a><a class="anchor" name="del acl (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="del acl"></a><a href="#9.2-del%20acl">del acl</a></b> <span style="color: #080">&lt;acl&gt;</span> <span style="color: #008">[<span style="color: #080">&lt;key&gt;</span>|#<span style="color: #080">&lt;ref&gt;</span>]</span></div><pre class="text">Delete all the acl entries from the acl &lt;acl&gt; corresponding to the key &lt;key&gt;.
&lt;acl&gt; is the #&lt;id&gt; or the &lt;file&gt; returned by &quot;<a href="#show%20acl">show acl</a>&quot;. If the &lt;ref&gt; is used,
this command delete only the listed reference. The reference can be found with
listing the content of the acl. Note that if the reference &lt;acl&gt; is a file and
is shared with a map, the entry will be also deleted in the map.
</pre><a class="anchor" name="del"></a><a class="anchor" name="9-del"></a><a class="anchor" name="9.2-del"></a><a class="anchor" name="del (Statistics and monitoring)"></a><a class="anchor" name="del (Unix Socket commands)"></a><a class="anchor" name="del map"></a><a class="anchor" name="9-del map"></a><a class="anchor" name="9.2-del map"></a><a class="anchor" name="del map (Statistics and monitoring)"></a><a class="anchor" name="del map (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="del map"></a><a href="#9.2-del%20map">del map</a></b> <span style="color: #080">&lt;map&gt;</span> <span style="color: #008">[<span style="color: #080">&lt;key&gt;</span>|#<span style="color: #080">&lt;ref&gt;</span>]</span></div><pre class="text">Delete all the map entries from the map &lt;map&gt; corresponding to the key &lt;key&gt;.
&lt;map&gt; is the #&lt;id&gt; or the &lt;file&gt; returned by &quot;<a href="#show%20map">show map</a>&quot;. If the &lt;ref&gt; is used,
this command delete only the listed reference. The reference can be found with
listing the content of the map. Note that if the reference &lt;map&gt; is a file and
is shared with a acl, the entry will be also deleted in the map.
</pre><a class="anchor" name="disable"></a><a class="anchor" name="9-disable"></a><a class="anchor" name="9.2-disable"></a><a class="anchor" name="disable (Statistics and monitoring)"></a><a class="anchor" name="disable (Unix Socket commands)"></a><a class="anchor" name="disable agent"></a><a class="anchor" name="9-disable agent"></a><a class="anchor" name="9.2-disable agent"></a><a class="anchor" name="disable agent (Statistics and monitoring)"></a><a class="anchor" name="disable agent (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="disable agent"></a><a href="#9.2-disable%20agent">disable agent</a></b> <span style="color: #080">&lt;backend&gt;</span>/<span style="color: #080">&lt;server&gt;</span></div><pre class="text">Mark the auxiliary agent check as temporarily stopped.

In the case where an agent check is being run as a auxiliary check, due
to the agent-check parameter of a server directive, new checks are only
initialised when the agent is in the enabled. Thus, disable agent will
prevent any new agent checks from begin initiated until the agent
re-enabled using enable agent.

When an agent is disabled the processing of an auxiliary agent check that
was initiated while the agent was set as enabled is as follows: All
results that would alter the weight, specifically &quot;drain&quot; or a weight
returned by the agent, are ignored. The processing of agent check is
otherwise unchanged.

The motivation for this feature is to allow the weight changing effects
of the agent checks to be paused to allow the weight of a server to be
configured using set weight without being overridden by the agent.

This command is restricted and can only be issued on sockets configured for
level &quot;admin&quot;.
</pre><a class="anchor" name="disable"></a><a class="anchor" name="9-disable"></a><a class="anchor" name="9.2-disable"></a><a class="anchor" name="disable (Statistics and monitoring)"></a><a class="anchor" name="disable (Unix Socket commands)"></a><a class="anchor" name="disable frontend"></a><a class="anchor" name="9-disable frontend"></a><a class="anchor" name="9.2-disable frontend"></a><a class="anchor" name="disable frontend (Statistics and monitoring)"></a><a class="anchor" name="disable frontend (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="disable frontend"></a><a href="#9.2-disable%20frontend">disable frontend</a></b> <span style="color: #080">&lt;frontend&gt;</span></div><pre class="text">Mark the frontend as temporarily stopped. This corresponds to the mode which
is used during a soft restart : the frontend releases the port but can be
enabled again if needed. This should be used with care as some non-Linux OSes
are unable to enable it back. This is intended to be used in environments
where stopping a proxy is not even imaginable but a misconfigured proxy must
be fixed. That way it's possible to release the port and bind it into another
process to restore operations. The frontend will appear with status &quot;STOP&quot;
on the stats page.

The frontend may be specified either by its name or by its numeric ID,
prefixed with a sharp ('#').

This command is restricted and can only be issued on sockets configured for
level &quot;admin&quot;.
</pre><a class="anchor" name="disable"></a><a class="anchor" name="9-disable"></a><a class="anchor" name="9.2-disable"></a><a class="anchor" name="disable (Statistics and monitoring)"></a><a class="anchor" name="disable (Unix Socket commands)"></a><a class="anchor" name="disable health"></a><a class="anchor" name="9-disable health"></a><a class="anchor" name="9.2-disable health"></a><a class="anchor" name="disable health (Statistics and monitoring)"></a><a class="anchor" name="disable health (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="disable health"></a><a href="#9.2-disable%20health">disable health</a></b> <span style="color: #080">&lt;backend&gt;</span>/<span style="color: #080">&lt;server&gt;</span></div><pre class="text">Mark the primary health check as temporarily stopped. This will disable
sending of health checks, and the last health check result will be ignored.
The server will be in unchecked state and considered UP unless an auxiliary
agent check forces it down.

This command is restricted and can only be issued on sockets configured for
level &quot;admin&quot;.
</pre><a class="anchor" name="disable"></a><a class="anchor" name="9-disable"></a><a class="anchor" name="9.2-disable"></a><a class="anchor" name="disable (Statistics and monitoring)"></a><a class="anchor" name="disable (Unix Socket commands)"></a><a class="anchor" name="disable server"></a><a class="anchor" name="9-disable server"></a><a class="anchor" name="9.2-disable server"></a><a class="anchor" name="disable server (Statistics and monitoring)"></a><a class="anchor" name="disable server (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="disable server"></a><a href="#9.2-disable%20server">disable server</a></b> <span style="color: #080">&lt;backend&gt;</span>/<span style="color: #080">&lt;server&gt;</span></div><pre class="text">Mark the server DOWN for maintenance. In this mode, no more checks will be
performed on the server until it leaves maintenance.
If the server is tracked by other servers, those servers will be set to DOWN
during the maintenance.

In the statistics page, a server DOWN for maintenance will appear with a
&quot;MAINT&quot; status, its tracking servers with the &quot;MAINT(via)&quot; one.

Both the backend and the server may be specified either by their name or by
their numeric ID, prefixed with a sharp ('#').

This command is restricted and can only be issued on sockets configured for
level &quot;admin&quot;.
</pre><a class="anchor" name="enable"></a><a class="anchor" name="9-enable"></a><a class="anchor" name="9.2-enable"></a><a class="anchor" name="enable (Statistics and monitoring)"></a><a class="anchor" name="enable (Unix Socket commands)"></a><a class="anchor" name="enable agent"></a><a class="anchor" name="9-enable agent"></a><a class="anchor" name="9.2-enable agent"></a><a class="anchor" name="enable agent (Statistics and monitoring)"></a><a class="anchor" name="enable agent (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="enable agent"></a><a href="#9.2-enable%20agent">enable agent</a></b> <span style="color: #080">&lt;backend&gt;</span>/<span style="color: #080">&lt;server&gt;</span></div><pre class="text">Resume auxiliary agent check that was temporarily stopped.

See &quot;<a href="#disable%20agent">disable agent</a>&quot; for details of the effect of temporarily starting
and stopping an auxiliary agent.

This command is restricted and can only be issued on sockets configured for
level &quot;admin&quot;.
</pre><a class="anchor" name="enable"></a><a class="anchor" name="9-enable"></a><a class="anchor" name="9.2-enable"></a><a class="anchor" name="enable (Statistics and monitoring)"></a><a class="anchor" name="enable (Unix Socket commands)"></a><a class="anchor" name="enable frontend"></a><a class="anchor" name="9-enable frontend"></a><a class="anchor" name="9.2-enable frontend"></a><a class="anchor" name="enable frontend (Statistics and monitoring)"></a><a class="anchor" name="enable frontend (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="enable frontend"></a><a href="#9.2-enable%20frontend">enable frontend</a></b> <span style="color: #080">&lt;frontend&gt;</span></div><pre class="text">Resume a frontend which was temporarily stopped. It is possible that some of
the listening ports won't be able to bind anymore (eg: if another process
took them since the 'disable frontend' operation). If this happens, an error
is displayed. Some operating systems might not be able to resume a frontend
which was disabled.

The frontend may be specified either by its name or by its numeric ID,
prefixed with a sharp ('#').

This command is restricted and can only be issued on sockets configured for
level &quot;admin&quot;.
</pre><a class="anchor" name="enable"></a><a class="anchor" name="9-enable"></a><a class="anchor" name="9.2-enable"></a><a class="anchor" name="enable (Statistics and monitoring)"></a><a class="anchor" name="enable (Unix Socket commands)"></a><a class="anchor" name="enable health"></a><a class="anchor" name="9-enable health"></a><a class="anchor" name="9.2-enable health"></a><a class="anchor" name="enable health (Statistics and monitoring)"></a><a class="anchor" name="enable health (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="enable health"></a><a href="#9.2-enable%20health">enable health</a></b> <span style="color: #080">&lt;backend&gt;</span>/<span style="color: #080">&lt;server&gt;</span></div><pre class="text">Resume a primary health check that was temporarily stopped. This will enable
sending of health checks again. Please see &quot;<a href="#disable%20health">disable health</a>&quot; for details.

This command is restricted and can only be issued on sockets configured for
level &quot;admin&quot;.
</pre><a class="anchor" name="enable"></a><a class="anchor" name="9-enable"></a><a class="anchor" name="9.2-enable"></a><a class="anchor" name="enable (Statistics and monitoring)"></a><a class="anchor" name="enable (Unix Socket commands)"></a><a class="anchor" name="enable server"></a><a class="anchor" name="9-enable server"></a><a class="anchor" name="9.2-enable server"></a><a class="anchor" name="enable server (Statistics and monitoring)"></a><a class="anchor" name="enable server (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="enable server"></a><a href="#9.2-enable%20server">enable server</a></b> <span style="color: #080">&lt;backend&gt;</span>/<span style="color: #080">&lt;server&gt;</span></div><pre class="text">If the server was previously marked as DOWN for maintenance, this marks the
server UP and checks are re-enabled.

Both the backend and the server may be specified either by their name or by
their numeric ID, prefixed with a sharp ('#').

This command is restricted and can only be issued on sockets configured for
level &quot;admin&quot;.
</pre><a class="anchor" name="get"></a><a class="anchor" name="9-get"></a><a class="anchor" name="9.2-get"></a><a class="anchor" name="get (Statistics and monitoring)"></a><a class="anchor" name="get (Unix Socket commands)"></a><a class="anchor" name="get map"></a><a class="anchor" name="9-get map"></a><a class="anchor" name="9.2-get map"></a><a class="anchor" name="get map (Statistics and monitoring)"></a><a class="anchor" name="get map (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="get map"></a><a href="#9.2-get%20map">get map</a></b> <span style="color: #080">&lt;map&gt;</span> <span style="color: #080">&lt;value&gt;</span></div><a class="anchor" name="get"></a><a class="anchor" name="9-get"></a><a class="anchor" name="9.2-get"></a><a class="anchor" name="get (Statistics and monitoring)"></a><a class="anchor" name="get (Unix Socket commands)"></a><a class="anchor" name="get acl"></a><a class="anchor" name="9-get acl"></a><a class="anchor" name="9.2-get acl"></a><a class="anchor" name="get acl (Statistics and monitoring)"></a><a class="anchor" name="get acl (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="get acl"></a><a href="#9.2-get%20acl">get acl</a></b> <span style="color: #080">&lt;acl&gt;</span> <span style="color: #080">&lt;value&gt;</span></div><pre class="text">Lookup the value &lt;value&gt; in the map &lt;map&gt; or in the ACL &lt;acl&gt;. &lt;map&gt; or &lt;acl&gt;
are the #&lt;id&gt; or the &lt;file&gt; returned by &quot;<a href="#show%20map">show map</a>&quot; or &quot;<a href="#show%20acl">show acl</a>&quot;. This command
returns all the matching patterns associated with this map. This is useful for
debugging maps and ACLs. The output format is composed by one line par
matching type. Each line is composed by space-delimited series of words.

The first two words are:

   &lt;match method&gt;:   The match method applied. It can be &quot;found&quot;, &quot;bool&quot;,
                     &quot;int&quot;, &quot;ip&quot;, &quot;bin&quot;, &quot;len&quot;, &quot;str&quot;, &quot;beg&quot;, &quot;sub&quot;, &quot;dir&quot;,
                     &quot;dom&quot;, &quot;end&quot; or &quot;reg&quot;.

   &lt;match result&gt;:   The result. Can be &quot;match&quot; or &quot;no-match&quot;.

The following words are returned only if the pattern matches an entry.

   &lt;index type&gt;:     &quot;tree&quot; or &quot;list&quot;. The internal lookup algorithm.

   &lt;case&gt;:           &quot;case-insensitive&quot; or &quot;case-sensitive&quot;. The
                     interpretation of the case.

   &lt;entry matched&gt;:  match=&quot;&lt;entry&gt;&quot;. Return the matched pattern. It is
                     useful with regular expressions.

The two last word are used to show the returned value and its type. With the
&quot;<a href="#acl">acl</a>&quot; case, the pattern doesn't exist.

   return=nothing:        No return because there are no &quot;<a href="#map">map</a>&quot;.
   return=&quot;&lt;value&gt;&quot;:      The value returned in the string format.
   return=cannot-display: The value cannot be converted as string.

   type=&quot;&lt;type&gt;&quot;:         The type of the returned sample.
</pre><a class="anchor" name="get"></a><a class="anchor" name="9-get"></a><a class="anchor" name="9.2-get"></a><a class="anchor" name="get (Statistics and monitoring)"></a><a class="anchor" name="get (Unix Socket commands)"></a><a class="anchor" name="get weight"></a><a class="anchor" name="9-get weight"></a><a class="anchor" name="9.2-get weight"></a><a class="anchor" name="get weight (Statistics and monitoring)"></a><a class="anchor" name="get weight (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="get weight"></a><a href="#9.2-get%20weight">get weight</a></b> <span style="color: #080">&lt;backend&gt;</span>/<span style="color: #080">&lt;server&gt;</span></div><pre class="text">Report the current weight and the initial weight of server &lt;server&gt; in
backend &lt;backend&gt; or an error if either doesn't exist. The initial weight is
the one that appears in the configuration file. Both are normally equal
unless the current weight has been changed. Both the backend and the server
may be specified either by their name or by their numeric ID, prefixed with a
sharp ('#').
</pre><a class="anchor" name="help"></a><a class="anchor" name="9-help"></a><a class="anchor" name="9.2-help"></a><a class="anchor" name="help (Statistics and monitoring)"></a><a class="anchor" name="help (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="help"></a><a href="#9.2-help">help</a></b></div><pre class="text">Print the list of known keywords and their basic usage. The same help screen
is also displayed for unknown commands.
</pre><a class="anchor" name="prompt"></a><a class="anchor" name="9-prompt"></a><a class="anchor" name="9.2-prompt"></a><a class="anchor" name="prompt (Statistics and monitoring)"></a><a class="anchor" name="prompt (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="prompt"></a><a href="#9.2-prompt">prompt</a></b></div><pre class="text">Toggle the prompt at the beginning of the line and enter or leave interactive
mode. In interactive mode, the connection is not closed after a command
completes. Instead, the prompt will appear again, indicating the user that
the interpreter is waiting for a new command. The prompt consists in a right
angle bracket followed by a space &quot;&gt; &quot;. This mode is particularly convenient
when one wants to periodically check information such as stats or errors.
It is also a good idea to enter interactive mode before issuing a &quot;<a href="#help">help</a>&quot;
command.
</pre><a class="anchor" name="quit"></a><a class="anchor" name="9-quit"></a><a class="anchor" name="9.2-quit"></a><a class="anchor" name="quit (Statistics and monitoring)"></a><a class="anchor" name="quit (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="quit"></a><a href="#9.2-quit">quit</a></b></div><pre class="text">Close the connection when in interactive mode.
</pre><a class="anchor" name="set"></a><a class="anchor" name="9-set"></a><a class="anchor" name="9.2-set"></a><a class="anchor" name="set (Statistics and monitoring)"></a><a class="anchor" name="set (Unix Socket commands)"></a><a class="anchor" name="set map"></a><a class="anchor" name="9-set map"></a><a class="anchor" name="9.2-set map"></a><a class="anchor" name="set map (Statistics and monitoring)"></a><a class="anchor" name="set map (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="set map"></a><a href="#9.2-set%20map">set map</a></b> <span style="color: #080">&lt;map&gt;</span> <span style="color: #008">[<span style="color: #080">&lt;key&gt;</span>|#<span style="color: #080">&lt;ref&gt;</span>]</span> <span style="color: #080">&lt;value&gt;</span></div><pre class="text">Modify the value corresponding to each key &lt;key&gt; in a map &lt;map&gt;. &lt;map&gt; is the
#&lt;id&gt; or &lt;file&gt; returned by &quot;<a href="#show%20map">show map</a>&quot;. If the &lt;ref&gt; is used in place of
&lt;key&gt;, only the entry pointed by &lt;ref&gt; is changed. The new value is &lt;value&gt;.
</pre><a class="anchor" name="set"></a><a class="anchor" name="9-set"></a><a class="anchor" name="9.2-set"></a><a class="anchor" name="set (Statistics and monitoring)"></a><a class="anchor" name="set (Unix Socket commands)"></a><a class="anchor" name="set maxconn"></a><a class="anchor" name="9-set maxconn"></a><a class="anchor" name="9.2-set maxconn"></a><a class="anchor" name="set maxconn (Statistics and monitoring)"></a><a class="anchor" name="set maxconn (Unix Socket commands)"></a><a class="anchor" name="set maxconn frontend"></a><a class="anchor" name="9-set maxconn frontend"></a><a class="anchor" name="9.2-set maxconn frontend"></a><a class="anchor" name="set maxconn frontend (Statistics and monitoring)"></a><a class="anchor" name="set maxconn frontend (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="set maxconn frontend"></a><a href="#9.2-set%20maxconn%20frontend">set maxconn frontend</a></b> <span style="color: #080">&lt;frontend&gt;</span> <span style="color: #080">&lt;value&gt;</span></div><pre class="text">Dynamically change the specified frontend's maxconn setting. Any positive
value is allowed including zero, but setting values larger than the global
maxconn does not make much sense. If the limit is increased and connections
were pending, they will immediately be accepted. If it is lowered to a value
below the current number of connections, new connections acceptation will be
delayed until the threshold is reached. The frontend might be specified by
either its name or its numeric ID prefixed with a sharp ('#').
</pre><a class="anchor" name="set"></a><a class="anchor" name="9-set"></a><a class="anchor" name="9.2-set"></a><a class="anchor" name="set (Statistics and monitoring)"></a><a class="anchor" name="set (Unix Socket commands)"></a><a class="anchor" name="set maxconn"></a><a class="anchor" name="9-set maxconn"></a><a class="anchor" name="9.2-set maxconn"></a><a class="anchor" name="set maxconn (Statistics and monitoring)"></a><a class="anchor" name="set maxconn (Unix Socket commands)"></a><a class="anchor" name="set maxconn global"></a><a class="anchor" name="9-set maxconn global"></a><a class="anchor" name="9.2-set maxconn global"></a><a class="anchor" name="set maxconn global (Statistics and monitoring)"></a><a class="anchor" name="set maxconn global (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="set maxconn global"></a><a href="#9.2-set%20maxconn%20global">set maxconn global</a></b> <span style="color: #080">&lt;maxconn&gt;</span></div><pre class="text">Dynamically change the global maxconn setting within the range defined by the
initial global maxconn setting. If it is increased and connections were
pending, they will immediately be accepted. If it is lowered to a value below
the current number of connections, new connections acceptation will be
delayed until the threshold is reached. A value of zero restores the initial
setting.
</pre><a class="anchor" name="set"></a><a class="anchor" name="9-set"></a><a class="anchor" name="9.2-set"></a><a class="anchor" name="set (Statistics and monitoring)"></a><a class="anchor" name="set (Unix Socket commands)"></a><a class="anchor" name="set rate-limit"></a><a class="anchor" name="9-set rate-limit"></a><a class="anchor" name="9.2-set rate-limit"></a><a class="anchor" name="set rate-limit (Statistics and monitoring)"></a><a class="anchor" name="set rate-limit (Unix Socket commands)"></a><a class="anchor" name="set rate-limit connections"></a><a class="anchor" name="9-set rate-limit connections"></a><a class="anchor" name="9.2-set rate-limit connections"></a><a class="anchor" name="set rate-limit connections (Statistics and monitoring)"></a><a class="anchor" name="set rate-limit connections (Unix Socket commands)"></a><a class="anchor" name="set rate-limit connections global"></a><a class="anchor" name="9-set rate-limit connections global"></a><a class="anchor" name="9.2-set rate-limit connections global"></a><a class="anchor" name="set rate-limit connections global (Statistics and monitoring)"></a><a class="anchor" name="set rate-limit connections global (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="set rate-limit connections global"></a><a href="#9.2-set%20rate-limit%20connections%20global">set rate-limit connections global</a></b> <span style="color: #080">&lt;value&gt;</span></div><pre class="text">Change the process-wide connection rate limit, which is set by the global
'maxconnrate' setting. A value of zero disables the limitation. This limit
applies to all frontends and the change has an immediate effect. The value
is passed in number of connections per second.
</pre><a class="anchor" name="set"></a><a class="anchor" name="9-set"></a><a class="anchor" name="9.2-set"></a><a class="anchor" name="set (Statistics and monitoring)"></a><a class="anchor" name="set (Unix Socket commands)"></a><a class="anchor" name="set rate-limit"></a><a class="anchor" name="9-set rate-limit"></a><a class="anchor" name="9.2-set rate-limit"></a><a class="anchor" name="set rate-limit (Statistics and monitoring)"></a><a class="anchor" name="set rate-limit (Unix Socket commands)"></a><a class="anchor" name="set rate-limit http-compression"></a><a class="anchor" name="9-set rate-limit http-compression"></a><a class="anchor" name="9.2-set rate-limit http-compression"></a><a class="anchor" name="set rate-limit http-compression (Statistics and monitoring)"></a><a class="anchor" name="set rate-limit http-compression (Unix Socket commands)"></a><a class="anchor" name="set rate-limit http-compression global"></a><a class="anchor" name="9-set rate-limit http-compression global"></a><a class="anchor" name="9.2-set rate-limit http-compression global"></a><a class="anchor" name="set rate-limit http-compression global (Statistics and monitoring)"></a><a class="anchor" name="set rate-limit http-compression global (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="set rate-limit http-compression global"></a><a href="#9.2-set%20rate-limit%20http-compression%20global">set rate-limit http-compression global</a></b> <span style="color: #080">&lt;value&gt;</span></div><pre class="text">Change the maximum input compression rate, which is set by the global
'maxcomprate' setting. A value of zero disables the limitation. The value is
passed in number of kilobytes per second. The value is available in the &quot;show
info&quot; on the line &quot;CompressBpsRateLim&quot; in bytes.
</pre><a class="anchor" name="set"></a><a class="anchor" name="9-set"></a><a class="anchor" name="9.2-set"></a><a class="anchor" name="set (Statistics and monitoring)"></a><a class="anchor" name="set (Unix Socket commands)"></a><a class="anchor" name="set rate-limit"></a><a class="anchor" name="9-set rate-limit"></a><a class="anchor" name="9.2-set rate-limit"></a><a class="anchor" name="set rate-limit (Statistics and monitoring)"></a><a class="anchor" name="set rate-limit (Unix Socket commands)"></a><a class="anchor" name="set rate-limit sessions"></a><a class="anchor" name="9-set rate-limit sessions"></a><a class="anchor" name="9.2-set rate-limit sessions"></a><a class="anchor" name="set rate-limit sessions (Statistics and monitoring)"></a><a class="anchor" name="set rate-limit sessions (Unix Socket commands)"></a><a class="anchor" name="set rate-limit sessions global"></a><a class="anchor" name="9-set rate-limit sessions global"></a><a class="anchor" name="9.2-set rate-limit sessions global"></a><a class="anchor" name="set rate-limit sessions global (Statistics and monitoring)"></a><a class="anchor" name="set rate-limit sessions global (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="set rate-limit sessions global"></a><a href="#9.2-set%20rate-limit%20sessions%20global">set rate-limit sessions global</a></b> <span style="color: #080">&lt;value&gt;</span></div><pre class="text">Change the process-wide session rate limit, which is set by the global
'maxsessrate' setting. A value of zero disables the limitation. This limit
applies to all frontends and the change has an immediate effect. The value
is passed in number of sessions per second.
</pre><a class="anchor" name="set"></a><a class="anchor" name="9-set"></a><a class="anchor" name="9.2-set"></a><a class="anchor" name="set (Statistics and monitoring)"></a><a class="anchor" name="set (Unix Socket commands)"></a><a class="anchor" name="set rate-limit"></a><a class="anchor" name="9-set rate-limit"></a><a class="anchor" name="9.2-set rate-limit"></a><a class="anchor" name="set rate-limit (Statistics and monitoring)"></a><a class="anchor" name="set rate-limit (Unix Socket commands)"></a><a class="anchor" name="set rate-limit ssl-sessions"></a><a class="anchor" name="9-set rate-limit ssl-sessions"></a><a class="anchor" name="9.2-set rate-limit ssl-sessions"></a><a class="anchor" name="set rate-limit ssl-sessions (Statistics and monitoring)"></a><a class="anchor" name="set rate-limit ssl-sessions (Unix Socket commands)"></a><a class="anchor" name="set rate-limit ssl-sessions global"></a><a class="anchor" name="9-set rate-limit ssl-sessions global"></a><a class="anchor" name="9.2-set rate-limit ssl-sessions global"></a><a class="anchor" name="set rate-limit ssl-sessions global (Statistics and monitoring)"></a><a class="anchor" name="set rate-limit ssl-sessions global (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="set rate-limit ssl-sessions global"></a><a href="#9.2-set%20rate-limit%20ssl-sessions%20global">set rate-limit ssl-sessions global</a></b> <span style="color: #080">&lt;value&gt;</span></div><pre class="text">Change the process-wide SSL session rate limit, which is set by the global
'maxsslrate' setting. A value of zero disables the limitation. This limit
applies to all frontends and the change has an immediate effect. The value
is passed in number of sessions per second sent to the SSL stack. It applies
before the handshake in order to protect the stack against handshake abuses.
</pre><a class="anchor" name="set"></a><a class="anchor" name="9-set"></a><a class="anchor" name="9.2-set"></a><a class="anchor" name="set (Statistics and monitoring)"></a><a class="anchor" name="set (Unix Socket commands)"></a><a class="anchor" name="set server"></a><a class="anchor" name="9-set server"></a><a class="anchor" name="9.2-set server"></a><a class="anchor" name="set server (Statistics and monitoring)"></a><a class="anchor" name="set server (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="set server"></a><a href="#9.2-set%20server">set server</a></b> <span style="color: #080">&lt;backend&gt;</span>/<span style="color: #080">&lt;server&gt;</span> agent <span style="color: #008">[ up | down ]</span></div><pre class="text">Force a server's agent to a new state. This can be useful to immediately
switch a server's state regardless of some slow agent checks for example.
Note that the change is propagated to tracking servers if any.
</pre><a class="anchor" name="set"></a><a class="anchor" name="9-set"></a><a class="anchor" name="9.2-set"></a><a class="anchor" name="set (Statistics and monitoring)"></a><a class="anchor" name="set (Unix Socket commands)"></a><a class="anchor" name="set server"></a><a class="anchor" name="9-set server"></a><a class="anchor" name="9.2-set server"></a><a class="anchor" name="set server (Statistics and monitoring)"></a><a class="anchor" name="set server (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="set server"></a><a href="#9.2-set%20server">set server</a></b> <span style="color: #080">&lt;backend&gt;</span>/<span style="color: #080">&lt;server&gt;</span> health <span style="color: #008">[ up | stopping | down ]</span></div><pre class="text">Force a server's health to a new state. This can be useful to immediately
switch a server's state regardless of some slow health checks for example.
Note that the change is propagated to tracking servers if any.
</pre><a class="anchor" name="set"></a><a class="anchor" name="9-set"></a><a class="anchor" name="9.2-set"></a><a class="anchor" name="set (Statistics and monitoring)"></a><a class="anchor" name="set (Unix Socket commands)"></a><a class="anchor" name="set server"></a><a class="anchor" name="9-set server"></a><a class="anchor" name="9.2-set server"></a><a class="anchor" name="set server (Statistics and monitoring)"></a><a class="anchor" name="set server (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="set server"></a><a href="#9.2-set%20server">set server</a></b> <span style="color: #080">&lt;backend&gt;</span>/<span style="color: #080">&lt;server&gt;</span> state <span style="color: #008">[ ready | drain | maint ]</span></div><pre class="text">Force a server's administrative state to a new state. This can be useful to
disable load balancing and/or any traffic to a server. Setting the state to
&quot;ready&quot; puts the server in normal mode, and the command is the equivalent of
the &quot;<a href="#enable%20server">enable server</a>&quot; command. Setting the state to &quot;maint&quot; disables any traffic
to the server as well as any health checks. This is the equivalent of the
&quot;<a href="#disable%20server">disable server</a>&quot; command. Setting the mode to &quot;drain&quot; only removes the server
from load balancing but still allows it to be checked and to accept new
persistent connections. Changes are propagated to tracking servers if any.
</pre><a class="anchor" name="set"></a><a class="anchor" name="9-set"></a><a class="anchor" name="9.2-set"></a><a class="anchor" name="set (Statistics and monitoring)"></a><a class="anchor" name="set (Unix Socket commands)"></a><a class="anchor" name="set server"></a><a class="anchor" name="9-set server"></a><a class="anchor" name="9.2-set server"></a><a class="anchor" name="set server (Statistics and monitoring)"></a><a class="anchor" name="set server (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="set server"></a><a href="#9.2-set%20server">set server</a></b> <span style="color: #080">&lt;backend&gt;</span>/<span style="color: #080">&lt;server&gt;</span> weight <span style="color: #080">&lt;weight&gt;</span><span style="color: #008">[%]</span></div><pre class="text">Change a server's weight to the value passed in argument. This is the exact
equivalent of the &quot;<a href="#set%20weight">set weight</a>&quot; command below.
</pre><a class="anchor" name="set"></a><a class="anchor" name="9-set"></a><a class="anchor" name="9.2-set"></a><a class="anchor" name="set (Statistics and monitoring)"></a><a class="anchor" name="set (Unix Socket commands)"></a><a class="anchor" name="set ssl"></a><a class="anchor" name="9-set ssl"></a><a class="anchor" name="9.2-set ssl"></a><a class="anchor" name="set ssl (Statistics and monitoring)"></a><a class="anchor" name="set ssl (Unix Socket commands)"></a><a class="anchor" name="set ssl ocsp-response"></a><a class="anchor" name="9-set ssl ocsp-response"></a><a class="anchor" name="9.2-set ssl ocsp-response"></a><a class="anchor" name="set ssl ocsp-response (Statistics and monitoring)"></a><a class="anchor" name="set ssl ocsp-response (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="set ssl ocsp-response"></a><a href="#9.2-set%20ssl%20ocsp-response">set ssl ocsp-response</a></b> <span style="color: #080">&lt;response&gt;</span></div><pre class="text">This command is used to update an OCSP Response for a certificate (see &quot;<span class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">crt<span class="caret"></span></a><ul class="dropdown-menu"><li class="dropdown-header">This keyword is available in sections :</li><li><a href="#crt%20%28Bind%20options%29">Bind options</a></li><li><a href="#crt%20%28Server%20and%20default-server%20options%29">Server and default-server options</a></li></ul></span>&quot;
on &quot;<a href="#bind">bind</a>&quot; lines). Same controls are performed as during the initial loading of
the response. The &lt;response&gt; must be passed as a base64 encoded string of the
DER encoded response from the OCSP server.
</pre><div class="separator">
<span class="label label-success">Example:</span>
<pre class="prettyprint">
<code>openssl ocsp -issuer issuer.pem -cert server.pem \
             -host ocsp.issuer.com:80 -respout resp.der
echo &quot;set ssl ocsp-response $(base64 -w 10000 resp.der)&quot; | \
             socat stdio /var/run/haproxy.stat
</code></pre>
</div><a class="anchor" name="set"></a><a class="anchor" name="9-set"></a><a class="anchor" name="9.2-set"></a><a class="anchor" name="set (Statistics and monitoring)"></a><a class="anchor" name="set (Unix Socket commands)"></a><a class="anchor" name="set table"></a><a class="anchor" name="9-set table"></a><a class="anchor" name="9.2-set table"></a><a class="anchor" name="set table (Statistics and monitoring)"></a><a class="anchor" name="set table (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="set table"></a><a href="#9.2-set%20table">set table</a></b> <span style="color: #080">&lt;table&gt;</span> key <span style="color: #080">&lt;key&gt;</span> <span style="color: #008">[data.<span style="color: #080">&lt;data_type&gt;</span> <span style="color: #080">&lt;value&gt;</span>]</span>*</div><pre class="text">Create or update a stick-table entry in the table. If the key is not present,
an entry is inserted. See stick-table in <a href="#4.2">section 4.2</a> to find all possible
values for &lt;data_type&gt;. The most likely use consists in dynamically entering
entries for source IP addresses, with a flag in gpc0 to dynamically block an
IP address or affect its quality of service. It is possible to pass multiple
data_types in a single call.
</pre><a class="anchor" name="set"></a><a class="anchor" name="9-set"></a><a class="anchor" name="9.2-set"></a><a class="anchor" name="set (Statistics and monitoring)"></a><a class="anchor" name="set (Unix Socket commands)"></a><a class="anchor" name="set timeout"></a><a class="anchor" name="9-set timeout"></a><a class="anchor" name="9.2-set timeout"></a><a class="anchor" name="set timeout (Statistics and monitoring)"></a><a class="anchor" name="set timeout (Unix Socket commands)"></a><a class="anchor" name="set timeout cli"></a><a class="anchor" name="9-set timeout cli"></a><a class="anchor" name="9.2-set timeout cli"></a><a class="anchor" name="set timeout cli (Statistics and monitoring)"></a><a class="anchor" name="set timeout cli (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="set timeout cli"></a><a href="#9.2-set%20timeout%20cli">set timeout cli</a></b> <span style="color: #080">&lt;delay&gt;</span></div><pre class="text">Change the CLI interface timeout for current connection. This can be useful
during long debugging sessions where the user needs to constantly inspect
some indicators without being disconnected. The delay is passed in seconds.
</pre><a class="anchor" name="set"></a><a class="anchor" name="9-set"></a><a class="anchor" name="9.2-set"></a><a class="anchor" name="set (Statistics and monitoring)"></a><a class="anchor" name="set (Unix Socket commands)"></a><a class="anchor" name="set weight"></a><a class="anchor" name="9-set weight"></a><a class="anchor" name="9.2-set weight"></a><a class="anchor" name="set weight (Statistics and monitoring)"></a><a class="anchor" name="set weight (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="set weight"></a><a href="#9.2-set%20weight">set weight</a></b> <span style="color: #080">&lt;backend&gt;</span>/<span style="color: #080">&lt;server&gt;</span> <span style="color: #080">&lt;weight&gt;</span><span style="color: #008">[%]</span></div><pre class="text">Change a server's weight to the value passed in argument. If the value ends
with the '%' sign, then the new weight will be relative to the initially
configured weight.  Absolute weights are permitted between 0 and 256.
Relative weights must be positive with the resulting absolute weight is
capped at 256.  Servers which are part of a farm running a static
load-balancing algorithm have stricter limitations because the weight
cannot change once set. Thus for these servers, the only accepted values
are 0 and 100% (or 0 and the initial weight). Changes take effect
immediately, though certain LB algorithms require a certain amount of
requests to consider changes. A typical usage of this command is to
disable a server during an update by setting its weight to zero, then to
enable it again after the update by setting it back to 100%. This command
is restricted and can only be issued on sockets configured for level
&quot;admin&quot;. Both the backend and the server may be specified either by their
name or by their numeric ID, prefixed with a sharp ('#').
</pre><a class="anchor" name="show"></a><a class="anchor" name="9-show"></a><a class="anchor" name="9.2-show"></a><a class="anchor" name="show (Statistics and monitoring)"></a><a class="anchor" name="show (Unix Socket commands)"></a><a class="anchor" name="show errors"></a><a class="anchor" name="9-show errors"></a><a class="anchor" name="9.2-show errors"></a><a class="anchor" name="show errors (Statistics and monitoring)"></a><a class="anchor" name="show errors (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="show errors"></a><a href="#9.2-show%20errors">show errors</a></b> <span style="color: #008">[<span style="color: #080">&lt;iid&gt;</span>]</span></div><pre class="text">Dump last known request and response errors collected by frontends and
backends. If &lt;iid&gt; is specified, the limit the dump to errors concerning
either frontend or backend whose ID is &lt;iid&gt;. This command is restricted
and can only be issued on sockets configured for levels &quot;operator&quot; or
&quot;admin&quot;.

The errors which may be collected are the last request and response errors
caused by protocol violations, often due to invalid characters in header
names. The report precisely indicates what exact character violated the
protocol. Other important information such as the exact date the error was
detected, frontend and backend names, the server name (when known), the
internal session ID and the source address which has initiated the session
are reported too.

All characters are returned, and non-printable characters are encoded. The
most common ones (\t = 9, \n = 10, \r = 13 and \e = 27) are encoded as one
letter following a backslash. The backslash itself is encoded as '\\' to
avoid confusion. Other non-printable characters are encoded '\xNN' where
NN is the two-digits hexadecimal representation of the character's ASCII
code.

Lines are prefixed with the position of their first character, starting at 0
for the beginning of the buffer. At most one input line is printed per line,
and large lines will be broken into multiple consecutive output lines so that
the output never goes beyond 79 characters wide. It is easy to detect if a
line was broken, because it will not end with '\n' and the next line's offset
will be followed by a '+' sign, indicating it is a continuation of previous
line.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>    $ echo &quot;<a href="#show%20errors">show errors</a>&quot; | socat stdio /tmp/sock1
&gt;&gt;&gt; [04/Mar/2009:15:46:56.081] backend http-in (<span class="comment">#2) : invalid response</span>
      src 127.0.0.1, session <span class="comment">#54, frontend fe-eth0 (#1), server s2 (#1)</span>
      response length 213 bytes, error at position 23:

      00000  HTTP/1.0 200 OK\r\n
      00017  header/bizarre:blah\r\n
      00038  Location: blah\r\n
      00054  Long-line: this is a very long line which should b
      00104+ e broken into multiple lines on the output buffer,
      00154+  otherwise it would be too large to print in a ter
      00204+ minal\r\n
      00211  \r\n

In the example above, we see that the backend &quot;http-in&quot; which has internal
ID 2 has blocked an invalid response from its server s2 which has internal
ID 1. The request was on session 54 initiated by source 127.0.0.1 and
received by frontend fe-eth0 whose ID is 1. The total response length was
213 bytes when the error was detected, and the error was at byte 23. This
is the slash ('/') in header name &quot;header/bizarre&quot;, which is not a valid
HTTP character for a header name.
</code></pre>
</div><a class="anchor" name="show"></a><a class="anchor" name="9-show"></a><a class="anchor" name="9.2-show"></a><a class="anchor" name="show (Statistics and monitoring)"></a><a class="anchor" name="show (Unix Socket commands)"></a><a class="anchor" name="show info"></a><a class="anchor" name="9-show info"></a><a class="anchor" name="9.2-show info"></a><a class="anchor" name="show info (Statistics and monitoring)"></a><a class="anchor" name="show info (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="show info"></a><a href="#9.2-show%20info">show info</a></b></div><pre class="text">Dump info about haproxy status on current process.
</pre><a class="anchor" name="show"></a><a class="anchor" name="9-show"></a><a class="anchor" name="9.2-show"></a><a class="anchor" name="show (Statistics and monitoring)"></a><a class="anchor" name="show (Unix Socket commands)"></a><a class="anchor" name="show map"></a><a class="anchor" name="9-show map"></a><a class="anchor" name="9.2-show map"></a><a class="anchor" name="show map (Statistics and monitoring)"></a><a class="anchor" name="show map (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="show map"></a><a href="#9.2-show%20map">show map</a></b> <span style="color: #008">[<span style="color: #080">&lt;map&gt;</span>]</span></div><pre class="text">Dump info about map converters. Without argument, the list of all available
maps is returned. If a &lt;map&gt; is specified, its contents are dumped. &lt;map&gt; is
the #&lt;id&gt; or &lt;file&gt;. The first column is a unique identifier. It can be used
as reference for the operation &quot;<a href="#del%20map">del map</a>&quot; and &quot;<a href="#set%20map">set map</a>&quot;. The second column is
the pattern and the third column is the sample if available. The data returned
are not directly a list of available maps, but are the list of all patterns
composing any map. Many of these patterns can be shared with ACL.
</pre><a class="anchor" name="show"></a><a class="anchor" name="9-show"></a><a class="anchor" name="9.2-show"></a><a class="anchor" name="show (Statistics and monitoring)"></a><a class="anchor" name="show (Unix Socket commands)"></a><a class="anchor" name="show acl"></a><a class="anchor" name="9-show acl"></a><a class="anchor" name="9.2-show acl"></a><a class="anchor" name="show acl (Statistics and monitoring)"></a><a class="anchor" name="show acl (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="show acl"></a><a href="#9.2-show%20acl">show acl</a></b> <span style="color: #008">[<span style="color: #080">&lt;acl&gt;</span>]</span></div><pre class="text">Dump info about acl converters. Without argument, the list of all available
acls is returned. If a &lt;acl&gt; is specified, its contents are dumped. &lt;acl&gt; if
the #&lt;id&gt; or &lt;file&gt;. The dump format is the same than the map even for the
sample value. The data returned are not a list of available ACL, but are the
list of all patterns composing any ACL. Many of these patterns can be shared
with maps.
</pre><a class="anchor" name="show"></a><a class="anchor" name="9-show"></a><a class="anchor" name="9.2-show"></a><a class="anchor" name="show (Statistics and monitoring)"></a><a class="anchor" name="show (Unix Socket commands)"></a><a class="anchor" name="show pools"></a><a class="anchor" name="9-show pools"></a><a class="anchor" name="9.2-show pools"></a><a class="anchor" name="show pools (Statistics and monitoring)"></a><a class="anchor" name="show pools (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="show pools"></a><a href="#9.2-show%20pools">show pools</a></b></div><pre class="text">Dump the status of internal memory pools. This is useful to track memory
usage when suspecting a memory leak for example. It does exactly the same
as the SIGQUIT when running in foreground except that it does not flush
the pools.
</pre><a class="anchor" name="show"></a><a class="anchor" name="9-show"></a><a class="anchor" name="9.2-show"></a><a class="anchor" name="show (Statistics and monitoring)"></a><a class="anchor" name="show (Unix Socket commands)"></a><a class="anchor" name="show sess"></a><a class="anchor" name="9-show sess"></a><a class="anchor" name="9.2-show sess"></a><a class="anchor" name="show sess (Statistics and monitoring)"></a><a class="anchor" name="show sess (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="show sess"></a><a href="#9.2-show%20sess">show sess</a></b></div><pre class="text">Dump all known sessions. Avoid doing this on slow connections as this can
be huge. This command is restricted and can only be issued on sockets
configured for levels &quot;operator&quot; or &quot;admin&quot;.
</pre><a class="anchor" name="show"></a><a class="anchor" name="9-show"></a><a class="anchor" name="9.2-show"></a><a class="anchor" name="show (Statistics and monitoring)"></a><a class="anchor" name="show (Unix Socket commands)"></a><a class="anchor" name="show sess"></a><a class="anchor" name="9-show sess"></a><a class="anchor" name="9.2-show sess"></a><a class="anchor" name="show sess (Statistics and monitoring)"></a><a class="anchor" name="show sess (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="show sess"></a><a href="#9.2-show%20sess">show sess</a></b> <span style="color: #080">&lt;id&gt;</span></div><pre class="text">Display a lot of internal information about the specified session identifier.
This identifier is the first field at the beginning of the lines in the dumps
of &quot;<a href="#show%20sess">show sess</a>&quot; (it corresponds to the session pointer). Those information are
useless to most users but may be used by haproxy developers to troubleshoot a
complex bug. The output format is intentionally not documented so that it can
freely evolve depending on demands. The special id &quot;all&quot; dumps the states of
all sessions, which can be avoided as much as possible as it is highly CPU
intensive and can take a lot of time.
</pre><a class="anchor" name="show"></a><a class="anchor" name="9-show"></a><a class="anchor" name="9.2-show"></a><a class="anchor" name="show (Statistics and monitoring)"></a><a class="anchor" name="show (Unix Socket commands)"></a><a class="anchor" name="show stat"></a><a class="anchor" name="9-show stat"></a><a class="anchor" name="9.2-show stat"></a><a class="anchor" name="show stat (Statistics and monitoring)"></a><a class="anchor" name="show stat (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="show stat"></a><a href="#9.2-show%20stat">show stat</a></b> <span style="color: #008">[<span style="color: #080">&lt;iid&gt;</span> <span style="color: #080">&lt;type&gt;</span> <span style="color: #080">&lt;sid&gt;</span>]</span></div><pre class="text">Dump statistics in the CSV format. By passing &lt;id&gt;, &lt;type&gt; and &lt;sid&gt;, it is
possible to dump only selected items :
  - &lt;iid&gt; is a proxy ID, -1 to dump everything
  - &lt;type&gt; selects the type of dumpable objects : 1 for frontends, 2 for
     backends, 4 for servers, -1 for everything. These values can be ORed,
     for example:
        1 + 2     = 3   -&gt; frontend + backend.
        1 + 2 + 4 = 7   -&gt; frontend + backend + server.
  - &lt;sid&gt; is a server ID, -1 to dump everything from the selected proxy.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>    $ echo &quot;show info;show stat&quot; | socat stdio unix-connect:/tmp/sock1
&gt;&gt;&gt; Name: HAProxy
    Version: 1.4-dev2-49
    Release_date: 2009/09/23
    Nbproc: 1
    Process_num: 1
    (...)

    <span class="comment"># pxname,svname,qcur,qmax,scur,smax,slim,stot,bin,bout,dreq,  (...)</span>
    stats,FRONTEND,,,0,0,1000,0,0,0,0,0,0,,,,,OPEN,,,,,,,,,1,1,0, (...)
    stats,BACKEND,0,0,0,0,1000,0,0,0,0,0,,0,0,0,0,UP,0,0,0,,0,250,(...)
    (...)
    www1,BACKEND,0,0,0,0,1000,0,0,0,0,0,,0,0,0,0,UP,1,1,0,,0,250, (...)

    $

Here, two commands have been issued at once. That way it's easy to find
which process the stats apply to in multi-process mode. Notice the empty
line after the information output which marks the end of the first block.
A similar empty line appears at the end of the second block (stats) so that
the reader knows the output has not been truncated.
</code></pre>
</div><a class="anchor" name="show"></a><a class="anchor" name="9-show"></a><a class="anchor" name="9.2-show"></a><a class="anchor" name="show (Statistics and monitoring)"></a><a class="anchor" name="show (Unix Socket commands)"></a><a class="anchor" name="show table"></a><a class="anchor" name="9-show table"></a><a class="anchor" name="9.2-show table"></a><a class="anchor" name="show table (Statistics and monitoring)"></a><a class="anchor" name="show table (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="show table"></a><a href="#9.2-show%20table">show table</a></b></div><pre class="text">Dump general information on all known stick-tables. Their name is returned
(the name of the proxy which holds them), their type (currently zero, always
IP), their size in maximum possible number of entries, and the number of
entries currently in use.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>    $ echo &quot;<a href="#show%20table">show table</a>&quot; | socat stdio /tmp/sock1
&gt;&gt;&gt; <span class="comment"># table: front_pub, type: ip, size:204800, used:171454</span>
&gt;&gt;&gt; <span class="comment"># table: back_rdp, type: ip, size:204800, used:0</span>
</code></pre>
</div><a class="anchor" name="show"></a><a class="anchor" name="9-show"></a><a class="anchor" name="9.2-show"></a><a class="anchor" name="show (Statistics and monitoring)"></a><a class="anchor" name="show (Unix Socket commands)"></a><a class="anchor" name="show table"></a><a class="anchor" name="9-show table"></a><a class="anchor" name="9.2-show table"></a><a class="anchor" name="show table (Statistics and monitoring)"></a><a class="anchor" name="show table (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="show table"></a><a href="#9.2-show%20table">show table</a></b> <span style="color: #080">&lt;name&gt;</span> <span style="color: #008">[ data.<span style="color: #080">&lt;type&gt;</span> <span style="color: #080">&lt;operator&gt;</span> <span style="color: #080">&lt;value&gt;</span> ]</span> | <span style="color: #008">[ key <span style="color: #080">&lt;key&gt;</span> ]</span></div><pre class="text">Dump contents of stick-table &lt;name&gt;. In this mode, a first line of generic
information about the table is reported as with &quot;<a href="#show%20table">show table</a>&quot;, then all
entries are dumped. Since this can be quite heavy, it is possible to specify
a filter in order to specify what entries to display.

When the &quot;data.&quot; form is used the filter applies to the stored data (see
&quot;<a href="#stick-table">stick-table</a>&quot; in <a href="#4.2">section 4.2</a>).  A stored data type must be specified
in &lt;type&gt;, and this data type must be stored in the table otherwise an
error is reported. The data is compared according to &lt;operator&gt; with the
64-bit integer &lt;value&gt;.  Operators are the same as with the ACLs :

  - eq : match entries whose data is equal to this value
  - ne : match entries whose data is not equal to this value
  - le : match entries whose data is less than or equal to this value
  - ge : match entries whose data is greater than or equal to this value
  - lt : match entries whose data is less than this value
  - gt : match entries whose data is greater than this value


When the key form is used the entry &lt;key&gt; is shown.  The key must be of the
same type as the table, which currently is limited to IPv4, IPv6, integer,
and string.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>    $ echo &quot;show table http_proxy&quot; | socat stdio /tmp/sock1
&gt;&gt;&gt; <span class="comment"># table: http_proxy, type: ip, size:204800, used:2</span>
&gt;&gt;&gt; 0x80e6a4c: key=127.0.0.1 use=0 exp=3594729 gpc0=0 conn_rate(30000)=1  \
      bytes_out_rate(60000)=187
&gt;&gt;&gt; 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \
      bytes_out_rate(60000)=191

    $ echo &quot;show table http_proxy data.gpc0 gt 0&quot; | socat stdio /tmp/sock1
&gt;&gt;&gt; <span class="comment"># table: http_proxy, type: ip, size:204800, used:2</span>
&gt;&gt;&gt; 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \
      bytes_out_rate(60000)=191

    $ echo &quot;show table http_proxy data.conn_rate gt 5&quot; | \
        socat stdio /tmp/sock1
&gt;&gt;&gt; <span class="comment"># table: http_proxy, type: ip, size:204800, used:2</span>
&gt;&gt;&gt; 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \
      bytes_out_rate(60000)=191

    $ echo &quot;show table http_proxy key 127.0.0.2&quot; | \
        socat stdio /tmp/sock1
&gt;&gt;&gt; <span class="comment"># table: http_proxy, type: ip, size:204800, used:2</span>
&gt;&gt;&gt; 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \
      bytes_out_rate(60000)=191
</code></pre>
</div><pre class="text">When the data criterion applies to a dynamic value dependent on time such as
a bytes rate, the value is dynamically computed during the evaluation of the
entry in order to decide whether it has to be dumped or not. This means that
such a filter could match for some time then not match anymore because as
time goes, the average event rate drops.

It is possible to use this to extract lists of IP addresses abusing the
service, in order to monitor them or even blacklist them in a firewall.
</pre><div class="separator">
<span class="label label-success">Example :</span>
<pre class="prettyprint">
<code>$ echo &quot;show table http_proxy data.gpc0 gt 0&quot; \
  | socat stdio /tmp/sock1 \
  | fgrep 'key=' | cut -d' ' -f2 | cut -d= -f2 &gt; abusers-ip.txt
  ( or | awk '/key/{ print a[split($2,a,&quot;=&quot;)]; }' )
</code></pre>
</div><a class="anchor" name="shutdown"></a><a class="anchor" name="9-shutdown"></a><a class="anchor" name="9.2-shutdown"></a><a class="anchor" name="shutdown (Statistics and monitoring)"></a><a class="anchor" name="shutdown (Unix Socket commands)"></a><a class="anchor" name="shutdown frontend"></a><a class="anchor" name="9-shutdown frontend"></a><a class="anchor" name="9.2-shutdown frontend"></a><a class="anchor" name="shutdown frontend (Statistics and monitoring)"></a><a class="anchor" name="shutdown frontend (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="shutdown frontend"></a><a href="#9.2-shutdown%20frontend">shutdown frontend</a></b> <span style="color: #080">&lt;frontend&gt;</span></div><pre class="text">Completely delete the specified frontend. All the ports it was bound to will
be released. It will not be possible to enable the frontend anymore after
this operation. This is intended to be used in environments where stopping a
proxy is not even imaginable but a misconfigured proxy must be fixed. That
way it's possible to release the port and bind it into another process to
restore operations. The frontend will not appear at all on the stats page
once it is terminated.

The frontend may be specified either by its name or by its numeric ID,
prefixed with a sharp ('#').

This command is restricted and can only be issued on sockets configured for
level &quot;admin&quot;.
</pre><a class="anchor" name="shutdown"></a><a class="anchor" name="9-shutdown"></a><a class="anchor" name="9.2-shutdown"></a><a class="anchor" name="shutdown (Statistics and monitoring)"></a><a class="anchor" name="shutdown (Unix Socket commands)"></a><a class="anchor" name="shutdown session"></a><a class="anchor" name="9-shutdown session"></a><a class="anchor" name="9.2-shutdown session"></a><a class="anchor" name="shutdown session (Statistics and monitoring)"></a><a class="anchor" name="shutdown session (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="shutdown session"></a><a href="#9.2-shutdown%20session">shutdown session</a></b> <span style="color: #080">&lt;id&gt;</span></div><pre class="text">Immediately terminate the session matching the specified session identifier.
This identifier is the first field at the beginning of the lines in the dumps
of &quot;<a href="#show%20sess">show sess</a>&quot; (it corresponds to the session pointer). This can be used to
terminate a long-running session without waiting for a timeout or when an
endless transfer is ongoing. Such terminated sessions are reported with a 'K'
flag in the logs.
</pre><a class="anchor" name="shutdown"></a><a class="anchor" name="9-shutdown"></a><a class="anchor" name="9.2-shutdown"></a><a class="anchor" name="shutdown (Statistics and monitoring)"></a><a class="anchor" name="shutdown (Unix Socket commands)"></a><a class="anchor" name="shutdown sessions"></a><a class="anchor" name="9-shutdown sessions"></a><a class="anchor" name="9.2-shutdown sessions"></a><a class="anchor" name="shutdown sessions (Statistics and monitoring)"></a><a class="anchor" name="shutdown sessions (Unix Socket commands)"></a><div class="keyword"><b><a class="anchor" name="shutdown sessions"></a><a href="#9.2-shutdown%20sessions">shutdown sessions</a></b> <span style="color: #080">&lt;backend&gt;</span>/<span style="color: #080">&lt;server&gt;</span></div><pre class="text">Immediately terminate all the sessions attached to the specified server. This
can be used to terminate long-running sessions after a server is put into
maintenance mode, for instance. Such terminated sessions are reported with a
'K' flag in the logs.
</pre>
</div>

						<br>
						<hr>
						<div class="text-right">
							HAProxy 1.6-dev0 &ndash; Configuration Manual<br>
							<small>2014/06/19, willy tarreau</small>
						</div>
					</div>
					<!-- /.col-lg-12 -->
				</div>
				<!-- /.row -->
				<div style="position: fixed; z-index: 1000; bottom: 0; left: 0; right: 0; padding: 10px">
					<ul class="pager" style="margin: 0">
						<li class="previous"><a id="previous" href="#"></a></li>
						<li class="next"><a id="next" href="#"></a></li>
					</ul>
				</div>
			</div>
			<!-- /#page-wrapper -->

		</div>
		<!-- /#wrapper -->

		<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.10.2/typeahead.bundle.min.js"></script>
		<script>
			/* Keyword search */
			var searchFocus = false
			var keywords = [
				"accept-proxy",
				"acl",
				"add",
				"add acl",
				"add map",
				"addr",
				"agent-check",
				"agent-inter",
				"agent-port",
				"alpn",
				"always_false",
				"always_true",
				"appsession",
				"avg_queue",
				"backlog (Alphabetically sorted keywords reference)",
				"backlog (Bind options)",
				"backup",
				"balance",
				"balance url_param",
				"base",
				"base32",
				"base64",
				"be_conn",
				"be_id",
				"be_sess_rate",
				"bind",
				"bind-process",
				"block",
				"ca-base",
				"ca-file (Bind options)",
				"ca-file (Server and default-server options)",
				"ca-ignore-err",
				"capture",
				"capture cookie",
				"capture request",
				"capture request header",
				"capture response",
				"capture response header",
				"capture.req.hdr",
				"capture.req.method",
				"capture.req.uri",
				"capture.req.ver",
				"capture.res.hdr",
				"capture.res.ver",
				"check",
				"check-send-proxy",
				"check-ssl",
				"chroot",
				"ciphers",
				"clear",
				"clear acl",
				"clear counters",
				"clear counters all",
				"clear map",
				"clear table",
				"clitimeout",
				"compression",
				"compression algo",
				"compression offload",
				"compression type",
				"connslots",
				"contimeout",
				"cook",
				"cook_cnt",
				"cook_val",
				"cookie (Alphabetically sorted keywords reference)",
				"cookie (Server and default-server options)",
				"cookie (Fetching HTTP samples (Layer 7))",
				"cpu-map",
				"crl-file (Bind options)",
				"crl-file (Server and default-server options)",
				"crt (Bind options)",
				"crt (Server and default-server options)",
				"crt-base",
				"crt-ignore-err",
				"crt-list",
				"daemon",
				"date",
				"debug",
				"default-server",
				"default_backend",
				"defer-accept",
				"del",
				"del acl",
				"del map",
				"description (Process management and security)",
				"description (Alphabetically sorted keywords reference)",
				"disable",
				"disable agent",
				"disable frontend",
				"disable health",
				"disable server",
				"disabled (Alphabetically sorted keywords reference)",
				"disabled (Server and default-server options)",
				"dispatch",
				"downinter",
				"dst",
				"dst_conn",
				"dst_port",
				"ecdhe",
				"enable",
				"enable agent",
				"enable frontend",
				"enable health",
				"enable server",
				"enabled",
				"env",
				"error-limit",
				"errorfile",
				"errorloc",
				"errorloc302",
				"errorloc303",
				"fall",
				"fastinter",
				"fe_conn",
				"fe_id",
				"fe_sess_rate",
				"force-persist",
				"force-sslv3 (Bind options)",
				"force-sslv3 (Server and default-server options)",
				"force-tlsv10",
				"force-tlsv11",
				"force-tlsv12",
				"fullconn",
				"get",
				"get acl",
				"get map",
				"get weight",
				"gid (Process management and security)",
				"gid (Bind options)",
				"grace",
				"group (Process management and security)",
				"group (Userlists)",
				"group (Bind options)",
				"hash-type",
				"hdr",
				"hdr_cnt",
				"hdr_ip",
				"hdr_val",
				"help",
				"hex",
				"http-check",
				"http-check disable-on-404",
				"http-check expect",
				"http-check send-state",
				"http-request",
				"http-response",
				"http-send-name-header",
				"http_auth",
				"http_auth_group",
				"http_date",
				"http_first_req",
				"id (Alphabetically sorted keywords reference)",
				"id (Bind options)",
				"id (Server and default-server options)",
				"ignore-persist",
				"inter",
				"interface",
				"ipmask",
				"language",
				"level",
				"log (Process management and security)",
				"log (Alphabetically sorted keywords reference)",
				"log global",
				"log-format",
				"log-send-hostname",
				"log-tag",
				"lower",
				"map",
				"max-keep-alive-queue",
				"max-spread-checks",
				"maxcompcpuusage",
				"maxcomprate",
				"maxconn (Performance tuning)",
				"maxconn (Alphabetically sorted keywords reference)",
				"maxconn (Bind options)",
				"maxconn (Server and default-server options)",
				"maxconnrate",
				"maxpipes",
				"maxqueue",
				"maxsessrate",
				"maxsslconn",
				"maxsslrate",
				"maxzlibmem",
				"method",
				"minconn",
				"mode",
				"monitor",
				"monitor fail",
				"monitor-net",
				"monitor-uri",
				"mss",
				"name",
				"nbproc",
				"nbsrv",
				"nice",
				"no log",
				"no option",
				"no option abortonclose",
				"no option accept-invalid-http-request",
				"no option accept-invalid-http-response",
				"no option allbackups",
				"no option checkcache",
				"no option clitcpka",
				"no option dontlog-normal",
				"no option dontlognull",
				"no option forceclose",
				"no option http-keep-alive",
				"no option http-no-delay",
				"no option http-pretend-keepalive",
				"no option http-server-close",
				"no option http-tunnel",
				"no option http-use-proxy-header",
				"no option http_proxy",
				"no option httpclose",
				"no option independent-streams",
				"no option log-health-checks",
				"no option log-separate-errors",
				"no option logasap",
				"no option nolinger",
				"no option persist",
				"no option prefer-last-server",
				"no option redispatch",
				"no option socket-stats",
				"no option splice-auto",
				"no option splice-request",
				"no option splice-response",
				"no option srvtcpka",
				"no option tcp-smart-accept",
				"no option tcp-smart-connect",
				"no option transparent",
				"no-sslv3 (Bind options)",
				"no-sslv3 (Server and default-server options)",
				"no-tls-tickets",
				"no-tlsv10",
				"no-tlsv11",
				"no-tlsv12",
				"node",
				"noepoll",
				"nogetaddrinfo",
				"nokqueue",
				"non-stick",
				"nopoll",
				"nosplice",
				"npn",
				"observe",
				"on-error",
				"on-marked-down",
				"on-marked-up",
				"option",
				"option abortonclose",
				"option accept-invalid-http-request",
				"option accept-invalid-http-response",
				"option allbackups",
				"option checkcache",
				"option clitcpka",
				"option contstats",
				"option dontlog-normal",
				"option dontlognull",
				"option forceclose",
				"option forwardfor",
				"option http-keep-alive",
				"option http-no-delay",
				"option http-pretend-keepalive",
				"option http-server-close",
				"option http-tunnel",
				"option http-use-proxy-header",
				"option http_proxy",
				"option httpchk",
				"option httpclose",
				"option httplog",
				"option independent-streams",
				"option ldap-check",
				"option log-health-checks",
				"option log-separate-errors",
				"option logasap",
				"option mysql-check",
				"option nolinger",
				"option originalto",
				"option persist",
				"option pgsql-check",
				"option prefer-last-server",
				"option redis-check",
				"option redispatch",
				"option smtpchk",
				"option socket-stats",
				"option splice-auto",
				"option splice-request",
				"option splice-response",
				"option srvtcpka",
				"option ssl-hello-chk",
				"option tcp-check",
				"option tcp-smart-accept",
				"option tcp-smart-connect",
				"option tcpka",
				"option tcplog",
				"option transparent",
				"path",
				"payload",
				"payload_lv",
				"peer",
				"peers",
				"persist",
				"persist rdp-cookie",
				"pidfile",
				"port",
				"process",
				"prompt",
				"queue",
				"quiet",
				"quit",
				"rand",
				"rate-limit",
				"rate-limit sessions",
				"rdp_cookie",
				"rdp_cookie_cnt",
				"redir",
				"redirect",
				"redirect location",
				"redirect prefix",
				"redirect scheme",
				"redisp",
				"redispatch",
				"rep_ssl_hello_type",
				"req.cook",
				"req.cook_cnt",
				"req.cook_val",
				"req.fhdr",
				"req.fhdr_cnt",
				"req.hdr",
				"req.hdr_cnt",
				"req.hdr_ip",
				"req.hdr_val",
				"req.len",
				"req.payload",
				"req.payload_lv",
				"req.proto_http",
				"req.rdp_cookie",
				"req.rdp_cookie_cnt",
				"req.ssl_hello_type",
				"req.ssl_sni",
				"req.ssl_ver",
				"req.ver",
				"req_len",
				"req_proto_http",
				"req_ssl_hello_type",
				"req_ssl_sni",
				"req_ssl_ver",
				"req_ver",
				"reqadd",
				"reqallow",
				"reqdel",
				"reqdeny",
				"reqiallow",
				"reqidel",
				"reqideny",
				"reqipass",
				"reqirep",
				"reqitarpit",
				"reqpass",
				"reqrep",
				"reqtarpit",
				"res.comp",
				"res.comp_algo",
				"res.cook",
				"res.cook_cnt",
				"res.cook_val",
				"res.fhdr",
				"res.fhdr_cnt",
				"res.hdr",
				"res.hdr_cnt",
				"res.hdr_ip",
				"res.hdr_val",
				"res.len",
				"res.payload",
				"res.payload_lv",
				"res.ssl_hello_type",
				"res.ver",
				"resp_ver",
				"retries",
				"rise",
				"rspadd",
				"rspdel",
				"rspdeny",
				"rspidel",
				"rspideny",
				"rspirep",
				"rsprep",
				"sc0_bytes_in_rate",
				"sc0_bytes_out_rate",
				"sc0_clr_gpc0",
				"sc0_conn_cnt",
				"sc0_conn_cur",
				"sc0_conn_rate",
				"sc0_get_gpc0",
				"sc0_gpc0_rate",
				"sc0_http_err_cnt",
				"sc0_http_err_rate",
				"sc0_http_req_cnt",
				"sc0_http_req_rate",
				"sc0_inc_gpc0",
				"sc0_kbytes_in",
				"sc0_kbytes_out",
				"sc0_sess_cnt",
				"sc0_sess_rate",
				"sc0_tracked",
				"sc0_trackers",
				"sc1_bytes_in_rate",
				"sc1_bytes_out_rate",
				"sc1_clr_gpc0",
				"sc1_conn_cnt",
				"sc1_conn_cur",
				"sc1_conn_rate",
				"sc1_get_gpc0",
				"sc1_gpc0_rate",
				"sc1_http_err_cnt",
				"sc1_http_err_rate",
				"sc1_http_req_cnt",
				"sc1_http_req_rate",
				"sc1_inc_gpc0",
				"sc1_kbytes_in",
				"sc1_kbytes_out",
				"sc1_sess_cnt",
				"sc1_sess_rate",
				"sc1_tracked",
				"sc1_trackers",
				"sc2_bytes_in_rate",
				"sc2_bytes_out_rate",
				"sc2_clr_gpc0",
				"sc2_conn_cnt",
				"sc2_conn_cur",
				"sc2_conn_rate",
				"sc2_get_gpc0",
				"sc2_gpc0_rate",
				"sc2_http_err_cnt",
				"sc2_http_err_rate",
				"sc2_http_req_cnt",
				"sc2_http_req_rate",
				"sc2_inc_gpc0",
				"sc2_kbytes_in",
				"sc2_kbytes_out",
				"sc2_sess_cnt",
				"sc2_sess_rate",
				"sc2_tracked",
				"sc2_trackers",
				"sc_bytes_in_rate",
				"sc_bytes_out_rate",
				"sc_clr_gpc0",
				"sc_conn_cnt",
				"sc_conn_cur",
				"sc_conn_rate",
				"sc_get_gpc0",
				"sc_gpc0_rate",
				"sc_http_err_cnt",
				"sc_http_err_rate",
				"sc_http_req_cnt",
				"sc_http_req_rate",
				"sc_inc_gpc0",
				"sc_kbytes_in",
				"sc_kbytes_out",
				"sc_sess_cnt",
				"sc_sess_rate",
				"sc_tracked",
				"sc_trackers",
				"scook",
				"scook_cnt",
				"scook_val",
				"send-proxy",
				"send-proxy-v2",
				"send-proxy-v2-ssl",
				"send-proxy-v2-ssl-cn",
				"server",
				"set",
				"set map",
				"set maxconn",
				"set maxconn frontend",
				"set maxconn global",
				"set rate-limit",
				"set rate-limit connections",
				"set rate-limit connections global",
				"set rate-limit http-compression",
				"set rate-limit http-compression global",
				"set rate-limit sessions",
				"set rate-limit sessions global",
				"set rate-limit ssl-sessions",
				"set rate-limit ssl-sessions global",
				"set server",
				"set ssl",
				"set ssl ocsp-response",
				"set table",
				"set timeout",
				"set timeout cli",
				"set weight",
				"set-cookie",
				"shdr",
				"shdr_cnt",
				"shdr_ip",
				"shdr_val",
				"show",
				"show acl",
				"show errors",
				"show info",
				"show map",
				"show pools",
				"show sess",
				"show stat",
				"show table",
				"shutdown",
				"shutdown frontend",
				"shutdown session",
				"shutdown sessions",
				"slowstart",
				"so_id",
				"source (Alphabetically sorted keywords reference)",
				"source (Server and default-server options)",
				"spread-checks",
				"src",
				"src_bytes_in_rate",
				"src_bytes_out_rate",
				"src_clr_gpc0",
				"src_conn_cnt",
				"src_conn_cur",
				"src_conn_rate",
				"src_get_gpc0",
				"src_gpc0_rate",
				"src_http_err_cnt",
				"src_http_err_rate",
				"src_http_req_cnt",
				"src_http_req_rate",
				"src_inc_gpc0",
				"src_kbytes_in",
				"src_kbytes_out",
				"src_port",
				"src_sess_cnt",
				"src_sess_rate",
				"src_updt_conn_cnt",
				"srv_conn",
				"srv_id",
				"srv_is_up",
				"srv_sess_rate",
				"srvtimeout",
				"ssl (Bind options)",
				"ssl (Server and default-server options)",
				"ssl-default-bind-ciphers",
				"ssl-default-server-ciphers",
				"ssl-server-verify",
				"ssl_bc",
				"ssl_bc_alg_keysize",
				"ssl_bc_cipher",
				"ssl_bc_protocol",
				"ssl_bc_session_id",
				"ssl_bc_unique_id",
				"ssl_bc_use_keysize",
				"ssl_c_ca_err",
				"ssl_c_ca_err_depth",
				"ssl_c_err",
				"ssl_c_i_dn",
				"ssl_c_key_alg",
				"ssl_c_notafter",
				"ssl_c_notbefore",
				"ssl_c_s_dn",
				"ssl_c_serial",
				"ssl_c_sha1",
				"ssl_c_sig_alg",
				"ssl_c_used",
				"ssl_c_verify",
				"ssl_c_version",
				"ssl_f_i_dn",
				"ssl_f_key_alg",
				"ssl_f_notafter",
				"ssl_f_notbefore",
				"ssl_f_s_dn",
				"ssl_f_serial",
				"ssl_f_sha1",
				"ssl_f_sig_alg",
				"ssl_f_version",
				"ssl_fc",
				"ssl_fc_alg_keysize",
				"ssl_fc_alpn",
				"ssl_fc_cipher",
				"ssl_fc_has_crt",
				"ssl_fc_has_sni",
				"ssl_fc_npn",
				"ssl_fc_protocol",
				"ssl_fc_session_id",
				"ssl_fc_sni",
				"ssl_fc_unique_id",
				"ssl_fc_use_keysize",
				"stats (Process management and security)",
				"stats (Alphabetically sorted keywords reference)",
				"stats admin",
				"stats auth",
				"stats bind-process",
				"stats enable",
				"stats hide-version",
				"stats http-request",
				"stats maxconn",
				"stats realm",
				"stats refresh",
				"stats scope",
				"stats show-desc",
				"stats show-legends",
				"stats show-node",
				"stats socket",
				"stats timeout",
				"stats uri",
				"status",
				"stick",
				"stick match",
				"stick on",
				"stick store-request",
				"stick store-response",
				"stick-table",
				"stick-table type",
				"strict-sni",
				"table_avl",
				"table_cnt",
				"tcp-check",
				"tcp-check connect",
				"tcp-check expect",
				"tcp-check send",
				"tcp-check send-binary",
				"tcp-request",
				"tcp-request connection",
				"tcp-request content",
				"tcp-request inspect-delay",
				"tcp-response",
				"tcp-response content",
				"tcp-response inspect-delay",
				"tfo",
				"timeout",
				"timeout check",
				"timeout client",
				"timeout client-fin",
				"timeout clitimeout",
				"timeout connect",
				"timeout contimeout",
				"timeout http-keep-alive",
				"timeout http-request",
				"timeout queue",
				"timeout server",
				"timeout server-fin",
				"timeout srvtimeout",
				"timeout tarpit",
				"timeout tunnel",
				"track",
				"transparent",
				"tune.bufsize",
				"tune.chksize",
				"tune.comp.maxlevel",
				"tune.http.cookielen",
				"tune.http.maxhdr",
				"tune.idletimer",
				"tune.maxaccept",
				"tune.maxpollevents",
				"tune.maxrewrite",
				"tune.pipesize",
				"tune.rcvbuf.client",
				"tune.rcvbuf.server",
				"tune.sndbuf.client",
				"tune.sndbuf.server",
				"tune.ssl.cachesize",
				"tune.ssl.default-dh-param",
				"tune.ssl.force-private-cache",
				"tune.ssl.lifetime",
				"tune.ssl.maxrecord",
				"tune.zlib.memlevel",
				"tune.zlib.windowsize",
				"uid (Process management and security)",
				"uid (Bind options)",
				"ulimit-n",
				"unique-id-format",
				"unique-id-header",
				"unix-bind",
				"upper",
				"url",
				"url_ip",
				"url_param",
				"url_port",
				"urlp",
				"urlp_val",
				"use-server",
				"use_backend",
				"user (Process management and security)",
				"user (Userlists)",
				"user (Bind options)",
				"userlist",
				"v4v6",
				"v6only",
				"verify (Bind options)",
				"verify (Server and default-server options)",
				"verifyhost",
				"wait_end",
				"weight"
			]

			function updateKeyboardNavStatus() {
				var status = searchFocus ? '<span class="label label-disabled">Disabled</span>' : '<span class="label label-success">Enabled</span>'
				$('#keyboardNavStatus').html(status)
			}

			function search(keyword) {
				if (keyword && !!~$.inArray(keyword, keywords)) {
					window.location.hash = keyword
				}
			}
			// constructs the suggestion engine
			var kwbh = new Bloodhound({
				datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
				queryTokenizer: Bloodhound.tokenizers.whitespace,
				local: $.map(keywords, function(keyword) { return { value: keyword }; })
			});
			kwbh.initialize()

			$('#searchKeyword .typeahead').typeahead({
				hint: true,
				highlight: true,
				minLength: 1,
				autoselect: true
			},
			{
				name: 'keywords',
				displayKey: 'value',
				 source: kwbh.ttAdapter()
			}).focus(function() {
				searchFocus = true
				updateKeyboardNavStatus()
			}).blur(function() {
				searchFocus = false
				updateKeyboardNavStatus()
			}).bind('typeahead:selected', function ($e, datum) {
				search(datum.value)
			})

			/* EXPERIMENTAL - Previous/Next navigation */
			var headings = $(":header")
			var previousTarget = false
			var nextTarget = false
			var $previous = $('#previous')
			var $next = $('#next')
			function refreshNavigation() {
				var previous = false
				var next = false
				$.each(headings, function(item, value) {
					var el = $(value)

					// TODO : avoid target recalculation on each refresh
					var target = el.attr('data-target')
					if (! target) return true

					var target_el = $('#' + target.replace(/\./, "\\."))
					if (! target_el.attr('id')) return true

					if (target_el.offset().top < $(window).scrollTop()) {
						previous = el
					}
					if (target_el.offset().top - 1 > $(window).scrollTop()) {
						next = el
					}
					if (next) return false
				})

				previousTarget = previous ? previous.attr('data-target') : 'top'
				$previous.html(
					previous && previousTarget ?
						'<span class="glyphicon glyphicon-arrow-left"></span> ' + previous.text() :
						'<span class="glyphicon glyphicon-arrow-up"></span> Top'
				).attr('href', '#' + previousTarget)

				nextTarget = next ? next.attr('data-target') : 'bottom'
				$next.html(
					next && nextTarget ?
						next.text() + ' <span class="glyphicon glyphicon-arrow-right"></span>' :
						'Bottom <span class="glyphicon glyphicon-arrow-down"></span>'
				).attr('href', '#' + nextTarget)
			}

			$(window).scroll(function () {
				refreshNavigation()
			});
			$(document).ready(function() {
				refreshNavigation()
				updateKeyboardNavStatus()
			});

			/* EXPERIMENTAL - Enable keyboard navigation */
			$(document).keydown(function(e){
				if (searchFocus) return

				switch(e.which) {
					case 37: // left
					window.location.hash = previousTarget ? previousTarget : 'top'
					break

					case 39: // right
					window.location.hash = nextTarget ? nextTarget : 'bottom'
					break

					default: return // exit this handler for other keys
				}
				e.preventDefault()
			})
		</script>
		<!-- Piwik -->
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://stats.cdncdn.net/" : "http://stats.cdncdn.net/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 4);
piwikTracker.setCustomVariable (1, 'HaproxyVersion', 'version 1.6-dev0', 'page');
piwikTracker.setCustomVariable (2, 'HaproxyDconvVersion', '0.3.1-20', 'page');
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img src="http://stats.cdncdn.net/piwik.php?idsite=4" style="border:0" alt="" /></p></noscript>
<!-- End Piwik Tracking Code -->

		<a class="anchor" name="bottom"></a>
	</body>
</html>

<!-- git:v1.6-dev0 -->
